#!/usr/bin/env node
/**
 * build.js
 *
 * Spawns xterms to build all of the docker containers generated by debian.js
 *
 * Used for sweeping tests after making changes to the generators.
 */

// Dependencies
var spawn = require('child_process').spawn
var path  = require('path')

// Supported distributions
var dists       = []
dists['debian'] = []
dists['ubuntu'] = []

//Debian
dists['debian']['wheezy'] = []
dists['debian']['wheezy']['0.10.30']  = {}
dists['debian']['wheezy']['0.10.31']  = {}
dists['debian']['wheezy']['0.10.32']  = {}
dists['debian']['wheezy']['0.10.33']  = {}
dists['debian']['wheezy']['0.10.34']  = {}
dists['debian']['wheezy']['0.10.35']  = {}

dists['debian']['jessie'] = []
dists['debian']['jessie']['0.10.30']  = {}
dists['debian']['jessie']['0.10.31']  = {}
dists['debian']['jessie']['0.10.32']  = {}
dists['debian']['jessie']['0.10.33']  = {}
dists['debian']['jessie']['0.10.34']  = {}
dists['debian']['jessie']['0.10.35']  = {}

dists['debian']['sid'] = []
dists['debian']['sid']['0.10.30']     = {}
dists['debian']['sid']['0.10.31']     = {}
dists['debian']['sid']['0.10.32']     = {}
dists['debian']['sid']['0.10.33']     = {}
dists['debian']['sid']['0.10.34']     = {}
dists['debian']['sid']['0.10.35']     = {}

// Debian aliases
dists['debian']['stable']   = dists['debian']['wheezy']
dists['debian']['testing']  = dists['debian']['jessie']
dists['debian']['unstable'] = dists['debian']['sid']

// Ubuntu
dists['ubuntu']['precise']  = []
dists['ubuntu']['precise']['0.10.30'] = {}
dists['ubuntu']['precise']['0.10.31'] = {}
dists['ubuntu']['precise']['0.10.32'] = {}
dists['ubuntu']['precise']['0.10.33'] = {}
dists['ubuntu']['precise']['0.10.34'] = {}
dists['ubuntu']['precise']['0.10.35'] = {}

dists['ubuntu']['trusty']   = []
dists['ubuntu']['trusty']['0.10.30']  = {}
dists['ubuntu']['trusty']['0.10.31']  = {}
dists['ubuntu']['trusty']['0.10.32']  = {}
dists['ubuntu']['trusty']['0.10.33']  = {}
dists['ubuntu']['trusty']['0.10.34']  = {}
dists['ubuntu']['trusty']['0.10.35']  = {}

dists['ubuntu']['utopic']   = []
dists['ubuntu']['utopic']['0.10.32']  = {}
dists['ubuntu']['utopic']['0.10.33']  = {}
dists['ubuntu']['utopic']['0.10.34']  = {}
dists['ubuntu']['utopic']['0.10.35']  = {}


for(dist in dists) {
  for(release in dists[dist]) {
    for(version in dists[dist][release]) {
      var dir = path.join(dist,release,version)
      var file = path.join(dir,"Dockerfile")
      var command = "xterm"
      var args = ["-hold","-title",dir,"-e","bash -c \"cd "+dir+";docker build .\""]

      console.log("Starting "+dir)
      var child = spawn(command,args)
      child.stdout.pipe(process.stdout)
      child.stderr.pipe(process.stderr)
    }
  }
}
