# Tested image `nodesource/wheezy:4.2.5`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 67a76714e970
 ---> 9462e1cbcda2
Removing intermediate container 67a76714e970
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.5-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 27b4588bc32a
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 12 10.6M   12 1343k    0     0  1428k      0  0:00:07 --:--:--  0:00:07 1709k[0m[91m100 10.6M  100 10.6M    0     0  7196k      0  0:00:01  0:00:01 --:--:-- 8017k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (4.2.5-1nodesource1~wheezy1) ...
 ---> 94aabd19525d
Removing intermediate container 27b4588bc32a
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 1e0122f3777b
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (forever-agent@0.5.2, caseless@0.8.0, aws-sign2@0.5.0, oauth-sign@0.5.0, tunnel-agent@0.4.2, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp[0m[91m info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@4.2.5 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v4.2.5/node-v4.2.5.tar.gz
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v4.2.5/node-v4.2.5.tar.gz
[0m[91mgyp http GET[0m[91m http://nodejs.org/dist/v4.2.5/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp [0m[91m200 http://nodejs.org/dist/v4.2.5/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp[0m[91m info [0m[91mspawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
[0m[91mgyp info [0m[91mspawn args   '-I',
gyp[0m[91m info spawn args[0m[91m   '/build/config.gypi',
gyp[0m[91m [0m[91minfo spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args[0m[91m   '/root/.node-gyp/4.2.5/common.gypi',
[0m[91mgyp[0m[91m info[0m[91m spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.5',
gyp info spawn args   '-Druntime=node',
gyp [0m[91minfo[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info [0m[91mspawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp [0m[91minfo [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
[0m[91mgyp ERR! stack[0m[91m Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System[0m[91m Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp ERR! node -v v4.2.5
gyp ERR! [0m[91mpangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 08259aea28aa
Error removing intermediate container 1e0122f3777b: rmfs: Unable to remove filesystem for 1e0122f3777b79026c5918a9e4fab84ba7f3299dc79d931e737147035823255f: remove /var/lib/docker/containers/1e0122f3777b79026c5918a9e4fab84ba7f3299dc79d931e737147035823255f/shm: device or resource busy
Step 5 : ENV NODE_ENV production
 ---> Running in c40aeac89cb5
 ---> 114f1570aca8
Error removing intermediate container 1e0122f3777b: nosuchcontainer: No such container: 1e0122f3777b79026c5918a9e4fab84ba7f3299dc79d931e737147035823255f
Step 6 : WORKDIR /usr/src/app
 ---> Running in 64b947954c2a
 ---> 42db8b0d6cb6
Error removing intermediate container 1e0122f3777b: nosuchcontainer: No such container: 1e0122f3777b79026c5918a9e4fab84ba7f3299dc79d931e737147035823255f
Step 7 : CMD npm start
 ---> Running in 2e8503a77882
 ---> 1b2ceaec125e
Error removing intermediate container 1e0122f3777b: nosuchcontainer: No such container: 1e0122f3777b79026c5918a9e4fab84ba7f3299dc79d931e737147035823255f
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 275d2466c5d6
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://httpredir.debian.org wheezy Release [191 kB]
Get:6 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:7 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 4s (1805 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> b472bec9dbd0
Error removing intermediate container 1e0122f3777b: nosuchcontainer: No such container: 1e0122f3777b79026c5918a9e4fab84ba7f3299dc79d931e737147035823255f
Successfully built b472bec9dbd0

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test40`

Contents of dockerfile `/root/docker-node/.~tmp.test40/Dockerfile`:

```
FROM nodesource/wheezy:4.2.5
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:4.2.5-test1` from `/root/docker-node/.~tmp.test40`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:4.2.5
 ---> b472bec9dbd0
Step 2 : ENV NODE_ENV test
 ---> Running in 7c79a9d0e442
 ---> ab8dbb5d125a
Removing intermediate container 7c79a9d0e442
Step 3 : RUN node -v
 ---> Running in 9aee99ba20b4
v4.2.5
 ---> 7bb385a6acac
Removing intermediate container 9aee99ba20b4
Step 4 : RUN node -p "process.versions"
 ---> Running in cfb9c787595e
{ http_parser: '2.5.0',
  node: '4.2.5',
  v8: '4.5.103.35',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2e' }
 ---> abf906fe62dc
Removing intermediate container cfb9c787595e
Step 5 : RUN npm --version
 ---> Running in 9702e47d6d7e
2.14.12
 ---> a5a6a9ec9e79
Removing intermediate container 9702e47d6d7e
Successfully built a5a6a9ec9e79

```

# Tested image `nodesource/jessie:0.10.36`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in f7a050ed3e18
 ---> d4ed11f6567a
Removing intermediate container f7a050ed3e18
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.36-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 6f61f28a1025
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 3960k  100 3960k    0     0  5802k      0 --:--:-- --:--:-- --:--:-- 5806k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.36-1nodesource1~jessie1) ...
Setting up nodejs (0.10.36-1nodesource1~jessie1) ...
 ---> f3abd4bd50fa
Removing intermediate container 6f61f28a1025
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 85c0006100c1
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, tunnel-agent@0.4.2, oauth-sign@0.5.0, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.10.36 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.36/node-v0.10.36.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.36/node-v0.10.36.tar.gz
[0m[91mgyp [0m[91mhttp GET http://nodejs.org/dist/v0.10.36/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.36/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.36/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.36',
gyp info spawn args   '-Druntime=node',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.36
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> ab492cee60c3
Error removing intermediate container 85c0006100c1: rmfs: Unable to remove filesystem for 85c0006100c13712ff817e7f4044912fccb8ef86f5ff6f0a6e1f1c1dfc99cd6b: remove /var/lib/docker/containers/85c0006100c13712ff817e7f4044912fccb8ef86f5ff6f0a6e1f1c1dfc99cd6b/shm: device or resource busy
Step 5 : ENV NODE_ENV production
 ---> Running in 0fee15e20c73
 ---> e69b16188ef2
Error removing intermediate container 85c0006100c1: nosuchcontainer: No such container: 85c0006100c13712ff817e7f4044912fccb8ef86f5ff6f0a6e1f1c1dfc99cd6b
Step 6 : WORKDIR /usr/src/app
 ---> Running in 8e2dae7a29a8
 ---> 9dc03cab9072
Error removing intermediate container 85c0006100c1: nosuchcontainer: No such container: 85c0006100c13712ff817e7f4044912fccb8ef86f5ff6f0a6e1f1c1dfc99cd6b
Step 7 : CMD npm start
 ---> Running in 2d40687b4750
 ---> 61c506dfb67a
Error removing intermediate container 85c0006100c1: nosuchcontainer: No such container: 85c0006100c13712ff817e7f4044912fccb8ef86f5ff6f0a6e1f1c1dfc99cd6b
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in faf5d3d54f47
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 1s (6036 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> e8ceb0cdb5ea
Removing intermediate container 2d40687b4750
Removing intermediate container faf5d3d54f47
Error removing intermediate container 85c0006100c1: nosuchcontainer: No such container: 85c0006100c13712ff817e7f4044912fccb8ef86f5ff6f0a6e1f1c1dfc99cd6b
Successfully built e8ceb0cdb5ea

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test64`

Contents of dockerfile `/root/docker-node/.~tmp.test64/Dockerfile`:

```
FROM nodesource/jessie:0.10.36
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.10.36-test1` from `/root/docker-node/.~tmp.test64`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.10.36
 ---> e8ceb0cdb5ea
Step 2 : ENV NODE_ENV test
 ---> Running in 6283363fa081
 ---> 3245df459aa8
Removing intermediate container 6283363fa081
Step 3 : RUN node -v
 ---> Running in f0c3db3a946b
v0.10.36
 ---> 2b184c2d5f76
Removing intermediate container f0c3db3a946b
Step 4 : RUN node -p "process.versions"
 ---> Running in b026c3c0fd59
{ http_parser: '1.0',
  node: '0.10.36',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.30',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1l' }
 ---> 5e2a89c20ee8
Removing intermediate container b026c3c0fd59
Step 5 : RUN npm --version
 ---> Running in 9b3d48957ae9
1.4.28
 ---> f967d6c21971
Removing intermediate container 9b3d48957ae9
Successfully built f967d6c21971

```

# Tested image `nodesource/jessie:5.0.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in ebfdf59bacf3
 ---> 2182c45a2aff
Removing intermediate container ebfdf59bacf3
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.0.0-3nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in bc63a4d89443
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 86 6949k   86 6031k    0     0  7438k      0 --:--:-- --:--:-- --:--:-- 7437k[0m[91m100 6949k  100 6949k    0     0  7356k      0 --:--:-- --:--:-- --:--:-- 7353k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.0.0-3nodesource1~jessie1) ...
Setting up nodejs (5.0.0-3nodesource1~jessie1) ...
 ---> d20e680a4e88
Removing intermediate container bc63a4d89443
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 5f0904774a4c
[91mnpm[0m[91m [0m[91mWARN[0m[91m [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
gyp info using node@5.0.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v5.0.0/node-v5.0.0.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v5.0.0/node-v5.0.0.tar.gz
[0m[91mgyp[0m
[91m http GET http://nodejs.org/dist/v5.0.0/SHASUMS256.txt
gyp http 200 http://nodejs.org/dist/v5.0.0/SHASUMS256.txt
gyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.0.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.0.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
gyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.0.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m ---> 6cf542146386
Error removing intermediate container 5f0904774a4c: rmfs: Unable to remove filesystem for 5f0904774a4cdc200e61ebfd6db8e67da66cc0f06828dc077fa39bcad5b70956: remove /var/lib/docker/containers/5f0904774a4cdc200e61ebfd6db8e67da66cc0f06828dc077fa39bcad5b70956/shm: device or resource busy
Step 5 : ENV NODE_ENV production
 ---> Running in 9ac09434eeda
 ---> 4574360a5766
Error removing intermediate container 5f0904774a4c: nosuchcontainer: No such container: 5f0904774a4cdc200e61ebfd6db8e67da66cc0f06828dc077fa39bcad5b70956
Step 6 : WORKDIR /usr/src/app
 ---> Running in fe014a6fe2cb
 ---> da0976883776
Removing intermediate container 9ac09434eeda
Removing intermediate container fe014a6fe2cb
Error removing intermediate container 5f0904774a4c: nosuchcontainer: No such container: 5f0904774a4cdc200e61ebfd6db8e67da66cc0f06828dc077fa39bcad5b70956
Step 7 : CMD npm start
 ---> Running in 7cdb9735142e
 ---> 72f02c0a5a0f
Error removing intermediate container 5f0904774a4c: nosuchcontainer: No such container: 5f0904774a4cdc200e61ebfd6db8e67da66cc0f06828dc077fa39bcad5b70956
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 382f2bf6e97b
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (3206 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 99085852da47
Error removing intermediate container 5f0904774a4c: nosuchcontainer: No such container: 5f0904774a4cdc200e61ebfd6db8e67da66cc0f06828dc077fa39bcad5b70956
Successfully built 99085852da47

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test51`

Contents of dockerfile `/root/docker-node/.~tmp.test51/Dockerfile`:

```
FROM nodesource/jessie:5.0.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:5.0.0-test1` from `/root/docker-node/.~tmp.test51`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:5.0.0
 ---> 99085852da47
Step 2 : ENV NODE_ENV test
 ---> Running in a9c32c235d83
 ---> edae4de59b4c
Removing intermediate container a9c32c235d83
Step 3 : RUN node -v
 ---> Running in e5d48df92c4b
v5.0.0
 ---> bdacd2da80b1
Removing intermediate container e5d48df92c4b
Step 4 : RUN node -p "process.versions"
 ---> Running in ac4eddf3f888
{ http_parser: '2.5.0',
  node: '5.0.0',
  v8: '4.6.85.28',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '52.1',
  modules: '47',
  openssl: '1.0.2d' }
 ---> 8d07bcb0f385
Removing intermediate container ac4eddf3f888
Step 5 : RUN npm --version
 ---> Running in c6b54edc7a0f
3.3.6
 ---> 3dac981b63e4
Removing intermediate container c6b54edc7a0f
Successfully built 3dac981b63e4

```

# Tested image `nodesource/jessie:0.10.41`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 007af2b6bda8
 ---> 8d5409f8d377
Removing intermediate container 007af2b6bda8
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.41-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 57d14a72e840
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  [0m[91mUpload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --[0m[91m:--:--  [0m[91m [0m[91m  0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 4281k  100 4281k    0     0  4193k      0  0:00:01  0:00:01 --:--:-- 4198k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.41-1nodesource1~jessie1) ...
Setting up nodejs (0.10.41-1nodesource1~jessie1) ...
 ---> ae55ca20a1ee
Removing intermediate container 57d14a72e840
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in e4b9e1038473
[91mnpm WARN deprecated This version of npm lacks support for important features,
npm WARN deprecated such as scoped packages, offered by the primary npm
npm WARN deprecated registry. Consider upgrading to at least npm@2, if not the
npm WARN deprecated latest stable version. To upgrade to npm@2, run:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest-2
npm WARN deprecated 
npm WARN deprecated To upgrade to the latest stable version, run:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest
npm WARN deprecated 
npm WARN deprecated (Depending on how Node.js was installed on your system, you
npm WARN deprecated may need to prefix the preceding commands with `sudo`, or if
npm WARN deprecated on Windows, run them from an Administrator prompt.)
npm WARN deprecated 
npm WARN deprecated If you're running the version of npm bundled with
npm WARN deprecated Node.js 0.10 LTS, be aware that the next version of 0.10 LTS
npm WARN deprecated will be bundled with a version of npm@2, which has some small
npm WARN deprecated backwards-incompatible changes made to `npm run-script` and
npm WARN deprecated semver behavior.
[0m[91mnpm[0m[91m [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ fstream@1.0.8 (graceful-fs@4.1.3, inherits@2.0.1)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, hawk@1.1.1, bl@0.9.5, form-data@0.2.0)
[91mnpm[0m[91m WARN deprecated This version of npm lacks support for important features,
npm WARN deprecated such as scoped packages, offered by the primary npm
[0m[91mnpm WARN deprecated registry. Consider upgrading to at least npm@2, if not the
npm WARN deprecated latest stable version. To upgrade to npm@2, run:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest-2
npm WARN deprecated 
npm WARN [0m[91mdeprecated To upgrade to the latest stable version, run:
npm [0m[91mWARN deprecated 
npm WARN deprecated   npm -g install npm@latest
npm WARN deprecated 
[0m[91mnpm WARN[0m[91m [0m[91mdeprecated[0m[91m (Depending on how Node.js was installed on your system, you
[0m[91mnpm[0m[91m [0m[91mWARN[0m[91m [0m[91mdeprecated[0m[91m may need to prefix the preceding commands with `sudo`, or if
[0m[91mnpm WARN[0m[91m deprecated on Windows, run them from an Administrator prompt.)
[0m[91mnpm WARN deprecated 
npm WARN deprecated If you're running the version of npm bundled with
npm WARN deprecated Node.js 0.10 LTS, be aware that the next version of 0.10 LTS
npm WARN deprecated will be bundled with a version of npm@2, which has some small
npm WARN deprecated backwards-incompatible changes made to `npm run-script` and
npm WARN deprecated semver behavior.
[0m[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp info [0m[91musing pangyp@2.3.3
[0m[91mgyp info using node@0.10.41 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.10.41/node-v0.10.41.tar.gz
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v0.10.41/node-v0.10.41.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.41/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.41/SHASUMS256.txt
[0m[91mgyp [0m[91minfo spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.41/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.41',
gyp info[0m[91m [0m[91mspawn args[0m[91m   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args[0m[91m   '--depth=.',
gyp info [0m[91mspawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args[0m[91m   'build',
gyp info [0m[91mspawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.41
gyp ERR! pangyp -v v2.3.3
gyp [0m[91mERR! [0m[91mnot ok 
[0m
 ---> a172bf698f8f
Removing intermediate container e4b9e1038473
Step 5 : ENV NODE_ENV production
 ---> Running in 30a3c6ad856b
 ---> 6de06b0c5524
Removing intermediate container 30a3c6ad856b
Step 6 : WORKDIR /usr/src/app
 ---> Running in f7d377203e68
 ---> f52dd98f901a
Removing intermediate container f7d377203e68
Step 7 : CMD npm start
 ---> Running in 0bc817ed0944
 ---> 54ab751e2e5f
Removing intermediate container 0bc817ed0944
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 72de74b236dc
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:4 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:5 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (2694 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> ece5697284f3
Removing intermediate container 72de74b236dc
Successfully built ece5697284f3

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test69`

Contents of dockerfile `/root/docker-node/.~tmp.test69/Dockerfile`:

```
FROM nodesource/jessie:0.10.41
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.10.41-test1` from `/root/docker-node/.~tmp.test69`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.10.41
 ---> ece5697284f3
Step 2 : ENV NODE_ENV test
 ---> Running in fe447024a245
 ---> 48f8d706c70a
Removing intermediate container fe447024a245
Step 3 : RUN node -v
 ---> Running in 668b219d12c2
v0.10.41
 ---> 6c656cbf7a27
Removing intermediate container 668b219d12c2
Step 4 : RUN node -p "process.versions"
 ---> Running in 5729710a6094
{ http_parser: '1.0',
  node: '0.10.41',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1q' }
 ---> 1286ebe13fb5
Removing intermediate container 5729710a6094
Step 5 : RUN npm --version
 ---> Running in 82fb17ce8d0a
1.4.29
 ---> 04b192595e19
Removing intermediate container 82fb17ce8d0a
Successfully built 04b192595e19

```

# Tested image `nodesource/wheezy:5.4.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in d91bd55a43fb
 ---> 2939f4a73450
Removing intermediate container d91bd55a43fb
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.4.0-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 533396a95d7f
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  9 10.7M    9 1039k    0     0  2931k      0  0:00:03 --:--:--  0:00:03 3189k[0m[91m100 10.7M  100 10.7M    0     0  9915k      0  0:00:01  0:00:01 --:--:--  9.9M
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (5.4.0-1nodesource1~wheezy1) ...
 ---> c01467e5cfc2
Removing intermediate container 533396a95d7f
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 8013d241539a
[91mnpm[0m[91m [0m[91mWARN deprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@5.4.0 | linux | x64
[0m[91mgyp http [0m[91mGET http://nodejs.org/dist/v5.4.0/node-v5.4.0.tar.gz
[0m[91mgyp http 200[0m[91m http://nodejs.org/dist/v5.4.0/node-v5.4.0.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v5.4.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v5.4.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.4.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.4.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.4.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 53809f40ca8c
Error removing intermediate container 8013d241539a: rmfs: Unable to remove filesystem for 8013d241539ae603754086664f9ccc05170f2290669ec67de63737f441d4f635: remove /var/lib/docker/containers/8013d241539ae603754086664f9ccc05170f2290669ec67de63737f441d4f635/shm: device or resource busy
Step 5 : ENV NODE_ENV production
 ---> Running in 99636703fdd7
 ---> 65e5b3f71ece
Error removing intermediate container 8013d241539a: nosuchcontainer: No such container: 8013d241539ae603754086664f9ccc05170f2290669ec67de63737f441d4f635
Step 6 : WORKDIR /usr/src/app
 ---> Running in d077cdb1151a
 ---> 1bffeb3894fc
Error removing intermediate container 8013d241539a: nosuchcontainer: No such container: 8013d241539ae603754086664f9ccc05170f2290669ec67de63737f441d4f635
Step 7 : CMD npm start
 ---> Running in 91b267365a8f
 ---> 58dc864ecf12
Error removing intermediate container 8013d241539a: nosuchcontainer: No such container: 8013d241539ae603754086664f9ccc05170f2290669ec67de63737f441d4f635
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 7e324aae270d
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 2s (3162 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 8bc26bc3bdf7
Removing intermediate container 91b267365a8f
Removing intermediate container 7e324aae270d
Error removing intermediate container 8013d241539a: nosuchcontainer: No such container: 8013d241539ae603754086664f9ccc05170f2290669ec67de63737f441d4f635
Successfully built 8bc26bc3bdf7

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test43`

Contents of dockerfile `/root/docker-node/.~tmp.test43/Dockerfile`:

```
FROM nodesource/wheezy:5.4.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:5.4.0-test1` from `/root/docker-node/.~tmp.test43`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:5.4.0
 ---> 8bc26bc3bdf7
Step 2 : ENV NODE_ENV test
 ---> Running in 46d0dd54ac12
 ---> 7d8b7bb5b8d5
Removing intermediate container 46d0dd54ac12
Step 3 : RUN node -v
 ---> Running in 09b3b97d01b0
v5.4.0
 ---> 8630109314d8
Removing intermediate container 09b3b97d01b0
Step 4 : RUN node -p "process.versions"
 ---> Running in 70ca1d3a0efd
{ http_parser: '2.6.0',
  node: '5.4.0',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> eb3a1f2b434e
Removing intermediate container 70ca1d3a0efd
Step 5 : RUN npm --version
 ---> Running in bc913fb236a6
3.3.12
 ---> 5782f884451a
Removing intermediate container bc913fb236a6
Successfully built 5782f884451a

```

# Tested image `nodesource/wheezy:4.2.3`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in f45467ddd2bb
 ---> cb240641e815
Removing intermediate container f45467ddd2bb
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.3-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in cefbe6aded3f
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 11 10.4M   11 1247k    0     0  2094k      0  0:00:05 --:--:--  0:00:05 2196k[0m[91m100 10.4M  100 10.4M    0     0  8749k      0  0:00:01  0:00:01 --:--:-- 8962k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (4.2.3-1nodesource1~wheezy1) ...
 ---> 8f2749c28a38
Removing intermediate container cefbe6aded3f
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in feb3a04520c9
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (forever-agent@0.5.2, aws-sign2@0.5.0, caseless@0.8.0, oauth-sign@0.5.0, tunnel-agent@0.4.2, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with[0m[91m ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@4.2.3 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v4.2.3/node-v4.2.3.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.3/node-v4.2.3.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.2.3/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.3/SHASUMS256.txt
[0m[91mgyp[0m[91m info spawn python
[0m[91mgyp info spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp[0m[91m [0m[91minfo spawn args   'binding.gyp',
gyp info [0m[91mspawn args   '-f',
gyp[0m[91m info spawn args   'make',
gyp info spawn args   '-I',
[0m[91mgyp [0m[91minfo spawn args[0m[91m   '/build/config.gypi',
[0m[91mgyp info spawn args   '-I',
[0m[91mgyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp [0m[91minfo spawn args[0m[91m   '-I',
gyp [0m[91minfo [0m[91mspawn args[0m[91m   '/root/.node-gyp/4.2.3/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.3',
gyp info spawn args   '-Druntime=node',
gyp[0m[91m info spawn args[0m[91m   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.2.3
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 33712ff1e9e3
Error removing intermediate container feb3a04520c9: rmfs: Unable to remove filesystem for feb3a04520c9d03212d8ba2cf496414bc9a53ee4712fb747375fa0073ffb7a3f: remove /var/lib/docker/containers/feb3a04520c9d03212d8ba2cf496414bc9a53ee4712fb747375fa0073ffb7a3f/shm: device or resource busy
Step 5 : ENV NODE_ENV production
 ---> Running in 7932bc610511
 ---> 1b117dfaff92
Error removing intermediate container feb3a04520c9: nosuchcontainer: No such container: feb3a04520c9d03212d8ba2cf496414bc9a53ee4712fb747375fa0073ffb7a3f
Step 6 : WORKDIR /usr/src/app
 ---> Running in 9722a4192441
 ---> d42119183bf8
Error removing intermediate container feb3a04520c9: nosuchcontainer: No such container: feb3a04520c9d03212d8ba2cf496414bc9a53ee4712fb747375fa0073ffb7a3f
Step 7 : CMD npm start
 ---> Running in 6d1ba108df4c
 ---> f0b8e9f592de
Removing intermediate container 9722a4192441
Removing intermediate container 6d1ba108df4c
Error removing intermediate container feb3a04520c9: nosuchcontainer: No such container: feb3a04520c9d03212d8ba2cf496414bc9a53ee4712fb747375fa0073ffb7a3f
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in e775985ae55f
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 2s (3410 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 4907cde1296e
Error removing intermediate container feb3a04520c9: nosuchcontainer: No such container: feb3a04520c9d03212d8ba2cf496414bc9a53ee4712fb747375fa0073ffb7a3f
Successfully built 4907cde1296e

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test38`

Contents of dockerfile `/root/docker-node/.~tmp.test38/Dockerfile`:

```
FROM nodesource/wheezy:4.2.3
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:4.2.3-test1` from `/root/docker-node/.~tmp.test38`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:4.2.3
 ---> 4907cde1296e
Step 2 : ENV NODE_ENV test
 ---> Running in b9934e8c96dc
 ---> 2aafb5decae2
Removing intermediate container b9934e8c96dc
Step 3 : RUN node -v
 ---> Running in 60546caae491
v4.2.3
 ---> e650d093c058
Removing intermediate container 60546caae491
Step 4 : RUN node -p "process.versions"
 ---> Running in 7eaa6ba94558
{ http_parser: '2.5.0',
  node: '4.2.3',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2e' }
 ---> d79035c4aa93
Removing intermediate container 7eaa6ba94558
Step 5 : RUN npm --version
 ---> Running in 12e54246bcff
2.14.7
 ---> 3d235427db39
Removing intermediate container 12e54246bcff
Successfully built 3d235427db39

```

# Tested image `nodesource/jessie:5.4.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in e2812b889c4e
 ---> 5ccd6376aa57
Removing intermediate container e2812b889c4e
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.4.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 6f986a163b3c
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  3 8515k    3  319k    0     0   709k      0  0:00:12 --:--:--  0:00:12  708k[0m[91m 68 8515k   68 5855k    0     0  4244k      0  0:00:02  0:00:01  0:00:01 4243k[0m[91m100 8515k  100 8515k    0     0  5381k      0  0:00:01  0:00:01 --:--:-- 5379k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.4.0-1nodesource1~jessie1) ...
Setting up nodejs (5.4.0-1nodesource1~jessie1) ...
 ---> 191ca7a20f09
Removing intermediate container 6f986a163b3c
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 569624c90126
[91mnpm[0m[91m [0m[91mWARN[0m[91m [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using[0m[91m pangyp@2.3.3
gyp info using node@5.4.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v5.4.0/node-v5.4.0.tar.gz
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v5.4.0/node-v5.4.0.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v5.4.0/SHASUMS256.txt
gyp http 200 http://nodejs.org/dist/v5.4.0/SHASUMS256.txt
gyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.4.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.4.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
gyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.4.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> c0eb0ce317ac
Error removing intermediate container 569624c90126: rmfs: Unable to remove filesystem for 569624c90126c5454d54a33f486d467e24cd539ade98457a911da9552053a11b: remove /var/lib/docker/containers/569624c90126c5454d54a33f486d467e24cd539ade98457a911da9552053a11b/shm: device or resource busy
Step 5 : ENV NODE_ENV production
 ---> Running in 82e55aaa3fad
 ---> cca199eea994
Error removing intermediate container 569624c90126: nosuchcontainer: No such container: 569624c90126c5454d54a33f486d467e24cd539ade98457a911da9552053a11b
Step 6 : WORKDIR /usr/src/app
 ---> Running in ad23e29322ce
 ---> ea7e6ebed275
Removing intermediate container 82e55aaa3fad
Removing intermediate container ad23e29322ce
Error removing intermediate container 569624c90126: nosuchcontainer: No such container: 569624c90126c5454d54a33f486d467e24cd539ade98457a911da9552053a11b
Step 7 : CMD npm start
 ---> Running in d8a8ef352216
 ---> 086df3779e29
Error removing intermediate container 569624c90126: nosuchcontainer: No such container: 569624c90126c5454d54a33f486d467e24cd539ade98457a911da9552053a11b
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 611f0ca05e00
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3678 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> ff222dce802d
Error removing intermediate container 569624c90126: nosuchcontainer: No such container: 569624c90126c5454d54a33f486d467e24cd539ade98457a911da9552053a11b
Successfully built ff222dce802d

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test89`

Contents of dockerfile `/root/docker-node/.~tmp.test89/Dockerfile`:

```
FROM nodesource/jessie:5.4.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:5.4.0-test1` from `/root/docker-node/.~tmp.test89`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:5.4.0
 ---> ff222dce802d
Step 2 : ENV NODE_ENV test
 ---> Running in 522b151918db
 ---> 943b743c1763
Removing intermediate container 522b151918db
Step 3 : RUN node -v
 ---> Running in a8fd7063f526
v5.4.0
 ---> 9229c8ee1c9a
Removing intermediate container a8fd7063f526
Step 4 : RUN node -p "process.versions"
 ---> Running in 7586adaa9299
{ http_parser: '2.6.0',
  node: '5.4.0',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> 4ef1ca2b93c0
Removing intermediate container 7586adaa9299
Step 5 : RUN npm --version
 ---> Running in ad72ea0d06cb
3.3.12
 ---> 69abe59cb265
Removing intermediate container ad72ea0d06cb
Successfully built 69abe59cb265

```

# Tested image `nodesource/wheezy:0.12.7`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in ec50439f4428
 ---> 6e0a3535d6b5
Removing intermediate container ec50439f4428
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.7-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in ee7e1f893b43
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0   [0m[91m  0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 60 7916k   60 4815k    0     0  6044k      0  0:00:01 --:--:--  0:00:01 6361k[0m[91m[0m[91m100 7916k  100 7916k    0     0 [0m[91m 7655k      0  0:00:01  0:00:01 --:--:-- 7956k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.12.7-1nodesource1~wheezy1) ...
 ---> eb66829e2332
Removing intermediate container ee7e1f893b43
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 10106bb15db3
[91mnpm WARN [0m[91mdeprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with ok
[0m[91mgyp [0m[91minfo[0m[91m using[0m[91m pangyp@2.3.3
[0m[91mgyp info [0m[91musing node@0.12.7 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.7/node-v0.12.7.tar.gz
[0m[91mgyp http [0m[91m200 http://nodejs.org/dist/v0.12.7/node-v0.12.7.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.12.7/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.7/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.7/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.7',
gyp info spawn args   '-Druntime=node',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.7
gyp ERR! pangyp -v v2.3.3
[0m[91mgyp ERR! not ok 
[0m
 ---> a869f6856822
Removing intermediate container 10106bb15db3
Step 5 : ENV NODE_ENV production
 ---> Running in 30117ca891c9
 ---> b3fc1f212ece
Removing intermediate container 30117ca891c9
Step 6 : WORKDIR /usr/src/app
 ---> Running in 2bc753add044
 ---> 1cf6f7b26346
Removing intermediate container 2bc753add044
Step 7 : CMD npm start
 ---> Running in a015c60b6b77
 ---> 317b23a92af8
Removing intermediate container a015c60b6b77
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 1eff3a2613bd
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 3s (2326 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 851189f226e8
Removing intermediate container 1eff3a2613bd
Successfully built 851189f226e8

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test32`

Contents of dockerfile `/root/docker-node/.~tmp.test32/Dockerfile`:

```
FROM nodesource/wheezy:0.12.7
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.12.7-test1` from `/root/docker-node/.~tmp.test32`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.12.7
 ---> 851189f226e8
Step 2 : ENV NODE_ENV test
 ---> Running in 37f7b98524e5
 ---> 25e797c3a016
Removing intermediate container 37f7b98524e5
Step 3 : RUN node -v
 ---> Running in 3e90eaa7c9a8
v0.12.7
 ---> 212f2a8a3944
Removing intermediate container 3e90eaa7c9a8
Step 4 : RUN node -p "process.versions"
 ---> Running in a27afcb17cf0
{ http_parser: '2.3',
  node: '0.12.7',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1p' }
 ---> 6a0b5682d68b
Removing intermediate container a27afcb17cf0
Step 5 : RUN npm --version
 ---> Running in 23117824989c
2.11.3
 ---> 84181176788a
Removing intermediate container 23117824989c
Successfully built 84181176788a

```

# Tested image `nodesource/jessie:0.12.3`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 47c5b6f8eb50
 ---> 7906aab524ea
Removing intermediate container 47c5b6f8eb50
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.3-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in fb06fbc08add
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--   [0m[91m  0[0m[91m100 5178k  100 5178k    0     0  5299k      0 --:--:-- --:--:-- --:--:-- 5299k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.3-1nodesource1~jessie1) ...
Setting up nodejs (0.12.3-1nodesource1~jessie1) ...
 ---> e68d76f04d77
Removing intermediate container fb06fbc08add
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in ecf6c53fecc9
[91mnpm[0m[91m WARN [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN[0m[91m deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with[0m[91m ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
gyp info[0m[91m [0m[91musing node@0.12.3 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.3/node-v0.12.3.tar.gz
[0m[91mgyp http [0m[91m200 http://nodejs.org/dist/v0.12.3/node-v0.12.3.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.3/SHASUMS256.txt
[0m[91mgyp http [0m[91m200 http://nodejs.org/dist/v0.12.3/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp [0m[91minfo spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp [0m[91minfo spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp[0m[91m info spawn args   '-I',
[0m[91mgyp info spawn args   '/build/config.gypi',
gyp[0m[91m info [0m[91mspawn args   '-I',
gyp info [0m[91mspawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info[0m[91m spawn args   '-I',
gyp info[0m[91m spawn args[0m[91m   '/root/.node-gyp/0.12.3/common.gypi',
[0m[91mgyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp [0m[91minfo spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.3',
[0m[91mgyp[0m[91m [0m[91minfo[0m[91m spawn args[0m[91m   '-Druntime=node',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp[0m[91m info [0m[91mspawn args   '--no-parallel',
gyp[0m[91m info[0m[91m spawn args   '--generator-output',
[0m[91mgyp [0m[91minfo[0m[91m [0m[91mspawn args   'build',
gyp [0m[91minfo spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.3
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> cfdc5b31596e
Removing intermediate container ecf6c53fecc9
Step 5 : ENV NODE_ENV production
 ---> Running in 87684e4cbbe2
 ---> 081e3fac046d
Removing intermediate container 87684e4cbbe2
Step 6 : WORKDIR /usr/src/app
 ---> Running in 22fbfef15f1f
 ---> c69e51df20d5
Removing intermediate container 22fbfef15f1f
Step 7 : CMD npm start
 ---> Running in 11850a944fec
 ---> dccf42aaa42d
Removing intermediate container 11850a944fec
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in dc676b173c41
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3248 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 7ed067533b7c
Removing intermediate container dc676b173c41
Successfully built 7ed067533b7c

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test73`

Contents of dockerfile `/root/docker-node/.~tmp.test73/Dockerfile`:

```
FROM nodesource/jessie:0.12.3
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.12.3-test1` from `/root/docker-node/.~tmp.test73`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.12.3
 ---> 7ed067533b7c
Step 2 : ENV NODE_ENV test
 ---> Running in 5632a889606e
 ---> d6f74c60a685
Removing intermediate container 5632a889606e
Step 3 : RUN node -v
 ---> Running in 2154f2966fda
v0.12.3
 ---> e6e2cb118c61
Removing intermediate container 2154f2966fda
Step 4 : RUN node -p "process.versions"
 ---> Running in c9fb63d69197
{ http_parser: '2.3',
  node: '0.12.3',
  v8: '3.28.71.19',
  uv: '1.5.0',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1m' }
 ---> ffab5b0d365f
Removing intermediate container c9fb63d69197
Step 5 : RUN npm --version
 ---> Running in bd4b7adfb99e
2.9.1
 ---> b3109e77dd43
Removing intermediate container bd4b7adfb99e
Successfully built b3109e77dd43

```

# Tested image `nodesource/jessie:0.10.33`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 930b7a08c9c8
 ---> 6bf7f2cfbd7b
Removing intermediate container 930b7a08c9c8
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.33-2nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in a543158b183a
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 18 4048k   18  767k    0     0  2323k      0  0:00:01 --:--:--  0:00:01 2319k[0m[91m100 4048k  100 4048k    0     0  6577k      0 --:--:-- --:--:-- --:--:-- 6573k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.33-2nodesource1~jessie1) ...
Setting up nodejs (0.10.33-2nodesource1~jessie1) ...
 ---> e5c8a5579f56
Removing intermediate container a543158b183a
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in af9f2f686756
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
gyp info using node@0.10.33 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.33/node-v0.10.33.tar.gz
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v0.10.33/node-v0.10.33.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.33/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.33/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.33/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.33',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args[0m[91m   'build',
gyp [0m[91minfo spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:810:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.33
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 2748391c22ca
Removing intermediate container af9f2f686756
Step 5 : ENV NODE_ENV production
 ---> Running in e2a97d1a3f9c
 ---> 7635e6ed4d72
Removing intermediate container e2a97d1a3f9c
Step 6 : WORKDIR /usr/src/app
 ---> Running in 9cab06befd4d
 ---> 7f7626eee630
Removing intermediate container 9cab06befd4d
Step 7 : CMD npm start
 ---> Running in c331d01b327a
 ---> 9195cf46e081
Removing intermediate container c331d01b327a
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in d5dab172d79f
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (2601 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 679dd883982c
Removing intermediate container d5dab172d79f
Successfully built 679dd883982c

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test61`

Contents of dockerfile `/root/docker-node/.~tmp.test61/Dockerfile`:

```
FROM nodesource/jessie:0.10.33
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.10.33-test1` from `/root/docker-node/.~tmp.test61`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.10.33
 ---> 679dd883982c
Step 2 : ENV NODE_ENV test
 ---> Running in 2c0e069a496e
 ---> 0295f5c61f95
Removing intermediate container 2c0e069a496e
Step 3 : RUN node -v
 ---> Running in 159c9dc55512
v0.10.33
 ---> 2b2e92423364
Removing intermediate container 159c9dc55512
Step 4 : RUN node -p "process.versions"
 ---> Running in e34fa474d4ba
{ http_parser: '1.0',
  node: '0.10.33',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.29',
  zlib: '1.2.3',
  modules: '11',
  openssl: '1.0.1j' }
 ---> 5f6c94369054
Removing intermediate container e34fa474d4ba
Step 5 : RUN npm --version
 ---> Running in 6c8f8218f874
1.4.28
 ---> 71c4a04fdc9b
Removing intermediate container 6c8f8218f874
Successfully built 71c4a04fdc9b

```

# Tested image `nodesource/wheezy:0.10.38`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 19cac6323914
 ---> fe1cdee229df
Removing intermediate container 19cac6323914
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.38-1chl1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in e2d107ad956c
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                               [0m[91m  Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 30 5944k   30 1823k    0     0  2818k      0  0:00:02 --:--:--  0:00:02 2950k[0m[91m100 5944k  100 5944k    0     0  5584k      0  0:00:01  0:00:01 --:--:-- 5749k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.10.38-1chl1~wheezy1) ...
 ---> 3c603d8aaab0
Removing intermediate container e2d107ad956c
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 5b2fac735bbf
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ fstream@1.0.8 (graceful-fs@4.1.3, inherits@2.0.1)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp [0m[91minfo [0m[91musing[0m[91m pangyp@2.3.3
gyp info using node@0.10.38 | linux | x64
[0m[91mgyp [0m[91mhttp GET http://nodejs.org/dist/v0.10.38/node-v0.10.38.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.38/node-v0.10.38.tar.gz
[0m[91mgyp http GET[0m[91m http://nodejs.org/dist/v0.10.38/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.38/SHASUMS256.txt
[0m[91mgyp[0m[91m info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.38/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.38',
gyp info[0m[91m spawn args[0m[91m   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
gyp[0m[91m info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! [0m[91mconfigure error 
[0m[91mgyp ERR! [0m[91mstack Error: `gyp` failed with exit code: 1
[0m[91mgyp[0m[91m ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
[0m[91mgyp ERR! [0m[91mstack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.38
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 757c70b69c4c
Removing intermediate container 5b2fac735bbf
Step 5 : ENV NODE_ENV production
 ---> Running in 3ebfd923afa1
 ---> bfbf12a503b8
Removing intermediate container 3ebfd923afa1
Step 6 : WORKDIR /usr/src/app
 ---> Running in d188ce84e25f
 ---> 3c498b5b1a0d
Removing intermediate container d188ce84e25f
Step 7 : CMD npm start
 ---> Running in f121b4423e84
 ---> fc601d86e69b
Removing intermediate container f121b4423e84
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in f84935417079
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 1s (6156 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 85a43e521afc
Removing intermediate container f84935417079
Successfully built 85a43e521afc

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test21`

Contents of dockerfile `/root/docker-node/.~tmp.test21/Dockerfile`:

```
FROM nodesource/wheezy:0.10.38
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.10.38-test1` from `/root/docker-node/.~tmp.test21`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.10.38
 ---> 85a43e521afc
Step 2 : ENV NODE_ENV test
 ---> Running in ab238cc41e49
 ---> 8a2c2f58bd76
Removing intermediate container ab238cc41e49
Step 3 : RUN node -v
 ---> Running in 3cec9ccf5448
v0.10.38
 ---> 5d835c284ed6
Removing intermediate container 3cec9ccf5448
Step 4 : RUN node -p "process.versions"
 ---> Running in 02ded8f22db7
{ http_parser: '1.0',
  node: '0.10.38',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1m' }
 ---> 883659eae5a6
Removing intermediate container 02ded8f22db7
Step 5 : RUN npm --version
 ---> Running in 223792ee6401
1.4.28
 ---> a9971975c560
Removing intermediate container 223792ee6401
Successfully built a9971975c560

```

# Tested image `nodesource/jessie:0.12.10`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in a837dcaa3b7f
 ---> ea51fdff653a
Removing intermediate container a837dcaa3b7f
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.10-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 5fc9e0809360
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 74 6939k   74 5151k    0     0  5290k      0  0:00:01 --:--:--  0:00:01 5289k[0m[91m100 6939k  100 6939k    0     0  6285k      0  0:00:01  0:00:01 --:--:-- 6291k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.10-1nodesource1~jessie1) ...
Setting up nodejs (0.12.10-1nodesource1~jessie1) ...
 ---> 66a7dd3cd4aa
Removing intermediate container 5fc9e0809360
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 7f961762bf00
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@0.12.10 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp [0m[91mGET http://nodejs.org/dist/v0.12.10/node-v0.12.10.tar.gz
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v0.12.10/node-v0.12.10.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.10/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.10/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.10/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.10',
gyp info spawn args   '-Druntime=node',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp [0m[91minfo spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1075:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.10
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> e7f67cefa847
Removing intermediate container 7f961762bf00
Step 5 : ENV NODE_ENV production
 ---> Running in ecd59b79145c
 ---> 5c4ef186f3f6
Removing intermediate container ecd59b79145c
Step 6 : WORKDIR /usr/src/app
 ---> Running in 6a3b9e98a77d
 ---> d214b74df69d
Removing intermediate container 6a3b9e98a77d
Step 7 : CMD npm start
 ---> Running in 9708f246dfd3
 ---> e5b5fb5cbdbf
Removing intermediate container 9708f246dfd3
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in dfc2ea439b50
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie Release [148 kB]
Get:6 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 1s (6280 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> be476fdafa4d
Removing intermediate container dfc2ea439b50
Successfully built be476fdafa4d

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test71`

Contents of dockerfile `/root/docker-node/.~tmp.test71/Dockerfile`:

```
FROM nodesource/jessie:0.12.10
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.12.10-test1` from `/root/docker-node/.~tmp.test71`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.12.10
 ---> be476fdafa4d
Step 2 : ENV NODE_ENV test
 ---> Running in 095363a8fe2c
 ---> 8ea4215d8ec8
Removing intermediate container 095363a8fe2c
Step 3 : RUN node -v
 ---> Running in 1b60c71563e2
v0.12.10
 ---> 45d81d91c2c8
Removing intermediate container 1b60c71563e2
Step 4 : RUN node -p "process.versions"
 ---> Running in be833146b18e
{ http_parser: '2.3',
  node: '0.12.10',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1r' }
 ---> a4fa2815bbf2
Removing intermediate container be833146b18e
Step 5 : RUN npm --version
 ---> Running in e7bca7c6b7ff
2.14.9
 ---> aab3adde8ef5
Removing intermediate container e7bca7c6b7ff
Successfully built aab3adde8ef5

```

# Tested image `nodesource/jessie:iojs-2.0.2`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in d400b6475374
 ---> a9b32d72eb38
Removing intermediate container d400b6475374
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.0.2-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in a690017825dc
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 52 5607k   52 2927k    0     0  3824k      0  0:00:01 --:--:--  0:00:01 3822k[0m[91m100 5607k  100 5607k    0     0  6007k      0 --:--:-- --:--:-- --:--:-- 6004k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.0.2-1nodesource1~jessie1) ...
Setting up iojs (2.0.2-1nodesource1~jessie1) ...
 ---> a70ad5f580a1
Removing intermediate container a690017825dc
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in d999c553d75e
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, tunnel-agent@0.4.2, stringstream@0.0.5, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@2.0.2 | linux | x64
[0m[91mgyp http GET https://iojs.org/dist/v2.0.2/iojs-v2.0.2.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v2.0.2/iojs-v2.0.2.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v2.0.2/SHASUMS256.txt
[0m[91mgyp[0m[91m http 200 https://iojs.org/dist/v2.0.2/SHASUMS256.txt
[0m[91mgyp [0m[91minfo spawn python
[0m[91mgyp info spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp [0m[91minfo[0m[91m [0m[91mspawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args[0m[91m   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
[0m[91mgyp [0m[91minfo spawn args   '-I',
[0m[91mgyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp [0m[91minfo [0m[91mspawn args[0m[91m   '-I',
gyp info spawn args   '/root/.node-gyp/2.0.2/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info[0m[91m [0m[91mspawn args   '-Dvisibility=default',
gyp info spawn args[0m[91m   '-Dnode_root_dir=/root/.node-gyp/2.0.2',
[0m[91mgyp[0m[91m info[0m[91m spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp [0m[91minfo spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info [0m[91mspawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m
[91mERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1009:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v2.0.2
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m ---> 5cab91e26a81
Error removing intermediate container d999c553d75e: rmfs: Unable to remove filesystem for d999c553d75e284fc51eb0639597c15a638f16d08fb3d7166e94546253e53b45: remove /var/lib/docker/containers/d999c553d75e284fc51eb0639597c15a638f16d08fb3d7166e94546253e53b45/shm: device or resource busy
Step 5 : ENV NODE_ENV production
 ---> Running in 75ae1c81dd39
 ---> 87d92d8dfd1f
Error removing intermediate container d999c553d75e: nosuchcontainer: No such container: d999c553d75e284fc51eb0639597c15a638f16d08fb3d7166e94546253e53b45
Step 6 : WORKDIR /usr/src/app
 ---> Running in d7dfdf0aef9b
 ---> 74a7a0097f4a
Error removing intermediate container d999c553d75e: nosuchcontainer: No such container: d999c553d75e284fc51eb0639597c15a638f16d08fb3d7166e94546253e53b45
Step 7 : CMD npm start
 ---> Running in b8c284a1fc46
 ---> bf29be1085e3
Removing intermediate container d7dfdf0aef9b
Removing intermediate container b8c284a1fc46
Error removing intermediate container d999c553d75e: nosuchcontainer: No such container: d999c553d75e284fc51eb0639597c15a638f16d08fb3d7166e94546253e53b45
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 5704c424b3ba
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:4 http://httpredir.debian.org jessie Release [148 kB]
Get:5 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:6 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 1s (5065 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> a03c2fba0f5e
Error removing intermediate container d999c553d75e: nosuchcontainer: No such container: d999c553d75e284fc51eb0639597c15a638f16d08fb3d7166e94546253e53b45
Successfully built a03c2fba0f5e

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test98`

Contents of dockerfile `/root/docker-node/.~tmp.test98/Dockerfile`:

```
FROM nodesource/jessie:iojs-2.0.2
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-2.0.2-test1` from `/root/docker-node/.~tmp.test98`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-2.0.2
 ---> a03c2fba0f5e
Step 2 : ENV NODE_ENV test
 ---> Running in 86afb5881cd4
 ---> 1961284803cf
Removing intermediate container 86afb5881cd4
Step 3 : RUN node -v
 ---> Running in 5037efd46163
v2.0.2
 ---> a2a81fd69836
Removing intermediate container 5037efd46163
Step 4 : RUN node -p "process.versions"
 ---> Running in f18aab95a8c6
{ http_parser: '2.5.0',
  node: '2.0.2',
  v8: '4.2.77.20',
  uv: '1.5.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2a' }
 ---> f4860cf32a4d
Removing intermediate container f18aab95a8c6
Step 5 : RUN npm --version
 ---> Running in 05644d7236ff
2.9.0
 ---> d67d885c6785
Removing intermediate container 05644d7236ff
Successfully built d67d885c6785

```

# Tested image `nodesource/wheezy:0.10.31`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 50f7967a2717
 ---> 99868894b5be
Removing intermediate container 50f7967a2717
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.31-1chl1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 7c20ab6c67aa
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  S[0m[91mpeed
  0     0    0     0    0     0      0     [0m[91m 0 --:--:-- --:--:-- --:--:--     0[0m[91m  0 5800k    0 48854    0     0   174k      0  0:00:33 --:--:--  0:00:33  194k[0m[91m100 5800k  100 5800k    0     0  5832k      0 --:--:-- --:--:-- --:--:-- 6010k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.10.31-1chl1~wheezy1) ...
 ---> 2a271e9224e1
Removing intermediate container 7c20ab6c67aa
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 085bee6c5e7a
[91mnpm WARN [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@0.10.31 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.31/node-v0.10.31.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.31/node-v0.10.31.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.31/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.31/SHASUMS256.txt
[0m[91mgyp [0m[91minfo spawn python
[0m[91mgyp [0m[91minfo[0m[91m spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args[0m[91m   'make',
[0m[91mgyp[0m[91m [0m[91minfo[0m[91m [0m[91mspawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp[0m[91m info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args[0m[91m   '-I',
gyp[0m[91m info[0m[91m spawn args   '/root/.node-gyp/0.10.31/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args[0m[91m   '-Dvisibility=default',
gyp[0m[91m [0m[91minfo spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.31',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:810:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.31
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> cf7eb31ffcc5
Removing intermediate container 085bee6c5e7a
Step 5 : ENV NODE_ENV production
 ---> Running in 3b05333448c4
 ---> 622cee1f302b
Removing intermediate container 3b05333448c4
Step 6 : WORKDIR /usr/src/app
 ---> Running in 0ea384e5d1a4
 ---> 85b489659671
Removing intermediate container 0ea384e5d1a4
Step 7 : CMD npm start
 ---> Running in bf42b87a7fac
 ---> 6b52c7c7b5f0
Removing intermediate container bf42b87a7fac
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 3a9ee4a6da59
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 2s (3481 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 1016233222d5
Removing intermediate container 3a9ee4a6da59
Successfully built 1016233222d5

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test14`

Contents of dockerfile `/root/docker-node/.~tmp.test14/Dockerfile`:

```
FROM nodesource/wheezy:0.10.31
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.10.31-test1` from `/root/docker-node/.~tmp.test14`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.10.31
 ---> 1016233222d5
Step 2 : ENV NODE_ENV test
 ---> Running in ed589a9ad07c
 ---> 7ee3a8b1de17
Removing intermediate container ed589a9ad07c
Step 3 : RUN node -v
 ---> Running in 103f6eee0cc2
v0.10.31
 ---> cc1985faa51f
Removing intermediate container 103f6eee0cc2
Step 4 : RUN node -p "process.versions"
 ---> Running in 101a2feafa15
{ http_parser: '1.0',
  node: '0.10.31',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.28',
  zlib: '1.2.3',
  modules: '11',
  openssl: '1.0.1i' }
 ---> f6a277be73a5
Removing intermediate container 101a2feafa15
Step 5 : RUN npm --version
 ---> Running in 2cc4201f3c71
1.4.23
 ---> 57d240296c7a
Removing intermediate container 2cc4201f3c71
Successfully built 57d240296c7a

```

# Tested image `nodesource/wheezy:0.10.35`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 98bdb9cbe449
 ---> e372a48cfbb9
Removing intermediate container 98bdb9cbe449
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.35-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 206dbf26eaaa
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0 [0m[91m   0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 21 5942k   21 1263k    0     0  2371k      0  0:00:02 --:--:--  0:00:02 [0m[91m2502k[0m[91m100 5942k  100 5942k    0     0  5673k      0  0:00:01  0:00:01 --:--:-- 5831k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.10.35-1nodesource1~wheezy1) ...
 ---> 55224b09fd6a
Removing intermediate container 206dbf26eaaa
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in cb125b68a6c6
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with ok
[0m[91mgyp[0m[91m [0m[91minfo using pangyp@2.3.3
gyp info using node@0.10.35 | linux | x64
[0m[91mgyp [0m[91mhttp GET[0m[91m http://nodejs.org/dist/v0.10.35/node-v0.10.35.tar.gz
[0m[91mgyp[0m[91m http[0m[91m [0m[91m200 http://nodejs.org/dist/v0.10.35/node-v0.10.35.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.10.35/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.35/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.35/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.35',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp[0m[91m info [0m[91mspawn args   '--generator-output',
gyp info spawn args   'build',
gyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! [0m[91mconfigure error 
[0m[91mgyp ERR! [0m[91mstack Error: `gyp` failed with exit code: 1
gyp ERR! [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp[0m[91m ERR! [0m[91mstack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
[0m[91mgyp ERR! [0m[91mSystem Linux 3.13.0-79-generic
[0m[91mgyp ERR! command[0m[91m "node" "/usr/bin/node-gyp" "configure"
[0m[91mgyp[0m[91m ERR! [0m[91mcwd /
gyp ERR! node -v v0.10.35
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> b1a1deab4055
Removing intermediate container cb125b68a6c6
Step 5 : ENV NODE_ENV production
 ---> Running in b78260f43311
 ---> 49db6a54fb35
Removing intermediate container b78260f43311
Step 6 : WORKDIR /usr/src/app
 ---> Running in aa6bbaea6682
 ---> 8257ad6898c4
Removing intermediate container aa6bbaea6682
Step 7 : CMD npm start
 ---> Running in 22a83813410c
 ---> 430b9efb3f05
Removing intermediate container 22a83813410c
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 10de879319f6
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 2s (3212 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 2072e6ebc19f
Removing intermediate container 10de879319f6
Successfully built 2072e6ebc19f

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test18`

Contents of dockerfile `/root/docker-node/.~tmp.test18/Dockerfile`:

```
FROM nodesource/wheezy:0.10.35
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.10.35-test1` from `/root/docker-node/.~tmp.test18`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.10.35
 ---> 2072e6ebc19f
Step 2 : ENV NODE_ENV test
 ---> Running in 515dcbdec3b7
 ---> 8f9244806f34
Removing intermediate container 515dcbdec3b7
Step 3 : RUN node -v
 ---> Running in 320e16a17c0f
v0.10.35
 ---> 4a2c6dc6d3d0
Removing intermediate container 320e16a17c0f
Step 4 : RUN node -p "process.versions"
 ---> Running in 0de12644d5ab
{ http_parser: '1.0',
  node: '0.10.35',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.30',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1j' }
 ---> 2398cdc198c0
Removing intermediate container 0de12644d5ab
Step 5 : RUN npm --version
 ---> Running in 7bb8c25f8083
1.4.28
 ---> 35429189acdc
Removing intermediate container 7bb8c25f8083
Successfully built 35429189acdc

```

# Tested image `nodesource/jessie:5.3.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in e5813e8c0b8a
 ---> 81e984d17ea1
Removing intermediate container e5813e8c0b8a
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.3.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 4eb8541b1efd
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 18 8491k   18 1599k    0     0  1861k      0  0:00:04 --:--:--  0:00:04 1860k[0m[91m100 8491k  100 8491k    0     0  5314k      0  0:00:01  0:00:01 --:--:-- 5317k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.3.0-1nodesource1~jessie1) ...
Setting up nodejs (5.3.0-1nodesource1~jessie1) ...
 ---> f93887c02e58
Removing intermediate container 4eb8541b1efd
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in e2803a5d6bc7
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@5.3.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v5.3.0/node-v5.3.0.tar.gz
[0m[91mgyp[0m[91m http[0m[91m [0m[91m200 http://nodejs.org/dist/v5.3.0/node-v5.3.0.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v5.3.0/SHASUMS256.txt
gyp http 200 http://nodejs.org/dist/v5.3.0/SHASUMS256.txt
gyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.3.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.3.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
gyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.3.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 6bd721bda9a4
Error removing intermediate container e2803a5d6bc7: rmfs: Unable to remove filesystem for e2803a5d6bc7384a35bb9e1c54e0195caf81626a600b5235cde20c9b70b56251: remove /var/lib/docker/containers/e2803a5d6bc7384a35bb9e1c54e0195caf81626a600b5235cde20c9b70b56251/shm: device or resource busy
Step 5 : ENV NODE_ENV production
 ---> Running in 0250a5f737b3
 ---> 0451a3055e7b
Error removing intermediate container e2803a5d6bc7: nosuchcontainer: No such container: e2803a5d6bc7384a35bb9e1c54e0195caf81626a600b5235cde20c9b70b56251
Step 6 : WORKDIR /usr/src/app
 ---> Running in 2aadbbe9c81c
 ---> b6ff1e3af55a
Error removing intermediate container e2803a5d6bc7: nosuchcontainer: No such container: e2803a5d6bc7384a35bb9e1c54e0195caf81626a600b5235cde20c9b70b56251
Step 7 : CMD npm start
 ---> Running in 887e385a991d
 ---> 41d34b05595f
Removing intermediate container 0250a5f737b3
Removing intermediate container 2aadbbe9c81c
Removing intermediate container 887e385a991d
Error removing intermediate container e2803a5d6bc7: nosuchcontainer: No such container: e2803a5d6bc7384a35bb9e1c54e0195caf81626a600b5235cde20c9b70b56251
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 13c1757133cb
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 4s (2178 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 96a1e8e7d5d1
Error removing intermediate container e2803a5d6bc7: nosuchcontainer: No such container: e2803a5d6bc7384a35bb9e1c54e0195caf81626a600b5235cde20c9b70b56251
Successfully built 96a1e8e7d5d1

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test54`

Contents of dockerfile `/root/docker-node/.~tmp.test54/Dockerfile`:

```
FROM nodesource/jessie:5.3.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:5.3.0-test1` from `/root/docker-node/.~tmp.test54`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:5.3.0
 ---> 96a1e8e7d5d1
Step 2 : ENV NODE_ENV test
 ---> Running in a3d19b6a18a7
 ---> 1c94fc9244d9
Removing intermediate container a3d19b6a18a7
Step 3 : RUN node -v
 ---> Running in 1f53928f3d06
v5.3.0
 ---> 80a4e989bed0
Removing intermediate container 1f53928f3d06
Step 4 : RUN node -p "process.versions"
 ---> Running in 6878a819be74
{ http_parser: '2.6.0',
  node: '5.3.0',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> f1d73f0c6d53
Removing intermediate container 6878a819be74
Step 5 : RUN npm --version
 ---> Running in 37648ed88747
3.3.12
 ---> 09fec3de56eb
Removing intermediate container 37648ed88747
Successfully built 09fec3de56eb

```

# Tested image `nodesource/jessie:0.10.38`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in b02644090fe6
 ---> e9d7010279dd
Removing intermediate container b02644090fe6
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.38-1chl1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 4843156af997
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 12 3962k   12  479k    0     0  1584k      0  0:00:02 --:--:--  0:00:02 1583k[0m[91m100 3962k  100 3962k    0     0  5853k      0 --:--:-- --:--:-- --:--:-- 5852k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.38-1chl1~jessie1) ...
Setting up nodejs (0.10.38-1chl1~jessie1) ...
 ---> 85a2bee4dd9c
Removing intermediate container 4843156af997
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 8766adb15d95
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, hawk@1.1.1, form-data@0.2.0)
â””â”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using[0m[91m node@0.10.38 | linux | x64
[0m[91mgyp http[0m[91m GET http://nodejs.org/dist/v0.10.38/node-v0.10.38.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.38/node-v0.10.38.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.10.38/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.38/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp[0m[91m info spawn args[0m[91m   'binding.gyp',
[0m[91mgyp info spawn args   '-f',
gyp info spawn args   'make',
gyp [0m[91minfo spawn args[0m[91m   '-I',
[0m[91mgyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp[0m[91m info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.38/common.gypi',
gyp info spawn args[0m[91m   '-Dlibrary=shared_library',
gyp [0m[91minfo spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.38',
gyp info[0m[91m spawn args[0m[91m   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp[0m[91m [0m[91minfo spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! [0m[91mconfigure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp [0m[91mERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! [0m[91mstack[0m[91m     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! [0m[91mSystem Linux 3.13.0-79-generic
[0m[91mgyp ERR![0m[91m command[0m[91m "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.38
gyp [0m[91mERR! [0m[91mpangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> cfd69ed13753
Removing intermediate container 8766adb15d95
Step 5 : ENV NODE_ENV production
 ---> Running in 2ff83757e74b
 ---> b3999f845968
Removing intermediate container 2ff83757e74b
Step 6 : WORKDIR /usr/src/app
 ---> Running in 90bf8546a06f
 ---> aa563e39f412
Removing intermediate container 90bf8546a06f
Step 7 : CMD npm start
 ---> Running in d1ec283aff1a
 ---> 19c07c9c8655
Removing intermediate container d1ec283aff1a
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in a860a89a921e
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:4 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3924 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 73931e73b3d3
Removing intermediate container a860a89a921e
Successfully built 73931e73b3d3

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test66`

Contents of dockerfile `/root/docker-node/.~tmp.test66/Dockerfile`:

```
FROM nodesource/jessie:0.10.38
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.10.38-test1` from `/root/docker-node/.~tmp.test66`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.10.38
 ---> 73931e73b3d3
Step 2 : ENV NODE_ENV test
 ---> Running in 6cb51a17828d
 ---> f44c706066f5
Removing intermediate container 6cb51a17828d
Step 3 : RUN node -v
 ---> Running in 380c15a2e823
v0.10.38
 ---> aa206901dad1
Removing intermediate container 380c15a2e823
Step 4 : RUN node -p "process.versions"
 ---> Running in 40fb329f4ae5
{ http_parser: '1.0',
  node: '0.10.38',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1m' }
 ---> 037b25fad07c
Removing intermediate container 40fb329f4ae5
Step 5 : RUN npm --version
 ---> Running in 164416132a83
1.4.28
 ---> bdeab660e1ce
Removing intermediate container 164416132a83
Successfully built bdeab660e1ce

```

# Tested image `nodesource/wheezy:0.12.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 146cd6408bd1
 ---> 01ba695dd7ac
Removing intermediate container 146cd6408bd1
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.0-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 24a32d20e263
[91m  % Total  [0m[91m  % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0[0m[91m     0    0     0  [0m[91m    0      [0m[91m0 --:--:[0m[91m-- --:--:-- --:--:--     0[0m[91m  2 7474k    2  191k    0     0   645k      0  0:00:11 --:--:--  0:00:11  715k[0m[91m100 7474k  100 7474k    0     0  8243k      0 --:--:-- --:--:-- --:--:-- 8513k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.12.0-1nodesource1~wheezy1) ...
 ---> a2b31c4cf0ad
Removing intermediate container 24a32d20e263
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in f07099600f10
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN [0m[91mdeprecated[0m[91m graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp[0m[91m info using pangyp@2.3.3
gyp info using node@0.12.0 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.12.0/node-v0.12.0.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.0/node-v0.12.0.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.12.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.0/SHASUMS256.txt
gyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m
[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1067:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m ---> 409e392089e6
Removing intermediate container f07099600f10
Step 5 : ENV NODE_ENV production
 ---> Running in da06cd0ad3cb
 ---> 7bca2a8a0502
Removing intermediate container da06cd0ad3cb
Step 6 : WORKDIR /usr/src/app
 ---> Running in 24146275a313
 ---> f5cc4b65e2c8
Removing intermediate container 24146275a313
Step 7 : CMD npm start
 ---> Running in 3906d914ddf0
 ---> 889ce8af7104
Removing intermediate container 3906d914ddf0
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 79fa0569a912
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 4s (2050 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> f1e5fcf8efdb
Removing intermediate container 79fa0569a912
Successfully built f1e5fcf8efdb

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test25`

Contents of dockerfile `/root/docker-node/.~tmp.test25/Dockerfile`:

```
FROM nodesource/wheezy:0.12.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.12.0-test1` from `/root/docker-node/.~tmp.test25`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.12.0
 ---> f1e5fcf8efdb
Step 2 : ENV NODE_ENV test
 ---> Running in 234442637efa
 ---> d475f0cd77ed
Removing intermediate container 234442637efa
Step 3 : RUN node -v
 ---> Running in 7c300462839a
v0.12.0
 ---> 54393639a912
Removing intermediate container 7c300462839a
Step 4 : RUN node -p "process.versions"
 ---> Running in 0518d8ef04b6
{ http_parser: '2.3',
  node: '0.12.0',
  v8: '3.28.73',
  uv: '1.0.2',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1l' }
 ---> 66f21adb5a56
Removing intermediate container 0518d8ef04b6
Step 5 : RUN npm --version
 ---> Running in 1d88bf123586
2.5.1
 ---> f0cc6ed7b58d
Removing intermediate container 1d88bf123586
Successfully built f0cc6ed7b58d

```

# Tested image `nodesource/wheezy:4.1.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 7788750bb756
 ---> e27d8e8d2ba6
Removing intermediate container 7788750bb756
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.1.1-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 1bb9e3b15971
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total[0m[91m   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 47 8458k   47 4015k    0     0  5121k      0  0:00:01 --:--:--  0:00:01 6093k[0m[91m100 8458k  100 8458k    0     0  7332k      0  0:00:01  0:00:01 --:--:-- 8235k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (4.1.1-1nodesource1~wheezy1) ...
 ---> 80c40fdec952
Removing intermediate container 1bb9e3b15971
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 1a91ec9c177d
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@4.1.1 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp [0m[91mGET http://nodejs.org/dist/v4.1.1/node-v4.1.1.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.1.1/node-v4.1.1.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v4.1.1/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.1.1/SHASUMS256.txt
[0m[91mgyp[0m[91m [0m[91minfo spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.1.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.1.1',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info [0m[91mspawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.1.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 33d4013c0daa
Removing intermediate container 1a91ec9c177d
Step 5 : ENV NODE_ENV production
 ---> Running in 53a5652120ae
 ---> fce20a6e3625
Removing intermediate container 53a5652120ae
Step 6 : WORKDIR /usr/src/app
 ---> Running in 548c4a3886c6
 ---> 5e16daf35958
Removing intermediate container 548c4a3886c6
Step 7 : CMD npm start
 ---> Running in 26f3547b2dbb
 ---> 971d59e4a424
Removing intermediate container 26f3547b2dbb
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in a5259cff4b0f
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 1s (6620 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 3a791915ec5e
Removing intermediate container a5259cff4b0f
Successfully built 3a791915ec5e

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test34`

Contents of dockerfile `/root/docker-node/.~tmp.test34/Dockerfile`:

```
FROM nodesource/wheezy:4.1.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:4.1.1-test1` from `/root/docker-node/.~tmp.test34`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:4.1.1
 ---> 3a791915ec5e
Step 2 : ENV NODE_ENV test
 ---> Running in 3d364fb1c7f2
 ---> 814c347cdc4b
Removing intermediate container 3d364fb1c7f2
Step 3 : RUN node -v
 ---> Running in e1ffa39a8f45
v4.1.1
 ---> 063b9dc41a3a
Removing intermediate container e1ffa39a8f45
Step 4 : RUN node -p "process.versions"
 ---> Running in 4d0f5659e66e
{ http_parser: '2.5.0',
  node: '4.1.1',
  v8: '4.5.103.33',
  uv: '1.7.4',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '46',
  openssl: '1.0.2d' }
 ---> e7b57ba495ce
Removing intermediate container 4d0f5659e66e
Step 5 : RUN npm --version
 ---> Running in c142635a3a86
2.14.4
 ---> 1e05137ad670
Removing intermediate container c142635a3a86
Successfully built 1e05137ad670

```

# Tested image `nodesource/wheezy:0.10.41`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in d791a7df8ebf
 ---> 822e8ce3f019
Removing intermediate container d791a7df8ebf
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.41-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 78d68290bc2f
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 11 6386k   11  719k    0     0  1279k      0  0:00:04 --:--:--  0:00:04 1490k[0m[91m100 6386k  100 6386k    0     0  6966k      0 --:--:-- --:--:-- --:--:-- 7630k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.10.41-1nodesource1~wheezy1) ...
 ---> e584ed88dd24
Removing intermediate container 78d68290bc2f
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in eee723d7f549
[91mnpm[0m[91m [0m[91mWARN deprecated This version of npm lacks support for important features,
npm WARN deprecated such as scoped packages, offered by the primary npm
[0m[91mnpm WARN deprecated registry. Consider upgrading to at least npm@2, if not the
npm WARN deprecated latest stable version. To upgrade to npm@2, run:
[0m[91mnpm [0m[91mWARN deprecated 
npm WARN deprecated   npm -g install npm@latest-2
npm WARN deprecated 
npm WARN deprecated To upgrade to the latest stable version, run:
[0m[91mnpm WARN deprecated[0m[91m 
[0m[91mnpm WARN deprecated   npm -g install npm@latest
npm WARN deprecated 
npm WARN deprecated (Depending on how Node.js was installed on your system, you
npm WARN deprecated may need to prefix the preceding commands with `sudo`, or if
npm WARN deprecated on Windows, run them from an Administrator prompt.)
npm WARN deprecated 
npm WARN deprecated If you're running the version of npm bundled with
[0m[91mnpm WARN [0m[91mdeprecated Node.js 0.10 LTS, be aware that the next version of 0.10 LTS
[0m[91mnpm[0m[91m [0m[91mWARN [0m[91mdeprecated will be bundled with a version of npm@2, which has some small
[0m[91mnpm[0m[91m WARN deprecated backwards-incompatible changes made to `npm run-script` and
npm WARN [0m[91mdeprecated semver behavior.
[0m[91mnpm WARN[0m[91m [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (graceful-fs@4.1.3, inherits@2.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mnpm [0m[91mWARN deprecated This version of npm lacks support for important features,
npm WARN[0m[91m deprecated such as scoped packages, offered by the primary npm
[0m[91mnpm WARN deprecated registry. Consider upgrading to at least npm@2, if not the
npm WARN[0m[91m deprecated latest stable version. To upgrade to npm@2, run:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest-2
npm WARN deprecated 
npm WARN deprecated To upgrade to the latest stable version, run:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest
npm WARN deprecated 
npm WARN deprecated (Depending on how Node.js was installed on your system, you
npm WARN deprecated may need to prefix the preceding commands with `sudo`, or if
[0m[91mnpm WARN deprecated on Windows, run them from an Administrator prompt.)
npm WARN deprecated 
npm WARN deprecated If you're running the version of npm bundled with
npm WARN deprecated Node.js 0.10 LTS, be aware that the next version of 0.10 LTS
npm WARN deprecated will be bundled with a version of npm@2, which has some small
npm WARN deprecated backwards-incompatible changes made to `npm run-script` and
[0m[91mnpm WARN deprecated semver behavior.
[0m[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
[0m[91mgyp info using node@0.10.41 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.41/node-v0.10.41.tar.gz
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v0.10.41/node-v0.10.41.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.41/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.41/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.41/common.gypi',
[0m[91mgyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.41',
gyp info[0m[91m spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.41
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 0f02c4b1f73d
Removing intermediate container eee723d7f549
Step 5 : ENV NODE_ENV production
 ---> Running in be0853f3d8b0
 ---> 3d06d6cb363e
Removing intermediate container be0853f3d8b0
Step 6 : WORKDIR /usr/src/app
 ---> Running in a5f73fabf6c9
 ---> dac3ee896d08
Removing intermediate container a5f73fabf6c9
Step 7 : CMD npm start
 ---> Running in f1b865c94650
 ---> 6798ec06d9b9
Removing intermediate container f1b865c94650
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 05e40b75f98b
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:3 http://security.debian.org wheezy/updates Release [102 kB]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://httpredir.debian.org wheezy Release [191 kB]
Get:6 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:7 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:8 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 1s (6316 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> ed05f5fef474
Removing intermediate container 05e40b75f98b
Successfully built ed05f5fef474

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test24`

Contents of dockerfile `/root/docker-node/.~tmp.test24/Dockerfile`:

```
FROM nodesource/wheezy:0.10.41
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.10.41-test1` from `/root/docker-node/.~tmp.test24`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.10.41
 ---> ed05f5fef474
Step 2 : ENV NODE_ENV test
 ---> Running in de14a8ba953a
 ---> a15253192b92
Removing intermediate container de14a8ba953a
Step 3 : RUN node -v
 ---> Running in ca5fa4582fc3
v0.10.41
 ---> dcd6cff491bf
Removing intermediate container ca5fa4582fc3
Step 4 : RUN node -p "process.versions"
 ---> Running in ac016b739ec8
{ http_parser: '1.0',
  node: '0.10.41',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1q' }
 ---> e017526e3359
Removing intermediate container ac016b739ec8
Step 5 : RUN npm --version
 ---> Running in a5d65e25a893
1.4.29
 ---> 064cff886d9e
Removing intermediate container a5d65e25a893
Successfully built 064cff886d9e

```

# Tested image `nodesource/jessie:5.1.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in ffa2be5c7ba2
 ---> 509337b4fa82
Removing intermediate container ffa2be5c7ba2
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.1.0-2nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 6f83b23a1d0a
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 49 8330k   49 4095k    0     0  4455k      0  0:00:01 --:--:--  0:00:01 4451k[0m[91m100 8330k  100 8330k    0     0  6697k      0  0:00:01  0:00:01 --:--:-- 6702k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.1.0-2nodesource1~jessie1) ...
Setting up nodejs (5.1.0-2nodesource1~jessie1) ...
 ---> 482d070e2aaa
Removing intermediate container 6f83b23a1d0a
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 459a222303dd
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@5.1.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v5.1.0/node-v5.1.0.tar.gz
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v5.1.0/node-v5.1.0.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v5.1.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v5.1.0/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.1.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.1.0',
gyp info spawn args   '-Druntime=node',
gyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR![0m[91m configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.1.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok[0m[91m 
[0m
 ---> 42a4fb5e3cad
Removing intermediate container 459a222303dd
Step 5 : ENV NODE_ENV production
 ---> Running in dcf9f301a9aa
 ---> e60b707d91dc
Removing intermediate container dcf9f301a9aa
Step 6 : WORKDIR /usr/src/app
 ---> Running in 8961b02050ac
 ---> aebb2bd970d6
Removing intermediate container 8961b02050ac
Step 7 : CMD npm start
 ---> Running in 7ed6d2b08656
 ---> 78c59712ef4e
Removing intermediate container 7ed6d2b08656
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 204a88fbb458
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3328 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 7d7878589b7e
Removing intermediate container 204a88fbb458
Successfully built 7d7878589b7e

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test88`

Contents of dockerfile `/root/docker-node/.~tmp.test88/Dockerfile`:

```
FROM nodesource/jessie:5.1.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:5.1.0-test1` from `/root/docker-node/.~tmp.test88`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:5.1.0
 ---> 7d7878589b7e
Step 2 : ENV NODE_ENV test
 ---> Running in af02cc923942
 ---> fd956bc2ee5d
Removing intermediate container af02cc923942
Step 3 : RUN node -v
 ---> Running in 64c1b56c7f5f
v5.1.0
 ---> 28e7ba682348
Removing intermediate container 64c1b56c7f5f
Step 4 : RUN node -p "process.versions"
 ---> Running in 0e706faf9d24
{ http_parser: '2.6.0',
  node: '5.1.0',
  v8: '4.6.85.31',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2d' }
 ---> 9905f701ca7f
Removing intermediate container 0e706faf9d24
Step 5 : RUN npm --version
 ---> Running in a1e4a2069873
3.3.12
 ---> 352059dd898a
Removing intermediate container a1e4a2069873
Successfully built 352059dd898a

```

# Tested image `nodesource/jessie:iojs-1.6.4`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 383cfda8296c
 ---> 35a54408e500
Removing intermediate container 383cfda8296c
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.6.4-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in a21edffb55c6
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0[0m[91m     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 55 5297k   55[0m[91m 2943k    0     0  [0m[91m3[0m[91m9[0m[91m0[0m[91m1[0m[91mk[0m[91m [0m[91m     0  0:00:01 --:--:--  [0m[91m0:00:01 3898k[0m[91m100 5297k  100 5297k    0     0  6634k      0 --:--:-- --:--:-- --:--:-- 6630k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.6.4-1nodesource1~jessie1) ...
Setting up iojs (1.6.4-1nodesource1~jessie1) ...
 ---> 05d57c951882
Removing intermediate container a21edffb55c6
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 9ae3f62a9be4
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@1.6.4 | linux | x64
[0m[91mgyp http GET https://iojs.org/dist/v1.6.4/iojs-v1.6.4.tar.gz
[0m[91mgyp[0m[91m http 200 https://iojs.org/dist/v1.6.4/iojs-v1.6.4.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v1.6.4/SHASUMS256.txt
[0m[91mgyp http 200[0m[91m https://iojs.org/dist/v1.6.4/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.6.4/common.gypi',
[0m[91mgyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.6.4',
gyp info spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.6.4
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 0551a937f912
Removing intermediate container 9ae3f62a9be4
Step 5 : ENV NODE_ENV production
 ---> Running in dd0b0cb52b79
 ---> 4f6ce466bec1
Removing intermediate container dd0b0cb52b79
Step 6 : WORKDIR /usr/src/app
 ---> Running in 310459c01281
 ---> 0346226a726f
Removing intermediate container 310459c01281
Step 7 : CMD npm start
 ---> Running in f1370599013f
 ---> 5fa583f8868c
Removing intermediate container f1370599013f
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 665db334f62a
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (2752 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 42df206f66c3
Error removing intermediate container 665db334f62a: rmdriverfs: Driver aufs failed to remove root filesystem 665db334f62a2b4f24342205a780ec2e4d83893d08288313ae4201c1e50f767c: rename /var/lib/docker/aufs/mnt/4a5e59db21a10670d1e2e6f66f3626eb0a5cfdfed99620ef783f012fc0cd6b2e /var/lib/docker/aufs/mnt/4a5e59db21a10670d1e2e6f66f3626eb0a5cfdfed99620ef783f012fc0cd6b2e-removing: device or resource busy
Successfully built 42df206f66c3

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test96`

Contents of dockerfile `/root/docker-node/.~tmp.test96/Dockerfile`:

```
FROM nodesource/jessie:iojs-1.6.4
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-1.6.4-test1` from `/root/docker-node/.~tmp.test96`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-1.6.4
 ---> 42df206f66c3
Step 2 : ENV NODE_ENV test
 ---> Running in e94aed9e4888
 ---> 8d2db504101a
Removing intermediate container e94aed9e4888
Step 3 : RUN node -v
 ---> Running in 014164e10d46
v1.6.4
 ---> 87976b106092
Removing intermediate container 014164e10d46
Step 4 : RUN node -p "process.versions"
 ---> Running in 95c0c027c403
{ http_parser: '2.3.0',
  node: '1.6.4',
  v8: '4.1.0.27',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1m' }
 ---> 293d9e930fe4
Removing intermediate container 95c0c027c403
Step 5 : RUN npm --version
 ---> Running in 5dfd042b7b9f
2.7.5
 ---> 9511d3f3cfd1
Removing intermediate container 5dfd042b7b9f
Successfully built 9511d3f3cfd1

```

# Tested image `nodesource/jessie:iojs-1.7.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 7db6904cfdab
 ---> fe389c80edda
Removing intermediate container 7db6904cfdab
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.7.1-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 81e1e5deee87
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  9 5300k    9  479k    0     0  1340k      0  0:00:03 --:--:--  0:00:03 1339k[0m[91m100 5300k  100 5300k    0     0  5170k      0  0:00:01  0:00:01 --:--:-- 5171k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.7.1-1nodesource1~jessie1) ...
Setting up iojs (1.7.1-1nodesource1~jessie1) ...
 ---> ac0a9d2cc6d6
Removing intermediate container 81e1e5deee87
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 64ce73b24409
[91mnpm [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, mime-types@1.0.2, node-uuid@1.4.7, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with[0m[91m ok
[0m[91mgyp [0m[91minfo[0m[91m using pangyp@2.3.3
gyp info using node@1.7.1 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v1.7.1/iojs-v1.7.1.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v1.7.1/iojs-v1.7.1.tar.gz
[0m[91mgyp[0m[91m http GET[0m[91m https://iojs.org/dist/v1.7.1/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v1.7.1/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp[0m[91m info [0m[91mspawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.7.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info [0m[91mspawn args   '-Dvisibility=default',
[0m[91mgyp[0m[91m info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.7.1',
gyp [0m[91minfo[0m[91m spawn args[0m[91m   '-Druntime=iojs',
gyp info spawn args[0m[91m   '-Dmodule_root_dir=/',
[0m[91mgyp info spawn args   '--depth=.',
[0m[91mgyp info[0m[91m spawn args   '--no-parallel',
[0m[91mgyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp [0m[91minfo [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! [0m[91mstack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1009:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.7.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> a71438dfd3e2
Removing intermediate container 64ce73b24409
Step 5 : ENV NODE_ENV production
 ---> Running in ce2e9da89ef1
 ---> 7a84664fba2e
Removing intermediate container ce2e9da89ef1
Step 6 : WORKDIR /usr/src/app
 ---> Running in 6718bd245ea1
 ---> d33df8a16198
Removing intermediate container 6718bd245ea1
Step 7 : CMD npm start
 ---> Running in a5426b6de2b7
 ---> 39994c384bad
Removing intermediate container a5426b6de2b7
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in d49fe5cc8c26
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 5s (1827 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 0f6f28401716
Removing intermediate container d49fe5cc8c26
Successfully built 0f6f28401716

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test97`

Contents of dockerfile `/root/docker-node/.~tmp.test97/Dockerfile`:

```
FROM nodesource/jessie:iojs-1.7.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-1.7.1-test1` from `/root/docker-node/.~tmp.test97`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-1.7.1
 ---> 0f6f28401716
Step 2 : ENV NODE_ENV test
 ---> Running in e04c7a3410e8
 ---> 86f96864d0bf
Removing intermediate container e04c7a3410e8
Step 3 : RUN node -v
 ---> Running in 49ba2c7210d1
v1.7.1
 ---> 2beb0eec07e6
Removing intermediate container 49ba2c7210d1
Step 4 : RUN node -p "process.versions"
 ---> Running in 7a90e869c30a
{ http_parser: '2.3.0',
  node: '1.7.1',
  v8: '4.1.0.27',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1m' }
 ---> 904d128daef5
Removing intermediate container 7a90e869c30a
Step 5 : RUN npm --version
 ---> Running in 299560ca4613
2.7.6
 ---> c452b2c6f2d2
Removing intermediate container 299560ca4613
Successfully built c452b2c6f2d2

```

# Tested image `nodesource/wheezy:5.7.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 79c94e211af8
 ---> 0256e9571a7f
Removing intermediate container 79c94e211af8
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.7.0-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in d0ec683a6389
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  8 11.1M    8  943k    0     0  2778k      0  0:00:04 --:--:--  0:00:04 3034k[0m[91m100 11.1M  100 11.1M    0     0   9.7M      0  0:00:[0m[91m01  0:00:01 --:--:-- 10.0M
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (5.7.0-1nodesource1~wheezy1) ...
 ---> 841359372f51
Removing intermediate container d0ec683a6389
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 188af03ab080
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with[0m[91m ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using[0m[91m node@5.7.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v5.7.0/node-v5.7.0.tar.gz
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v5.7.0/node-v5.7.0.tar.gz
[0m[91mgyp [0m[91mhttp GET http://nodejs.org/dist/v5.7.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v5.7.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp[0m[91m info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.7.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args[0m[91m   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.7.0',
gyp[0m[91m info spawn args   '-Druntime=node',
gyp info spawn args[0m[91m   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
[0m[91mgyp[0m[91m info [0m[91mspawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:100:13)
gyp ERR! stack     at ChildProcess.emit (events.js:185:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.7.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 84b7224fc27c
Removing intermediate container 188af03ab080
Step 5 : ENV NODE_ENV production
 ---> Running in 6689be886526
 ---> 79361ba709db
Removing intermediate container 6689be886526
Step 6 : WORKDIR /usr/src/app
 ---> Running in a26a5acbdfa3
 ---> 3873ac12f34c
Removing intermediate container a26a5acbdfa3
Step 7 : CMD npm start
 ---> Running in c71dde836700
 ---> 34386adca82b
Removing intermediate container c71dde836700
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 1b49f90cb42c
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 2s (3399 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 45389bfba6f8
Removing intermediate container 1b49f90cb42c
Successfully built 45389bfba6f8

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test1`

Contents of dockerfile `/root/docker-node/.~tmp.test1/Dockerfile`:

```
FROM nodesource/wheezy:5.7.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:5.7.0-test1` from `/root/docker-node/.~tmp.test1`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:5.7.0
 ---> 45389bfba6f8
Step 2 : ENV NODE_ENV test
 ---> Running in e2d806a3c784
 ---> c4348175094b
Removing intermediate container e2d806a3c784
Step 3 : RUN node -v
 ---> Running in 9d0c8b2a8a6c
v5.7.0
 ---> e66bfb79b43b
Removing intermediate container 9d0c8b2a8a6c
Step 4 : RUN node -p "process.versions"
 ---> Running in 50bdcedfea1a
{ http_parser: '2.6.2',
  node: '5.7.0',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2f' }
 ---> b22125d108b1
Removing intermediate container 50bdcedfea1a
Step 5 : RUN npm --version
 ---> Running in 85b9bb4d2bc2
3.6.0
 ---> 08fc5b286583
Error removing intermediate container 85b9bb4d2bc2: rmdriverfs: Driver aufs failed to remove root filesystem 85b9bb4d2bc23209639ee6a546e7982a4e04c5ae5890b917acebbcf7985d7029: rename /var/lib/docker/aufs/mnt/f05af62d145cd932973a8c58ae124efdd027bbd10f862cb4d0dca0a2f3138657 /var/lib/docker/aufs/mnt/f05af62d145cd932973a8c58ae124efdd027bbd10f862cb4d0dca0a2f3138657-removing: device or resource busy
Successfully built 08fc5b286583

```

# Tested image `nodesource/jessie:0.12.9`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 58f658bf565b
 ---> 701b3143bae1
Removing intermediate container 58f658bf565b
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.9-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 7faed67e6dac
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 98 6935k   98 6831k    0     0  7561k      0 --:--:-- --:--:-- --:--:-- 7557k[0m[91m100 6935k  100 6935k    0     0  7664k      0 --:--:-- --:--:-- --:--:-- 7663k[0m[91m
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.9-1nodesource1~jessie1) ...
Setting up nodejs (0.12.9-1nodesource1~jessie1) ...
 ---> 8111eaf52a26
Removing intermediate container 7faed67e6dac
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 5ed489d8123f
[91mnpm[0m[91m [0m[91mWARN[0m[91m deprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, oauth-sign@0.5.0, tunnel-agent@0.4.2, stringstream@0.0.5, aws-sign2@0.5.0, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@0.12.9 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.9/node-v0.12.9.tar.gz
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v0.12.9/node-v0.12.9.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.12.9/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.9/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.9/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.9',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR![0m[91m configure error 
[0m
[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1075:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.9
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m ---> e72924d2c7b4
Removing intermediate container 5ed489d8123f
Step 5 : ENV NODE_ENV production
 ---> Running in c308d6d58502
 ---> 1d37bf758bbf
Removing intermediate container c308d6d58502
Step 6 : WORKDIR /usr/src/app
 ---> Running in 509ace647078
 ---> cfdfa1409f78
Removing intermediate container 509ace647078
Step 7 : CMD npm start
 ---> Running in ca646395d298
 ---> 9fc31ed4bb28
Removing intermediate container ca646395d298
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 8aa9f53a8409
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3278 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 73d27d647861
Removing intermediate container 8aa9f53a8409
Successfully built 73d27d647861

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test47`

Contents of dockerfile `/root/docker-node/.~tmp.test47/Dockerfile`:

```
FROM nodesource/jessie:0.12.9
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.12.9-test1` from `/root/docker-node/.~tmp.test47`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.12.9
 ---> 73d27d647861
Step 2 : ENV NODE_ENV test
 ---> Running in c7ce60b284bb
 ---> 55e7ad785a96
Removing intermediate container c7ce60b284bb
Step 3 : RUN node -v
 ---> Running in eae27ec05e6d
v0.12.9
 ---> 5188d5a249e8
Removing intermediate container eae27ec05e6d
Step 4 : RUN node -p "process.versions"
 ---> Running in 28f8e0de21a2
{ http_parser: '2.3',
  node: '0.12.9',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1q' }
 ---> 77972092042a
Removing intermediate container 28f8e0de21a2
Step 5 : RUN npm --version
 ---> Running in f5f1dd25b308
2.14.9
 ---> 63851cfd14d1
Removing intermediate container f5f1dd25b308
Successfully built 63851cfd14d1

```

# Tested image `nodesource/jessie:0.12.5`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 8fa23a98dc53
 ---> 7ca2217c5094
Removing intermediate container 8fa23a98dc53
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.5-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 9e09ff34afc8
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:-- [0m[91m    0[0m[91m100 5281k  100 5281k    0     0  6354k      0 --:--:-- --:--:-- --:--:-- 6348k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.5-1nodesource1~jessie1) ...
Setting up nodejs (0.12.5-1nodesource1~jessie1) ...
 ---> 4a05509c8a15
Removing intermediate container 9e09ff34afc8
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in b3d88af83faa
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.12.5 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.12.5/node-v0.12.5.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.5/node-v0.12.5.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.5/SHASUMS256.txt
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v0.12.5/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.5/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args[0m[91m   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.5',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! [0m[91mnode -v v0.12.5
gyp ERR! pangyp -v v2.3.3
[0m[91mgyp[0m[91m ERR! not ok 
[0m
 ---> b9405e1aac88
Removing intermediate container b3d88af83faa
Step 5 : ENV NODE_ENV production
 ---> Running in e56b8f65ed50
 ---> b23ca3cc7c83
Removing intermediate container e56b8f65ed50
Step 6 : WORKDIR /usr/src/app
 ---> Running in 7ed45cf03ef3
 ---> 28b5631f25da
Removing intermediate container 7ed45cf03ef3
Step 7 : CMD npm start
 ---> Running in dcd8f2205234
 ---> 7810edb9ebc7
Removing intermediate container dcd8f2205234
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in ab2bbde63bd6
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (4533 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 2610f674da7e
Removing intermediate container ab2bbde63bd6
Successfully built 2610f674da7e

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test75`

Contents of dockerfile `/root/docker-node/.~tmp.test75/Dockerfile`:

```
FROM nodesource/jessie:0.12.5
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.12.5-test1` from `/root/docker-node/.~tmp.test75`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.12.5
 ---> 2610f674da7e
Step 2 : ENV NODE_ENV test
 ---> Running in 9dd9029a476c
 ---> 733cc119e957
Removing intermediate container 9dd9029a476c
Step 3 : RUN node -v
 ---> Running in afccd886ff5f
v0.12.5
 ---> ae11b18dca5e
Removing intermediate container afccd886ff5f
Step 4 : RUN node -p "process.versions"
 ---> Running in 06ceb5f6a2ce
{ http_parser: '2.3',
  node: '0.12.5',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1o' }
 ---> 169c7e871bbf
Removing intermediate container 06ceb5f6a2ce
Step 5 : RUN npm --version
 ---> Running in f2b23746044f
2.11.2
 ---> 3cd0a858908f
Removing intermediate container f2b23746044f
Successfully built 3cd0a858908f

```

# Tested image `nodesource/jessie:5.4.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 112c919b1413
 ---> 9d933aed8fc4
Removing intermediate container 112c919b1413
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.4.1-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in f3db135cecde
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 8528k  100 8528k    0     0  8536k      0 --:--:-- --:--:-- --:--:-- 8536k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.4.1-1nodesource1~jessie1) ...
Setting up nodejs (5.4.1-1nodesource1~jessie1) ...
 ---> 9fd831267916
Removing intermediate container f3db135cecde
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 70f602b249eb
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m [0m[91mWARN[0m[91m deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@5.4.1 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v5.4.1/node-v5.4.1.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v5.4.1/node-v5.4.1.tar.gz
[0m[91mgyp http [0m[91mGET[0m[91m http://nodejs.org/dist/v5.4.1/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v5.4.1/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info[0m[91m spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.4.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.4.1',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args   'build',
[0m[91mgyp [0m[91minfo[0m[91m spawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp[0m[91m ERR! stack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR![0m[91m command[0m[91m "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp ERR! node -v v5.4.1
gyp ERR! pangyp -v v2.3.3
[0m[91mgyp ERR! not ok[0m[91m 
[0m
 ---> f052f4cbe094
Removing intermediate container 70f602b249eb
Step 5 : ENV NODE_ENV production
 ---> Running in b066182e61dd
 ---> 45ef1f931c92
Removing intermediate container b066182e61dd
Step 6 : WORKDIR /usr/src/app
 ---> Running in 0c289697aaa4
 ---> 95d90e78c7cf
Removing intermediate container 0c289697aaa4
Step 7 : CMD npm start
 ---> Running in 4c72ee1c4d22
 ---> 58a2fa46f100
Removing intermediate container 4c72ee1c4d22
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in d409e89c9b13
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3662 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> ac052c38258b
Removing intermediate container d409e89c9b13
Successfully built ac052c38258b

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test55`

Contents of dockerfile `/root/docker-node/.~tmp.test55/Dockerfile`:

```
FROM nodesource/jessie:5.4.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:5.4.1-test1` from `/root/docker-node/.~tmp.test55`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:5.4.1
 ---> ac052c38258b
Step 2 : ENV NODE_ENV test
 ---> Running in 58ffbb5dbe23
 ---> a5b0685c4d3a
Removing intermediate container 58ffbb5dbe23
Step 3 : RUN node -v
 ---> Running in 9da78cc83142
v5.4.1
 ---> 453975099d39
Removing intermediate container 9da78cc83142
Step 4 : RUN node -p "process.versions"
 ---> Running in 0ed7d00f0a4a
{ http_parser: '2.6.0',
  node: '5.4.1',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> 4c0e024cfc6e
Removing intermediate container 0ed7d00f0a4a
Step 5 : RUN npm --version
 ---> Running in b76dc5fb0510
3.3.12
 ---> 1189b6afcc83
Removing intermediate container b76dc5fb0510
Successfully built 1189b6afcc83

```

# Tested image `nodesource/wheezy:0.10.32`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 3c1867c08ecf
 ---> b5c1b45321b1
Removing intermediate container 3c1867c08ecf
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.32-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 172daee38939
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 59 5873k   59 3487k    0     0  5764k      0  0:00:01 --:--:--  0:00:01 6423k[0m[91m100 5873k  100 5873k    0     0  7484k      0 --:--:-- --:--:-- --:--:-- 8124k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.10.32-1nodesource1~wheezy1) ...
 ---> 366d615307ca
Removing intermediate container 172daee38939
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in c5983360a83f
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, http-signature@0.10.1, tough-cookie@2.2.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.10.32 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.32/node-v0.10.32.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.32/node-v0.10.32.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.10.32/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.32/SHASUMS256.txt
[0m[91mgyp[0m[91m info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp [0m[91minfo spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info [0m[91mspawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp[0m[91m info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.32/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.32',
gyp info[0m[91m spawn args[0m[91m   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args[0m[91m   'build',
gyp info [0m[91mspawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m ERR! configure error[0m[91m 
[0m[91mgyp [0m[91mERR![0m[91m stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:810:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.32
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 8690327045e6
Removing intermediate container c5983360a83f
Step 5 : ENV NODE_ENV production
 ---> Running in 8c67430d6f88
 ---> 1133b7b316f5
Removing intermediate container 8c67430d6f88
Step 6 : WORKDIR /usr/src/app
 ---> Running in 4ba8d9320ad8
 ---> 89db48a87302
Removing intermediate container 4ba8d9320ad8
Step 7 : CMD npm start
 ---> Running in 83651c78e3e9
 ---> b4d2c12634d1
Removing intermediate container 83651c78e3e9
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in cb67362492cd
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:3 http://security.debian.org wheezy/updates Release [102 kB]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://httpredir.debian.org wheezy Release [191 kB]
Get:6 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:7 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:8 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 3s (2308 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 649bb4a9f7f7
Removing intermediate container cb67362492cd
Successfully built 649bb4a9f7f7

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test15`

Contents of dockerfile `/root/docker-node/.~tmp.test15/Dockerfile`:

```
FROM nodesource/wheezy:0.10.32
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.10.32-test1` from `/root/docker-node/.~tmp.test15`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.10.32
 ---> 649bb4a9f7f7
Step 2 : ENV NODE_ENV test
 ---> Running in 8963b970a010
 ---> 0bc6bc63d7cd
Removing intermediate container 8963b970a010
Step 3 : RUN node -v
 ---> Running in dea64413c640
v0.10.32
 ---> 1f75d96bfc98
Removing intermediate container dea64413c640
Step 4 : RUN node -p "process.versions"
 ---> Running in f795df214503
{ http_parser: '1.0',
  node: '0.10.32',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.28',
  zlib: '1.2.3',
  modules: '11',
  openssl: '1.0.1i' }
 ---> 009d56b16c62
Removing intermediate container f795df214503
Step 5 : RUN npm --version
 ---> Running in 76ba6ae6ea78
1.4.28
 ---> 7c04126681f0
Removing intermediate container 76ba6ae6ea78
Successfully built 7c04126681f0

```

# Tested image `nodesource/jessie:iojs-1.8.4`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 13f6c4e14ae7
 ---> 89312dbf03a0
Removing intermediate container 13f6c4e14ae7
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.8.4-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 7e177f8794ae
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 82 5760k   82 4751k    0     0  6063k      0 --:--:-- --:--:-- --:--:-- 6060k[0m[91m100 5760k  100 5760k    0     0  6784k      0 --:--:-- --:--:-- --:--:-- 6785k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.8.4-1nodesource1~jessie1) ...
Setting up iojs (1.8.4-1nodesource1~jessie1) ...
 ---> 60951f32a40f
Removing intermediate container 7e177f8794ae
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in b7f2bb1557fd
[91mnpm[0m[91m [0m[91mWARN[0m[91m deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo [0m[91musing pangyp@2.3.3
gyp info using node@1.8.4 | linux | x64
[0m[91mgyp[0m[91m http [0m[91mGET https://iojs.org/dist/v1.8.4/iojs-v1.8.4.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v1.8.4/iojs-v1.8.4.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v1.8.4/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v1.8.4/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.8.4/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.8.4',
gyp info spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
[0m[91mgyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1009:12)
gyp ERR![0m[91m System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.8.4
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 61be8ac04f7c
Removing intermediate container b7f2bb1557fd
Step 5 : ENV NODE_ENV production
 ---> Running in 4640ab442647
 ---> f76e1e67d6a7
Removing intermediate container 4640ab442647
Step 6 : WORKDIR /usr/src/app
 ---> Running in 76a62aeebce2
 ---> 3473f20ac5aa
Removing intermediate container 76a62aeebce2
Step 7 : CMD npm start
 ---> Running in 4b33c062d8b3
 ---> 8d1873bb8ba0
Removing intermediate container 4b33c062d8b3
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in ecc52615f856
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3835 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 69eba4241641
Removing intermediate container ecc52615f856
Successfully built 69eba4241641

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test90`

Contents of dockerfile `/root/docker-node/.~tmp.test90/Dockerfile`:

```
FROM nodesource/jessie:iojs-1.8.4
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-1.8.4-test1` from `/root/docker-node/.~tmp.test90`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-1.8.4
 ---> 69eba4241641
Step 2 : ENV NODE_ENV test
 ---> Running in 2464310de98c
 ---> e0a3728ce61e
Removing intermediate container 2464310de98c
Step 3 : RUN node -v
 ---> Running in 266e98c1bef5
v1.8.4
 ---> 87f8f07827fc
Removing intermediate container 266e98c1bef5
Step 4 : RUN node -p "process.versions"
 ---> Running in 95f4c3f752cb
{ http_parser: '2.5.0',
  node: '1.8.4',
  v8: '4.1.0.27',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.2d' }
 ---> c084b34d67d4
Removing intermediate container 95f4c3f752cb
Step 5 : RUN npm --version
 ---> Running in c85e064230a7
2.9.0
 ---> bc00926a9a33
Removing intermediate container c85e064230a7
Successfully built bc00926a9a33

```

# Tested image `nodesource/wheezy:5.5.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in cc97670ea960
 ---> f8d74e0d7b42
Removing intermediate container cc97670ea960
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.5.0-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in b40a72adfbdd
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left[0m[91m  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 18 10.8M   18 2015k    0     0  2600k      0  0:00:04 --:--:--  0:00:04 2702k[0m[91m100 10.8M  100 10.8M    0     0  7341k      0  0:00:01  0:00:01 --:--:-- 7487k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (5.5.0-1nodesource1~wheezy1) ...
 ---> d818d991f5b2
Removing intermediate container b40a72adfbdd
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 2126a2609b29
[91mnpm[0m[91m WARN[0m[91m [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m [0m[91mWARN[0m[91m [0m[91mdeprecated[0m[91m graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@5.5.0 | linux | x64
gyp http GET http://nodejs.org/dist/v5.5.0/node-v5.5.0.tar.gz
gyp http 200 http://nodejs.org/dist/v5.5.0/node-v5.5.0.tar.gz
[0m[91mgyp[0m[91m http[0m[91m GET http://nodejs.org/dist/v5.5.0/SHASUMS256.txt
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v5.5.0/SHASUMS256.txt
[0m[91mgyp info[0m[91m spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info [0m[91mspawn args   '-I',
gyp[0m[91m info spawn args[0m[91m   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.5.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.5.0',
gyp info spawn args   '-Druntime=node',
gyp info[0m[91m spawn args[0m[91m   '-Dmodule_root_dir=/',
gyp[0m[91m info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
gyp [0m[91minfo [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:100:13)
gyp ERR! stack     at ChildProcess.emit (events.js:185:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.5.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 2443c6258bbe
Removing intermediate container 2126a2609b29
Step 5 : ENV NODE_ENV production
 ---> Running in 54233d2ff096
 ---> 891552b7fadb
Removing intermediate container 54233d2ff096
Step 6 : WORKDIR /usr/src/app
 ---> Running in 6a9719af2b54
 ---> c5175b50b955
Removing intermediate container 6a9719af2b54
Step 7 : CMD npm start
 ---> Running in 96607332246f
 ---> e2cad5ef60f5
Removing intermediate container 96607332246f
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in f2214b5f8889
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:3 http://security.debian.org wheezy/updates Release [102 kB]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://httpredir.debian.org wheezy Release [191 kB]
Get:6 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:7 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:8 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 1s (6163 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> b6f2b7f4b9d3
Removing intermediate container f2214b5f8889
Successfully built b6f2b7f4b9d3

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test11`

Contents of dockerfile `/root/docker-node/.~tmp.test11/Dockerfile`:

```
FROM nodesource/wheezy:5.5.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:5.5.0-test1` from `/root/docker-node/.~tmp.test11`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:5.5.0
 ---> b6f2b7f4b9d3
Step 2 : ENV NODE_ENV test
 ---> Running in d355b59ebb7a
 ---> c72aba1df819
Removing intermediate container d355b59ebb7a
Step 3 : RUN node -v
 ---> Running in 9190e985221f
v5.5.0
 ---> 4e00c0f23ba0
Removing intermediate container 9190e985221f
Step 4 : RUN node -p "process.versions"
 ---> Running in 79b2ca08d43f
{ http_parser: '2.6.0',
  node: '5.5.0',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> 314319d1a8a7
Removing intermediate container 79b2ca08d43f
Step 5 : RUN npm --version
 ---> Running in 37981aa5d884
3.3.12
 ---> f9e8404f8def
Removing intermediate container 37981aa5d884
Successfully built f9e8404f8def

```

# Tested image `nodesource/wheezy:0.10.33`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 110158c7d06d
 ---> bee0a3b6f485
Removing intermediate container 110158c7d06d
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.33-2nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in d148555d3a1d
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 41 5901k   41 2447k    0     0  4638k      0  0:00:01 --:--:--  0:00:01 5015k[0m[91m100 5901k  100 5901k    0     0  7386k      0 --:--:-- --:--:-- --:--:-- 7774k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.10.33-2nodesource1~wheezy1) ...
 ---> 94d705ef6d17
Removing intermediate container d148555d3a1d
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 93da030c8fb6
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, http-signature@0.10.1, tough-cookie@2.2.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@0.10.33 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.33/node-v0.10.33.tar.gz
[0m[91mgyp [0m[91mhttp [0m[91m200[0m[91m http://nodejs.org/dist/v0.10.33/node-v0.10.33.tar.gz
[0m[91mgyp [0m[91mhttp [0m[91mGET http://nodejs.org/dist/v0.10.33/SHASUMS256.txt
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v0.10.33/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.33/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.33',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args[0m[91m   'build',
[0m[91mgyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m ERR! configure error 
[0m[91mgyp ERR![0m[91m stack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:810:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR![0m[91m node -v[0m[91m v0.10.33
[0m[91mgyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 8a4e779f1de2
Removing intermediate container 93da030c8fb6
Step 5 : ENV NODE_ENV production
 ---> Running in d39a13a9f92f
 ---> 109e58aee21c
Removing intermediate container d39a13a9f92f
Step 6 : WORKDIR /usr/src/app
 ---> Running in 390d2e5606c1
 ---> 0893460ef7ed
Removing intermediate container 390d2e5606c1
Step 7 : CMD npm start
 ---> Running in c3a7351c650d
 ---> 9c939611b50d
Removing intermediate container c3a7351c650d
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 4ab80b6eee39
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 2s (3463 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> cd23579f2dc2
Removing intermediate container 4ab80b6eee39
Successfully built cd23579f2dc2

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test16`

Contents of dockerfile `/root/docker-node/.~tmp.test16/Dockerfile`:

```
FROM nodesource/wheezy:0.10.33
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.10.33-test1` from `/root/docker-node/.~tmp.test16`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.10.33
 ---> cd23579f2dc2
Step 2 : ENV NODE_ENV test
 ---> Running in 77162f05b458
 ---> 0ad1aa8cd232
Removing intermediate container 77162f05b458
Step 3 : RUN node -v
 ---> Running in 226432211c21
v0.10.33
 ---> 7259a6ea338c
Removing intermediate container 226432211c21
Step 4 : RUN node -p "process.versions"
 ---> Running in cbd6a390a881
{ http_parser: '1.0',
  node: '0.10.33',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.29',
  zlib: '1.2.3',
  modules: '11',
  openssl: '1.0.1j' }
 ---> 62415e6d781d
Removing intermediate container cbd6a390a881
Step 5 : RUN npm --version
 ---> Running in 974b3717b038
1.4.28
 ---> f98122fc1b28
Error removing intermediate container 974b3717b038: rmdriverfs: Driver aufs failed to remove root filesystem 974b3717b0380a675008079b10fae3067bda16a03be8f51d9bea958935cfff55: rename /var/lib/docker/aufs/mnt/6ce08b397fd1fe105002e8c265ea6b88fdf3b1314556ecc6919b82b2a3a5b837 /var/lib/docker/aufs/mnt/6ce08b397fd1fe105002e8c265ea6b88fdf3b1314556ecc6919b82b2a3a5b837-removing: device or resource busy
Successfully built f98122fc1b28

```

# Tested image `nodesource/wheezy:4.2.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 04b3cbd1a336
 ---> 1b8b5c09d466
Removing intermediate container 04b3cbd1a336
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.1-2nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 01c430d2dc16
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0  [0m[91m   0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 95 8988k   95 8591k    0     0  7472k      0  0:00:01  0:00:01 --:--:-- 7726k[0m[91m100 8988k  100 8988k    0     0  7756k      0  0:00:01  0:00:01 --:--:-- 8018k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (4.2.1-2nodesource1~wheezy1) ...
 ---> 69bea151d1cf
Removing intermediate container 01c430d2dc16
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 0a2d7dbd8f67
[91mnpm[0m[91m [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (forever-agent@0.5.2, aws-sign2@0.5.0, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp[0m[91m info using pangyp@2.3.3
[0m[91mgyp info using node@4.2.1 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v4.2.1/node-v4.2.1.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp 200 http://nodejs.org/dist/v4.2.1/node-v4.2.1.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.2.1/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.1/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.1',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args[0m[91m   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m
[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.2.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m ---> 5fb8803caa0e
Removing intermediate container 0a2d7dbd8f67
Step 5 : ENV NODE_ENV production
 ---> Running in c3d18492d5cc
 ---> 7ed5dccfaeec
Removing intermediate container c3d18492d5cc
Step 6 : WORKDIR /usr/src/app
 ---> Running in ac170a259e54
 ---> 80a5c6e7e84e
Removing intermediate container ac170a259e54
Step 7 : CMD npm start
 ---> Running in fbb2f3fc6e77
 ---> dd85710181b2
Removing intermediate container fbb2f3fc6e77
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in e66f274fe991
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 1s (4963 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> d1358bc2e093
Removing intermediate container e66f274fe991
Successfully built d1358bc2e093

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test36`

Contents of dockerfile `/root/docker-node/.~tmp.test36/Dockerfile`:

```
FROM nodesource/wheezy:4.2.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:4.2.1-test1` from `/root/docker-node/.~tmp.test36`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:4.2.1
 ---> d1358bc2e093
Step 2 : ENV NODE_ENV test
 ---> Running in f6cb78b3b157
 ---> b8562e6939cd
Removing intermediate container f6cb78b3b157
Step 3 : RUN node -v
 ---> Running in fe472a40e174
v4.2.1
 ---> f8f37ebb8cf3
Removing intermediate container fe472a40e174
Step 4 : RUN node -p "process.versions"
 ---> Running in b7aabf5f7e64
{ http_parser: '2.5.0',
  node: '4.2.1',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '46',
  openssl: '1.0.2d' }
 ---> 0208da1d0d6e
Removing intermediate container b7aabf5f7e64
Step 5 : RUN npm --version
 ---> Running in 36839c7dbf9c
2.14.7
 ---> a8483fb90f49
Removing intermediate container 36839c7dbf9c
Successfully built a8483fb90f49

```

# Tested image `nodesource/wheezy:5.6.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 35d1f92dd7e4
 ---> 6814ea2b1b06
Removing intermediate container 35d1f92dd7e4
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.6.0-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in ad4586def18f
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0 11.1M    0  111k    0     0   276k      0  0:00:41 --:--:--  0:00:41  298k[0m[91m100 11.1M  100 11.1M    0     0  8835k      0  0:00:01  0:00:01 --:--:-- 9050k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (5.6.0-1nodesource1~wheezy1) ...
 ---> 3f861ea13e4a
Removing intermediate container ad4586def18f
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 1937fe9f2fb9
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@5.6.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v5.6.0/node-v5.6.0.tar.gz
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v5.6.0/node-v5.6.0.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v5.6.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v5.6.0/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.6.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.6.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args   'build',
gyp [0m[91minfo spawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! stack[0m[91m     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! stack     at emitTwo (events.js:100:13)
gyp ERR! stack     at ChildProcess.emit (events.js:185:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.6.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 4da239d93bfd
Removing intermediate container 1937fe9f2fb9
Step 5 : ENV NODE_ENV production
 ---> Running in be3f62b1bdfc
 ---> 105520b1d67e
Removing intermediate container be3f62b1bdfc
Step 6 : WORKDIR /usr/src/app
 ---> Running in 567f3b3d29f9
 ---> 8e4ee11116f5
Removing intermediate container 567f3b3d29f9
Step 7 : CMD npm start
 ---> Running in d3f6178e6cd0
 ---> 45150d704f1d
Removing intermediate container d3f6178e6cd0
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 57cb355b39fc
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 2s (3513 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> b2e4de983d35
Removing intermediate container 57cb355b39fc
Successfully built b2e4de983d35

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test12`

Contents of dockerfile `/root/docker-node/.~tmp.test12/Dockerfile`:

```
FROM nodesource/wheezy:5.6.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:5.6.0-test1` from `/root/docker-node/.~tmp.test12`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:5.6.0
 ---> b2e4de983d35
Step 2 : ENV NODE_ENV test
 ---> Running in d52d452a4340
 ---> a9223bd9d163
Removing intermediate container d52d452a4340
Step 3 : RUN node -v
 ---> Running in 770aa6444caf
v5.6.0
 ---> fd49151b2d76
Removing intermediate container 770aa6444caf
Step 4 : RUN node -p "process.versions"
 ---> Running in 239214b0f8b2
{ http_parser: '2.6.1',
  node: '5.6.0',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2f' }
 ---> bf441341b19e
Removing intermediate container 239214b0f8b2
Step 5 : RUN npm --version
 ---> Running in fe8876afbed9
3.6.0
 ---> 025fc97fbd44
Removing intermediate container fe8876afbed9
Successfully built 025fc97fbd44

```

# Tested image `nodesource/wheezy:0.10.40`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in ea693616b51b
 ---> 8a4604d0897f
Removing intermediate container ea693616b51b
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.40-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 10cc7c6e2a7f
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 86 5946k   86 5167k    0     0  6742k      0 --:--:-- --:--:-- --:--:-- 7021k[0m[91m100 5946k  100 5946k    0     0  7213k      0 --:--:-- --:--:-- --:--:-- 7489k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.10.40-1nodesource1~wheezy1) ...
 ---> d2152bd90333
Removing intermediate container 10cc7c6e2a7f
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 1f889c50e8b3
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.10.40 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.40/node-v0.10.40.tar.gz
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v0.10.40/node-v0.10.40.tar.gz
[0m
[91mgyp http GET http://nodejs.org/dist/v0.10.40/SHASUMS256.txt
gyp http 200 http://nodejs.org/dist/v0.10.40/SHASUMS256.txt
gyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.40/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.40',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
gyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.40
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m ---> 3770a7febea8
Removing intermediate container 1f889c50e8b3
Step 5 : ENV NODE_ENV production
 ---> Running in c3b26145c4e4
 ---> 8a1e3573540e
Removing intermediate container c3b26145c4e4
Step 6 : WORKDIR /usr/src/app
 ---> Running in 4d0945146e32
 ---> a19d565468c2
Removing intermediate container 4d0945146e32
Step 7 : CMD npm start
 ---> Running in f8c5c2033791
 ---> f427d213e0a5
Removing intermediate container f8c5c2033791
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in d08407041b7c
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 2s (3545 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 8939dd32b565
Removing intermediate container d08407041b7c
Successfully built 8939dd32b565

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test23`

Contents of dockerfile `/root/docker-node/.~tmp.test23/Dockerfile`:

```
FROM nodesource/wheezy:0.10.40
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.10.40-test1` from `/root/docker-node/.~tmp.test23`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.10.40
 ---> 8939dd32b565
Step 2 : ENV NODE_ENV test
 ---> Running in 11a87502fc0b
 ---> a5d8bc655787
Removing intermediate container 11a87502fc0b
Step 3 : RUN node -v
 ---> Running in e23cf7008628
v0.10.40
 ---> fb705bad1dc6
Removing intermediate container e23cf7008628
Step 4 : RUN node -p "process.versions"
 ---> Running in 94aadbb0d3d2
{ http_parser: '1.0',
  node: '0.10.40',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1p' }
 ---> 6f8f835e3324
Removing intermediate container 94aadbb0d3d2
Step 5 : RUN npm --version
 ---> Running in 6726abab5e9b
1.4.28
 ---> acc047561b41
Removing intermediate container 6726abab5e9b
Successfully built acc047561b41

```

# Tested image `nodesource/jessie:4.2.2`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in ec7cf68bc690
 ---> 24684b3e2d36
Removing intermediate container ec7cf68bc690
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.2-2nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 4dbcd3572e2b
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  8 6845k    [0m[91m8  575k    0     0  1555k      0  0:00:04 --:--:--  0:00:04[0m[91m 1551k[0m[91m100 6845k  100 6845k    0     0  7694k      0 --:--:-- --:--:-- --:--:-- 7691k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.2.2-2nodesource1~jessie1) ...
Setting up nodejs (4.2.2-2nodesource1~jessie1) ...
 ---> 20140558bd0f
Removing intermediate container 4dbcd3572e2b
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in d7814195c6f4
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1, bl@0.9.5)
â””â”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@4.2.2 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.2.2/node-v4.2.2.tar.gz
[0m[91mgyp [0m[91mhttp 200[0m[91m http://nodejs.org/dist/v4.2.2/node-v4.2.2.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v4.2.2/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.2/SHASUMS256.txt
[0m[91mgyp[0m[91m [0m[91minfo[0m[91m [0m[91mspawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
[0m[91mgyp[0m[91m info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info[0m[91m [0m[91mspawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args[0m[91m   '/root/.node-gyp/4.2.2/common.gypi',
gyp[0m[91m [0m[91minfo spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.2',
[0m[91mgyp info[0m[91m spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
[0m[91mgyp [0m[91minfo spawn args   '--depth=.',
gyp info spawn args[0m[91m   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m
[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.2.2
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m ---> 80a7051e8892
Removing intermediate container d7814195c6f4
Step 5 : ENV NODE_ENV production
 ---> Running in e35ed9a274e1
 ---> 22c0b0fbfe0d
Removing intermediate container e35ed9a274e1
Step 6 : WORKDIR /usr/src/app
 ---> Running in 5d8b2f8a79f4
 ---> 11f56426feaf
Removing intermediate container 5d8b2f8a79f4
Step 7 : CMD npm start
 ---> Running in 8328a8384705
 ---> 493c0b0201ba
Removing intermediate container 8328a8384705
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 0cb94318ddc1
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3684 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 0ef0624cdcc5
Removing intermediate container 0cb94318ddc1
Successfully built 0ef0624cdcc5

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test83`

Contents of dockerfile `/root/docker-node/.~tmp.test83/Dockerfile`:

```
FROM nodesource/jessie:4.2.2
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:4.2.2-test1` from `/root/docker-node/.~tmp.test83`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:4.2.2
 ---> 0ef0624cdcc5
Step 2 : ENV NODE_ENV test
 ---> Running in 070f2022ac83
 ---> f41716c15c08
Removing intermediate container 070f2022ac83
Step 3 : RUN node -v
 ---> Running in bc90a82d1e4e
v4.2.2
 ---> ecce163913b8
Removing intermediate container bc90a82d1e4e
Step 4 : RUN node -p "process.versions"
 ---> Running in ca37bc164c9d
{ http_parser: '2.5.0',
  node: '4.2.2',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '52.1',
  modules: '46',
  openssl: '1.0.2d' }
 ---> 161539c3430d
Removing intermediate container ca37bc164c9d
Step 5 : RUN npm --version
 ---> Running in 4a12f46fc0e9
2.14.7
 ---> 8cd90dc7aac2
Removing intermediate container 4a12f46fc0e9
Successfully built 8cd90dc7aac2

```

# Tested image `nodesource/jessie:0.10.31`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in e87f6354b6d6
 ---> b3543811b8ef
Removing intermediate container e87f6354b6d6
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.31-1chl1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in d974092d19bf
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 93 3993k   93[0m[91m 3743k    0     0  6128k      0 --:--:-- --:--:-- --:--:-- 6127k100 3993k  100 3993k    0     0  6305k      0 --:--:-- --:--:-- --:--:-- 6299k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.31-1chl1~jessie1) ...
Setting up nodejs (0.10.31-1chl1~jessie1) ...
 ---> 8d6aa9ac9d9f
Removing intermediate container d974092d19bf
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in e90f744df22e
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (graceful-fs@4.1.3, inherits@2.0.1)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@0.10.31 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.31/node-v0.10.31.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.31/node-v0.10.31.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.31/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.31/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.31/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.31',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args[0m[91m   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:810:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.31
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 4d938420c4cd
Removing intermediate container e90f744df22e
Step 5 : ENV NODE_ENV production
 ---> Running in 148fcb67aeb7
 ---> db2664a2860e
Removing intermediate container 148fcb67aeb7
Step 6 : WORKDIR /usr/src/app
 ---> Running in fb00b6044255
 ---> 157562271a45
Removing intermediate container fb00b6044255
Step 7 : CMD npm start
 ---> Running in f357c0e30bb9
 ---> 2dd0a3ef87a1
Removing intermediate container f357c0e30bb9
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 99f65969471d
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (2484 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> eaa1ddad8bc8
Removing intermediate container 99f65969471d
Successfully built eaa1ddad8bc8

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test59`

Contents of dockerfile `/root/docker-node/.~tmp.test59/Dockerfile`:

```
FROM nodesource/jessie:0.10.31
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.10.31-test1` from `/root/docker-node/.~tmp.test59`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.10.31
 ---> eaa1ddad8bc8
Step 2 : ENV NODE_ENV test
 ---> Running in 5f329c7b96b5
 ---> 08cf88c229aa
Removing intermediate container 5f329c7b96b5
Step 3 : RUN node -v
 ---> Running in 44e3529978ae
v0.10.31
 ---> 2c675dc5e9c4
Removing intermediate container 44e3529978ae
Step 4 : RUN node -p "process.versions"
 ---> Running in f329d901b115
{ http_parser: '1.0',
  node: '0.10.31',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.28',
  zlib: '1.2.3',
  modules: '11',
  openssl: '1.0.1i' }
 ---> cdba3a6a1fea
Removing intermediate container f329d901b115
Step 5 : RUN npm --version
 ---> Running in e04018e3e422
1.4.23
 ---> ececa341b6be
Removing intermediate container e04018e3e422
Successfully built ececa341b6be

```

# Tested image `nodesource/wheezy:4.3.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 2198f9f9a5bc
 ---> e98245f94111
Removing intermediate container 2198f9f9a5bc
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.3.1-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in ddf61947612d
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Cur[0m[91mrent
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 73 [0m[91m10.[0m[91m6[0m[91mM[0m[91m   73 [0m[91m8079k    0     0[0m[91m  6825[0m[91mk [0m[91m     0  0:00:01  0:00:01 --:--:-- 7099k[0m[91m100 10.6M  100 10.6M    0     0  8565k      0  0:00:01  0:00:01 --:--:-- 8882k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (4.3.1-1nodesource1~wheezy1) ...
 ---> 00aa62d254f3
Removing intermediate container ddf61947612d
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 7a60cf87b5db
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
â””â”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@4.3.1 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.3.1/node-v4.3.1.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp [0m[91m200 http://nodejs.org/dist/v4.3.1/node-v4.3.1.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v4.3.1/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.3.1/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.3.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.3.1',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
[0m[91mgyp ERR! node -v v4.3.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> a4ace6d8fadb
Removing intermediate container 7a60cf87b5db
Step 5 : ENV NODE_ENV production
 ---> Running in 9891fed9dc00
 ---> fd22187f4dea
Removing intermediate container 9891fed9dc00
Step 6 : WORKDIR /usr/src/app
 ---> Running in 8519ad566ae7
 ---> ad96a03a766d
Removing intermediate container 8519ad566ae7
Step 7 : CMD npm start
 ---> Running in 38065d2ab6ee
 ---> 17c8eb2bc048
Removing intermediate container 38065d2ab6ee
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in b435673aae68
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://httpredir.debian.org wheezy Release [191 kB]
Get:6 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:7 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 4s (1804 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> c875f42b85ea
Removing intermediate container b435673aae68
Successfully built c875f42b85ea

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test0`

Contents of dockerfile `/root/docker-node/.~tmp.test0/Dockerfile`:

```
FROM nodesource/wheezy:4.3.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:4.3.1-test1` from `/root/docker-node/.~tmp.test0`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:4.3.1
 ---> c875f42b85ea
Step 2 : ENV NODE_ENV test
 ---> Running in fdd92be4eceb
 ---> 7119bc24e327
Removing intermediate container fdd92be4eceb
Step 3 : RUN node -v
 ---> Running in af80584c6489
v4.3.1
 ---> e74f3ffdd9b5
Removing intermediate container af80584c6489
Step 4 : RUN node -p "process.versions"
 ---> Running in 99d4a9839198
{ http_parser: '2.5.2',
  node: '4.3.1',
  v8: '4.5.103.35',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2f' }
 ---> 298395ab767f
Removing intermediate container 99d4a9839198
Step 5 : RUN npm --version
 ---> Running in a2fa8324cccd
2.14.12
 ---> 96d7f6a47fa0
Removing intermediate container a2fa8324cccd
Successfully built 96d7f6a47fa0

```

# Tested image `nodesource/jessie:0.10.40`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 4c86984d830f
 ---> 5f11e568e791
Removing intermediate container 4c86984d830f
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.40-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in d1f6f54ab313
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  4 3964k    4  175k    0     0   675k      0  0:00:05 --:--:--  0:00:05  673k[0m[91m100 3964k  100 3964k    0     0  4225k      0 --:--:-- --:-[0m[91m-:-- --:--:-- 4222k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.40-1nodesource1~jessie1) ...
Setting up nodejs (0.10.40-1nodesource1~jessie1) ...
 ---> 693a8099abae
Removing intermediate container d1f6f54ab313
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 4604dcd807b3
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ fstream@1.0.8 (graceful-fs@4.1.3, inherits@2.0.1)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp info [0m[91musing pangyp@2.3.3
[0m[91mgyp info using node@0.10.40 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp GET http://nodejs.org/dist/v0.10.40/node-v0.10.40.tar.gz
[0m[91mgyp http[0m[91m [0m[91m200 http://nodejs.org/dist/v0.10.40/node-v0.10.40.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp GET http://nodejs.org/dist/v0.10.40/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp[0m[91m 200 http://nodejs.org/dist/v0.10.40/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.40/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info[0m[91m spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.40',
gyp info[0m[91m [0m[91mspawn args   '-Druntime=node',
[0m[91mgyp info spawn args[0m[91m   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp[0m[91m ERR! [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp [0m[91mERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.40
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 755e467f400b
Removing intermediate container 4604dcd807b3
Step 5 : ENV NODE_ENV production
 ---> Running in 4cda3243104f
 ---> 5fe895dcafdd
Removing intermediate container 4cda3243104f
Step 6 : WORKDIR /usr/src/app
 ---> Running in 1dcb9baf08f7
 ---> b03cc77af7b3
Removing intermediate container 1dcb9baf08f7
Step 7 : CMD npm start
 ---> Running in 32c00afb306d
 ---> e35a0c93fa13
Removing intermediate container 32c00afb306d
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in dccac3b92e4d
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:4 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (2562 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 25bd5ba5527a
Removing intermediate container dccac3b92e4d
Successfully built 25bd5ba5527a

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test68`

Contents of dockerfile `/root/docker-node/.~tmp.test68/Dockerfile`:

```
FROM nodesource/jessie:0.10.40
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.10.40-test1` from `/root/docker-node/.~tmp.test68`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.10.40
 ---> 25bd5ba5527a
Step 2 : ENV NODE_ENV test
 ---> Running in 21caad2c039c
 ---> 9c7ab0a4ce0d
Removing intermediate container 21caad2c039c
Step 3 : RUN node -v
 ---> Running in 6123d34c9008
v0.10.40
 ---> 85140e457abe
Removing intermediate container 6123d34c9008
Step 4 : RUN node -p "process.versions"
 ---> Running in 4d0f43804eca
{ http_parser: '1.0',
  node: '0.10.40',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1p' }
 ---> 4798ab512d3a
Removing intermediate container 4d0f43804eca
Step 5 : RUN npm --version
 ---> Running in 47b247a37956
1.4.28
 ---> f7ce530decc1
Removing intermediate container 47b247a37956
Successfully built f7ce530decc1

```

# Tested image `nodesource/jessie:0.10.39`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 64d0b70a09c1
 ---> ef8c83640e26
Removing intermediate container 64d0b70a09c1
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.39-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in ae86fef29522
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  2 3964k    2 98006    0     0   430k      0  0:00:09 --:--:--  0[0m[91m:00:09  429k[0m[91m100 3964k  100 3964k    0     0  5016k      0 --:--:-- --:--:-- --:--:-- 5011k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.39-1nodesource1~jessie1) ...
Setting up nodejs (0.10.39-1nodesource1~jessie1) ...
 ---> a94242acac87
Removing intermediate container ae86fef29522
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in d51d5cbbdae8
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ fstream@1.0.8 (graceful-fs@4.1.3, inherits@2.0.1)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.10.39 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.39/node-v0.10.39.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.39/node-v0.10.39.tar.gz
[0m[91mgyp [0m[91mhttp GET http://nodejs.org/dist/v0.10.39/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.39/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp[0m[91m info spawn args[0m[91m   'binding.gyp',
[0m[91mgyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp [0m[91minfo spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info[0m[91m spawn args[0m[91m   '-I',
gyp info[0m[91m spawn args   '/root/.node-gyp/0.10.39/common.gypi',
gyp[0m[91m info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.39',
gyp info[0m[91m spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
[0m[91mgyp info [0m[91mspawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp [0m[91mERR! [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp [0m[91mERR![0m[91m [0m[91mstack     at ChildProcess.emit (events.js:98:17)
gyp [0m[91mERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command[0m[91m "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.39
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> b94d57e5389c
Removing intermediate container d51d5cbbdae8
Step 5 : ENV NODE_ENV production
 ---> Running in 94a413aae2ad
 ---> e7e360b4b61c
Removing intermediate container 94a413aae2ad
Step 6 : WORKDIR /usr/src/app
 ---> Running in 8319e51f19a8
 ---> d822bed1107f
Removing intermediate container 8319e51f19a8
Step 7 : CMD npm start
 ---> Running in f82b9939e0a0
 ---> 2422d42bdb4f
Removing intermediate container f82b9939e0a0
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 2a5d78b078ae
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie Release [148 kB]
Get:6 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (4643 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> b2a550e1de26
Removing intermediate container 2a5d78b078ae
Successfully built b2a550e1de26

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test67`

Contents of dockerfile `/root/docker-node/.~tmp.test67/Dockerfile`:

```
FROM nodesource/jessie:0.10.39
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.10.39-test1` from `/root/docker-node/.~tmp.test67`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.10.39
 ---> b2a550e1de26
Step 2 : ENV NODE_ENV test
 ---> Running in 9bd090298920
 ---> 2bbbe5ae0a3e
Removing intermediate container 9bd090298920
Step 3 : RUN node -v
 ---> Running in 10741661ee2f
v0.10.39
 ---> f837594c3cf1
Removing intermediate container 10741661ee2f
Step 4 : RUN node -p "process.versions"
 ---> Running in 18fb1e1c4826
{ http_parser: '1.0',
  node: '0.10.39',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1o' }
 ---> d12125f5470b
Removing intermediate container 18fb1e1c4826
Step 5 : RUN npm --version
 ---> Running in 7cb1a303c80a
1.4.28
 ---> 1991094d1b96
Removing intermediate container 7cb1a303c80a
Successfully built 1991094d1b96

```

# Tested image `nodesource/wheezy:0.12.8`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 450d690d4396
 ---> 47b509212cae
Removing intermediate container 450d690d4396
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.8-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in ef7f3ef50ce7
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 29 10.0M   29 3007k    0     0  5287k      0  0:00:01 --:--:--  0:00:01 5580k[0m[91m100 10.0M  100 10.0M    0     0  9194k      0  0:00:01  0:00:01 --:--:-- 9454k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.12.8-1nodesource1~wheezy1) ...
 ---> 86076a562a43
Removing intermediate container ef7f3ef50ce7
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in e7793f9ce0e9
[91mnpm[0m[91m [0m[91mWARN[0m[91m deprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1, bl@0.9.5)
â””â”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
[91mgyp[0m[91m [0m[91minfo[0m[91m [0m[91mit worked if it ends with ok
[0m[91mgyp info using[0m[91m pangyp@2.3.3
gyp info [0m[91musing node@0.12.8 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp [0m[91mGET http://nodejs.org/dist/v0.12.8/node-v0.12.8.tar.gz
[0m[91mgyp http [0m[91m200 http://nodejs.org/dist/v0.12.8/node-v0.12.8.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.8/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.8/SHASUMS256.txt
[0m[91mgyp[0m[91m info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp [0m[91minfo spawn args   'binding.gyp',
gyp info[0m[91m spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.8/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.8',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1075:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.8
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 236b4968ba6e
Removing intermediate container e7793f9ce0e9
Step 5 : ENV NODE_ENV production
 ---> Running in 1bf7b9041068
 ---> 61bad4da80d0
Removing intermediate container 1bf7b9041068
Step 6 : WORKDIR /usr/src/app
 ---> Running in 97b58df41265
 ---> 0f25f4286c1f
Removing intermediate container 97b58df41265
Step 7 : CMD npm start
 ---> Running in cbceba5a4b1b
 ---> 47cdc710bbfd
Removing intermediate container cbceba5a4b1b
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 5da78c530282
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 2s (3307 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> dc64f3c44cae
Removing intermediate container 5da78c530282
Successfully built dc64f3c44cae

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test33`

Contents of dockerfile `/root/docker-node/.~tmp.test33/Dockerfile`:

```
FROM nodesource/wheezy:0.12.8
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.12.8-test1` from `/root/docker-node/.~tmp.test33`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.12.8
 ---> dc64f3c44cae
Step 2 : ENV NODE_ENV test
 ---> Running in da611d0ac807
 ---> efc75dbc5281
Removing intermediate container da611d0ac807
Step 3 : RUN node -v
 ---> Running in 4b171618ba03
v0.12.8
 ---> 52b0820520d4
Removing intermediate container 4b171618ba03
Step 4 : RUN node -p "process.versions"
 ---> Running in 92e4830ff87c
{ http_parser: '2.3',
  node: '0.12.8',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1p' }
 ---> 27daac7990ed
Removing intermediate container 92e4830ff87c
Step 5 : RUN npm --version
 ---> Running in 28af25f9a0e2
2.14.9
 ---> ba9ffa6411c5
Removing intermediate container 28af25f9a0e2
Successfully built ba9ffa6411c5

```

# Tested image `nodesource/wheezy:4.2.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in eaf36e9aaedd
 ---> 385db9db2b5d
Removing intermediate container eaf36e9aaedd
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.0-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 4a104cf1dcac
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  S[0m[91mpeed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 39 8516k   39 3343k    0     0  3741k      0  0:00:02 --:--:--  0:00:02 3870k[0m[91m100 8516k  100 8516k    0     0  6553k      0  0:00:01  0:00:01 --:--:-- 6710k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (4.2.0-1nodesource1~wheezy1) ...
 ---> 35463af73f61
Removing intermediate container 4a104cf1dcac
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 0ec406883f3e
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1, bl@0.9.5)
[91mgyp [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp[0m[91m info using node@4.2.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v4.2.0/node-v4.2.0.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.0/node-v4.2.0.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v4.2.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.2.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 4ab6adb41169
Removing intermediate container 0ec406883f3e
Step 5 : ENV NODE_ENV production
 ---> Running in 36efd0be87a5
 ---> f9d7dea6702a
Removing intermediate container 36efd0be87a5
Step 6 : WORKDIR /usr/src/app
 ---> Running in be85c571fd97
 ---> 66e5c909f9af
Removing intermediate container be85c571fd97
Step 7 : CMD npm start
 ---> Running in 5b7fc968f0b3
 ---> 768fda355123
Removing intermediate container 5b7fc968f0b3
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 37f13a0c9c69
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 1s (6458 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 315bad10f671
Removing intermediate container 37f13a0c9c69
Successfully built 315bad10f671

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test35`

Contents of dockerfile `/root/docker-node/.~tmp.test35/Dockerfile`:

```
FROM nodesource/wheezy:4.2.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:4.2.0-test1` from `/root/docker-node/.~tmp.test35`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:4.2.0
 ---> 315bad10f671
Step 2 : ENV NODE_ENV test
 ---> Running in e6622eaf674a
 ---> 0bf3752176c7
Removing intermediate container e6622eaf674a
Step 3 : RUN node -v
 ---> Running in d99da843289a
v4.2.0
 ---> d5cf048fe686
Removing intermediate container d99da843289a
Step 4 : RUN node -p "process.versions"
 ---> Running in ab7f2a6c8dab
{ http_parser: '2.5.0',
  node: '4.2.0',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '46',
  openssl: '1.0.2d' }
 ---> 704c45914ec7
Removing intermediate container ab7f2a6c8dab
Step 5 : RUN npm --version
 ---> Running in 4cb14839951d
2.14.7
 ---> 83ade8858f80
Removing intermediate container 4cb14839951d
Successfully built 83ade8858f80

```

# Tested image `nodesource/wheezy:0.10.30`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in cdea67a4aa99
 ---> 3f7b6d32e2f6
Removing intermediate container cdea67a4aa99
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.30-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in ba4b02029b33
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  9 5792k    9  559k    0     0  1180k      0  0:00:04 --:--:--  0:00:04 1274k[0m[91m100 5792k  1[0m[91m00 5792k    0     0  7669k      0 --:--:-- --:--:-- --:--:-- 8045k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.10.30-1nodesource1~wheezy1) ...
 ---> e9001160b19d
Removing intermediate container ba4b02029b33
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 18ad5fdd026d
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, oauth-sign@0.5.0, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.10.30 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.10.30/node-v0.10.30.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.30/node-v0.10.30.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.30/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.30/SHASUMS256.txt
gyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.30/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.30',
gyp info[0m[91m spawn args[0m[91m   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m
[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR![0m[91m stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:810:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.30
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m ---> b03956f1e1b4
Removing intermediate container 18ad5fdd026d
Step 5 : ENV NODE_ENV production
 ---> Running in a8eec340ce1f
 ---> ce4587daf9fa
Removing intermediate container a8eec340ce1f
Step 6 : WORKDIR /usr/src/app
 ---> Running in 11441ce56572
 ---> 778ee95d465c
Removing intermediate container 11441ce56572
Step 7 : CMD npm start
 ---> Running in f85de5a4a0e3
 ---> 75f45edb42dc
Removing intermediate container f85de5a4a0e3
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 6eac6a95e8eb
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:3 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:4 http://security.debian.org wheezy/updates Release [102 kB]
Get:5 http://httpredir.debian.org wheezy Release [191 kB]
Get:6 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:7 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:8 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Get:9 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Fetched 8511 kB in 4s (1922 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 018b78303521
Removing intermediate container 6eac6a95e8eb
Successfully built 018b78303521

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test13`

Contents of dockerfile `/root/docker-node/.~tmp.test13/Dockerfile`:

```
FROM nodesource/wheezy:0.10.30
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.10.30-test1` from `/root/docker-node/.~tmp.test13`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.10.30
 ---> 018b78303521
Step 2 : ENV NODE_ENV test
 ---> Running in d5a4ec6211fa
 ---> 00070c99bbde
Removing intermediate container d5a4ec6211fa
Step 3 : RUN node -v
 ---> Running in 48c728aaa49f
v0.10.30
 ---> 4f788878086a
Removing intermediate container 48c728aaa49f
Step 4 : RUN node -p "process.versions"
 ---> Running in 7b3995c558e5
{ http_parser: '1.0',
  node: '0.10.30',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.28',
  zlib: '1.2.3',
  modules: '11',
  openssl: '1.0.1h' }
 ---> 83e96a12bb93
Removing intermediate container 7b3995c558e5
Step 5 : RUN npm --version
 ---> Running in 28cf788c95bd
1.4.21
 ---> 08b159cf5da6
Removing intermediate container 28cf788c95bd
Successfully built 08b159cf5da6

```

# Tested image `nodesource/wheezy:0.12.6`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 9634fc56616c
 ---> 3df45819adbf
Removing intermediate container 9634fc56616c
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.6-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 12878b180f4c
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 46 7913k   46 3647k    0     0  3392k      0  0:00:02  0:00:01  0:00:01 3490k[0m[91m100 7913k  100 7913k    0     0  5506k      0  0:00:01  0:00:01 --:--:-- 5624k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.12.6-1nodesource1~wheezy1) ...
 ---> 12f43fa066a2
Removing intermediate container 12878b180f4c
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in feee031910d9
[91mnpm[0m[91m [0m[91mWARN[0m[91m deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@0.12.6 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.6/node-v0.12.6.tar.gz
[0m[91mgyp http [0m[91m200 http://nodejs.org/dist/v0.12.6/node-v0.12.6.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.6/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.6/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.6/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.6',
gyp info spawn args   '-Druntime=node',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.6
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> cab1d43e0f18
Removing intermediate container feee031910d9
Step 5 : ENV NODE_ENV production
 ---> Running in a917adbd259c
 ---> c22758df030c
Removing intermediate container a917adbd259c
Step 6 : WORKDIR /usr/src/app
 ---> Running in 30ab146bd645
 ---> e00186f80252
Removing intermediate container 30ab146bd645
Step 7 : CMD npm start
 ---> Running in 63dff636aabf
 ---> 65b28166c6ed
Removing intermediate container 63dff636aabf
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in ed0d6b3c37ca
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://httpredir.debian.org wheezy Release [191 kB]
Get:6 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 3s (2329 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 40632937d0d1
Removing intermediate container ed0d6b3c37ca
Successfully built 40632937d0d1

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test31`

Contents of dockerfile `/root/docker-node/.~tmp.test31/Dockerfile`:

```
FROM nodesource/wheezy:0.12.6
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.12.6-test1` from `/root/docker-node/.~tmp.test31`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.12.6
 ---> 40632937d0d1
Step 2 : ENV NODE_ENV test
 ---> Running in af927c72ddb7
 ---> 221910281e2c
Removing intermediate container af927c72ddb7
Step 3 : RUN node -v
 ---> Running in 6cc8ec88820a
v0.12.6
 ---> 4d5cc44ac6a2
Removing intermediate container 6cc8ec88820a
Step 4 : RUN node -p "process.versions"
 ---> Running in 4a2d6cc3ae9d
{ http_parser: '2.3',
  node: '0.12.6',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1o' }
 ---> 2f38cbaa7f09
Removing intermediate container 4a2d6cc3ae9d
Step 5 : RUN npm --version
 ---> Running in 82817a781a55
2.11.2
 ---> 8969bd6b98a1
Removing intermediate container 82817a781a55
Successfully built 8969bd6b98a1

```

# Tested image `nodesource/jessie:5.5.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 3d78208613af
 ---> 5d57dcb970d8
Removing intermediate container 3d78208613af
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.5.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 5a56c06edd61
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 62 8534k   62 5327k    0     0  7372k      0  0:00:01 --:--:--  0:00:01 7368k[0m[91m100 8534k  100 8534k    0     0  8808k      0 --:--:--[0m[91m --:--:-- --:--:-- 8807k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.5.0-1nodesource1~jessie1) ...
Setting up nodejs (5.5.0-1nodesource1~jessie1) ...
 ---> df84c27ea3d1
Removing intermediate container 5a56c06edd61
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in bfa420a8b7a5
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated[0m[91m graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp[0m[91m info using pangyp@2.3.3
gyp info using node@5.5.0 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v5.5.0/node-v5.5.0.tar.gz
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v5.5.0/node-v5.5.0.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v5.5.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v5.5.0/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.5.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.5.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:100:13)
gyp ERR! stack     at ChildProcess.emit (events.js:185:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.5.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> bec58831291f
Removing intermediate container bfa420a8b7a5
Step 5 : ENV NODE_ENV production
 ---> Running in 8d18c9348335
 ---> 4328e897519b
Removing intermediate container 8d18c9348335
Step 6 : WORKDIR /usr/src/app
 ---> Running in 88bfa4d0451e
 ---> c8101e7e1ae9
Removing intermediate container 88bfa4d0451e
Step 7 : CMD npm start
 ---> Running in eecda118f244
 ---> b3ab9ba36811
Removing intermediate container eecda118f244
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 9df3046253e7
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:4 http://httpredir.debian.org jessie Release [148 kB]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Get:7 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Fetched 9651 kB in 2s (3816 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> aa7d184a93d1
Removing intermediate container 9df3046253e7
Successfully built aa7d184a93d1

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test56`

Contents of dockerfile `/root/docker-node/.~tmp.test56/Dockerfile`:

```
FROM nodesource/jessie:5.5.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:5.5.0-test1` from `/root/docker-node/.~tmp.test56`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:5.5.0
 ---> aa7d184a93d1
Step 2 : ENV NODE_ENV test
 ---> Running in 7b327cd23859
 ---> a65ef2b04edb
Removing intermediate container 7b327cd23859
Step 3 : RUN node -v
 ---> Running in c38961bb0776
v5.5.0
 ---> 2c6d4999f76a
Removing intermediate container c38961bb0776
Step 4 : RUN node -p "process.versions"
 ---> Running in 6e28f980938f
{ http_parser: '2.6.0',
  node: '5.5.0',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> 8d0bcda315ce
Removing intermediate container 6e28f980938f
Step 5 : RUN npm --version
 ---> Running in 674371abaa10
3.3.12
 ---> ed52ed7dee2f
Removing intermediate container 674371abaa10
Successfully built ed52ed7dee2f

```

# Tested image `nodesource/jessie:4.1.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 152d4ddd8408
 ---> 00574f543022
Removing intermediate container 152d4ddd8408
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.1.1-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in cf915e47543c
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 29 6465k   29 1903k    0     0  2842k      0  0:00:02 --:--:--  0:00:02 2841k[0m[91m100 6465k  100 6465k    0     0  5837k      0  0:00:01  0:00:01 --:--:-- 5840k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.1.1-1nodesource1~jessie1) ...
Setting up nodejs (4.1.1-1nodesource1~jessie1) ...
 ---> 90b390c96fc6
Removing intermediate container cf915e47543c
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 0c86d8d72479
[91mnpm[0m[91m [0m[91mWARN[0m[91m [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated[0m[91m graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info[0m[91m using pangyp@2.3.3
gyp info using[0m[91m node@4.1.1 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v4.1.1/node-v4.1.1.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.1.1/node-v4.1.1.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.1.1/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v4.1.1/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info [0m[91mspawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.1.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.1.1',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp[0m[91m info spawn args   '--generator-output',
gyp [0m[91minfo[0m[91m spawn args   'build',
gyp info spawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR![0m[91m stack     at emitTwo (events.js:87:13)
gyp ERR! [0m[91mstack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.1.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> b0bc46e1f87c
Removing intermediate container 0c86d8d72479
Step 5 : ENV NODE_ENV production
 ---> Running in e64ea9116dc1
 ---> 7260cd3f8b33
Removing intermediate container e64ea9116dc1
Step 6 : WORKDIR /usr/src/app
 ---> Running in 63add4131752
 ---> 23f45ced6da8
Removing intermediate container 63add4131752
Step 7 : CMD npm start
 ---> Running in cba0fb8e21f0
 ---> 496ca5bc292a
Removing intermediate container cba0fb8e21f0
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 8f67974e33ef
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 6s (1599 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 6295b1584170
Removing intermediate container 8f67974e33ef
Successfully built 6295b1584170

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test80`

Contents of dockerfile `/root/docker-node/.~tmp.test80/Dockerfile`:

```
FROM nodesource/jessie:4.1.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:4.1.1-test1` from `/root/docker-node/.~tmp.test80`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:4.1.1
 ---> 6295b1584170
Step 2 : ENV NODE_ENV test
 ---> Running in 78ab5d927524
 ---> a71ec09f6599
Removing intermediate container 78ab5d927524
Step 3 : RUN node -v
 ---> Running in 6c347733ec33
v4.1.1
 ---> a995162d91a5
Removing intermediate container 6c347733ec33
Step 4 : RUN node -p "process.versions"
 ---> Running in e02ff548c40f
{ http_parser: '2.5.0',
  node: '4.1.1',
  v8: '4.5.103.33',
  uv: '1.7.4',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '46',
  openssl: '1.0.2d' }
 ---> 109ce28589ae
Removing intermediate container e02ff548c40f
Step 5 : RUN npm --version
 ---> Running in c3655145c131
2.14.4
 ---> a968c06b04f2
Removing intermediate container c3655145c131
Successfully built a968c06b04f2

```

# Tested image `nodesource/wheezy:5.0.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 9f0912ba88d1
 ---> 7ea3cf0e8ac8
Removing intermediate container 9f0912ba88d1
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.0.0-3nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 6490afba2eba
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m[0m[91m 13 9127k   13 1263k    0     0  3428k[0m[91m      0  0:00:02 --:--:--  0:00:02 3716k[0m[91m100 9127k  100 9127k    0     0  8833k      0  0:00:01  0:00:01 --:--:-- 9091k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (5.0.0-3nodesource1~wheezy1) ...
 ---> 64103df644c8
Removing intermediate container 6490afba2eba
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in c029ba381ae1
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp[0m[91m info[0m[91m using pangyp@2.3.3
gyp info using node@5.0.0 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp GET http://nodejs.org/dist/v5.0.0/node-v5.0.0.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp[0m[91m 200 http://nodejs.org/dist/v5.0.0/node-v5.0.0.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v5.0.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v5.0.0/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
[0m[91mgyp info spawn args[0m[91m   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args[0m[91m   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info [0m[91mspawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.0.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args[0m[91m   '-Dnode_root_dir=/root/.node-gyp/5.0.0',
gyp info spawn args[0m[91m   '-Druntime=node',
gyp[0m[91m info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp[0m[91m info[0m[91m spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp info[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
[0m[91mgyp [0m[91mERR! [0m[91mstack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.0.0
[0m[91mgyp ERR! pangyp -v v2.3.3
[0m[91mgyp ERR! not ok 
[0m
 ---> 6e758098a227
Removing intermediate container c029ba381ae1
Step 5 : ENV NODE_ENV production
 ---> Running in c7dc224b11b1
 ---> 0ddf10a32ed0
Removing intermediate container c7dc224b11b1
Step 6 : WORKDIR /usr/src/app
 ---> Running in bf8d0b0778c7
 ---> 0edbbe18743b
Removing intermediate container bf8d0b0778c7
Step 7 : CMD npm start
 ---> Running in 10a2afdfb662
 ---> 340f7b949bca
Removing intermediate container 10a2afdfb662
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in fdea9f94ae8e
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Get:9 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Fetched 8511 kB in 3s (2512 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 05efc0123d13
Removing intermediate container fdea9f94ae8e
Successfully built 05efc0123d13

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test6`

Contents of dockerfile `/root/docker-node/.~tmp.test6/Dockerfile`:

```
FROM nodesource/wheezy:5.0.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:5.0.0-test1` from `/root/docker-node/.~tmp.test6`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:5.0.0
 ---> 05efc0123d13
Step 2 : ENV NODE_ENV test
 ---> Running in 4b30cbfa881b
 ---> 012ab34eb003
Removing intermediate container 4b30cbfa881b
Step 3 : RUN node -v
 ---> Running in ae0b2191f7d6
v5.0.0
 ---> 9bb5cb8d7246
Removing intermediate container ae0b2191f7d6
Step 4 : RUN node -p "process.versions"
 ---> Running in f0c8c0c18ba8
{ http_parser: '2.5.0',
  node: '5.0.0',
  v8: '4.6.85.28',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '4.8.1.1',
  modules: '47',
  openssl: '1.0.2d' }
 ---> ae8a64658982
Removing intermediate container f0c8c0c18ba8
Step 5 : RUN npm --version
 ---> Running in 25c7303c42d7
3.3.6
 ---> d4f637b386a1
Removing intermediate container 25c7303c42d7
Successfully built d4f637b386a1

```

# Tested image `nodesource/jessie:5.1.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 18d76743c1de
 ---> a40336a8771c
Removing intermediate container 18d76743c1de
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.1.1-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in d1224ee8d098
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 72 8333k   72 6015k    0     0  8114k      0  0:00:01 --:--:--  0:00:01 8107k[0m[91m100 8333k  100 8333k    0     0  9123k      0 --:--:-- --:--:-- --:--:-- 9118k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.1.1-1nodesource1~jessie1) ...
Setting up nodejs (5.1.1-1nodesource1~jessie1) ...
 ---> 9d8a59654ed4
Removing intermediate container d1224ee8d098
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 5f013f64a366
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
npm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@5.1.1 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp[0m[91m [0m[91mGET http://nodejs.org/dist/v5.1.1/node-v5.1.1.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v5.1.1/node-v5.1.1.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v5.1.1/SHASUMS256.txt
[0m[91mgyp[0m[91m http 200[0m[91m http://nodejs.org/dist/v5.1.1/SHASUMS256.txt
[0m[91mgyp info spawn[0m[91m python
[0m[91mgyp[0m[91m info [0m[91mspawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
[0m[91mgyp[0m[91m info spawn args   'make',
[0m[91mgyp info[0m[91m spawn args   '-I',
gyp info spawn args[0m[91m   '/build/config.gypi',
gyp [0m[91minfo spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.1.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.1.1',
gyp info spawn args[0m[91m   '-Druntime=node',
[0m[91mgyp [0m[91minfo spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args[0m[91m   '--no-parallel',
gyp [0m[91minfo spawn args[0m[91m   '--generator-output',
gyp info spawn args   'build',
gyp[0m[91m [0m[91minfo[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! [0m[91mconfigure error[0m[91m 
[0m[91mgyp[0m[91m ERR! [0m[91mstack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp [0m[91mERR! stack     at emitTwo (events.js:87:13)
[0m[91mgyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR![0m[91m [0m[91mSystem Linux 3.13.0-79-generic
gyp ERR![0m[91m command[0m[91m "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! [0m[91mnode -v v5.1.1
[0m[91mgyp ERR! [0m[91mpangyp -v[0m[91m v2.3.3
[0m[91mgyp [0m[91mERR! [0m[91mnot ok[0m[91m 
[0m
 ---> 51604761145d
Removing intermediate container 5f013f64a366
Step 5 : ENV NODE_ENV production
 ---> Running in 848925a1051b
 ---> 429579d0f1b4
Removing intermediate container 848925a1051b
Step 6 : WORKDIR /usr/src/app
 ---> Running in 823d6fdad585
 ---> 587fdf2020d4
Removing intermediate container 823d6fdad585
Step 7 : CMD npm start
 ---> Running in d8dcfc30819c
 ---> 12aea84aeb59
Removing intermediate container d8dcfc30819c
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 567501c9747c
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (2454 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> f68f2be9e52d
Removing intermediate container 567501c9747c
Successfully built f68f2be9e52d

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test52`

Contents of dockerfile `/root/docker-node/.~tmp.test52/Dockerfile`:

```
FROM nodesource/jessie:5.1.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:5.1.1-test1` from `/root/docker-node/.~tmp.test52`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:5.1.1
 ---> f68f2be9e52d
Step 2 : ENV NODE_ENV test
 ---> Running in e4cf25d7bdd4
 ---> 397c26837065
Removing intermediate container e4cf25d7bdd4
Step 3 : RUN node -v
 ---> Running in c68f0efa412e
v5.1.1
 ---> deecc48a98bf
Removing intermediate container c68f0efa412e
Step 4 : RUN node -p "process.versions"
 ---> Running in d87e3664d286
{ http_parser: '2.6.0',
  node: '5.1.1',
  v8: '4.6.85.31',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> 92fc4dcc244e
Removing intermediate container d87e3664d286
Step 5 : RUN npm --version
 ---> Running in 0f295d0fe693
3.3.12
 ---> 7e9459ae7d8d
Removing intermediate container 0f295d0fe693
Successfully built 7e9459ae7d8d

```

# Tested image `nodesource/jessie:0.10.35`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 03fdac93d822
 ---> 6fd3e288b4f0
Removing intermediate container 03fdac93d822
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.35-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 3885fcc4f9bc
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 3959k  100 3959k    0     0  6399k      0 --:--:-- --:--:-- --:--:-- 6407k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.35-1nodesource1~jessie1) ...
Setting up nodejs (0.10.35-1nodesource1~jessie1) ...
 ---> fc2b43190ba3
Removing intermediate container 3885fcc4f9bc
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 176cb589fdf6
[91mnpm[0m[91m WARN deprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, oauth-sign@0.5.0, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.10.35 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.35/node-v0.10.35.tar.gz
[0m[91mgyp [0m[91mhttp[0m[91m 200 http://nodejs.org/dist/v0.10.35/node-v0.10.35.tar.gz
[0m[91mgyp [0m[91mhttp GET http://nodejs.org/dist/v0.10.35/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v0.10.35/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.35/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.35',
gyp info [0m[91mspawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp[0m[91m [0m[91mERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.35
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 1748e674795d
Removing intermediate container 176cb589fdf6
Step 5 : ENV NODE_ENV production
 ---> Running in b5bbca573ee0
 ---> daef466b67bc
Removing intermediate container b5bbca573ee0
Step 6 : WORKDIR /usr/src/app
 ---> Running in 6d50bcb152b2
 ---> c4c2a5cfb658
Removing intermediate container 6d50bcb152b2
Step 7 : CMD npm start
 ---> Running in af25634961a2
 ---> c7ecb032b774
Removing intermediate container af25634961a2
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 230c83279b97
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:4 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 1s (5601 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 9e0bbcc09173
Removing intermediate container 230c83279b97
Successfully built 9e0bbcc09173

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test63`

Contents of dockerfile `/root/docker-node/.~tmp.test63/Dockerfile`:

```
FROM nodesource/jessie:0.10.35
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.10.35-test1` from `/root/docker-node/.~tmp.test63`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.10.35
 ---> 9e0bbcc09173
Step 2 : ENV NODE_ENV test
 ---> Running in ac2293c063a0
 ---> a23180c8354b
Removing intermediate container ac2293c063a0
Step 3 : RUN node -v
 ---> Running in a060130cea51
v0.10.35
 ---> 6f2332af2cbf
Removing intermediate container a060130cea51
Step 4 : RUN node -p "process.versions"
 ---> Running in 844a6e9eb1b3
{ http_parser: '1.0',
  node: '0.10.35',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.30',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1j' }
 ---> d7807fd1c018
Removing intermediate container 844a6e9eb1b3
Step 5 : RUN npm --version
 ---> Running in 198d115bf2ed
1.4.28
 ---> 63020b1fc1c9
Removing intermediate container 198d115bf2ed
Successfully built 63020b1fc1c9

```

# Tested image `nodesource/jessie:4.0.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 22c3ca9668e0
 ---> ea27889d9502
Removing intermediate container 22c3ca9668e0
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.0.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in d35bb4c39a19
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 35 6450k   35 2271k    0     0  3818k      0  0:00:01 --:--:--  0:00:01 3817k[0m[91m100 6450k  100 6450k    0     0  7085k      0 --:--:-- --:--:-- --:--:-- 708[0m[91m0k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.0.0-1nodesource1~jessie1) ...
Setting up nodejs (4.0.0-1nodesource1~jessie1) ...
 ---> 6b1bfc15974a
Removing intermediate container d35bb4c39a19
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in c16e297996fe
[91mnpm[0m[91m [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@4.0.0 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp GET http://nodejs.org/dist/v4.0.0/node-v4.0.0.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp 200 http://nodejs.org/dist/v4.0.0/node-v4.0.0.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.0.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.0.0/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info [0m[91mspawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info [0m[91mspawn args   '-I',
gyp info[0m[91m spawn args   '/root/.node-gyp/4.0.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.0.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info[0m[91m spawn args[0m[91m   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info[0m[91m spawn args[0m[91m   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp [0m[91minfo[0m[91m [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error[0m[91m 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack[0m[91m     at emitTwo (events.js:87:13)
[0m[91mgyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command[0m[91m "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp ERR! node -v v4.0.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! [0m[91mnot ok 
[0m
 ---> 9c44b9147f22
Removing intermediate container c16e297996fe
Step 5 : ENV NODE_ENV production
 ---> Running in dfdceb095745
 ---> 02d906058fbc
Removing intermediate container dfdceb095745
Step 6 : WORKDIR /usr/src/app
 ---> Running in 5325f592bb68
 ---> b857efca9301
Removing intermediate container 5325f592bb68
Step 7 : CMD npm start
 ---> Running in 6c71024b1c02
 ---> e0ab407425be
Removing intermediate container 6c71024b1c02
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 6e64eb517769
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 4s (2373 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 0380db358772
Removing intermediate container 6e64eb517769
Successfully built 0380db358772

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test48`

Contents of dockerfile `/root/docker-node/.~tmp.test48/Dockerfile`:

```
FROM nodesource/jessie:4.0.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:4.0.0-test1` from `/root/docker-node/.~tmp.test48`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:4.0.0
 ---> 0380db358772
Step 2 : ENV NODE_ENV test
 ---> Running in 4ef15e831b24
 ---> de09358b28eb
Removing intermediate container 4ef15e831b24
Step 3 : RUN node -v
 ---> Running in 8e7087b125cb
v4.0.0
 ---> fe6edfb717f7
Removing intermediate container 8e7087b125cb
Step 4 : RUN node -p "process.versions"
 ---> Running in 85dfcaac9ca7
{ http_parser: '2.5.0',
  node: '4.0.0',
  v8: '4.5.103.30',
  uv: '1.7.3',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '46',
  openssl: '1.0.2d' }
 ---> 420ef9c8ad2a
Removing intermediate container 85dfcaac9ca7
Step 5 : RUN npm --version
 ---> Running in 029ed0f79c4a
2.14.2
 ---> cd461a599650
Removing intermediate container 029ed0f79c4a
Successfully built cd461a599650

```

# Tested image `nodesource/jessie:0.12.2`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 17704830fdef
 ---> aa202155e1c5
Removing intermediate container 17704830fdef
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.2-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 00f35858f532
[91m  % Total    % Received % Xferd  Average Speed   Time    Time   [0m[91m  Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 62 5069k   62 3167k    0     0  4451k      0  0:00:01 --:--:--  0:00:01 4449k[0m[91m100 5069k  100 5069k    0     0  7055k      0 --:--:-- --:--:-- --:--:-- 7051k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.2-1nodesource1~jessie1) ...
Setting up nodejs (0.12.2-1nodesource1~jessie1) ...
 ---> 355154ca6998
Removing intermediate container 00f35858f532
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 1657e714d59d
[91mnpm[0m[91m WARN [0m[91mdeprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo[0m[91m it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.12.2 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.2/node-v0.12.2.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.2/node-v0.12.2.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.2/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.2/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args[0m[91m   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.2/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.2',
gyp info spawn args   '-Druntime=node',
gyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.2
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> dffbb01edb06
Removing intermediate container 1657e714d59d
Step 5 : ENV NODE_ENV production
 ---> Running in 5c51a9fc0441
 ---> b3d0b25b1bf9
Removing intermediate container 5c51a9fc0441
Step 6 : WORKDIR /usr/src/app
 ---> Running in 49c12e671c8a
 ---> 1187226d32d3
Removing intermediate container 49c12e671c8a
Step 7 : CMD npm start
 ---> Running in 37a00878fd64
 ---> ddbc015861ce
Removing intermediate container 37a00878fd64
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in aecff97fecb6
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie Release [148 kB]
Get:6 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 1s (5124 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 7b8a5d543339
Removing intermediate container aecff97fecb6
Successfully built 7b8a5d543339

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test72`

Contents of dockerfile `/root/docker-node/.~tmp.test72/Dockerfile`:

```
FROM nodesource/jessie:0.12.2
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.12.2-test1` from `/root/docker-node/.~tmp.test72`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.12.2
 ---> 7b8a5d543339
Step 2 : ENV NODE_ENV test
 ---> Running in 8e44782796e3
 ---> 452323189f32
Removing intermediate container 8e44782796e3
Step 3 : RUN node -v
 ---> Running in 623679118dea
v0.12.2
 ---> d920d313e9d6
Removing intermediate container 623679118dea
Step 4 : RUN node -p "process.versions"
 ---> Running in b6a0c4940a87
{ http_parser: '2.3',
  node: '0.12.2',
  v8: '3.28.73',
  uv: '1.4.2-node1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1m' }
 ---> 0442fc716026
Removing intermediate container b6a0c4940a87
Step 5 : RUN npm --version
 ---> Running in 491883c5cdad
2.7.4
 ---> 74effb8a0122
Removing intermediate container 491883c5cdad
Successfully built 74effb8a0122

```

# Tested image `nodesource/jessie:0.10.32`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 8603bc30959b
 ---> 90591bd8965a
Removing intermediate container 8603bc30959b
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.32-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in daa8ffa212bd
[91m  % Total    % Receiv[0m[91med % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 51 4040k   5[0m[91m1 2063k    0     0  4013k      0  0:00:01 --:--:--  0:00:01 4007k[0m[91m100 4040k  100 4040k    0     0  5540k [0m[91m     0 --:--:-- --:--:-- --:--:-- 5535k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.32-1nodesource1~jessie1) ...
Setting up nodejs (0.10.32-1nodesource1~jessie1) ...
 ---> 879caa77a2d8
Removing intermediate container daa8ffa212bd
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in ebf3aa76f349
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m [0m[91mWARN[0m[91m deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (graceful-fs@4.1.3, inherits@2.0.1)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@0.10.32 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.32/node-v0.10.32.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.32/node-v0.10.32.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp GET http://nodejs.org/dist/v0.10.32/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.32/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.32/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.32',
gyp info[0m[91m spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:810:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.32
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 7620c55671ca
Removing intermediate container ebf3aa76f349
Step 5 : ENV NODE_ENV production
 ---> Running in 0fed335009d1
 ---> 37a9e8f578fc
Removing intermediate container 0fed335009d1
Step 6 : WORKDIR /usr/src/app
 ---> Running in 964e198ddec2
 ---> 50f7e97ccbd8
Removing intermediate container 964e198ddec2
Step 7 : CMD npm start
 ---> Running in e13915d42b45
 ---> c0e5978a4262
Removing intermediate container e13915d42b45
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in e0d438166e61
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (4122 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 4ecd85d216b0
Removing intermediate container e0d438166e61
Successfully built 4ecd85d216b0

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test60`

Contents of dockerfile `/root/docker-node/.~tmp.test60/Dockerfile`:

```
FROM nodesource/jessie:0.10.32
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.10.32-test1` from `/root/docker-node/.~tmp.test60`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.10.32
 ---> 4ecd85d216b0
Step 2 : ENV NODE_ENV test
 ---> Running in b0c2ad0cdd82
 ---> 83a65f8de624
Removing intermediate container b0c2ad0cdd82
Step 3 : RUN node -v
 ---> Running in 1c3deee4e3bf
v0.10.32
 ---> 6f3c199a27c2
Removing intermediate container 1c3deee4e3bf
Step 4 : RUN node -p "process.versions"
 ---> Running in df78f3441940
{ http_parser: '1.0',
  node: '0.10.32',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.28',
  zlib: '1.2.3',
  modules: '11',
  openssl: '1.0.1i' }
 ---> 1fa7ce596103
Removing intermediate container df78f3441940
Step 5 : RUN npm --version
 ---> Running in 93eaa9fb326d
1.4.28
 ---> c7260a096f65
Removing intermediate container 93eaa9fb326d
Successfully built c7260a096f65

```

# Tested image `nodesource/wheezy:5.3.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 2f7686a68683
 ---> aa302f814766
Removing intermediate container 2f7686a68683
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.3.0-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 4ea707ccd69b
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 63 10.7M   63 6975k    0     0  6998k      0  0:00:01 --:--:--  0:00:01 7335k[0m[91m100 10.7M  100 10.7M    0     0  8320k      0  0:00:01  0:00:01 --:--:-- 8624k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (5.3.0-1nodesource1~wheezy1) ...
 ---> 59ffaf9a33bf
Removing intermediate container 4ea707ccd69b
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in a581938fe00b
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated[0m[91m graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@5.3.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v5.3.0/node-v5.3.0.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v5.3.0/node-v5.3.0.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v5.3.0/SHASUMS256.txt
[0m[91mgyp[0m[91m [0m[91mhttp 200 http://nodejs.org/dist/v5.3.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
[0m[91mgyp info spawn args[0m[91m   'make',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.3.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.3.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
gyp [0m[91minfo[0m[91m [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.3.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 771ca9407bb8
Removing intermediate container a581938fe00b
Step 5 : ENV NODE_ENV production
 ---> Running in 8752b32931f7
 ---> ec99e0343804
Removing intermediate container 8752b32931f7
Step 6 : WORKDIR /usr/src/app
 ---> Running in 69fbd42d9b9b
 ---> 848a212fb6d7
Removing intermediate container 69fbd42d9b9b
Step 7 : CMD npm start
 ---> Running in 28c3b2b9b047
 ---> 7977c4367a33
Removing intermediate container 28c3b2b9b047
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in bf08b3895211
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 2s (3533 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 8d922ae10016
Removing intermediate container bf08b3895211
Successfully built 8d922ae10016

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test9`

Contents of dockerfile `/root/docker-node/.~tmp.test9/Dockerfile`:

```
FROM nodesource/wheezy:5.3.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:5.3.0-test1` from `/root/docker-node/.~tmp.test9`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:5.3.0
 ---> 8d922ae10016
Step 2 : ENV NODE_ENV test
 ---> Running in 01e4ec56e6ff
 ---> 5e40e903804b
Removing intermediate container 01e4ec56e6ff
Step 3 : RUN node -v
 ---> Running in 91aa07ddd664
v5.3.0
 ---> 0126be38c791
Removing intermediate container 91aa07ddd664
Step 4 : RUN node -p "process.versions"
 ---> Running in 0b5c107af1b7
{ http_parser: '2.6.0',
  node: '5.3.0',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> 828266c62f5e
Removing intermediate container 0b5c107af1b7
Step 5 : RUN npm --version
 ---> Running in 3dd23d2bbe5a
3.3.12
 ---> 9ea7b766479b
Removing intermediate container 3dd23d2bbe5a
Successfully built 9ea7b766479b

```

# Tested image `nodesource/jessie:0.10.30`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 0f95419184e1
 ---> b83ec0b74610
Removing intermediate container 0f95419184e1
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.30-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in b998494cd8d7
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 68 3989k   68 2751k    0     0  3368k      0  0:00:01 --:--:--  0:00:01 3368k[0m[91m100 3989k  100 3989k    0     0  4213k      0 --:--:-- --:--:-- --:--:-- 4213k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.30-1nodesource1~jessie1) ...
Setting up nodejs (0.10.30-1nodesource1~jessie1) ...
 ---> 48a1e67f8450
Removing intermediate container b998494cd8d7
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 05ce3b83f372
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN[0m[91m [0m[91mdeprecated[0m[91m graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo[0m[91m [0m[91mit worked if it ends with ok
[0m[91mgyp info using[0m[91m pangyp@2.3.3
gyp info using node@0.10.30 | linux | x64
[0m[91mgyp http [0m[91mGET http://nodejs.org/dist/v0.10.30/node-v0.10.30.tar.gz
[0m[91mgyp http [0m[91m200 http://nodejs.org/dist/v0.10.30/node-v0.10.30.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.30/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.30/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp[0m[91m info[0m[91m spawn args   'binding.gyp',
[0m[91mgyp info spawn args   '-f',
gyp info [0m[91mspawn args   'make',
[0m[91mgyp info[0m[91m spawn args[0m[91m   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args[0m[91m   '/root/.node-gyp/0.10.30/common.gypi',
gyp [0m[91minfo [0m[91mspawn args   '-Dlibrary=shared_library',
[0m[91mgyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.30',
gyp info[0m[91m [0m[91mspawn args[0m[91m   '-Druntime=node',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
gyp [0m[91minfo[0m[91m spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR![0m[91m stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:810:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.30
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 80e4d3ec4b01
Removing intermediate container 05ce3b83f372
Step 5 : ENV NODE_ENV production
 ---> Running in fd4b1eb82543
 ---> c9c28b98b8dc
Removing intermediate container fd4b1eb82543
Step 6 : WORKDIR /usr/src/app
 ---> Running in 6536691c71ad
 ---> bada4a58bee1
Removing intermediate container 6536691c71ad
Step 7 : CMD npm start
 ---> Running in ca70831f4043
 ---> 8d11b771462b
Removing intermediate container ca70831f4043
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in a681177430ba
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3861 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 61662be5a639
Removing intermediate container a681177430ba
Successfully built 61662be5a639

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test58`

Contents of dockerfile `/root/docker-node/.~tmp.test58/Dockerfile`:

```
FROM nodesource/jessie:0.10.30
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.10.30-test1` from `/root/docker-node/.~tmp.test58`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.10.30
 ---> 61662be5a639
Step 2 : ENV NODE_ENV test
 ---> Running in 628ce37ce726
 ---> 17cc2f2f9e42
Removing intermediate container 628ce37ce726
Step 3 : RUN node -v
 ---> Running in 1f1438fad532
v0.10.30
 ---> a85e2ab8d873
Removing intermediate container 1f1438fad532
Step 4 : RUN node -p "process.versions"
 ---> Running in b4c21a1b69ce
{ http_parser: '1.0',
  node: '0.10.30',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.28',
  zlib: '1.2.3',
  modules: '11',
  openssl: '1.0.1h' }
 ---> 97dc63fa1a67
Removing intermediate container b4c21a1b69ce
Step 5 : RUN npm --version
 ---> Running in 05eec0389cbb
1.4.21
 ---> 23e17ef64500
Removing intermediate container 05eec0389cbb
Successfully built 23e17ef64500

```

# Tested image `nodesource/jessie:4.2.5`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in fb7df3f30a81
 ---> db5e446e3fd1
Removing intermediate container fb7df3f30a81
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.5-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 5dc36f51bfb0
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 12 8387k   12 1071k    0     0  2286k      0  0:00:03 --:--:--  0:00:03 2285k[0m[91m100 8387k  100 8387k    0     0  7597k      0  0:00:01  0:00:01 --:--:-- 7604k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.2.5-1nodesource1~jessie1) ...
Setting up nodejs (4.2.5-1nodesource1~jessie1) ...
 ---> 2698bf2862a4
Removing intermediate container 5dc36f51bfb0
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 147336b1b85a
[91mnpm[0m[91m WARN [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@4.2.5 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v4.2.5/node-v4.2.5.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.5/node-v4.2.5.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v4.2.5/SHASUMS256.txt
[0m[91mgyp[0m[91m [0m[91mhttp 200 http://nodejs.org/dist/v4.2.5/SHASUMS256.txt
[0m[91mgyp info spawn[0m[91m python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info[0m[91m [0m[91mspawn args[0m[91m   'make',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.5/common.gypi',
[0m[91mgyp info [0m[91mspawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.5',
gyp info spawn args   '-Druntime=node',
gyp[0m[91m info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args[0m[91m   '--depth=.',
[0m[91mgyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info[0m[91m [0m[91mspawn args[0m[91m   'build',
gyp [0m[91minfo[0m[91m spawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.2.5
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 67d53e72bf10
Removing intermediate container 147336b1b85a
Step 5 : ENV NODE_ENV production
 ---> Running in 27dbb37aebe1
 ---> 3f42b49b58b7
Removing intermediate container 27dbb37aebe1
Step 6 : WORKDIR /usr/src/app
 ---> Running in 481a1c121069
 ---> 64e71eec21c3
Removing intermediate container 481a1c121069
Step 7 : CMD npm start
 ---> Running in c5f7784d9d42
 ---> 5a21489ff540
Removing intermediate container c5f7784d9d42
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 604347f51658
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 1s (6124 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> f37d25055425
Removing intermediate container 604347f51658
Successfully built f37d25055425

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test86`

Contents of dockerfile `/root/docker-node/.~tmp.test86/Dockerfile`:

```
FROM nodesource/jessie:4.2.5
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:4.2.5-test1` from `/root/docker-node/.~tmp.test86`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:4.2.5
 ---> f37d25055425
Step 2 : ENV NODE_ENV test
 ---> Running in d90c89e74fba
 ---> 8099bc840d7b
Removing intermediate container d90c89e74fba
Step 3 : RUN node -v
 ---> Running in a64c52284fcc
v4.2.5
 ---> cc25f2ca69dd
Removing intermediate container a64c52284fcc
Step 4 : RUN node -p "process.versions"
 ---> Running in 2cc8ed750af1
{ http_parser: '2.5.0',
  node: '4.2.5',
  v8: '4.5.103.35',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2e' }
 ---> 2691e5bc136d
Removing intermediate container 2cc8ed750af1
Step 5 : RUN npm --version
 ---> Running in f66a4904467e
2.14.12
 ---> b8a392856b75
Removing intermediate container f66a4904467e
Successfully built b8a392856b75

```

# Tested image `nodesource/jessie:4.3.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 6cec4f962659
 ---> b328d0eb837c
Removing intermediate container 6cec4f962659
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.3.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 38ad1054fe2a
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m[0m[91m  5 8391k    5  431k    0     0  1482k      0  0:00:05 --:--:--  0:00:05 1478k[0m[91m100 8391k  100 8391k    0     0  8614k      0 --:--:-- --:--:-- --:--:-- 8615k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.3.0-1nodesource1~jessie1) ...
Setting up nodejs (4.3.0-1nodesource1~jessie1) ...
 ---> 445ab77294b4
Removing intermediate container 38ad1054fe2a
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in f933f32e16f9
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (forever-agent@0.5.2, aws-sign2@0.5.0, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@4.3.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v4.3.0/node-v4.3.0.tar.gz
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v4.3.0/node-v4.3.0.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v4.3.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.3.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.3.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.3.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.3.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 412c1d70a64e
Removing intermediate container f933f32e16f9
Step 5 : ENV NODE_ENV production
 ---> Running in 97489d2f3774
 ---> 8271bea51c7a
Removing intermediate container 97489d2f3774
Step 6 : WORKDIR /usr/src/app
 ---> Running in a3490cb009d9
 ---> f6ad381bf694
Removing intermediate container a3490cb009d9
Step 7 : CMD npm start
 ---> Running in c695ff1af512
 ---> 258e858a58ac
Removing intermediate container c695ff1af512
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in d1ce7f0debdc
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:4 http://httpredir.debian.org jessie Release [148 kB]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (4028 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> f88ab3dad2ff
Removing intermediate container d1ce7f0debdc
Successfully built f88ab3dad2ff

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test87`

Contents of dockerfile `/root/docker-node/.~tmp.test87/Dockerfile`:

```
FROM nodesource/jessie:4.3.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:4.3.0-test1` from `/root/docker-node/.~tmp.test87`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:4.3.0
 ---> f88ab3dad2ff
Step 2 : ENV NODE_ENV test
 ---> Running in 366062fc63f1
 ---> 06baf21f38f6
Removing intermediate container 366062fc63f1
Step 3 : RUN node -v
 ---> Running in 576a4baeb4fa
v4.3.0
 ---> d9f00e2a187d
Removing intermediate container 576a4baeb4fa
Step 4 : RUN node -p "process.versions"
 ---> Running in 39d11e4536a7
{ http_parser: '2.5.1',
  node: '4.3.0',
  v8: '4.5.103.35',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2f' }
 ---> 513bbfba97ba
Removing intermediate container 39d11e4536a7
Step 5 : RUN npm --version
 ---> Running in caab227f7004
2.14.12
 ---> e8f2160c2972
Removing intermediate container caab227f7004
Successfully built e8f2160c2972

```

# Tested image `nodesource/wheezy:5.2.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 7aeb0897fd1c
 ---> d5de3387f978
Removing intermediate container 7aeb0897fd1c
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.2.0-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 8cf41bc9c853
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 42 10.7M   42 4703k    0     0  6428k      0  0:00:01 --:--:--  0:00:01 6681k[0m[91m[0m[91m1[0m[91m00 10.7M  100 10.7M    0     0  9043k  [0m[91m    0  [0m[91m0:00:01  0:00:01 --:--:-- 9267k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (5.2.0-1nodesource1~wheezy1) ...
 ---> 04e329fa084d
Removing intermediate container 8cf41bc9c853
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 942a1c72ed26
[91mnpm[0m[91m [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m [0m[91minfo[0m[91m [0m[91mit worked if it ends with[0m[91m ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@5.2.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v5.2.0/node-v5.2.0.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v5.2.0/node-v5.2.0.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v5.2.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v5.2.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.2.0/common.gypi',
gyp[0m[91m info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.2.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:88:13)
gyp ERR! stack     at ChildProcess.emit (events.js:173:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:201:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.2.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 8852c84b6e85
Removing intermediate container 942a1c72ed26
Step 5 : ENV NODE_ENV production
 ---> Running in 1bce1bdaf5fb
 ---> 64e27750b898
Removing intermediate container 1bce1bdaf5fb
Step 6 : WORKDIR /usr/src/app
 ---> Running in 836f1050f5f8
 ---> f98e463836ae
Removing intermediate container 836f1050f5f8
Step 7 : CMD npm start
 ---> Running in 744619f2564a
 ---> 178dad5ded24
Removing intermediate container 744619f2564a
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in d1c2ef901530
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 4s (2081 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> fdbef6eef123
Removing intermediate container d1c2ef901530
Successfully built fdbef6eef123

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test8`

Contents of dockerfile `/root/docker-node/.~tmp.test8/Dockerfile`:

```
FROM nodesource/wheezy:5.2.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:5.2.0-test1` from `/root/docker-node/.~tmp.test8`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:5.2.0
 ---> fdbef6eef123
Step 2 : ENV NODE_ENV test
 ---> Running in f5b21f3f7a9a
 ---> 1da3d1ad48b0
Removing intermediate container f5b21f3f7a9a
Step 3 : RUN node -v
 ---> Running in 9b7e55f76746
v5.2.0
 ---> c481a4e444a2
Removing intermediate container 9b7e55f76746
Step 4 : RUN node -p "process.versions"
 ---> Running in 9828f6f0e404
{ http_parser: '2.6.0',
  node: '5.2.0',
  v8: '4.6.85.31',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> cbf6b9030e56
Removing intermediate container 9828f6f0e404
Step 5 : RUN npm --version
 ---> Running in 64a04d15946f
3.3.12
 ---> 5ae230f4c030
Removing intermediate container 64a04d15946f
Successfully built 5ae230f4c030

```

# Tested image `nodesource/jessie:5.7.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in ab8faf30668b
 ---> 9ab1500527e4
Removing intermediate container ab8faf30668b
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.7.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 781b08ea3734
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 13 8809k   13 1231k    0     0  1973k      0  0:00:04 --:--:--  0:00:04 1973k[0m[91m100 8809k  100 8809k    0     0  7597k      0  0:00:01  0:00:01 --:--:-- 7600k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.7.0-1nodesource1~jessie1) ...
Setting up nodejs (5.7.0-1nodesource1~jessie1) ...
 ---> 0fde935a73e6
Removing intermediate container 781b08ea3734
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 637ad3ef04b9
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@5.7.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v5.7.0/node-v5.7.0.tar.gz
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v5.7.0/node-v5.7.0.tar.gz
[0m[91mgyp [0m[91mhttp[0m[91m [0m[91mGET[0m[91m http://nodejs.org/dist/v5.7.0/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v5.7.0/SHASUMS256.txt
[0m[91mgyp info[0m[91m spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp [0m[91minfo spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.7.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info [0m[91mspawn args   '-Dvisibility=default',
gyp[0m[91m info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.7.0',
gyp info[0m[91m spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
[0m[91mgyp info[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:100:13)
gyp ERR! stack     at ChildProcess.emit (events.js:185:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.7.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 7d8407e29bd6
Removing intermediate container 637ad3ef04b9
Step 5 : ENV NODE_ENV production
 ---> Running in 740cddab2f20
 ---> 27ee277aa766
Removing intermediate container 740cddab2f20
Step 6 : WORKDIR /usr/src/app
 ---> Running in acc2690e4d4a
 ---> 9502a6cddf11
Removing intermediate container acc2690e4d4a
Step 7 : CMD npm start
 ---> Running in 87ac008c8b50
 ---> a2d65d25b442
Removing intermediate container 87ac008c8b50
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in f054d1c55781
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (2658 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 2e1936ac899a
Removing intermediate container f054d1c55781
Successfully built 2e1936ac899a

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test45`

Contents of dockerfile `/root/docker-node/.~tmp.test45/Dockerfile`:

```
FROM nodesource/jessie:5.7.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:5.7.0-test1` from `/root/docker-node/.~tmp.test45`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:5.7.0
 ---> 2e1936ac899a
Step 2 : ENV NODE_ENV test
 ---> Running in 7aea65a7134f
 ---> 8263770a5ea3
Removing intermediate container 7aea65a7134f
Step 3 : RUN node -v
 ---> Running in cddaebd5d51f
v5.7.0
 ---> c8fb35c0f39f
Removing intermediate container cddaebd5d51f
Step 4 : RUN node -p "process.versions"
 ---> Running in b1e388bc8451
{ http_parser: '2.6.2',
  node: '5.7.0',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2f' }
 ---> c4bf4e0008eb
Removing intermediate container b1e388bc8451
Step 5 : RUN npm --version
 ---> Running in b2706cfe2a5e
3.6.0
 ---> 4dcad6312369
Removing intermediate container b2706cfe2a5e
Successfully built 4dcad6312369

```

# Tested image `nodesource/jessie:4.3.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in cd207edb09af
 ---> f4f2cf077bb6
Removing intermediate container cd207edb09af
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.3.1-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 534941fa28bc
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 31 8396k   31 2655k    0     0  5172k      0  0:00:01 --:--:--  0:00:01 5166k[0m[91m100 8396k  100 8396k    0     0  8638k      0 --:--:-- --:--:-- --:--:-- 8638k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.3.1-1nodesource1~jessie1) ...
Setting up nodejs (4.3.1-1nodesource1~jessie1) ...
 ---> 58042a4ac272
Removing intermediate container 534941fa28bc
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in bf173769b24b
[91mnpm[0m[91m WARN [0m[91mdeprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (forever-agent@0.5.2, aws-sign2@0.5.0, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@4.3.1 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v4.3.1/node-v4.3.1.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.3.1/node-v4.3.1.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.3.1/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.3.1/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.3.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.3.1',
[0m[91mgyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp [0m[91mERR![0m[91m cwd /
gyp ERR! node -v v4.3.1
gyp [0m[91mERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> dfd2698b8e1e
Removing intermediate container bf173769b24b
Step 5 : ENV NODE_ENV production
 ---> Running in bad144ad7427
 ---> 26802ddaa65c
Removing intermediate container bad144ad7427
Step 6 : WORKDIR /usr/src/app
 ---> Running in d4daa447c757
 ---> 216103ac67ec
Removing intermediate container d4daa447c757
Step 7 : CMD npm start
 ---> Running in 5de5886684c5
 ---> f6e2aba8e703
Removing intermediate container 5de5886684c5
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 2948b64b96e2
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (2860 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 0503bd3d98e5
Removing intermediate container 2948b64b96e2
Successfully built 0503bd3d98e5

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test44`

Contents of dockerfile `/root/docker-node/.~tmp.test44/Dockerfile`:

```
FROM nodesource/jessie:4.3.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:4.3.1-test1` from `/root/docker-node/.~tmp.test44`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:4.3.1
 ---> 0503bd3d98e5
Step 2 : ENV NODE_ENV test
 ---> Running in 52a363d67ac3
 ---> 72c3a7b808a2
Removing intermediate container 52a363d67ac3
Step 3 : RUN node -v
 ---> Running in daa61ced3f38
v4.3.1
 ---> 79e9dd0c8858
Removing intermediate container daa61ced3f38
Step 4 : RUN node -p "process.versions"
 ---> Running in 3461283fc470
{ http_parser: '2.5.2',
  node: '4.3.1',
  v8: '4.5.103.35',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2f' }
 ---> 662f0c37405a
Removing intermediate container 3461283fc470
Step 5 : RUN npm --version
 ---> Running in 6282b6f88958
2.14.12
 ---> b0b568b75182
Removing intermediate container 6282b6f88958
Successfully built b0b568b75182

```

# Tested image `nodesource/jessie:4.1.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 6b73a50df619
 ---> 4f24a4554d8b
Removing intermediate container 6b73a50df619
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.1.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 2326f346e5bc
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:--[0m[91m --:--:--     0[0m[91m100 6460k  100 6460k    0     0  8048k      0 --:--:-- --:--:-- --:--:-- 8055k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.1.0-1nodesource1~jessie1) ...
Setting up nodejs (4.1.0-1nodesource1~jessie1) ...
 ---> be194f80f9af
Removing intermediate container 2326f346e5bc
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 79eef43c3fa3
[91mnpm[0m[91m [0m[91mWARN[0m[91m [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, node-uuid@1.4.7, qs@2.3.3, combined-stream@0.0.7, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
â””â”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@4.1.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v4.1.0/node-v4.1.0.tar.gz
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v4.1.0/node-v4.1.0.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v4.1.0/SHASUMS256.txt
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v4.1.0/SHASUMS256.txt
[0m[91mgyp info spawn[0m[91m python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
[0m[91mgyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.1.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.1.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp[0m[91m [0m[91minfo[0m[91m [0m[91mspawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System[0m[91m Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.1.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 405e24269e15
Removing intermediate container 79eef43c3fa3
Step 5 : ENV NODE_ENV production
 ---> Running in f1ba196cf742
 ---> cb34fab851f4
Removing intermediate container f1ba196cf742
Step 6 : WORKDIR /usr/src/app
 ---> Running in 9cc10a72a0a1
 ---> f206ad6943ef
Removing intermediate container 9cc10a72a0a1
Step 7 : CMD npm start
 ---> Running in 3a5cbfc7bf75
 ---> 8ea245fab9e8
Removing intermediate container 3a5cbfc7bf75
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 39b32dc685e5
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie Release [148 kB]
Get:6 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (4552 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 09c8493997de
Removing intermediate container 39b32dc685e5
Successfully built 09c8493997de

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test79`

Contents of dockerfile `/root/docker-node/.~tmp.test79/Dockerfile`:

```
FROM nodesource/jessie:4.1.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:4.1.0-test1` from `/root/docker-node/.~tmp.test79`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:4.1.0
 ---> 09c8493997de
Step 2 : ENV NODE_ENV test
 ---> Running in 90a394bfb2fb
 ---> 98fd8572927a
Removing intermediate container 90a394bfb2fb
Step 3 : RUN node -v
 ---> Running in f91a96397e4f
v4.1.0
 ---> 52c6d22e5bb6
Removing intermediate container f91a96397e4f
Step 4 : RUN node -p "process.versions"
 ---> Running in ab0156f4bc7f
{ http_parser: '2.5.0',
  node: '4.1.0',
  v8: '4.5.103.33',
  uv: '1.7.4',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '46',
  openssl: '1.0.2d' }
 ---> 2b3a937a0626
Removing intermediate container ab0156f4bc7f
Step 5 : RUN npm --version
 ---> Running in 37a279221957
2.14.3
 ---> 39d8d8441f1f
Removing intermediate container 37a279221957
Successfully built 39d8d8441f1f

```

# Tested image `nodesource/wheezy:4.3.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 5aab5e2a4ae8
 ---> 8fc8c7632e3e
Removing intermediate container 5aab5e2a4ae8
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.3.0-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 1834c200eca0
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Ti[0m[91mme  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 92 10.6M   92  9.9M    0     0  9364k      0  0:00:01  0:00:01 --:--:-- 9620k[0m[91m100 10.6M  100 10.6M    0     0  9594k      0  0:00:01  0:00:01 --:--:-- 9838k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (4.3.0-1nodesource1~wheezy1) ...
 ---> 7c1c989fe88d
Removing intermediate container 1834c200eca0
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 5613ec0a5c26
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
â””â”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with[0m[91m ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@4.3.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v4.3.0/node-v4.3.0.tar.gz
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v4.3.0/node-v4.3.0.tar.gz
[0m[91mgyp[0m[91m http [0m[91mGET http://nodejs.org/dist/v4.3.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.3.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp [0m[91minfo spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.3.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.3.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
[0m[91mgyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
[0m[91mgyp[0m[91m ERR! stack Error: `gyp` failed with exit code: 1
gyp [0m[91mERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack[0m[91m     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd[0m[91m /
gyp ERR! node -v v4.3.0
gyp ERR! pangyp -v v2.3.3
gyp [0m[91mERR! not ok[0m[91m 
[0m
 ---> cdb9a5934506
Removing intermediate container 5613ec0a5c26
Step 5 : ENV NODE_ENV production
 ---> Running in a224483225e9
 ---> 814bb0d3c9ea
Removing intermediate container a224483225e9
Step 6 : WORKDIR /usr/src/app
 ---> Running in 0adba1e335dc
 ---> d0575238c948
Removing intermediate container 0adba1e335dc
Step 7 : CMD npm start
 ---> Running in 83f99da10605
 ---> f22a872bdea5
Removing intermediate container 83f99da10605
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in d6516a0b5d62
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://httpredir.debian.org wheezy Release [191 kB]
Get:6 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:7 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:8 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 4s (1995 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> e61247e8bdb2
Removing intermediate container d6516a0b5d62
Successfully built e61247e8bdb2

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test41`

Contents of dockerfile `/root/docker-node/.~tmp.test41/Dockerfile`:

```
FROM nodesource/wheezy:4.3.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:4.3.0-test1` from `/root/docker-node/.~tmp.test41`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:4.3.0
 ---> e61247e8bdb2
Step 2 : ENV NODE_ENV test
 ---> Running in d9c85830d4b7
 ---> 1f96184d9169
Removing intermediate container d9c85830d4b7
Step 3 : RUN node -v
 ---> Running in 51626a84425a
v4.3.0
 ---> 66f9d5a4cced
Removing intermediate container 51626a84425a
Step 4 : RUN node -p "process.versions"
 ---> Running in cb957fc43c6f
{ http_parser: '2.5.1',
  node: '4.3.0',
  v8: '4.5.103.35',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2f' }
 ---> 54bbcdd14bc0
Removing intermediate container cb957fc43c6f
Step 5 : RUN npm --version
 ---> Running in 0a7b2670f3c1
2.14.12
 ---> d942304d463f
Removing intermediate container 0a7b2670f3c1
Successfully built d942304d463f

```

# Tested image `nodesource/jessie:0.12.6`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 247d48b9d231
 ---> f962e3f45d7c
Removing intermediate container 247d48b9d231
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.6-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 4a3415e87d95
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0 5281k    0 32470    0     0   166k      0  0:00:31 --:--:--  0:00:31  166k[0m[91m100 [0m[91m5281k  100 5281k    0     0  7863k      0 --:--:-- --:--:-- --:--:-- 7859k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.6-1nodesource1~jessie1) ...
Setting up nodejs (0.12.6-1nodesource1~jessie1) ...
 ---> b674f44df2c5
Removing intermediate container 4a3415e87d95
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 9e1a8b18feaf
[91mnpm [0m[91mWARN[0m[91m [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info[0m[91m using[0m[91m pangyp@2.3.3
[0m[91mgyp info using node@0.12.6 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.6/node-v0.12.6.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.6/node-v0.12.6.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp [0m[91mGET http://nodejs.org/dist/v0.12.6/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.6/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.6/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info [0m[91mspawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.6',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args   'build',
[0m[91mgyp [0m[91minfo [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
gyp[0m[91m ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.6
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 67de1df60c75
Removing intermediate container 9e1a8b18feaf
Step 5 : ENV NODE_ENV production
 ---> Running in c30f8f4cb95c
 ---> ae70636865c5
Removing intermediate container c30f8f4cb95c
Step 6 : WORKDIR /usr/src/app
 ---> Running in f338f614d437
 ---> 4f436d8a36ba
Removing intermediate container f338f614d437
Step 7 : CMD npm start
 ---> Running in f29b4431d0af
 ---> b238461015e7
Removing intermediate container f29b4431d0af
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 44d73e5bc67d
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 4s (2255 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 38cf5c0a409d
Removing intermediate container 44d73e5bc67d
Successfully built 38cf5c0a409d

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test76`

Contents of dockerfile `/root/docker-node/.~tmp.test76/Dockerfile`:

```
FROM nodesource/jessie:0.12.6
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.12.6-test1` from `/root/docker-node/.~tmp.test76`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.12.6
 ---> 38cf5c0a409d
Step 2 : ENV NODE_ENV test
 ---> Running in 68f1e8c5b1bf
 ---> 37a74a44d01d
Removing intermediate container 68f1e8c5b1bf
Step 3 : RUN node -v
 ---> Running in 83dc652eba4c
v0.12.6
 ---> 3de06710dbaf
Removing intermediate container 83dc652eba4c
Step 4 : RUN node -p "process.versions"
 ---> Running in 3a35dfe56154
{ http_parser: '2.3',
  node: '0.12.6',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1o' }
 ---> b9dacc50a964
Removing intermediate container 3a35dfe56154
Step 5 : RUN npm --version
 ---> Running in f636119158f6
2.11.2
 ---> facb00267483
Removing intermediate container f636119158f6
Successfully built facb00267483

```

# Tested image `nodesource/jessie:iojs-1.5.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 3d435792247d
 ---> 1adbaffca225
Removing intermediate container 3d435792247d
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.5.1-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 8a0c4631285f
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 67 5106k   67 3439k    0     0  5845k      0 --:--:-- --:--:-- --:--:-- 5839k[0m[91m100 5106k  100 5106k    0     0  7051k      0 --:--:-- --:--:-- --:--:-- 7043k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.5.1-1nodesource1~jessie1) ...
Setting up iojs (1.5.1-1nodesource1~jessie1) ...
 ---> cd6d9a05bcb0
Removing intermediate container 8a0c4631285f
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 1856c20bce1a
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp[0m[91m info using pangyp@2.3.3
gyp info using node@1.5.1 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v1.5.1/iojs-v1.5.1.tar.gz
[0m[91mgyp[0m[91m http 200 https://iojs.org/dist/v1.5.1/iojs-v1.5.1.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v1.5.1/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v1.5.1/SHASUMS256.txt
[0m[91mgyp[0m[91m info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info[0m[91m spawn args   '-f',
[0m[91mgyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp[0m[91m info spawn args   '-I',
[0m[91mgyp[0m[91m [0m[91minfo spawn args[0m[91m   '/root/.node-gyp/1.5.1/common.gypi',
gyp [0m[91minfo [0m[91mspawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.5.1',
gyp info[0m[91m spawn args[0m[91m   '-Druntime=iojs',
[0m[91mgyp info [0m[91mspawn args   '-Dmodule_root_dir=/',
[0m[91mgyp[0m[91m info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info[0m[91m spawn args   'build',
[0m[91mgyp [0m[91minfo[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m
[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.5.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m ---> e2baa7f4e14a
Removing intermediate container 1856c20bce1a
Step 5 : ENV NODE_ENV production
 ---> Running in 44a43d0dc848
 ---> 1caac06ddcfc
Removing intermediate container 44a43d0dc848
Step 6 : WORKDIR /usr/src/app
 ---> Running in 3dcb536aff7e
 ---> fd3b074ffd52
Removing intermediate container 3dcb536aff7e
Step 7 : CMD npm start
 ---> Running in 13304fc1bd2a
 ---> 7ce1597cbf8d
Removing intermediate container 13304fc1bd2a
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in e0395d52f23b
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3222 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> c2f3417c0208
Removing intermediate container e0395d52f23b
Successfully built c2f3417c0208

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test95`

Contents of dockerfile `/root/docker-node/.~tmp.test95/Dockerfile`:

```
FROM nodesource/jessie:iojs-1.5.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-1.5.1-test1` from `/root/docker-node/.~tmp.test95`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-1.5.1
 ---> c2f3417c0208
Step 2 : ENV NODE_ENV test
 ---> Running in 51d3f61bd242
 ---> 8a49c735be7b
Removing intermediate container 51d3f61bd242
Step 3 : RUN node -v
 ---> Running in 2bfe3dfabb17
v1.5.1
 ---> 239f2637e29d
Removing intermediate container 2bfe3dfabb17
Step 4 : RUN node -p "process.versions"
 ---> Running in fc415776df55
{ http_parser: '2.3.0',
  node: '1.5.1',
  v8: '4.1.0.21',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1k' }
 ---> a25d49afbd96
Removing intermediate container fc415776df55
Step 5 : RUN npm --version
 ---> Running in 2bed0c373d14
2.7.0
 ---> 325ba7f158c8
Removing intermediate container 2bed0c373d14
Successfully built 325ba7f158c8

```

# Tested image `nodesource/wheezy:0.10.37`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 2f4e2d644cf6
 ---> c01706f1c6f3
Removing intermediate container 2f4e2d644cf6
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.37-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in b732e29acd71
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:[0m[91m-- --:--:--     0[0m[91m  6 5944k    6  383k    0     0   793k      0  0:00:07 --:--:--  0:00:07 1360k[0m[91m[0m[91m100 5944k  100 5944k    0     0  5847k      0  0:00:01  0:00:01 --:--:-- 7293k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.10.37-1nodesource1~wheezy1) ...
 ---> 10c61b630c7a
Removing intermediate container b732e29acd71
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in ef0557264c00
[91mnpm [0m[91mWARN[0m[91m deprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@0.10.37 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.37/node-v0.10.37.tar.gz
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v0.10.37/node-v0.10.37.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.37/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.37/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.37/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.37',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.37
gyp [0m[91mERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> e0feebde16ca
Removing intermediate container ef0557264c00
Step 5 : ENV NODE_ENV production
 ---> Running in b0205de95f01
 ---> 9b3bc463a9e3
Removing intermediate container b0205de95f01
Step 6 : WORKDIR /usr/src/app
 ---> Running in 6d34facb003f
 ---> 729d5de680ba
Removing intermediate container 6d34facb003f
Step 7 : CMD npm start
 ---> Running in e97203d62294
 ---> 6e82a038bc50
Removing intermediate container e97203d62294
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 11cf45f5c94a
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:3 http://security.debian.org wheezy/updates Release [102 kB]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://httpredir.debian.org wheezy Release [191 kB]
Get:6 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:7 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:8 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 1s (5750 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> ad951efbc500
Removing intermediate container 11cf45f5c94a
Successfully built ad951efbc500

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test20`

Contents of dockerfile `/root/docker-node/.~tmp.test20/Dockerfile`:

```
FROM nodesource/wheezy:0.10.37
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.10.37-test1` from `/root/docker-node/.~tmp.test20`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.10.37
 ---> ad951efbc500
Step 2 : ENV NODE_ENV test
 ---> Running in da04f2b2c4c6
 ---> 127a9ce082d6
Removing intermediate container da04f2b2c4c6
Step 3 : RUN node -v
 ---> Running in 38cf5bfe2f66
v0.10.37
 ---> 09a1b676ae3e
Removing intermediate container 38cf5bfe2f66
Step 4 : RUN node -p "process.versions"
 ---> Running in e1a0d06e0bb8
{ http_parser: '1.0',
  node: '0.10.37',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1l' }
 ---> 6737f0689d9f
Removing intermediate container e1a0d06e0bb8
Step 5 : RUN npm --version
 ---> Running in 230565c03e16
1.4.28
 ---> b67572cc2e6b
Removing intermediate container 230565c03e16
Successfully built b67572cc2e6b

```

# Tested image `nodesource/jessie:iojs-1.3.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in c309d17b7ff8
 ---> 12149d5268e6
Removing intermediate container c309d17b7ff8
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.3.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in f9878b117630
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 23 5065k   23 1183k    0     0  2076k      0  0:00:02 --:--:--  0:00:02 2076k[0m[91m100 5065k  100 5065k    0     0  5674k      0 --:--:-- --:--:-- --:--:-- 5672k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.3.0-1nodesource1~jessie1) ...
Setting up iojs (1.3.0-1nodesource1~jessie1) ...
 ---> d1658dc357dc
Removing intermediate container f9878b117630
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 07d7357bfdf9
[91mnpm[0m[91m [0m[91mWARN [0m[91mdeprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, form-data@0.2.0, http-signature@0.10.1, hawk@1.1.1)
[91mgyp [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@1.3.0 | linux | x64
[0m[91mgyp [0m[91mhttp[0m[91m [0m[91mGET https://iojs.org/dist/v1.3.0/iojs-v1.3.0.tar.gz
[0m[91mgyp[0m[91m http 200 https://iojs.org/dist/v1.3.0/iojs-v1.3.0.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v1.3.0/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v1.3.0/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp[0m[91m info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info[0m[91m spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.3.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
[0m[91mgyp [0m[91minfo[0m[91m [0m[91mspawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.3.0',
gyp info spawn args   '-Druntime=iojs',
gyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info[0m[91m spawn args[0m[91m   '--generator-output',
[0m[91mgyp info [0m[91mspawn args[0m[91m   'build',
gyp info [0m[91mspawn args[0m[91m   '-Goutput_dir=.' ]
[0m
[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.3.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m ---> a682eacc1526
Error removing intermediate container 07d7357bfdf9: rmfs: Unable to remove filesystem for 07d7357bfdf934712c74c9e9ee28c75a81c2f4678e6c627a0f8ae925d9da630c: remove /var/lib/docker/containers/07d7357bfdf934712c74c9e9ee28c75a81c2f4678e6c627a0f8ae925d9da630c/shm: device or resource busy
Step 5 : ENV NODE_ENV production
 ---> Running in 507ccfafbb4c
 ---> 74d428fea181
Error removing intermediate container 07d7357bfdf9: nosuchcontainer: No such container: 07d7357bfdf934712c74c9e9ee28c75a81c2f4678e6c627a0f8ae925d9da630c
Step 6 : WORKDIR /usr/src/app
 ---> Running in 752fe4b388c3
 ---> b41d9712eac4
Removing intermediate container 752fe4b388c3
Error removing intermediate container 07d7357bfdf9: nosuchcontainer: No such container: 07d7357bfdf934712c74c9e9ee28c75a81c2f4678e6c627a0f8ae925d9da630c
Step 7 : CMD npm start
 ---> Running in 0972a48ec52a
 ---> 90f4a37c4d94
Error removing intermediate container 07d7357bfdf9: nosuchcontainer: No such container: 07d7357bfdf934712c74c9e9ee28c75a81c2f4678e6c627a0f8ae925d9da630c
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 04b433a03f13
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3546 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> dac57e6b325f
Removing intermediate container 507ccfafbb4c
Removing intermediate container 0972a48ec52a
Removing intermediate container 04b433a03f13
Error removing intermediate container 07d7357bfdf9: nosuchcontainer: No such container: 07d7357bfdf934712c74c9e9ee28c75a81c2f4678e6c627a0f8ae925d9da630c
Successfully built dac57e6b325f

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test93`

Contents of dockerfile `/root/docker-node/.~tmp.test93/Dockerfile`:

```
FROM nodesource/jessie:iojs-1.3.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-1.3.0-test1` from `/root/docker-node/.~tmp.test93`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-1.3.0
 ---> dac57e6b325f
Step 2 : ENV NODE_ENV test
 ---> Running in 654eb9f90a4f
 ---> 43e7bca1fe18
Removing intermediate container 654eb9f90a4f
Step 3 : RUN node -v
 ---> Running in 4d111c843106
v1.3.0
 ---> eead3aca4c4d
Removing intermediate container 4d111c843106
Step 4 : RUN node -p "process.versions"
 ---> Running in 0b4f2ca7dcc1
{ http_parser: '2.3.0',
  node: '1.3.0',
  v8: '4.1.0.14',
  uv: '1.4.0',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1k' }
 ---> 17721fc46ad5
Removing intermediate container 0b4f2ca7dcc1
Step 5 : RUN npm --version
 ---> Running in 023f2fe117ec
2.5.1
 ---> 7ebd00b32bd6
Removing intermediate container 023f2fe117ec
Successfully built 7ebd00b32bd6

```

# Tested image `nodesource/wheezy:0.12.3`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 607f52f91685
 ---> f70b3e73e6bc
Removing intermediate container 607f52f91685
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.3-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in fa63c2a1f06d
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
            [0m[91m                     Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100[0m[91m 7832k  100 7832k    0     0  7329k      0  0:00:01  0:00:01 --:--:-- 8279k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.12.3-1nodesource1~wheezy1) ...
 ---> 8ffddeaff766
Removing intermediate container fa63c2a1f06d
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in b6a9ee6c8d56
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp [0m[91minfo it worked if it ends with ok
gyp info using pangyp@2.3.3
[0m[91mgyp info using node@0.12.3 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.3/node-v0.12.3.tar.gz
[0m[91mgyp http[0m[91m 200[0m[91m http://nodejs.org/dist/v0.12.3/node-v0.12.3.tar.gz
[0m
[91mgyp http GET http://nodejs.org/dist/v0.12.3/SHASUMS256.txt
gyp http 200 http://nodejs.org/dist/v0.12.3/SHASUMS256.txt
gyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.3/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.3',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
gyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.3
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m ---> f7464eee198e
Removing intermediate container b6a9ee6c8d56
Step 5 : ENV NODE_ENV production
 ---> Running in 1d83c1e432cd
 ---> 907c62712916
Removing intermediate container 1d83c1e432cd
Step 6 : WORKDIR /usr/src/app
 ---> Running in 95d373875c60
 ---> 3dbc167bd601
Removing intermediate container 95d373875c60
Step 7 : CMD npm start
 ---> Running in 680b6a16dc11
 ---> bfcabebe826e
Removing intermediate container 680b6a16dc11
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 6bd2281523c1
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 3s (2727 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> f6ccbde37838
Removing intermediate container 6bd2281523c1
Successfully built f6ccbde37838

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test28`

Contents of dockerfile `/root/docker-node/.~tmp.test28/Dockerfile`:

```
FROM nodesource/wheezy:0.12.3
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.12.3-test1` from `/root/docker-node/.~tmp.test28`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.12.3
 ---> f6ccbde37838
Step 2 : ENV NODE_ENV test
 ---> Running in 2cfdc41b7bf7
 ---> ec51a75c051c
Removing intermediate container 2cfdc41b7bf7
Step 3 : RUN node -v
 ---> Running in eee491c5af5b
v0.12.3
 ---> 2df0982d7688
Removing intermediate container eee491c5af5b
Step 4 : RUN node -p "process.versions"
 ---> Running in d9e4bbaf3d4a
{ http_parser: '2.3',
  node: '0.12.3',
  v8: '3.28.71.19',
  uv: '1.5.0',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1m' }
 ---> 0a375b004cce
Removing intermediate container d9e4bbaf3d4a
Step 5 : RUN npm --version
 ---> Running in 556f02c2ed8f
2.9.1
 ---> 3c75b265013e
Removing intermediate container 556f02c2ed8f
Successfully built 3c75b265013e

```

# Tested image `nodesource/jessie:iojs-2.5.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 3154d0853bd9
 ---> 1aba8060342a
Removing intermediate container 3154d0853bd9
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.5.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 4df30828ff4e
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 6052k  100 6052k    0     0  7176k      0 --:--:-- --:--:-- --:--:-- 7179k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.5.0-1nodesource1~jessie1) ...
Setting up iojs (2.5.0-1nodesource1~jessie1) ...
 ---> 430effdbd47e
Removing intermediate container 4df30828ff4e
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 464466dbc66e
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN[0m[91m deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, tunnel-agent@0.4.2, oauth-sign@0.5.0, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m info it worked if it ends with ok
gyp[0m[91m info using pangyp@2.3.3
gyp info using node@2.5.0 | linux | x64
[0m[91mgyp http GET https://iojs.org/dist/v2.5.0/iojs-v2.5.0.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v2.5.0/iojs-v2.5.0.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v2.5.0/SHASUMS256.txt
[0m[91mgyp http [0m[91m200 https://iojs.org/dist/v2.5.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/2.5.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/2.5.0',
gyp info spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info[0m[91m spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
[0m[91mgyp info spawn args   '--generator-output',
[0m[91mgyp[0m[91m info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v2.5.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 7d50234328f3
Removing intermediate container 464466dbc66e
Step 5 : ENV NODE_ENV production
 ---> Running in 4d375d1ac3e5
 ---> 026a30c87408
Removing intermediate container 4d375d1ac3e5
Step 6 : WORKDIR /usr/src/app
 ---> Running in 6058a7e9d47a
 ---> 2b5e6a74998f
Removing intermediate container 6058a7e9d47a
Step 7 : CMD npm start
 ---> Running in 985d3fd42054
 ---> acd5c0d317e5
Removing intermediate container 985d3fd42054
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in f3562a8c1e48
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 6s (1431 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> f0c37e18a4ec
Removing intermediate container f3562a8c1e48
Successfully built f0c37e18a4ec

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test91`

Contents of dockerfile `/root/docker-node/.~tmp.test91/Dockerfile`:

```
FROM nodesource/jessie:iojs-2.5.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-2.5.0-test1` from `/root/docker-node/.~tmp.test91`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-2.5.0
 ---> f0c37e18a4ec
Step 2 : ENV NODE_ENV test
 ---> Running in 56406232b1c9
 ---> fc86fd4a114f
Removing intermediate container 56406232b1c9
Step 3 : RUN node -v
 ---> Running in 5b7bb4b785a6
v2.5.0
 ---> 2e58f2681455
Removing intermediate container 5b7bb4b785a6
Step 4 : RUN node -p "process.versions"
 ---> Running in 782a887403e1
{ http_parser: '2.5.0',
  node: '2.5.0',
  v8: '4.2.77.21',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2d' }
 ---> 0d7db58006fc
Removing intermediate container 782a887403e1
Step 5 : RUN npm --version
 ---> Running in da1888385aa1
2.13.2
 ---> 97e0486bf21c
Removing intermediate container da1888385aa1
Successfully built 97e0486bf21c

```

# Tested image `nodesource/wheezy:0.12.4`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 32ef1b722a90
 ---> c307584f5063
Removing intermediate container 32ef1b722a90
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.4-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in a9799864ed8c
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 7858k  100 7858k    0     0  7315k      0  0:00:01  0:00:01 --:--:-- 7534k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.12.4-1nodesource1~wheezy1) ...
 ---> 3555b04803f4
Removing intermediate container a9799864ed8c
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in b02f9637673f
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.12.4 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.4/node-v0.12.4.tar.gz
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v0.12.4/node-v0.12.4.tar.gz
[0m[91mgyp[0m[91m http [0m[91mGET[0m[91m http://nodejs.org/dist/v0.12.4/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.4/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info [0m[91mspawn args[0m[91m   '-f',
gyp info spawn args   'make',
gyp info spawn args[0m[91m   '-I',
gyp info [0m[91mspawn args   '/build/config.gypi',
[0m[91mgyp[0m[91m info spawn args   '-I',
gyp info spawn args[0m[91m   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp [0m[91minfo[0m[91m [0m[91mspawn args   '-I',
[0m[91mgyp[0m[91m info spawn args   '/root/.node-gyp/0.12.4/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp [0m[91minfo spawn args[0m[91m   '-Dvisibility=default',
[0m[91mgyp[0m[91m [0m[91minfo[0m[91m [0m[91mspawn args[0m[91m   '-Dnode_root_dir=/root/.node-gyp/0.12.4',
[0m[91mgyp info[0m[91m [0m[91mspawn args[0m[91m   '-Druntime=node',
[0m[91mgyp[0m[91m info spawn args   '-Dmodule_root_dir=/',
gyp info [0m[91mspawn args   '--depth=.',
[0m[91mgyp info spawn args   '--no-parallel',
gyp info spawn args[0m[91m   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.4
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 45464f241257
Removing intermediate container b02f9637673f
Step 5 : ENV NODE_ENV production
 ---> Running in fb72b2d8acb8
 ---> d3382d9f0468
Removing intermediate container fb72b2d8acb8
Step 6 : WORKDIR /usr/src/app
 ---> Running in a7d6d1be75f3
 ---> 1de23ff25e4b
Removing intermediate container a7d6d1be75f3
Step 7 : CMD npm start
 ---> Running in a07047e9981a
 ---> 2b8b6f0ff8f2
Removing intermediate container a07047e9981a
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 4cb7ce01f2f2
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 1s (4730 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 79400194a1ef
Removing intermediate container 4cb7ce01f2f2
Successfully built 79400194a1ef

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test29`

Contents of dockerfile `/root/docker-node/.~tmp.test29/Dockerfile`:

```
FROM nodesource/wheezy:0.12.4
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.12.4-test1` from `/root/docker-node/.~tmp.test29`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.12.4
 ---> 79400194a1ef
Step 2 : ENV NODE_ENV test
 ---> Running in 41f54815c0c5
 ---> ca6c533d5b61
Removing intermediate container 41f54815c0c5
Step 3 : RUN node -v
 ---> Running in 2bf5878383e4
v0.12.4
 ---> 7e6011ca1ad2
Removing intermediate container 2bf5878383e4
Step 4 : RUN node -p "process.versions"
 ---> Running in 1ffa1bce02a3
{ http_parser: '2.3',
  node: '0.12.4',
  v8: '3.28.71.19',
  uv: '1.5.0',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1m' }
 ---> 27d7f7dfe6b5
Removing intermediate container 1ffa1bce02a3
Step 5 : RUN npm --version
 ---> Running in 9546d507ecd3
2.10.1
 ---> 19af29dcee1a
Removing intermediate container 9546d507ecd3
Successfully built 19af29dcee1a

```

# Tested image `nodesource/jessie:0.12.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 8ca87f29b57e
 ---> b4a2af1b209a
Removing intermediate container 8ca87f29b57e
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 7949176f7739
[91m  % T[0m[91motal    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 4998k  100 4998k    0     0  7447k      0 --:--:-- --:--:-- --:--:-- 7449k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.0-1nodesource1~jessie1) ...
Setting up nodejs (0.12.0-1nodesource1~jessie1) ...
 ---> cf5f437563a0
Removing intermediate container 7949176f7739
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in b4fdc19e50c9
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@0.12.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.0/node-v0.12.0.tar.gz
[0m[91mgyp http [0m[91m200 http://nodejs.org/dist/v0.12.0/node-v0.12.0.tar.gz
[0m
[91mgyp http GET http://nodejs.org/dist/v0.12.0/SHASUMS256.txt
gyp http 200 http://nodejs.org/dist/v0.12.0/SHASUMS256.txt
gyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
gyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1067:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m ---> 68a08eb8535e
Error removing intermediate container b4fdc19e50c9: rmfs: Unable to remove filesystem for b4fdc19e50c9fc3024ea8cb281c78824496276930f12ba6a9f3c74711e068913: remove /var/lib/docker/containers/b4fdc19e50c9fc3024ea8cb281c78824496276930f12ba6a9f3c74711e068913/shm: device or resource busy
Step 5 : ENV NODE_ENV production
 ---> Running in 0a531c29abb3
 ---> 6ae20cc60df1
Error removing intermediate container b4fdc19e50c9: nosuchcontainer: No such container: b4fdc19e50c9fc3024ea8cb281c78824496276930f12ba6a9f3c74711e068913
Step 6 : WORKDIR /usr/src/app
 ---> Running in 01af5d5f2a61
 ---> dc37b336e01d
Error removing intermediate container b4fdc19e50c9: nosuchcontainer: No such container: b4fdc19e50c9fc3024ea8cb281c78824496276930f12ba6a9f3c74711e068913
Step 7 : CMD npm start
 ---> Running in 1d96a7be10cb
 ---> 8ce0834a8057
Removing intermediate container 01af5d5f2a61
Removing intermediate container 1d96a7be10cb
Error removing intermediate container b4fdc19e50c9: nosuchcontainer: No such container: b4fdc19e50c9fc3024ea8cb281c78824496276930f12ba6a9f3c74711e068913
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 032cb6a63017
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 1s (6249 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> db5d712472b6
Removing intermediate container 0a531c29abb3
Removing intermediate container 032cb6a63017
Error removing intermediate container b4fdc19e50c9: nosuchcontainer: No such container: b4fdc19e50c9fc3024ea8cb281c78824496276930f12ba6a9f3c74711e068913
Successfully built db5d712472b6

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test70`

Contents of dockerfile `/root/docker-node/.~tmp.test70/Dockerfile`:

```
FROM nodesource/jessie:0.12.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.12.0-test1` from `/root/docker-node/.~tmp.test70`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.12.0
 ---> db5d712472b6
Step 2 : ENV NODE_ENV test
 ---> Running in d3c99058a6b2
 ---> 5f32f74e4d70
Removing intermediate container d3c99058a6b2
Step 3 : RUN node -v
 ---> Running in 2d0c3b3ee0b4
v0.12.0
 ---> 9feddbed543e
Removing intermediate container 2d0c3b3ee0b4
Step 4 : RUN node -p "process.versions"
 ---> Running in a12502e81611
{ http_parser: '2.3',
  node: '0.12.0',
  v8: '3.28.73',
  uv: '1.0.2',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1l' }
 ---> bad6eae639d4
Removing intermediate container a12502e81611
Step 5 : RUN npm --version
 ---> Running in d05aa1fddad3
2.5.1
 ---> 6f39b29fab21
Removing intermediate container d05aa1fddad3
Successfully built 6f39b29fab21

```

# Tested image `nodesource/wheezy:0.10.34`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 5767c3cafb8b
 ---> 142fa2ede44f
Removing intermediate container 5767c3cafb8b
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.34-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 91803dffb501
[91m  % Total  [0m[91m  % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 15 5936k   15  911k    0     0  2226k      0  0:00:02 --:--:--  0:00:02 2950k[0m[91m100 5936k  100 5936k    0     0  7245k      0 --:--:-- --:--:-- --:--:-- 8255k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.10.34-1nodesource1~wheezy1) ...
 ---> 47772a5d893e
Removing intermediate container 91803dffb501
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in cf3759764af6
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, tunnel-agent@0.4.2, stringstream@0.0.5, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.10.34 | linux | x64
[0m[91mgyp [0m[91mhttp [0m[91mGET[0m[91m http://nodejs.org/dist/v0.10.34/node-v0.10.34.tar.gz
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v0.10.34/node-v0.10.34.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.10.34/SHASUMS256.txt
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v0.10.34/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.34/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.34',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m ERR! configure error 
[0m[91mgyp ERR! stack[0m[91m Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.34
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 887e85336eb0
Removing intermediate container cf3759764af6
Step 5 : ENV NODE_ENV production
 ---> Running in 5ae558ddf04c
 ---> 72ae2c0330c8
Removing intermediate container 5ae558ddf04c
Step 6 : WORKDIR /usr/src/app
 ---> Running in 9156a39708cd
 ---> 5cdef0ed9f05
Removing intermediate container 9156a39708cd
Step 7 : CMD npm start
 ---> Running in d45442689184
 ---> b35669f1a4f2
Removing intermediate container d45442689184
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in e0c91e0fae85
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 1s (5069 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 668bbc78575d
Removing intermediate container e0c91e0fae85
Successfully built 668bbc78575d

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test17`

Contents of dockerfile `/root/docker-node/.~tmp.test17/Dockerfile`:

```
FROM nodesource/wheezy:0.10.34
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.10.34-test1` from `/root/docker-node/.~tmp.test17`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.10.34
 ---> 668bbc78575d
Step 2 : ENV NODE_ENV test
 ---> Running in 639e27fdf7eb
 ---> ea4b60b4444d
Removing intermediate container 639e27fdf7eb
Step 3 : RUN node -v
 ---> Running in 7359a39315b8
v0.10.34
 ---> bcc260903b38
Removing intermediate container 7359a39315b8
Step 4 : RUN node -p "process.versions"
 ---> Running in 1395d3ae7167
{ http_parser: '1.0',
  node: '0.10.34',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.30',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1j' }
 ---> 7679432323d4
Removing intermediate container 1395d3ae7167
Step 5 : RUN npm --version
 ---> Running in c4136bba54d9
1.4.28
 ---> 8ff927cac59b
Removing intermediate container c4136bba54d9
Successfully built 8ff927cac59b

```

# Tested image `nodesource/jessie:0.12.8`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 13579a9eed83
 ---> 8535223cc80c
Removing intermediate container 13579a9eed83
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.8-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in deee73002716
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 7089k  100 7089k    0     0  7932k      0 --:--:-- --:--:-- --:--:-- 7930k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.8-1nodesource1~jessie1) ...
Setting up nodejs (0.12.8-1nodesource1~jessie1) ...
 ---> c31ca227d855
Removing intermediate container deee73002716
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 00233637f000
[91mnpm[0m[91m [0m[91mWARN[0m[91m [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo[0m[91m it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@0.12.8 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.12.8/node-v0.12.8.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.8/node-v0.12.8.tar.gz
[0m[91mgyp [0m[91mhttp GET http://nodejs.org/dist/v0.12.8/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.8/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.8/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.8',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp [0m[91minfo spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1075:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.8
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> f4653a764bc5
Removing intermediate container 00233637f000
Step 5 : ENV NODE_ENV production
 ---> Running in f10b92408de6
 ---> d2c7669a4b3d
Removing intermediate container f10b92408de6
Step 6 : WORKDIR /usr/src/app
 ---> Running in 1eeb2241443d
 ---> a1c094462f6f
Removing intermediate container 1eeb2241443d
Step 7 : CMD npm start
 ---> Running in f144ebd234dc
 ---> b03e2c9e0fad
Removing intermediate container f144ebd234dc
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in b1514399671a
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (3141 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 784960f35ddf
Removing intermediate container b1514399671a
Successfully built 784960f35ddf

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test78`

Contents of dockerfile `/root/docker-node/.~tmp.test78/Dockerfile`:

```
FROM nodesource/jessie:0.12.8
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.12.8-test1` from `/root/docker-node/.~tmp.test78`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.12.8
 ---> 784960f35ddf
Step 2 : ENV NODE_ENV test
 ---> Running in 2ba02107bc51
 ---> 38c72513d914
Removing intermediate container 2ba02107bc51
Step 3 : RUN node -v
 ---> Running in 37fefaddcfb6
v0.12.8
 ---> 929633f831a5
Removing intermediate container 37fefaddcfb6
Step 4 : RUN node -p "process.versions"
 ---> Running in ee705062effe
{ http_parser: '2.3',
  node: '0.12.8',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1p' }
 ---> 828d3bffea23
Removing intermediate container ee705062effe
Step 5 : RUN npm --version
 ---> Running in 386a8deda9a4
2.14.9
 ---> 7595c628b6e4
Removing intermediate container 386a8deda9a4
Successfully built 7595c628b6e4

```

# Tested image `nodesource/wheezy:0.12.10`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 95947a866cb3
 ---> 49c43ffc22ce
Removing intermediate container 95947a866cb3
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.10-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in b8d8d6119eb3
[91m  % Total   [0m[91m % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 70  9.8M   70 7103k    0     0  7686k      0  0:00:01 --:--:--  0:00:01 7937k[0m[91m100  9.8M  100  9.8M    0     0  8812k      0  0:00:01  0:00:01 --:--:-- 9058k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.12.10-1nodesource1~wheezy1) ...
 ---> ea4b6fa5c4d3
Removing intermediate container b8d8d6119eb3
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 383d890993b4
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, tunnel-agent@0.4.2, stringstream@0.0.5, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.12.10 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.10/node-v0.12.10.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.10/node-v0.12.10.tar.gz
[0m[91mgyp [0m[91mhttp GET http://nodejs.org/dist/v0.12.10/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v0.12.10/SHASUMS256.txt
[0m[91mgyp info[0m[91m spawn python
[0m[91mgyp[0m[91m info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info [0m[91mspawn args   '/build/config.gypi',
[0m[91mgyp[0m[91m info spawn args[0m[91m   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info[0m[91m spawn args[0m[91m   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.10/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.10',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m ERR![0m[91m configure error 
[0m[91mgyp ERR! stack[0m[91m Error: `gyp` failed with exit code: 1
[0m[91mgyp[0m[91m ERR![0m[91m stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1075:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
[0m[91mgyp [0m[91mERR! cwd /
gyp ERR! [0m[91mnode -v v0.12.10
gyp [0m[91mERR! pangyp -v[0m[91m v2.3.3
[0m[91mgyp ERR! not ok 
[0m
 ---> f85dd6c6d703
Removing intermediate container 383d890993b4
Step 5 : ENV NODE_ENV production
 ---> Running in 032fca4d458c
 ---> 3071ec3b1d33
Removing intermediate container 032fca4d458c
Step 6 : WORKDIR /usr/src/app
 ---> Running in e0cb351b327e
 ---> 687994085d80
Removing intermediate container e0cb351b327e
Step 7 : CMD npm start
 ---> Running in cef59920f651
 ---> 83c1d5c98398
Removing intermediate container cef59920f651
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 7a8e6de1cfa4
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 1s (4478 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> ca70529bff8d
Removing intermediate container 7a8e6de1cfa4
Successfully built ca70529bff8d

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test26`

Contents of dockerfile `/root/docker-node/.~tmp.test26/Dockerfile`:

```
FROM nodesource/wheezy:0.12.10
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.12.10-test1` from `/root/docker-node/.~tmp.test26`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.12.10
 ---> ca70529bff8d
Step 2 : ENV NODE_ENV test
 ---> Running in 95f656179f4d
 ---> 3a3f26fabab1
Removing intermediate container 95f656179f4d
Step 3 : RUN node -v
 ---> Running in fd2ea885f22a
v0.12.10
 ---> 898dd1e99962
Removing intermediate container fd2ea885f22a
Step 4 : RUN node -p "process.versions"
 ---> Running in 99100755deda
{ http_parser: '2.3',
  node: '0.12.10',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1r' }
 ---> 0cffdd1f73be
Removing intermediate container 99100755deda
Step 5 : RUN npm --version
 ---> Running in 887c57bb02d5
2.14.9
 ---> 33e506dda400
Removing intermediate container 887c57bb02d5
Successfully built 33e506dda400

```

# Tested image `nodesource/jessie:0.10.34`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 75665063569a
 ---> e3cc809e8448
Removing intermediate container 75665063569a
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.34-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in fe678a299351
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0  [0m[91m   0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 3955k  100 3955k    0     0  6582k      0 --:--:-- --:--:-- --:--:[0m[91m-- 6582k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.34-1nodesource1~jessie1) ...
Setting up nodejs (0.10.34-1nodesource1~jessie1) ...
 ---> 908db900934e
Removing intermediate container fe678a299351
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 6d38a18773ae
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, oauth-sign@0.5.0, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@0.10.34 | linux | x64
gyp http GET http://nodejs.org/dist/v0.10.34/node-v0.10.34.tar.gz
gyp http 200 http://nodejs.org/dist/v0.10.34/node-v0.10.34.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.34/SHASUMS256.txt
gyp http 200 http://nodejs.org/dist/v0.10.34/SHASUMS256.txt
[0m[91mgyp info spawn[0m[91m python
[0m[91mgyp info [0m[91mspawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.34/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.34',
gyp info[0m[91m spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp [0m[91minfo spawn args   'build',
gyp info[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
[0m[91mgyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.34
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> d3c01aa50e8e
Removing intermediate container 6d38a18773ae
Step 5 : ENV NODE_ENV production
 ---> Running in ed78c0627880
 ---> c3ab7f744b9a
Removing intermediate container ed78c0627880
Step 6 : WORKDIR /usr/src/app
 ---> Running in 4ff8424b12e0
 ---> a358f3268691
Removing intermediate container 4ff8424b12e0
Step 7 : CMD npm start
 ---> Running in cbaa7380b954
 ---> 283ef67efe25
Removing intermediate container cbaa7380b954
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 3411d7b5043b
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 4s (2140 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 5807ef06aade
Removing intermediate container 3411d7b5043b
Successfully built 5807ef06aade

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test62`

Contents of dockerfile `/root/docker-node/.~tmp.test62/Dockerfile`:

```
FROM nodesource/jessie:0.10.34
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.10.34-test1` from `/root/docker-node/.~tmp.test62`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.10.34
 ---> 5807ef06aade
Step 2 : ENV NODE_ENV test
 ---> Running in e4e63b64240f
 ---> 935376363db9
Removing intermediate container e4e63b64240f
Step 3 : RUN node -v
 ---> Running in 35c99c5fa44e
v0.10.34
 ---> a29e882f1b41
Removing intermediate container 35c99c5fa44e
Step 4 : RUN node -p "process.versions"
 ---> Running in ffacba931260
{ http_parser: '1.0',
  node: '0.10.34',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.30',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1j' }
 ---> 79d3b6a07783
Removing intermediate container ffacba931260
Step 5 : RUN npm --version
 ---> Running in 1faf7ff3e37a
1.4.28
 ---> 6e2651f57bde
Removing intermediate container 1faf7ff3e37a
Successfully built 6e2651f57bde

```

# Tested image `nodesource/jessie:iojs-2.1.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 31c489a9d52a
 ---> 960c25580220
Removing intermediate container 31c489a9d52a
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.1.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in f3e6ff97461c
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 48 5632k   48 2703k    0     0  3420k      0  0:00:01 --:--:--  0:00:01 3418k[0m[91m100 5632k  100 5632k    0     0  5306k      0  0:00:01  0:00:01 --:--:-- 5308k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.1.0-1nodesource1~jessie1) ...
Setting up iojs (2.1.0-1nodesource1~jessie1) ...
 ---> 23fa9f65fd27
Removing intermediate container f3e6ff97461c
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 5323b04180db
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@2.1.0 | linux | x64
gyp http GET https://iojs.org/dist/v2.1.0/iojs-v2.1.0.tar.gz
gyp http 200 https://iojs.org/dist/v2.1.0/iojs-v2.1.0.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v2.1.0/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v2.1.0/SHASUMS256.txt
[0m[91mgyp[0m[91m [0m[91minfo spawn python
[0m[91mgyp [0m[91minfo spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp [0m[91minfo spawn args[0m[91m   'binding.gyp',
[0m[91mgyp[0m[91m [0m[91minfo spawn args   '-f',
[0m[91mgyp[0m[91m [0m[91minfo spawn args   'make',
gyp[0m[91m info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
[0m[91mgyp info[0m[91m [0m[91mspawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/2.1.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info[0m[91m spawn args   '-Dvisibility=default',
[0m[91mgyp[0m[91m info spawn args[0m[91m   '-Dnode_root_dir=/root/.node-gyp/2.1.0',
[0m[91mgyp info spawn args   '-Druntime=iojs',
[0m[91mgyp info spawn args[0m[91m   '-Dmodule_root_dir=/',
[0m[91mgyp info spawn args   '--depth=.',
[0m[91mgyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
[0m[91mgyp[0m[91m info[0m[91m spawn args   'build',
gyp[0m[91m info[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
[0m[91mgyp ERR! stack[0m[91m Error: `gyp` failed with exit code: 1
gyp[0m[91m ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR![0m[91m stack     at ChildProcess.emit (events.js:172:7)
gyp[0m[91m [0m[91mERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1009:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v2.1.0
gyp ERR![0m[91m pangyp -v v2.3.3
[0m[91mgyp ERR! not ok 
[0m
 ---> d9428e1e8ae8
Removing intermediate container 5323b04180db
Step 5 : ENV NODE_ENV production
 ---> Running in 55d079594a41
 ---> 046adfb1013f
Removing intermediate container 55d079594a41
Step 6 : WORKDIR /usr/src/app
 ---> Running in ea06db1ec437
 ---> 50f80eabd3f8
Removing intermediate container ea06db1ec437
Step 7 : CMD npm start
 ---> Running in d53e81804529
 ---> dde74b6d7af7
Removing intermediate container d53e81804529
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 6af0ceccae9c
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:4 http://httpredir.debian.org jessie Release [148 kB]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (4435 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 9b6b985968f2
Removing intermediate container 6af0ceccae9c
Successfully built 9b6b985968f2

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test99`

Contents of dockerfile `/root/docker-node/.~tmp.test99/Dockerfile`:

```
FROM nodesource/jessie:iojs-2.1.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-2.1.0-test1` from `/root/docker-node/.~tmp.test99`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-2.1.0
 ---> 9b6b985968f2
Step 2 : ENV NODE_ENV test
 ---> Running in cbbe941d6fa7
 ---> 76560548c71a
Removing intermediate container cbbe941d6fa7
Step 3 : RUN node -v
 ---> Running in 2ddbd789a60d
v2.1.0
 ---> 454b5df563a2
Removing intermediate container 2ddbd789a60d
Step 4 : RUN node -p "process.versions"
 ---> Running in d4613c3f8e6b
{ http_parser: '2.5.0',
  node: '2.1.0',
  v8: '4.2.77.20',
  uv: '1.5.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2a' }
 ---> 25381d86cb49
Removing intermediate container d4613c3f8e6b
Step 5 : RUN npm --version
 ---> Running in 81a835411f81
2.10.1
 ---> 94223828b840
Removing intermediate container 81a835411f81
Successfully built 94223828b840

```

# Tested image `nodesource/wheezy:0.12.2`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 33b31270a77d
 ---> f1f160da6398
Removing intermediate container 33b31270a77d
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.2-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in df644684e843
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 93 7644k   93 7151k    0     0  7841k      0 -[0m[91m-:--:-- --:--:-- --:--:-- 8099k[0m[91m100 7644k  100 7644k    0     0  8056k      0 --:--:-- --:--:-- --:--:-- 8318k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.12.2-1nodesource1~wheezy1) ...
 ---> 48f353cd8bcb
Removing intermediate container df644684e843
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 1110d42bf279
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo[0m[91m [0m[91mit worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp[0m[91m [0m[91minfo using node@0.12.2 | linux | x64
[0m[91mgyp http [0m[91mGET http://nodejs.org/dist/v0.12.2/node-v0.12.2.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp[0m[91m 200 http://nodejs.org/dist/v0.12.2/node-v0.12.2.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp [0m[91mGET[0m[91m http://nodejs.org/dist/v0.12.2/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.2/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.2/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.2',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.2
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 037d72ae9bcf
Removing intermediate container 1110d42bf279
Step 5 : ENV NODE_ENV production
 ---> Running in 5d47a0a865ff
 ---> 20953fe39ad2
Removing intermediate container 5d47a0a865ff
Step 6 : WORKDIR /usr/src/app
 ---> Running in 544f3aed5b96
 ---> 57f735348c77
Removing intermediate container 544f3aed5b96
Step 7 : CMD npm start
 ---> Running in 87a5d69ccc5d
 ---> 748717298818
Removing intermediate container 87a5d69ccc5d
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 76212fd25923
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Get:9 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Fetched 8511 kB in 1s (4277 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> a4cddcbd309b
Removing intermediate container 76212fd25923
Successfully built a4cddcbd309b

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test27`

Contents of dockerfile `/root/docker-node/.~tmp.test27/Dockerfile`:

```
FROM nodesource/wheezy:0.12.2
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.12.2-test1` from `/root/docker-node/.~tmp.test27`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.12.2
 ---> a4cddcbd309b
Step 2 : ENV NODE_ENV test
 ---> Running in 9c90c294d433
 ---> d624ae3c99b2
Removing intermediate container 9c90c294d433
Step 3 : RUN node -v
 ---> Running in 6914bcf863c4
v0.12.2
 ---> b411179451b1
Removing intermediate container 6914bcf863c4
Step 4 : RUN node -p "process.versions"
 ---> Running in 73b2acfad040
{ http_parser: '2.3',
  node: '0.12.2',
  v8: '3.28.73',
  uv: '1.4.2-node1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1m' }
 ---> 0e2cf76b4acb
Removing intermediate container 73b2acfad040
Step 5 : RUN npm --version
 ---> Running in 4cbba4bfdf00
2.7.4
 ---> 1e6da4101ac4
Removing intermediate container 4cbba4bfdf00
Successfully built 1e6da4101ac4

```

# Tested image `nodesource/jessie:4.1.2`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 20b9982b0839
 ---> 9534e1029f14
Removing intermediate container 20b9982b0839
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.1.2-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in e00b77ea5bab
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 41 6474k   41 2671k    0     0  4011k      0  0:00:01 --:--:--  0:00:01 4011k[0m[91m100 6474k  100 6474k    0     0  6829k      0 --:--:-- --:--:-- --:--:-- 6829k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.1.2-1nodesource1~jessie1) ...
Setting up nodejs (4.1.2-1nodesource1~jessie1) ...
 ---> 9774421d7acc
Removing intermediate container e00b77ea5bab
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 464c5bc962da
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, oauth-sign@0.5.0, tunnel-agent@0.4.2, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@4.1.2 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.1.2/node-v4.1.2.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.1.2/node-v4.1.2.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v4.1.2/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.1.2/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.1.2/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.1.2',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp [0m[91mERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR![0m[91m cwd /
gyp ERR! node -v v4.1.2
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 8e02d6c5566b
Removing intermediate container 464c5bc962da
Step 5 : ENV NODE_ENV production
 ---> Running in 307d0561093e
 ---> ae8e14e13565
Removing intermediate container 307d0561093e
Step 6 : WORKDIR /usr/src/app
 ---> Running in ae6a65c8b4aa
 ---> 51d76f3d8906
Removing intermediate container ae6a65c8b4aa
Step 7 : CMD npm start
 ---> Running in c277fbd2dbd4
 ---> f4ab0f141a56
Removing intermediate container c277fbd2dbd4
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in e84f2220f199
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:4 http://httpredir.debian.org jessie Release [148 kB]
Get:5 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:6 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 1s (5427 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 9772536d1319
Removing intermediate container e84f2220f199
Successfully built 9772536d1319

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test49`

Contents of dockerfile `/root/docker-node/.~tmp.test49/Dockerfile`:

```
FROM nodesource/jessie:4.1.2
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:4.1.2-test1` from `/root/docker-node/.~tmp.test49`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:4.1.2
 ---> 9772536d1319
Step 2 : ENV NODE_ENV test
 ---> Running in 1717c97e14dd
 ---> b72b742f016a
Removing intermediate container 1717c97e14dd
Step 3 : RUN node -v
 ---> Running in ade682aa14b4
v4.1.2
 ---> db9d7975fa1b
Removing intermediate container ade682aa14b4
Step 4 : RUN node -p "process.versions"
 ---> Running in c47715ed068c
{ http_parser: '2.5.0',
  node: '4.1.2',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '46',
  openssl: '1.0.2d' }
 ---> 101a388e8d9e
Removing intermediate container c47715ed068c
Step 5 : RUN npm --version
 ---> Running in 5c0689f23f1d
2.14.4
 ---> 79e27d2edb95
Removing intermediate container 5c0689f23f1d
Successfully built 79e27d2edb95

```

# Tested image `nodesource/jessie:0.12.7`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in cedec30163d3
 ---> 73cd960576e5
Removing intermediate container cedec30163d3
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.7-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 47319f101121
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                         [0m[91m        Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  7 5285k    7  399k    0     0  1410k      0  0:00:03 --:--:--  0:00:03 1407k[0m[91m100 5285k  100 5285k    0     0  7725k      0 --:--:-- --:--:-- --:--:-- 7726k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.7-1nodesource1~jessie1) ...
Setting up nodejs (0.12.7-1nodesource1~jessie1) ...
 ---> 5240361fdb2c
Removing intermediate container 47319f101121
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in f3118ee087f5
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@0.12.7 | linux | x64
[0m[91mgyp[0m[91m http [0m[91mGET[0m[91m http://nodejs.org/dist/v0.12.7/node-v0.12.7.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.7/node-v0.12.7.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.7/SHASUMS256.txt
[0m[91mgyp http [0m[91m200 http://nodejs.org/dist/v0.12.7/SHASUMS256.txt
[0m[91mgyp info spawn[0m[91m python
[0m[91mgyp [0m[91minfo spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info[0m[91m spawn args[0m[91m   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp[0m[91m info [0m[91mspawn args   '-I',
[0m[91mgyp info[0m[91m spawn args   '/build/config.gypi',
gyp[0m[91m info spawn args   '-I',
gyp[0m[91m [0m[91minfo spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp info spawn args[0m[91m   '-I',
[0m[91mgyp[0m[91m info[0m[91m spawn args[0m[91m   '/root/.node-gyp/0.12.7/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
[0m[91mgyp [0m[91minfo [0m[91mspawn args[0m[91m   '-Dvisibility=default',
[0m[91mgyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.7',
gyp info spawn args[0m[91m   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
[0m[91mgyp [0m[91minfo spawn args[0m[91m   '--no-parallel',
[0m[91mgyp info spawn args   '--generator-output',
gyp info[0m[91m [0m[91mspawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp[0m[91m ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.7
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> accd52399cf2
Removing intermediate container f3118ee087f5
Step 5 : ENV NODE_ENV production
 ---> Running in 1fb796c61c71
 ---> b80dc3a82510
Removing intermediate container 1fb796c61c71
Step 6 : WORKDIR /usr/src/app
 ---> Running in 4379f53c6a62
 ---> ce2b7e05d96b
Removing intermediate container 4379f53c6a62
Step 7 : CMD npm start
 ---> Running in b9b484e6f46e
 ---> 5345f81e4c60
Removing intermediate container b9b484e6f46e
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in d49580078661
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie Release [148 kB]
Get:6 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 1s (5520 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> f728d3f4e664
Removing intermediate container d49580078661
Successfully built f728d3f4e664

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test77`

Contents of dockerfile `/root/docker-node/.~tmp.test77/Dockerfile`:

```
FROM nodesource/jessie:0.12.7
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.12.7-test1` from `/root/docker-node/.~tmp.test77`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.12.7
 ---> f728d3f4e664
Step 2 : ENV NODE_ENV test
 ---> Running in 778157f47199
 ---> 3832163eb443
Removing intermediate container 778157f47199
Step 3 : RUN node -v
 ---> Running in 971d67af5445
v0.12.7
 ---> ae0b1b1d3838
Removing intermediate container 971d67af5445
Step 4 : RUN node -p "process.versions"
 ---> Running in a5e6b17baad8
{ http_parser: '2.3',
  node: '0.12.7',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1p' }
 ---> 987bf6e807b8
Removing intermediate container a5e6b17baad8
Step 5 : RUN npm --version
 ---> Running in f7ac824029db
2.11.3
 ---> 0ce3e34af5b3
Removing intermediate container f7ac824029db
Successfully built 0ce3e34af5b3

```

# Tested image `nodesource/wheezy:5.4.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 65ab28613d29
 ---> 197412a12983
Removing intermediate container 65ab28613d29
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.4.1-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 85b2e6e6a6c6
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 74 10.8M   74 8239k    0     0  8095k      0  0:00:01  0:00:01 --:--:-- 8331k[0m[91m100 10.8M  100 10.8M    0     0  9790k      0  0:00:01  0:00:01 --:--:--  9.8M
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (5.4.1-1nodesource1~wheezy1) ...
 ---> 176275db9f29
Removing intermediate container 85b2e6e6a6c6
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in c374e91d91eb
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using[0m[91m node@5.4.1 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v5.4.1/node-v5.4.1.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v5.4.1/node-v5.4.1.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v5.4.1/SHASUMS256.txt
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v5.4.1/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info[0m[91m spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.4.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.4.1',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp [0m[91minfo[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.4.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 2a2e573dbfa0
Removing intermediate container c374e91d91eb
Step 5 : ENV NODE_ENV production
 ---> Running in f1db731f464a
 ---> 432451a62c7e
Removing intermediate container f1db731f464a
Step 6 : WORKDIR /usr/src/app
 ---> Running in 69d626456464
 ---> d016ccb68083
Removing intermediate container 69d626456464
Step 7 : CMD npm start
 ---> Running in 0a47c297d6e3
 ---> be07c6f840a9
Removing intermediate container 0a47c297d6e3
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 1184cea14625
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://httpredir.debian.org wheezy Release [191 kB]
Get:6 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:7 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 6s (1369 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> b318c0fac617
Removing intermediate container 1184cea14625
Successfully built b318c0fac617

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test10`

Contents of dockerfile `/root/docker-node/.~tmp.test10/Dockerfile`:

```
FROM nodesource/wheezy:5.4.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:5.4.1-test1` from `/root/docker-node/.~tmp.test10`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:5.4.1
 ---> b318c0fac617
Step 2 : ENV NODE_ENV test
 ---> Running in 5fd03f90694e
 ---> 497f330ba766
Removing intermediate container 5fd03f90694e
Step 3 : RUN node -v
 ---> Running in f09583353d5b
v5.4.1
 ---> d910b2b44434
Removing intermediate container f09583353d5b
Step 4 : RUN node -p "process.versions"
 ---> Running in 5f1442220f25
{ http_parser: '2.6.0',
  node: '5.4.1',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> b63848b02cd2
Removing intermediate container 5f1442220f25
Step 5 : RUN npm --version
 ---> Running in bc216701ecf9
3.3.12
 ---> 8a715b220de3
Removing intermediate container bc216701ecf9
Successfully built 8a715b220de3

```

# Tested image `nodesource/wheezy:4.2.4`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in a40b64903822
 ---> 34df039d25a3
Removing intermediate container a40b64903822
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.4-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 0bd33d16eda7
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  1 10.6M    1  127k    0     0   322k      0  0:00:33 --:--:--  0:00:33  350k[0m[91m100 10.6M  100 10.6M    0     0  8314k      0  0:00:01  0:00:01 --:-[0m[91m-:-- 8527k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (4.2.4-1nodesource1~wheezy1) ...
 ---> 381a6352f50b
Removing intermediate container 0bd33d16eda7
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 74121f06e629
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (forever-agent@0.5.2, caseless@0.8.0, aws-sign2@0.5.0, oauth-sign@0.5.0, tunnel-agent@0.4.2, stringstream@0.0.5, json-stringify-safe@5.0.1, mime-types@1.0.2, tough-cookie@2.2.1, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@4.2.4 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.2.4/node-v4.2.4.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.4/node-v4.2.4.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v4.2.4/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.4/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.4/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.4',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
[0m
[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.2.4
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m ---> 3a0e0342a6d5
Removing intermediate container 74121f06e629
Step 5 : ENV NODE_ENV production
 ---> Running in 85ca07c4527a
 ---> 35c8c2c704c7
Removing intermediate container 85ca07c4527a
Step 6 : WORKDIR /usr/src/app
 ---> Running in 9f2cc17c76e8
 ---> dc5b5cf9a4a6
Removing intermediate container 9f2cc17c76e8
Step 7 : CMD npm start
 ---> Running in 85c27259decb
 ---> 52706e6b464f
Removing intermediate container 85c27259decb
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 3ea7661eb1b6
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 2s (3532 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 1038203eb41f
Removing intermediate container 3ea7661eb1b6
Successfully built 1038203eb41f

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test39`

Contents of dockerfile `/root/docker-node/.~tmp.test39/Dockerfile`:

```
FROM nodesource/wheezy:4.2.4
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:4.2.4-test1` from `/root/docker-node/.~tmp.test39`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:4.2.4
 ---> 1038203eb41f
Step 2 : ENV NODE_ENV test
 ---> Running in 310c56d528d4
 ---> 884fc146cd81
Removing intermediate container 310c56d528d4
Step 3 : RUN node -v
 ---> Running in 9a07cd613aef
v4.2.4
 ---> c4ed66288294
Removing intermediate container 9a07cd613aef
Step 4 : RUN node -p "process.versions"
 ---> Running in 12867a749a41
{ http_parser: '2.5.0',
  node: '4.2.4',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2e' }
 ---> a663610d83f5
Removing intermediate container 12867a749a41
Step 5 : RUN npm --version
 ---> Running in eca0f7699b75
2.14.12
 ---> 32bba3923104
Removing intermediate container eca0f7699b75
Successfully built 32bba3923104

```

# Tested image `nodesource/jessie:4.2.3`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in a89e94bb2b99
 ---> 81b03435130d
Removing intermediate container a89e94bb2b99
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.3-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 810d5da2f033
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total[0m[91m   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 58 8285k   58 4863k    0[0m[91m     0  5578k      0  0:00:01 --:--:--  0:00:01 5577k[0m[91m100 8285k  100 8285k    0     0  7383k      0  0:00:01  0:00:01 --:--:-- 7390k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.2.3-1nodesource1~jessie1) ...
Setting up nodejs (4.2.3-1nodesource1~jessie1) ...
 ---> 9677b2a281dc
Removing intermediate container 810d5da2f033
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in c3c291bdf72c
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (forever-agent@0.5.2, caseless@0.8.0, aws-sign2@0.5.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@4.2.3 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v4.2.3/node-v4.2.3.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.3/node-v4.2.3.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp[0m[91m GET http://nodejs.org/dist/v4.2.3/SHASUMS256.txt
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v4.2.3/SHASUMS256.txt
[0m[91mgyp[0m[91m info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info [0m[91mspawn args   '-f',
[0m[91mgyp [0m[91minfo[0m[91m [0m[91mspawn args[0m[91m   'make',
gyp [0m[91minfo spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp[0m[91m [0m[91minfo spawn args   '-I',
gyp info spawn args[0m[91m   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp[0m[91m info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.3/common.gypi',
[0m[91mgyp[0m[91m info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp[0m[91m info[0m[91m spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.3',
gyp info spawn args   '-Druntime=node',
gyp[0m[91m info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info [0m[91mspawn args   '--depth=.',
[0m[91mgyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp[0m[91m [0m[91minfo spawn args[0m[91m   'build',
gyp info[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR![0m[91m configure error 
[0m[91mgyp [0m[91mERR! [0m[91mstack[0m[91m Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
[0m[91mgyp ERR![0m[91m stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR![0m[91m System[0m[91m Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.2.3
[0m[91mgyp [0m[91mERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 4b55eb9de2e3
Removing intermediate container c3c291bdf72c
Step 5 : ENV NODE_ENV production
 ---> Running in 6a516df70b80
 ---> 36b934ce32d8
Removing intermediate container 6a516df70b80
Step 6 : WORKDIR /usr/src/app
 ---> Running in a9dfdae1bee8
 ---> 037b6f52388c
Removing intermediate container a9dfdae1bee8
Step 7 : CMD npm start
 ---> Running in c384c214ae0a
 ---> 6fe3aff89642
Removing intermediate container c384c214ae0a
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 728f619ef411
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 10s (922 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 780d9f00fa03
Removing intermediate container 728f619ef411
Successfully built 780d9f00fa03

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test84`

Contents of dockerfile `/root/docker-node/.~tmp.test84/Dockerfile`:

```
FROM nodesource/jessie:4.2.3
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:4.2.3-test1` from `/root/docker-node/.~tmp.test84`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:4.2.3
 ---> 780d9f00fa03
Step 2 : ENV NODE_ENV test
 ---> Running in 7053d061a537
 ---> 1fced1470df4
Removing intermediate container 7053d061a537
Step 3 : RUN node -v
 ---> Running in 7e984cc8badf
v4.2.3
 ---> 767ffd01d917
Removing intermediate container 7e984cc8badf
Step 4 : RUN node -p "process.versions"
 ---> Running in 013ca0c3dda7
{ http_parser: '2.5.0',
  node: '4.2.3',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2e' }
 ---> d7388cb29a1d
Error removing intermediate container 013ca0c3dda7: rmdriverfs: Driver aufs failed to remove root filesystem 013ca0c3dda7044a27d848bd13bf7519046b9106cfeaf009efc9ac8ded182874: rename /var/lib/docker/aufs/mnt/738edbaf677f02bb6c7fa0826d9d256019726a9a260d71c1ea747b2611fb785a /var/lib/docker/aufs/mnt/738edbaf677f02bb6c7fa0826d9d256019726a9a260d71c1ea747b2611fb785a-removing: device or resource busy
Step 5 : RUN npm --version
 ---> Running in 1dda43fc5e27
2.14.7
 ---> c83eb8603f46
Error removing intermediate container 013ca0c3dda7: nosuchcontainer: No such container: 013ca0c3dda7044a27d848bd13bf7519046b9106cfeaf009efc9ac8ded182874
Successfully built c83eb8603f46

```

# Tested image `nodesource/wheezy:0.10.39`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in cca0dc23910b
 ---> 0dbe5579a342
Removing intermediate container cca0dc23910b
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.39-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 95ea68ba4fd1
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0 5946k    0 16086    0     0    98k      0  0:01:00 --:--:--  0:01:00  120k[0m[91m100 5946k  100 5946k    0     0  7936k      0 --:--:-- --:--:-- --:--:-- 8247k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.10.39-1nodesource1~wheezy1) ...
 ---> edec54a68415
Removing intermediate container 95ea68ba4fd1
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 6a41a25ba574
[91mnpm[0m[91m WARN [0m[91mdeprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (graceful-fs@4.1.3, inherits@2.0.1)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.10.39 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.39/node-v0.10.39.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.39/node-v0.10.39.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.39/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.39/SHASUMS256.txt
[0m[91mgyp[0m[91m info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.39/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.39',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.39
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 2369608924e4
Removing intermediate container 6a41a25ba574
Step 5 : ENV NODE_ENV production
 ---> Running in d4fee35fb654
 ---> d2de3f343852
Removing intermediate container d4fee35fb654
Step 6 : WORKDIR /usr/src/app
 ---> Running in 93d370888475
 ---> f03e5768d029
Removing intermediate container 93d370888475
Step 7 : CMD npm start
 ---> Running in 85d24643e298
 ---> f566d308cf10
Removing intermediate container 85d24643e298
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 1e5dd185da7d
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 1s (4801 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> cb56aaf0efb2
Removing intermediate container 1e5dd185da7d
Successfully built cb56aaf0efb2

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test22`

Contents of dockerfile `/root/docker-node/.~tmp.test22/Dockerfile`:

```
FROM nodesource/wheezy:0.10.39
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.10.39-test1` from `/root/docker-node/.~tmp.test22`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.10.39
 ---> cb56aaf0efb2
Step 2 : ENV NODE_ENV test
 ---> Running in 104e91bbe1fb
 ---> cb08b59efe65
Removing intermediate container 104e91bbe1fb
Step 3 : RUN node -v
 ---> Running in acdc073a6470
v0.10.39
 ---> 385c0832597c
Removing intermediate container acdc073a6470
Step 4 : RUN node -p "process.versions"
 ---> Running in 75ed4973f699
{ http_parser: '1.0',
  node: '0.10.39',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1o' }
 ---> 69cd1ce8cb04
Removing intermediate container 75ed4973f699
Step 5 : RUN npm --version
 ---> Running in 32706eda7c44
1.4.28
 ---> 5cf4a71484a0
Removing intermediate container 32706eda7c44
Successfully built 5cf4a71484a0

```

# Tested image `nodesource/wheezy:5.1.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 0a1121633495
 ---> 1df382d6f6e0
Removing intermediate container 0a1121633495
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.1.0-2nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 38b67b71ceaa
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spe[0m[91mnt    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 84 10.5M   84 9087k    0     0  9322k      0  0:00:01 --:--:--  0:00:01 9606k[0m[91m100 10.5M  100 10.5M    0     0  9730k    [0m[91m  0  0:00:01  0:00:01 --:--:--  9.7M[0m[91m
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (5.1.0-2nodesource1~wheezy1) ...
 ---> 647635955df0
Removing intermediate container 38b67b71ceaa
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 63cebdab3364
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@5.1.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v5.1.0/node-v5.1.0.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v5.1.0/node-v5.1.0.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v5.1.0/SHASUMS256.txt
[0m[91mgyp http 200[0m[91m http://nodejs.org/dist/v5.1.0/SHASUMS256.txt
[0m[91mgyp[0m[91m info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
[0m[91mgyp info spawn args   '-I',
gyp info [0m[91mspawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.1.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.1.0',
gyp info spawn args   '-Druntime=node',
gyp info[0m[91m spawn args[0m[91m   '-Dmodule_root_dir=/',
[0m[91mgyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR![0m[91m [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR![0m[91m [0m[91mstack[0m[91m     at ChildProcess.emit (events.js:172:7)
[0m[91mgyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR![0m[91m node -v v5.1.0
[0m[91mgyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 959fc924006b
Removing intermediate container 63cebdab3364
Step 5 : ENV NODE_ENV production
 ---> Running in 53c4d3ba0c46
 ---> 37c9a0cf989d
Removing intermediate container 53c4d3ba0c46
Step 6 : WORKDIR /usr/src/app
 ---> Running in 70eb08b01418
 ---> 71ea1e5e3abf
Removing intermediate container 70eb08b01418
Step 7 : CMD npm start
 ---> Running in 19cf0e878b86
 ---> f09cd8fec812
Removing intermediate container 19cf0e878b86
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in e47099559a27
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 1s (5003 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 7fd703b7ece5
Removing intermediate container e47099559a27
Successfully built 7fd703b7ece5

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test42`

Contents of dockerfile `/root/docker-node/.~tmp.test42/Dockerfile`:

```
FROM nodesource/wheezy:5.1.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:5.1.0-test1` from `/root/docker-node/.~tmp.test42`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:5.1.0
 ---> 7fd703b7ece5
Step 2 : ENV NODE_ENV test
 ---> Running in ec7988f26d92
 ---> 586ace9e223e
Removing intermediate container ec7988f26d92
Step 3 : RUN node -v
 ---> Running in f3316337df97
v5.1.0
 ---> 73fad76d9847
Removing intermediate container f3316337df97
Step 4 : RUN node -p "process.versions"
 ---> Running in 2c42b902b473
{ http_parser: '2.6.0',
  node: '5.1.0',
  v8: '4.6.85.31',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2d' }
 ---> d02704f6546c
Removing intermediate container 2c42b902b473
Step 5 : RUN npm --version
 ---> Running in ce1e53f2cea9
3.3.12
 ---> aef427330f40
Removing intermediate container ce1e53f2cea9
Successfully built aef427330f40

```

# Tested image `nodesource/jessie:4.2.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 15a769b47d88
 ---> 01326e44e063
Removing intermediate container 15a769b47d88
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 5db2a5270616
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 6489k  100 6489k    0     0  7656k      0 --:--:-- --:--:-- --:--:-- 7661k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.2.0-1nodesource1~jessie1) ...
Setting up nodejs (4.2.0-1nodesource1~jessie1) ...
 ---> 0e99b851d52a
Removing intermediate container 5db2a5270616
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 2669bd020f6e
[91mnpm[0m[91m [0m[91mWARN deprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (forever-agent@0.5.2, aws-sign2@0.5.0, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, node-uuid@1.4.7, qs@2.3.3, combined-stream@0.0.7, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
[0m[91mgyp info using node@4.2.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v4.2.0/node-v4.2.0.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.0/node-v4.2.0.tar.gz
[0m[91mgyp[0m[91m http GET[0m[91m http://nodejs.org/dist/v4.2.0/SHASUMS256.txt
[0m[91mgyp[0m[91m http 200[0m[91m http://nodejs.org/dist/v4.2.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp [0m[91minfo [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.2.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 6ed9bb6f73e0
Removing intermediate container 2669bd020f6e
Step 5 : ENV NODE_ENV production
 ---> Running in 4e2bf5c841c9
 ---> 60011c25681d
Removing intermediate container 4e2bf5c841c9
Step 6 : WORKDIR /usr/src/app
 ---> Running in c7392fe4374f
 ---> 4977dfe5d5f6
Removing intermediate container c7392fe4374f
Step 7 : CMD npm start
 ---> Running in d9c591307748
 ---> 557721943f36
Removing intermediate container d9c591307748
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in d0ed1b89eed5
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 5s (1619 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 5f538db3c10b
Removing intermediate container d0ed1b89eed5
Successfully built 5f538db3c10b

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test81`

Contents of dockerfile `/root/docker-node/.~tmp.test81/Dockerfile`:

```
FROM nodesource/jessie:4.2.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:4.2.0-test1` from `/root/docker-node/.~tmp.test81`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:4.2.0
 ---> 5f538db3c10b
Step 2 : ENV NODE_ENV test
 ---> Running in 1a24fe8113be
 ---> 9d4cd4e3d21f
Removing intermediate container 1a24fe8113be
Step 3 : RUN node -v
 ---> Running in b0f033fba0c2
v4.2.0
 ---> f790d541b73f
Removing intermediate container b0f033fba0c2
Step 4 : RUN node -p "process.versions"
 ---> Running in 1eb20d138d20
{ http_parser: '2.5.0',
  node: '4.2.0',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '46',
  openssl: '1.0.2d' }
 ---> 19ec593b381a
Removing intermediate container 1eb20d138d20
Step 5 : RUN npm --version
 ---> Running in 731d8e1d3e3f
2.14.7
 ---> fa90e89da25f
Removing intermediate container 731d8e1d3e3f
Successfully built fa90e89da25f

```

# Tested image `nodesource/wheezy:0.12.9`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 72579787a550
 ---> f73ca635845c
Removing intermediate container 72579787a550
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.9-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in df2a01a1501c
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 15  9.8M   15 1519k    0     0  3499k      0  0:00:02 --:--:-[0m[91m-  0:00:02 3743k[0m[91m100  9.8M  100  9.8M    0     0  9024k      0  0:00:01  0:00:01 --:--:-- 9[0m[91m269k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.12.9-1nodesource1~wheezy1) ...
 ---> e30dad7aa36c
Removing intermediate container df2a01a1501c
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in c80631f008d0
[91mnpm [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@0.12.9 | linux | x64
[0m[91mgyp http[0m[91m GET http://nodejs.org/dist/v0.12.9/node-v0.12.9.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.9/node-v0.12.9.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.9/SHASUMS256.txt
[0m[91mgyp http 200[0m[91m http://nodejs.org/dist/v0.12.9/SHASUMS256.txt
[0m[91mgyp[0m[91m info spawn python
[0m[91mgyp info spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp [0m[91minfo spawn args[0m[91m   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp [0m[91minfo [0m[91mspawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.9/common.gypi',
gyp[0m[91m info[0m[91m spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.9',
gyp info[0m[91m [0m[91mspawn args[0m[91m   '-Druntime=node',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
[0m[91mgyp[0m[91m info spawn args   '--no-parallel',
gyp info spawn args[0m[91m   '--generator-output',
[0m[91mgyp info[0m[91m [0m[91mspawn args[0m[91m   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp [0m[91mERR! [0m[91mstack[0m[91m Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp [0m[91mERR! [0m[91mstack     at ChildProcess.emit (events.js:110:17)
[0m[91mgyp[0m[91m ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1075:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v[0m[91m v0.12.9
[0m[91mgyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 859761384cdf
Removing intermediate container c80631f008d0
Step 5 : ENV NODE_ENV production
 ---> Running in 58d18cf6041b
 ---> 781aa143fe15
Removing intermediate container 58d18cf6041b
Step 6 : WORKDIR /usr/src/app
 ---> Running in ab3f1dd5c57b
 ---> 3c75502bc48a
Removing intermediate container ab3f1dd5c57b
Step 7 : CMD npm start
 ---> Running in d527eddafd46
 ---> b9e40a1ce0c3
Removing intermediate container d527eddafd46
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 15fc861cce61
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 5s (1628 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 2333b5c1a507
Removing intermediate container 15fc861cce61
Successfully built 2333b5c1a507

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test3`

Contents of dockerfile `/root/docker-node/.~tmp.test3/Dockerfile`:

```
FROM nodesource/wheezy:0.12.9
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.12.9-test1` from `/root/docker-node/.~tmp.test3`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.12.9
 ---> 2333b5c1a507
Step 2 : ENV NODE_ENV test
 ---> Running in d6544290a519
 ---> 721c095e4ba6
Removing intermediate container d6544290a519
Step 3 : RUN node -v
 ---> Running in 39747f0a6b9f
v0.12.9
 ---> cc2db2dd5252
Removing intermediate container 39747f0a6b9f
Step 4 : RUN node -p "process.versions"
 ---> Running in c92c0ca8fbde
{ http_parser: '2.3',
  node: '0.12.9',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1q' }
 ---> 47d60292eabd
Removing intermediate container c92c0ca8fbde
Step 5 : RUN npm --version
 ---> Running in c53f0a85788d
2.14.9
 ---> 105f2644c2d7
Removing intermediate container c53f0a85788d
Successfully built 105f2644c2d7

```

# Tested image `nodesource/jessie:5.6.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 91c1c02cd495
 ---> 878583c3fb6a
Removing intermediate container 91c1c02cd495
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.6.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 48230e8d5d5a
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  9 8787k    9  799k    0     0  1801k      0  0:00:04 --:--:--  0:00:04 1801k[0m[91m100 8787k  100 8787k    0     0  6976k      0  0:00:01  0:00:01 --:--:[0m[91m-- 6979k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.6.0-1nodesource1~jessie1) ...
Setting up nodejs (5.6.0-1nodesource1~jessie1) ...
 ---> 8c3c23014047
Removing intermediate container 48230e8d5d5a
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 689f83435cc6
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@5.6.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v5.6.0/node-v5.6.0.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v5.6.0/node-v5.6.0.tar.gz
[0m[91mgyp[0m[91m http GET[0m[91m http://nodejs.org/dist/v5.6.0/SHASUMS256.txt
[0m[91mgyp http [0m[91m200 http://nodejs.org/dist/v5.6.0/SHASUMS256.txt
[0m[91mgyp [0m[91minfo spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args[0m[91m   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp[0m[91m info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.6.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.6.0',
gyp info spawn args   '-Druntime=node',
gyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args[0m[91m   '--generator-output',
[0m[91mgyp[0m[91m [0m[91minfo [0m[91mspawn args   'build',
gyp info [0m[91mspawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:100:13)
gyp ERR! stack     at ChildProcess.emit (events.js:185:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp [0m[91mERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.6.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 8b734f25bf20
Removing intermediate container 689f83435cc6
Step 5 : ENV NODE_ENV production
 ---> Running in 55aa8f8cda75
 ---> 72d24a241172
Removing intermediate container 55aa8f8cda75
Step 6 : WORKDIR /usr/src/app
 ---> Running in d626e91917c9
 ---> 7684091512e5
Removing intermediate container d626e91917c9
Step 7 : CMD npm start
 ---> Running in 15408f2ab8ed
 ---> 69f30e0586f2
Removing intermediate container 15408f2ab8ed
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 53d7e8a651d7
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 6s (1380 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 520c561db2f9
Removing intermediate container 53d7e8a651d7
Successfully built 520c561db2f9

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test57`

Contents of dockerfile `/root/docker-node/.~tmp.test57/Dockerfile`:

```
FROM nodesource/jessie:5.6.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:5.6.0-test1` from `/root/docker-node/.~tmp.test57`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:5.6.0
 ---> 520c561db2f9
Step 2 : ENV NODE_ENV test
 ---> Running in bd2aee225392
 ---> 046844f0d12a
Removing intermediate container bd2aee225392
Step 3 : RUN node -v
 ---> Running in f0508799fe7d
v5.6.0
 ---> 28cad8f0f159
Removing intermediate container f0508799fe7d
Step 4 : RUN node -p "process.versions"
 ---> Running in 00b1d3ce65f7
{ http_parser: '2.6.1',
  node: '5.6.0',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2f' }
 ---> 250b76061ec4
Removing intermediate container 00b1d3ce65f7
Step 5 : RUN npm --version
 ---> Running in f5f4d26f811c
3.6.0
 ---> abeeeef726c4
Removing intermediate container f5f4d26f811c
Successfully built abeeeef726c4

```

# Tested image `nodesource/wheezy:5.1.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 2528782b8254
 ---> 5fc734180d23
Removing intermediate container 2528782b8254
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.1.1-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in bf79772d7d6b
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:[0m[91m--:--     0[0m[91m 27 10.5M   27 2911k    0     0  3006k      0  0:00:03 --:--:--  0:00:03 3908k[0m[91m100 10.5M  100 10.5M    0     0  6986k      0  0:00:01  0:00:01 --:--:-- 8180k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (5.1.1-1nodesource1~wheezy1) ...
 ---> 4699ace60e76
Removing intermediate container bf79772d7d6b
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 00fcf47a3005
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with[0m[91m ok
[0m[91mgyp[0m[91m info using pangyp@2.3.3
gyp info using node@5.1.1 | linux | x64
[0m[91mgyp[0m[91m http GET[0m[91m http://nodejs.org/dist/v5.1.1/node-v5.1.1.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v5.1.1/node-v5.1.1.tar.gz
[0m[91mgyp[0m[91m http[0m[91m GET http://nodejs.org/dist/v5.1.1/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v5.1.1/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info[0m[91m spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp[0m[91m info[0m[91m [0m[91mspawn args   '-f',
gyp info spawn args   'make',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info [0m[91mspawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp info spawn args   '-I',
gyp[0m[91m info [0m[91mspawn args   '/root/.node-gyp/5.1.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp[0m[91m info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.1.1',
gyp info spawn args   '-Druntime=node',
gyp info[0m[91m [0m[91mspawn args   '-Dmodule_root_dir=/',
gyp [0m[91minfo spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args[0m[91m   'build',
[0m[91mgyp [0m[91minfo[0m[91m [0m[91mspawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m [0m[91mERR! configure error 
[0m[91mgyp [0m[91mERR![0m[91m stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
[0m[91mgyp[0m[91m [0m[91mERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp [0m[91mERR! [0m[91mSystem Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp ERR! node -v v5.1.1
[0m[91mgyp ERR! [0m[91mpangyp -v v2.3.3
[0m[91mgyp ERR! not ok 
[0m
 ---> bc42b825c18a
Removing intermediate container 00fcf47a3005
Step 5 : ENV NODE_ENV production
 ---> Running in 2253a1c88c56
 ---> c126e1d32e37
Removing intermediate container 2253a1c88c56
Step 6 : WORKDIR /usr/src/app
 ---> Running in 80c688d83f9c
 ---> 2486a87cdf10
Removing intermediate container 80c688d83f9c
Step 7 : CMD npm start
 ---> Running in dc1cb4de5d21
 ---> 9bcf7f5708ee
Removing intermediate container dc1cb4de5d21
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in d29b58215b81
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://httpredir.debian.org wheezy Release [191 kB]
Get:6 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:7 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 4s (1980 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 305b7ef4e32a
Removing intermediate container d29b58215b81
Successfully built 305b7ef4e32a

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test7`

Contents of dockerfile `/root/docker-node/.~tmp.test7/Dockerfile`:

```
FROM nodesource/wheezy:5.1.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:5.1.1-test1` from `/root/docker-node/.~tmp.test7`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:5.1.1
 ---> 305b7ef4e32a
Step 2 : ENV NODE_ENV test
 ---> Running in f4ded794b12c
 ---> bda00ae0662b
Removing intermediate container f4ded794b12c
Step 3 : RUN node -v
 ---> Running in dda8f0a4959d
v5.1.1
 ---> 220bb9604665
Removing intermediate container dda8f0a4959d
Step 4 : RUN node -p "process.versions"
 ---> Running in fbf599742349
{ http_parser: '2.6.0',
  node: '5.1.1',
  v8: '4.6.85.31',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> aff5b2ea5f88
Removing intermediate container fbf599742349
Step 5 : RUN npm --version
 ---> Running in b20c4deaab27
3.3.12
 ---> 625a30f2ccf3
Removing intermediate container b20c4deaab27
Successfully built 625a30f2ccf3

```

# Tested image `nodesource/jessie:4.2.6`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 94b875a32830
 ---> fbc0ece9762f
Removing intermediate container 94b875a32830
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.6-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in da5b2ad42097
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0  [0m[91m  0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 8390k  100 8390k    0     0  9121k      0 --:--:-- --:--:-- --:--:-- 9119k[0m[91m
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.2.6-1nodesource1~jessie1) ...
Setting up nodejs (4.2.6-1nodesource1~jessie1) ...
 ---> 3e00fbac68e2
Removing intermediate container da5b2ad42097
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in c9c8f69276b0
[91mnpm[0m[91m [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (forever-agent@0.5.2, caseless@0.8.0, aws-sign2@0.5.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@4.2.6 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v4.2.6/node-v4.2.6.tar.gz
[0m[91mgyp[0m[91m http 200[0m[91m http://nodejs.org/dist/v4.2.6/node-v4.2.6.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.2.6/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.6/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp[0m[91m info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp [0m[91minfo spawn args   '-I',
gyp[0m[91m info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args[0m[91m   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp info [0m[91mspawn args[0m[91m   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.6/common.gypi',
gyp[0m[91m info[0m[91m spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp[0m[91m [0m[91minfo[0m[91m spawn args[0m[91m   '-Dnode_root_dir=/root/.node-gyp/4.2.6',
[0m[91mgyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp [0m[91minfo spawn args   '--depth=.',
gyp[0m[91m [0m[91minfo spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp[0m[91m [0m[91minfo spawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp [0m[91mERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
[0m[91mgyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
[0m[91mgyp ERR! node -v v4.2.6
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 46a0df145388
Removing intermediate container c9c8f69276b0
Step 5 : ENV NODE_ENV production
 ---> Running in 367a1bf09296
 ---> a61ed7bb3c19
Removing intermediate container 367a1bf09296
Step 6 : WORKDIR /usr/src/app
 ---> Running in 47386fbf7656
 ---> 3552d4f5c7ab
Removing intermediate container 47386fbf7656
Step 7 : CMD npm start
 ---> Running in 54d0e9f4f92e
 ---> 5247cc93eb0d
Removing intermediate container 54d0e9f4f92e
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 0c750b5f927b
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Ign http://httpredir.debian.org jessie InRelease
Get:5 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 13s (710 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 3056c1ab532e
Removing intermediate container 0c750b5f927b
Successfully built 3056c1ab532e

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test50`

Contents of dockerfile `/root/docker-node/.~tmp.test50/Dockerfile`:

```
FROM nodesource/jessie:4.2.6
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:4.2.6-test1` from `/root/docker-node/.~tmp.test50`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:4.2.6
 ---> 3056c1ab532e
Step 2 : ENV NODE_ENV test
 ---> Running in 54f859f976f3
 ---> a6321403c99a
Removing intermediate container 54f859f976f3
Step 3 : RUN node -v
 ---> Running in 7ad134c93f24
v4.2.6
 ---> 2d63b9907794
Removing intermediate container 7ad134c93f24
Step 4 : RUN node -p "process.versions"
 ---> Running in f20bdfa591dc
{ http_parser: '2.5.0',
  node: '4.2.6',
  v8: '4.5.103.35',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2e' }
 ---> 73942de8bc63
Removing intermediate container f20bdfa591dc
Step 5 : RUN npm --version
 ---> Running in a550cd237316
2.14.12
 ---> 0953ce41544d
Removing intermediate container a550cd237316
Successfully built 0953ce41544d

```

# Tested image `nodesource/jessie:0.10.42`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 9c75bcbfe635
 ---> 4d3e987d1a4c
Removing intermediate container 9c75bcbfe635
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.42-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 72c943514c91
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 32 4282k   32 1407k    0     0  3605k      0  0:00:01 --:--:--  0:00:01 3600k[0m[91m100 4282k  100 4282k    0     0  6717k      0 --:--:-- --:--:-- --:--:-- 6712k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.42-1nodesource1~jessie1) ...
Setting up nodejs (0.10.42-1nodesource1~jessie1) ...
 ---> 0a02a8f73241
Removing intermediate container 72c943514c91
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 86c71ae1b4ba
[91mnpm WARN deprecated This version of npm lacks support for important features,
npm WARN deprecated such as scoped packages, offered by the primary npm
npm WARN deprecated registry. Consider upgrading to at least npm@2, if not the
npm WARN deprecated latest stable version. To upgrade to npm@2, run:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest-2
npm WARN deprecated[0m[91m 
npm WARN deprecated To upgrade to the latest stable version, run:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest
npm WARN deprecated 
npm WARN deprecated (Depending on how Node.js was installed on your system, you
npm WARN deprecated may need to prefix the preceding commands with `sudo`, or if
[0m[91mnpm WARN deprecated on Windows, run them from an Administrator prompt.)
npm WARN deprecated 
npm WARN deprecated If you're running the version of npm bundled with
npm WARN deprecated Node.js 0.10 LTS, be aware that the next version of 0.10 LTS
npm WARN deprecated will be bundled with a version of npm@2, which has some small
npm WARN deprecated backwards-incompatible changes made to `npm run-script` and
npm WARN[0m[91m [0m[91mdeprecated semver behavior.
[0m[91mnpm [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mnpm[0m[91m WARN [0m[91mdeprecated This version of npm lacks support for important features,
npm WARN deprecated such as scoped packages, offered by the primary npm
npm WARN deprecated registry. Consider upgrading to at least npm@2, if not the
npm WARN deprecated latest stable version. To upgrade to npm@2, run:
npm WARN deprecated 
npm [0m[91mWARN deprecated   npm -g install npm@latest-2
npm WARN deprecated 
npm WARN deprecated To upgrade to the latest stable version, run:
npm WARN deprecated 
[0m[91mnpm WARN[0m[91m deprecated   npm -g install npm@latest
npm[0m[91m WARN[0m[91m deprecated 
npm WARN deprecated (Depending on how Node.js was installed on your system, you
[0m[91mnpm [0m[91mWARN deprecated may need to prefix the preceding commands with `sudo`, or if
npm WARN deprecated on Windows, run them from an Administrator prompt.)
npm WARN deprecated 
npm WARN deprecated[0m[91m If you're running the version of npm bundled with
[0m[91mnpm WARN[0m[91m deprecated Node.js 0.10 LTS, be aware that the next version of 0.10 LTS
[0m[91mnpm WARN deprecated[0m[91m will be bundled with a version of npm@2, which has some small
npm WARN deprecated backwards-incompatible changes made to `npm run-script` and
npm WARN deprecated semver behavior.
[0m[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.10.42 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.42/node-v0.10.42.tar.gz
gyp http 200 http://nodejs.org/dist/v0.10.42/node-v0.10.42.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp [0m[91mGET[0m[91m http://nodejs.org/dist/v0.10.42/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v0.10.42/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info [0m[91mspawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp [0m[91minfo spawn args   'binding.gyp',
gyp[0m[91m info spawn args   '-f',
[0m[91mgyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
[0m[91mgyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.42/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.42',
gyp info[0m[91m spawn args   '-Druntime=node',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp[0m[91m [0m[91minfo [0m[91mspawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.42
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 1ab0454747e0
Removing intermediate container 86c71ae1b4ba
Step 5 : ENV NODE_ENV production
 ---> Running in 1f7920eac027
 ---> fc00996958cd
Removing intermediate container 1f7920eac027
Step 6 : WORKDIR /usr/src/app
 ---> Running in ba7650553449
 ---> e2a97a5c13ec
Removing intermediate container ba7650553449
Step 7 : CMD npm start
 ---> Running in 56485c96fd86
 ---> e0c196dba9a7
Removing intermediate container 56485c96fd86
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 4233bdadecc7
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (4566 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 5ec3a99ffaa9
Removing intermediate container 4233bdadecc7
Successfully built 5ec3a99ffaa9

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test46`

Contents of dockerfile `/root/docker-node/.~tmp.test46/Dockerfile`:

```
FROM nodesource/jessie:0.10.42
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.10.42-test1` from `/root/docker-node/.~tmp.test46`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.10.42
 ---> 5ec3a99ffaa9
Step 2 : ENV NODE_ENV test
 ---> Running in 8a4558e47d66
 ---> 076c0f472ee9
Removing intermediate container 8a4558e47d66
Step 3 : RUN node -v
 ---> Running in ec485d88a1ea
v0.10.42
 ---> a061d0d15dd2
Removing intermediate container ec485d88a1ea
Step 4 : RUN node -p "process.versions"
 ---> Running in 00b42cbaef8c
{ http_parser: '1.1',
  node: '0.10.42',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1r' }
 ---> 782706a9f1b9
Removing intermediate container 00b42cbaef8c
Step 5 : RUN npm --version
 ---> Running in bf3baec42740
1.4.29
 ---> 18278a273bbb
Removing intermediate container bf3baec42740
Successfully built 18278a273bbb

```

# Tested image `nodesource/wheezy:0.10.42`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in acad2baaf669
 ---> a1da611f8df6
Removing intermediate container acad2baaf669
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.42-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 2db5eeaf21b3
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 18 6390k   18 1167k    0     0  3300k      0  0:00:01 --:--:--  0:00:0[0m[91m1 3592k[0m[91m100 6390k  100 6390k    0     0  8492k      0 --:--:-- --:--:-- --:--:-- 8826k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.10.42-1nodesource1~wheezy1) ...
 ---> 2fe10b1e4062
Removing intermediate container 2db5eeaf21b3
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 0fa613b8da71
[91mnpm WARN deprecated This version of npm lacks support for important features,
npm WARN deprecated such as scoped packages, offered by the primary npm
npm WARN deprecated registry. Consider upgrading to at least npm@2, if not the
npm WARN deprecated latest stable version. To upgrade to npm@2, run:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest-2
npm WARN deprecated 
npm WARN deprecated To upgrade to the latest stable version, run:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest
npm WARN deprecated 
npm WARN deprecated (Depending on how Node.js was installed on your system, you
npm WARN deprecated may need to prefix the preceding commands with `sudo`, or if
npm WARN deprecated on Windows, run them from an Administrator prompt.)
npm WARN deprecated 
npm WARN deprecated If you're running the version of npm bundled with
npm WARN deprecated Node.js 0.10 LTS, be aware that the next version of 0.10 LTS
npm WARN deprecated will be bundled with a version of npm@2, which has some small
npm WARN deprecated backwards-incompatible changes made to `npm run-script` and
npm WARN deprecated semver behavior.
[0m[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mnpm[0m[91m WARN deprecated This version of npm lacks support for important features,
npm WARN deprecated such as scoped packages, offered by the primary npm
npm WARN deprecated registry. Consider upgrading to at least npm@2, if not the
npm WARN deprecated latest stable version. To upgrade to npm@2, run:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest-2
npm WARN deprecated 
npm WARN deprecated To upgrade to the latest stable version, run:
npm [0m[91mWARN deprecated 
npm WARN deprecated   npm -g install npm@latest
npm WARN deprecated 
npm WARN [0m[91mdeprecated (Depending on how Node.js was installed on your system, you
[0m[91mnpm WARN deprecated may need to prefix the preceding commands with `sudo`, or if
npm WARN deprecated on Windows, run them from an Administrator prompt.)
npm WARN deprecated 
npm WARN deprecated If you're running the version of npm bundled with
npm WARN deprecated Node.js 0.10 LTS, be aware that the next version of 0.10 LTS
npm WARN deprecated will be bundled with a version of npm@2, which has some small
npm WARN deprecated backwards-incompatible changes made to `npm run-script` and
npm WARN deprecated semver behavior.
[0m[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@0.10.42 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.42/node-v0.10.42.tar.gz
[0m[91mgyp http [0m[91m200 http://nodejs.org/dist/v0.10.42/node-v0.10.42.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.42/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.42/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.42/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.42',
gyp info[0m[91m spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.42
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 75fd2e0e57b4
Removing intermediate container 0fa613b8da71
Step 5 : ENV NODE_ENV production
 ---> Running in 4d78885e2870
 ---> 97ed04e27eea
Removing intermediate container 4d78885e2870
Step 6 : WORKDIR /usr/src/app
 ---> Running in baf47deafc9c
 ---> f1a7c65dbfa9
Removing intermediate container baf47deafc9c
Step 7 : CMD npm start
 ---> Running in fa5b885b51f8
 ---> c8d7a438185a
Removing intermediate container fa5b885b51f8
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in fb385ee4d03e
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://httpredir.debian.org wheezy Release [191 kB]
Get:6 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:7 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:8 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Get:9 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Fetched 8511 kB in 5s (1631 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 38581fa0521b
Removing intermediate container fb385ee4d03e
Successfully built 38581fa0521b

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test2`

Contents of dockerfile `/root/docker-node/.~tmp.test2/Dockerfile`:

```
FROM nodesource/wheezy:0.10.42
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.10.42-test1` from `/root/docker-node/.~tmp.test2`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.10.42
 ---> 38581fa0521b
Step 2 : ENV NODE_ENV test
 ---> Running in fe14281b3a78
 ---> e2f3d2e5ba60
Removing intermediate container fe14281b3a78
Step 3 : RUN node -v
 ---> Running in d9282caa8ab7
v0.10.42
 ---> 0cb6fb8d7378
Removing intermediate container d9282caa8ab7
Step 4 : RUN node -p "process.versions"
 ---> Running in 4912099f8343
{ http_parser: '1.1',
  node: '0.10.42',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1r' }
 ---> 31761f859230
Removing intermediate container 4912099f8343
Step 5 : RUN npm --version
 ---> Running in 52cf132db3b7
1.4.29
 ---> 740ddb6c9c70
Removing intermediate container 52cf132db3b7
Successfully built 740ddb6c9c70

```

# Tested image `nodesource/jessie:0.12.4`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 106b96edf22f
 ---> e43b4637002f
Removing intermediate container 106b96edf22f
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.4-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in adef8e3f4366
[91m  % Total    % Received % Xferd  Average Speed   Time    Time   [0m[91m  Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5193k  100 5193k    0     0  6858k      0 --:--:-- --:--:-- --:--:-- 6851k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.4-1nodesource1~jessie1) ...
Setting up nodejs (0.12.4-1nodesource1~jessie1) ...
 ---> a095a0d3005d
Removing intermediate container adef8e3f4366
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 0b3bd44bca52
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with[0m[91m ok
[0m[91mgyp [0m[91minfo [0m[91musing[0m[91m pangyp@2.3.3
gyp info using node@0.12.4 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.12.4/node-v0.12.4.tar.gz
[0m[91mgyp http [0m[91m200 http://nodejs.org/dist/v0.12.4/node-v0.12.4.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.12.4/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.4/SHASUMS256.txt
[0m[91mgyp [0m[91minfo[0m[91m spawn python
[0m[91mgyp[0m[91m info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.4/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.4',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! [0m[91mconfigure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
[0m[91mgyp ERR![0m[91m System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
[0m[91mgyp[0m[91m [0m[91mERR! cwd /
gyp ERR! node -v v0.12.4
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> ed907229c075
Removing intermediate container 0b3bd44bca52
Step 5 : ENV NODE_ENV production
 ---> Running in 12f29649480c
 ---> d5920960b356
Removing intermediate container 12f29649480c
Step 6 : WORKDIR /usr/src/app
 ---> Running in 2abf5a94ee80
 ---> 4c9d5e3bfcd0
Removing intermediate container 2abf5a94ee80
Step 7 : CMD npm start
 ---> Running in c77d8179ceee
 ---> be48e658313b
Removing intermediate container c77d8179ceee
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 72fb7144d044
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (3200 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 3b0f9d717f9a
Removing intermediate container 72fb7144d044
Successfully built 3b0f9d717f9a

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test74`

Contents of dockerfile `/root/docker-node/.~tmp.test74/Dockerfile`:

```
FROM nodesource/jessie:0.12.4
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.12.4-test1` from `/root/docker-node/.~tmp.test74`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.12.4
 ---> 3b0f9d717f9a
Step 2 : ENV NODE_ENV test
 ---> Running in 510fb0ce9bd6
 ---> 261c4638d192
Removing intermediate container 510fb0ce9bd6
Step 3 : RUN node -v
 ---> Running in 0d1afe7684d7
v0.12.4
 ---> 01d0172149e5
Removing intermediate container 0d1afe7684d7
Step 4 : RUN node -p "process.versions"
 ---> Running in ca1d74f8740d
{ http_parser: '2.3',
  node: '0.12.4',
  v8: '3.28.71.19',
  uv: '1.5.0',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1m' }
 ---> e6935344ca1e
Removing intermediate container ca1d74f8740d
Step 5 : RUN npm --version
 ---> Running in 4bbdaac97b67
2.10.1
 ---> 4ea271e6433d
Removing intermediate container 4bbdaac97b67
Successfully built 4ea271e6433d

```

# Tested image `nodesource/wheezy:4.1.2`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 98ac1807034b
 ---> 2590a307a138
Removing intermediate container 98ac1807034b
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.1.2-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 10cc939b602a
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left [0m[91m Sp[0m[91meed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 20 8459k   20 1775k    0     0  4208k      0  0:00:02 --:--:--  0:00:02 4518k[0m[91m100 8459k  100 8459k    0     0  9314k      0 --:--:-- --:--:-- --:--:-- 9624k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (4.1.2-1nodesource1~wheezy1) ...
 ---> 22ef6317d9d4
Removing intermediate container 10cc939b602a
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in f3a4991912ac
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated[0m[91m graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with[0m[91m ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
gyp info using node@4.1.2 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v4.1.2/node-v4.1.2.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.1.2/node-v4.1.2.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.1.2/SHASUMS256.txt
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v4.1.2/SHASUMS256.txt
[0m[91mgyp[0m[91m info spawn python
[0m[91mgyp [0m[91minfo spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp [0m[91minfo spawn args[0m[91m   '-I',
gyp info [0m[91mspawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.1.2/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args[0m[91m   '-Dvisibility=default',
gyp [0m[91minfo spawn args   '-Dnode_root_dir=/root/.node-gyp/4.1.2',
[0m[91mgyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info [0m[91mspawn args   '--no-parallel',
[0m[91mgyp info[0m[91m spawn args[0m[91m   '--generator-output',
gyp[0m[91m [0m[91minfo [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp[0m[91m info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR![0m[91m configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp[0m[91m ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp[0m[91m [0m[91mERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR![0m[91m System[0m[91m Linux 3.13.0-79-generic
gyp ERR! command[0m[91m "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp[0m[91m ERR! cwd /
[0m[91mgyp [0m[91mERR![0m[91m [0m[91mnode -v[0m[91m v4.1.2
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> c904bd1400cb
Removing intermediate container f3a4991912ac
Step 5 : ENV NODE_ENV production
 ---> Running in d586fbdcfdcb
 ---> f9f8f32c795b
Removing intermediate container d586fbdcfdcb
Step 6 : WORKDIR /usr/src/app
 ---> Running in 301e51434684
 ---> 7f8ffb3d49ff
Removing intermediate container 301e51434684
Step 7 : CMD npm start
 ---> Running in 19c5c08fc4b3
 ---> b43cafb844cd
Removing intermediate container 19c5c08fc4b3
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in ffe6280d10d8
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 1s (4474 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 5f4532e0bbd1
Removing intermediate container ffe6280d10d8
Successfully built 5f4532e0bbd1

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test4`

Contents of dockerfile `/root/docker-node/.~tmp.test4/Dockerfile`:

```
FROM nodesource/wheezy:4.1.2
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:4.1.2-test1` from `/root/docker-node/.~tmp.test4`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:4.1.2
 ---> 5f4532e0bbd1
Step 2 : ENV NODE_ENV test
 ---> Running in 47d6b1fb2908
 ---> 6244d7ad00e8
Removing intermediate container 47d6b1fb2908
Step 3 : RUN node -v
 ---> Running in 7cbff2a15763
v4.1.2
 ---> 61ff5b75faed
Removing intermediate container 7cbff2a15763
Step 4 : RUN node -p "process.versions"
 ---> Running in 517e32d73d99
{ http_parser: '2.5.0',
  node: '4.1.2',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '46',
  openssl: '1.0.2d' }
 ---> 0807269b8147
Removing intermediate container 517e32d73d99
Step 5 : RUN npm --version
 ---> Running in fd5e952f92aa
2.14.4
 ---> e4e7b913fe3d
Removing intermediate container fd5e952f92aa
Successfully built e4e7b913fe3d

```

# Tested image `nodesource/jessie:0.10.37`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 1cc2ef608798
 ---> c4f8f3b33b99
Removing intermediate container 1cc2ef608798
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.37-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 2c1451edb4b0
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 3960k  100 3960k    0     0  6027k      0 --:--:-- --:--:-- --:--:-- 6028k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.37-1nodesource1~jessie1) ...
Setting up nodejs (0.10.37-1nodesource1~jessie1) ...
 ---> f0790f83a766
Removing intermediate container 2c1451edb4b0
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 3c0889a9a156
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, tunnel-agent@0.4.2, oauth-sign@0.5.0, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.10.37 | linux | x64
[0m[91mgyp[0m[91m http[0m[91m GET http://nodejs.org/dist/v0.10.37/node-v0.10.37.tar.gz
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v0.10.37/node-v0.10.37.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.37/SHASUMS256.txt
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v0.10.37/SHASUMS256.txt
[0m[91mgyp info[0m[91m spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info[0m[91m spawn args   'make',
gyp info spawn args[0m[91m   '-I',
gyp [0m[91minfo [0m[91mspawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info [0m[91mspawn args   '/root/.node-gyp/0.10.37/common.gypi',
gyp [0m[91minfo [0m[91mspawn args[0m[91m   '-Dlibrary=shared_library',
[0m[91mgyp [0m[91minfo spawn args   '-Dvisibility=default',
gyp [0m[91minfo spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.37',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR![0m[91m configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp[0m[91m ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.37
gyp ERR! pangyp -v[0m[91m v2.3.3
gyp ERR![0m[91m not ok 
[0m
 ---> 49ba4c806e56
Removing intermediate container 3c0889a9a156
Step 5 : ENV NODE_ENV production
 ---> Running in f122d1822cf4
 ---> 268bea6d7cec
Removing intermediate container f122d1822cf4
Step 6 : WORKDIR /usr/src/app
 ---> Running in f9ceb5fa3043
 ---> 59874f90da78
Removing intermediate container f9ceb5fa3043
Step 7 : CMD npm start
 ---> Running in 331a393e3137
 ---> 26544b501ab7
Removing intermediate container 331a393e3137
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 0fd323ec18f2
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 6s (1498 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 21480d10b6b6
Removing intermediate container 0fd323ec18f2
Successfully built 21480d10b6b6

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test65`

Contents of dockerfile `/root/docker-node/.~tmp.test65/Dockerfile`:

```
FROM nodesource/jessie:0.10.37
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:0.10.37-test1` from `/root/docker-node/.~tmp.test65`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:0.10.37
 ---> 21480d10b6b6
Step 2 : ENV NODE_ENV test
 ---> Running in 8521d4691221
 ---> afbe29effed2
Removing intermediate container 8521d4691221
Step 3 : RUN node -v
 ---> Running in 404950ae08a8
v0.10.37
 ---> 6c56dfa8a73b
Removing intermediate container 404950ae08a8
Step 4 : RUN node -p "process.versions"
 ---> Running in 66b95231ad6d
{ http_parser: '1.0',
  node: '0.10.37',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1l' }
 ---> eb020bdb4456
Removing intermediate container 66b95231ad6d
Step 5 : RUN npm --version
 ---> Running in 4583c99b9e22
1.4.28
 ---> 06ed13963d1a
Removing intermediate container 4583c99b9e22
Successfully built 06ed13963d1a

```

# Tested image `nodesource/wheezy:4.2.6`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 2c8d4317490e
 ---> 1b3ae21de3a6
Removing intermediate container 2c8d4317490e
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.6-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 1a1acb73b5e4
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 62 10.6M   62 6831k    0     0  7788k      0  0:00:01 --:--:--  0:00:01 9182k[0m[91m100 10.6M  100 10.6M    0     0  9129k      0  0:00:01  0:00:01 --:--:-- 10.0M
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (4.2.6-1nodesource1~wheezy1) ...
 ---> 4b2479062d5c
Removing intermediate container 1a1acb73b5e4
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in a72b4ba1d137
[91mnpm [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (forever-agent@0.5.2, aws-sign2@0.5.0, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, mime-types@1.0.2, tough-cookie@2.2.1, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@4.2.6 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v4.2.6/node-v4.2.6.tar.gz
gyp http 200 http://nodejs.org/dist/v4.2.6/node-v4.2.6.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v4.2.6/SHASUMS256.txt
[0m[91mgyp http 200[0m[91m http://nodejs.org/dist/v4.2.6/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.6/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.6',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
[0m[91mgyp info spawn args   'build',
gyp [0m[91minfo spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.2.6
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> d79d91f89a8a
Removing intermediate container a72b4ba1d137
Step 5 : ENV NODE_ENV production
 ---> Running in b0e803e987ea
 ---> a1566daccd19
Removing intermediate container b0e803e987ea
Step 6 : WORKDIR /usr/src/app
 ---> Running in 82ee69a16eeb
 ---> 4980937e7efd
Removing intermediate container 82ee69a16eeb
Step 7 : CMD npm start
 ---> Running in 37c4e2d97904
 ---> 560b612cc7b3
Removing intermediate container 37c4e2d97904
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in bce7f5a80431
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:4 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:5 http://httpredir.debian.org wheezy Release [191 kB]
Get:6 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 3s (2413 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 5ab5259f96e3
Removing intermediate container bce7f5a80431
Successfully built 5ab5259f96e3

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test5`

Contents of dockerfile `/root/docker-node/.~tmp.test5/Dockerfile`:

```
FROM nodesource/wheezy:4.2.6
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:4.2.6-test1` from `/root/docker-node/.~tmp.test5`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:4.2.6
 ---> 5ab5259f96e3
Step 2 : ENV NODE_ENV test
 ---> Running in 67a9a1422299
 ---> 67a0d3b7c1b5
Removing intermediate container 67a9a1422299
Step 3 : RUN node -v
 ---> Running in e624b1689b5f
v4.2.6
 ---> 95d8c9b493a5
Removing intermediate container e624b1689b5f
Step 4 : RUN node -p "process.versions"
 ---> Running in ed9bd340ef6e
{ http_parser: '2.5.0',
  node: '4.2.6',
  v8: '4.5.103.35',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2e' }
 ---> caa85347e20f
Removing intermediate container ed9bd340ef6e
Step 5 : RUN npm --version
 ---> Running in e456ee9de0a8
2.14.12
 ---> cf54458ecd61
Removing intermediate container e456ee9de0a8
Successfully built cf54458ecd61

```

# Tested image `nodesource/jessie:5.2.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 1238fdb0848d
 ---> 9fca4057337a
Removing intermediate container 1238fdb0848d
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.2.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 1e788e2769d0
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0[0m[91m  0 8481k    0 16086    0     0   9605      0  0:15:04  0:00:01  0:15:03  9603[0m[91m100 8481k  100 8481k    0     0  3446k      0  0:00:02  0:00:02 --:--:-- 3447k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.2.0-1nodesource1~jessie1) ...
Setting up nodejs (5.2.0-1nodesource1~jessie1) ...
 ---> 02d1225213ef
Removing intermediate container 1e788e2769d0
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 4922c07bc558
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp[0m[91m [0m[91minfo using pangyp@2.3.3
[0m[91mgyp info using node@5.2.0 | linux | x64
[0m[91mgyp[0m[91m http [0m[91mGET http://nodejs.org/dist/v5.2.0/node-v5.2.0.tar.gz
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v5.2.0/node-v5.2.0.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp GET http://nodejs.org/dist/v5.2.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v5.2.0/SHASUMS256.txt
[0m[91mgyp info[0m[91m spawn[0m[91m python
[0m[91mgyp [0m[91minfo[0m[91m spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info [0m[91mspawn args   '-I',
[0m[91mgyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.2.0/common.gypi',
[0m[91mgyp[0m[91m info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args[0m[91m   '-Dnode_root_dir=/root/.node-gyp/5.2.0',
[0m[91mgyp info spawn args   '-Druntime=node',
gyp info[0m[91m spawn args[0m[91m   '-Dmodule_root_dir=/',
[0m[91mgyp[0m[91m info spawn args[0m[91m   '--depth=.',
gyp info[0m[91m spawn args   '--no-parallel',
gyp[0m[91m info[0m[91m spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp [0m[91minfo[0m[91m [0m[91mspawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
[0m[91mgyp ERR![0m[91m [0m[91mstack[0m[91m Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:88:13)
[0m[91mgyp [0m[91mERR![0m[91m stack     at ChildProcess.emit (events.js:173:7)
[0m[91mgyp[0m[91m ERR![0m[91m stack[0m[91m     at Process.ChildProcess._handle.onexit (internal/child_process.js:201:12)
[0m[91mgyp ERR![0m[91m System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp [0m[91mERR![0m[91m [0m[91mcwd[0m[91m /
[0m[91mgyp ERR! node -v v5.2.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> fce8bd5dc696
Removing intermediate container 4922c07bc558
Step 5 : ENV NODE_ENV production
 ---> Running in 273c06b272ca
 ---> cc038f12357a
Removing intermediate container 273c06b272ca
Step 6 : WORKDIR /usr/src/app
 ---> Running in d98fe728fe0d
 ---> fd6b88445aa4
Removing intermediate container d98fe728fe0d
Step 7 : CMD npm start
 ---> Running in 0cff10ea8cfa
 ---> b9c663837c1e
Removing intermediate container 0cff10ea8cfa
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 1edc1cc9783d
Ign http://httpredir.debian.org jessie InRelease
Get:1 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:2 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:3 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:4 http://httpredir.debian.org jessie Release [148 kB]
Get:5 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:6 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Get:7 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Fetched 9651 kB in 4s (2313 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 0e999b142ac7
Removing intermediate container 1edc1cc9783d
Successfully built 0e999b142ac7

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test53`

Contents of dockerfile `/root/docker-node/.~tmp.test53/Dockerfile`:

```
FROM nodesource/jessie:5.2.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:5.2.0-test1` from `/root/docker-node/.~tmp.test53`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:5.2.0
 ---> 0e999b142ac7
Step 2 : ENV NODE_ENV test
 ---> Running in 579f366922ea
 ---> 060221408ddc
Removing intermediate container 579f366922ea
Step 3 : RUN node -v
 ---> Running in 9878ec0a0f01
v5.2.0
 ---> 59a9e09e022f
Removing intermediate container 9878ec0a0f01
Step 4 : RUN node -p "process.versions"
 ---> Running in dedd78caedb5
{ http_parser: '2.6.0',
  node: '5.2.0',
  v8: '4.6.85.31',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> 5efb432ed480
Removing intermediate container dedd78caedb5
Step 5 : RUN npm --version
 ---> Running in 32e914a097b5
3.3.12
 ---> 6ddd100d1f04
Removing intermediate container 32e914a097b5
Successfully built 6ddd100d1f04

```

# Tested image `nodesource/jessie:4.2.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 7328d537c92f
 ---> 2d702754a4b8
Removing intermediate container 7328d537c92f
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.1-2nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in be1364143b99
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 6820k  100 6820k    0     0  7526k      0 --:--:-- --:--:-- --:--:-- 7519k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.2.1-2nodesource1~jessie1) ...
Setting up nodejs (4.2.1-2nodesource1~jessie1) ...
 ---> 9c1834dc52be
Removing intermediate container be1364143b99
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 51fdc84b9b10
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@4.2.1 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp GET http://nodejs.org/dist/v4.2.1/node-v4.2.1.tar.gz
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v4.2.1/node-v4.2.1.tar.gz
[0m[91mgyp[0m[91m http GET[0m[91m http://nodejs.org/dist/v4.2.1/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200[0m[91m http://nodejs.org/dist/v4.2.1/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.1',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.2.1
gyp ERR! pangyp -v v2.3.3
[0m[91mgyp ERR! not ok 
[0m
 ---> ae4ae9a81182
Removing intermediate container 51fdc84b9b10
Step 5 : ENV NODE_ENV production
 ---> Running in 6367a89b78f5
 ---> 6bc9ac000bd7
Removing intermediate container 6367a89b78f5
Step 6 : WORKDIR /usr/src/app
 ---> Running in 10b1cbd223d4
 ---> a38ca4e2f3fd
Removing intermediate container 10b1cbd223d4
Step 7 : CMD npm start
 ---> Running in 4bc29997fbc6
 ---> 35c8963ae7a5
Removing intermediate container 4bc29997fbc6
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 7afd96a458c7
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (2686 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 2f4907f52aa5
Removing intermediate container 7afd96a458c7
Successfully built 2f4907f52aa5

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test82`

Contents of dockerfile `/root/docker-node/.~tmp.test82/Dockerfile`:

```
FROM nodesource/jessie:4.2.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:4.2.1-test1` from `/root/docker-node/.~tmp.test82`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:4.2.1
 ---> 2f4907f52aa5
Step 2 : ENV NODE_ENV test
 ---> Running in 9e28ccec3fcf
 ---> be2b62e185d3
Removing intermediate container 9e28ccec3fcf
Step 3 : RUN node -v
 ---> Running in 40823c943296
v4.2.1
 ---> f83149251157
Removing intermediate container 40823c943296
Step 4 : RUN node -p "process.versions"
 ---> Running in 2d03d1389d0e
{ http_parser: '2.5.0',
  node: '4.2.1',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '46',
  openssl: '1.0.2d' }
 ---> bb1990cd3bcb
Removing intermediate container 2d03d1389d0e
Step 5 : RUN npm --version
 ---> Running in 1e05d0d0114b
2.14.7
 ---> 8565e6ab13d5
Removing intermediate container 1e05d0d0114b
Successfully built 8565e6ab13d5

```

# Tested image `nodesource/wheezy:4.2.2`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 592d4d7302e9
 ---> c1bc498602c7
Removing intermediate container 592d4d7302e9
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.2-2nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 75b095afa20d
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     T[0m[91mime  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 45 9021k   45 4079k    0     0  53[0m[91m43k      0  0:00:01 --:--:--  0:00:01 6344k[0m[91m100 9021k  100 9021k    0     0  8156k      0 [0m[91m 0:00:01  0:00:01 --:--:-- 9149k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (4.2.2-2nodesource1~wheezy1) ...
 ---> dc6e9ab22f66
Removing intermediate container 75b095afa20d
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in f325b9952c66
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (forever-agent@0.5.2, aws-sign2@0.5.0, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@4.2.2 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.2.2/node-v4.2.2.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.2/node-v4.2.2.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.2.2/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.2/SHASUMS256.txt
[0m[91mgyp[0m[91m info[0m[91m spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.2/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.2',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.2.2
gyp ERR! pangyp -v v2.3.3
[0m[91mgyp ERR! not ok 
[0m
 ---> 505afe2b147e
Removing intermediate container f325b9952c66
Step 5 : ENV NODE_ENV production
 ---> Running in e2538fb54457
 ---> 027f24a0888b
Removing intermediate container e2538fb54457
Step 6 : WORKDIR /usr/src/app
 ---> Running in ed5c1f04b89a
 ---> 52dceb936ddb
Removing intermediate container ed5c1f04b89a
Step 7 : CMD npm start
 ---> Running in a67873699633
 ---> 846f33de1ae4
Removing intermediate container a67873699633
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 77ef77aacdf5
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 2s (2877 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 826e10691077
Removing intermediate container 77ef77aacdf5
Successfully built 826e10691077

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test37`

Contents of dockerfile `/root/docker-node/.~tmp.test37/Dockerfile`:

```
FROM nodesource/wheezy:4.2.2
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:4.2.2-test1` from `/root/docker-node/.~tmp.test37`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:4.2.2
 ---> 826e10691077
Step 2 : ENV NODE_ENV test
 ---> Running in 72cb18f89555
 ---> 86fc0c806acb
Removing intermediate container 72cb18f89555
Step 3 : RUN node -v
 ---> Running in 41fae11ce033
v4.2.2
 ---> 456355d9ba4f
Removing intermediate container 41fae11ce033
Step 4 : RUN node -p "process.versions"
 ---> Running in 5da89b2953e4
{ http_parser: '2.5.0',
  node: '4.2.2',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '4.8.1.1',
  modules: '46',
  openssl: '1.0.2d' }
 ---> 2ac5fb4501b6
Removing intermediate container 5da89b2953e4
Step 5 : RUN npm --version
 ---> Running in 8022c63d4d05
2.14.7
 ---> 969a1660b576
Removing intermediate container 8022c63d4d05
Successfully built 969a1660b576

```

# Tested image `nodesource/wheezy:0.10.36`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 51ec76318b20
 ---> 61a33dafe5d3
Removing intermediate container 51ec76318b20
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.36-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 5bc24da4fb79
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:[0m[91m--:-- --:--:--     0[0m[91m 15 5943k   15  895k    0     0  1940k      0  0:00:03 --:--:--  0:00:03 2068k[0m[91m100 5943k  100 5943k    0     0  6366k      0 --:--:-- --:--:--[0m[91m --:--:-- 6574k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.10.36-1nodesource1~wheezy1) ...
 ---> 869edc94e58c
Removing intermediate container 5bc24da4fb79
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in bdd91f6c153d
[91mnpm[0m[91m [0m[91mWARN[0m[91m [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp info [0m[91mit worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@0.10.36 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.36/node-v0.10.36.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.36/node-v0.10.36.tar.gz
[0m[91mgyp[0m[91m http [0m[91mGET http://nodejs.org/dist/v0.10.36/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.36/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info [0m[91mspawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
[0m[91mgyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.36/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info [0m[91mspawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.36',
gyp info[0m[91m spawn args   '-Druntime=node',
[0m[91mgyp info [0m[91mspawn args   '-Dmodule_root_dir=/',
gyp[0m[91m info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args[0m[91m   'build',
gyp [0m[91minfo [0m[91mspawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp ERR! node -v v0.10.36
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 027b44cf9231
Removing intermediate container bdd91f6c153d
Step 5 : ENV NODE_ENV production
 ---> Running in 7d2e7ee20ce7
 ---> c7fc72e460e9
Removing intermediate container 7d2e7ee20ce7
Step 6 : WORKDIR /usr/src/app
 ---> Running in 160ffb3ff483
 ---> f0d39b482daf
Removing intermediate container 160ffb3ff483
Step 7 : CMD npm start
 ---> Running in a2e5145737d1
 ---> e2417f65f122
Removing intermediate container a2e5145737d1
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in f04e946c0640
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 3s (2371 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 850478945f76
Removing intermediate container f04e946c0640
Successfully built 850478945f76

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test19`

Contents of dockerfile `/root/docker-node/.~tmp.test19/Dockerfile`:

```
FROM nodesource/wheezy:0.10.36
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.10.36-test1` from `/root/docker-node/.~tmp.test19`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.10.36
 ---> 850478945f76
Step 2 : ENV NODE_ENV test
 ---> Running in ef6f25ebe002
 ---> 7f8e63787516
Removing intermediate container ef6f25ebe002
Step 3 : RUN node -v
 ---> Running in 5e5cc17b1564
v0.10.36
 ---> 251a9681f0fa
Removing intermediate container 5e5cc17b1564
Step 4 : RUN node -p "process.versions"
 ---> Running in 067348f6f3c2
{ http_parser: '1.0',
  node: '0.10.36',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.30',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1l' }
 ---> 609eac9b30d1
Removing intermediate container 067348f6f3c2
Step 5 : RUN npm --version
 ---> Running in 49d27d3c6964
1.4.28
 ---> 167c1f17da8a
Removing intermediate container 49d27d3c6964
Successfully built 167c1f17da8a

```

# Tested image `nodesource/jessie:iojs-1.4.3`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in cb975c4cc1b3
 ---> 23422425acab
Removing intermediate container cb975c4cc1b3
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.4.3-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 47499bcfd639
[91m  % Total    [0m[91m% Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 96 5096k   96 4927k    0     0  5674k      0 --:--:-- --:--:-- --:--:-- 5670k[0m[91m100 5096k  100 5096k    0     0  5849k      0 --:--:[0m[91m-- --:--:-- --:--:-- 5844k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.4.3-1nodesource1~jessie1) ...
Setting up iojs (1.4.3-1nodesource1~jessie1) ...
 ---> 20a1da0a3b24
Removing intermediate container 47499bcfd639
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in ac0882672bd8
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@1.4.3 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp GET https://iojs.org/dist/v1.4.3/iojs-v1.4.3.tar.gz
[0m[91mgyp http [0m[91m200 https://iojs.org/dist/v1.4.3/iojs-v1.4.3.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp GET https://iojs.org/dist/v1.4.3/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200[0m[91m https://iojs.org/dist/v1.4.3/SHASUMS256.txt
[0m[91mgyp info spawn[0m[91m python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
[0m[91mgyp info spawn args[0m[91m   'make',
gyp[0m[91m info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.4.3/common.gypi',
gyp info [0m[91mspawn args   '-Dlibrary=shared_library',
gyp[0m[91m info spawn args   '-Dvisibility=default',
[0m[91mgyp info [0m[91mspawn args   '-Dnode_root_dir=/root/.node-gyp/1.4.3',
gyp[0m[91m info spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args[0m[91m   '--generator-output',
gyp info spawn args[0m[91m   'build',
gyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m [0m[91mERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack[0m[91m     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp [0m[91mERR! command "node" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp ERR! node -v v1.4.3
gyp ERR! pangyp -v v2.3.3
gyp ERR![0m[91m not ok[0m[91m 
[0m
 ---> eb9ec7b746a4
Removing intermediate container ac0882672bd8
Step 5 : ENV NODE_ENV production
 ---> Running in e2d2de32c63d
 ---> fd26fe3b131b
Removing intermediate container e2d2de32c63d
Step 6 : WORKDIR /usr/src/app
 ---> Running in 08a4d8778b8f
 ---> 6035cff47556
Removing intermediate container 08a4d8778b8f
Step 7 : CMD npm start
 ---> Running in 2c35415bbd9a
 ---> 9333a23eaa53
Removing intermediate container 2c35415bbd9a
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 2f11443d582f
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 6s (1408 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 881cbaae2894
Removing intermediate container 2f11443d582f
Successfully built 881cbaae2894

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test94`

Contents of dockerfile `/root/docker-node/.~tmp.test94/Dockerfile`:

```
FROM nodesource/jessie:iojs-1.4.3
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-1.4.3-test1` from `/root/docker-node/.~tmp.test94`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-1.4.3
 ---> 881cbaae2894
Step 2 : ENV NODE_ENV test
 ---> Running in 9ae4b53262b8
 ---> 0a6b77153735
Removing intermediate container 9ae4b53262b8
Step 3 : RUN node -v
 ---> Running in 22aeecd7f50f
v1.4.3
 ---> 73b0a8f80323
Removing intermediate container 22aeecd7f50f
Step 4 : RUN node -p "process.versions"
 ---> Running in 9826b8ca13c7
{ http_parser: '2.3.0',
  node: '1.4.3',
  v8: '4.1.0.21',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1k' }
 ---> ff57c5921177
Removing intermediate container 9826b8ca13c7
Step 5 : RUN npm --version
 ---> Running in 95b76f0627c4
2.6.1
 ---> 975c61e557d2
Removing intermediate container 95b76f0627c4
Successfully built 975c61e557d2

```

# Tested image `nodesource/wheezy:0.12.5`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/wheezy-base
 ---> 6670176875a2
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in dc9a9fff70f2
 ---> 586e55ab7877
Removing intermediate container dc9a9fff70f2
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.5-1nodesource1~wheezy1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in ad88ec23dcc1
[91m  % Total    % Received % Xferd  Average Speed   Time    [0m[91mTime     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 62 7913k   62 4959k    0     0  6426k      0  0:00:01 --:--:--  0:00:01 7413k[0m[91m100 7913k  100 7913k    0     0  8004k      0 --:--:-- --:--:-- --:--:-- 8931k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14461 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.12.5-1nodesource1~wheezy1) ...
 ---> f5def985245b
Removing intermediate container ad88ec23dcc1
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 43906aeb1e63
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with[0m[91m ok
[0m[91mgyp info using pangyp@2.3.3
gyp info [0m[91musing node@0.12.5 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.5/node-v0.12.5.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.5/node-v0.12.5.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.12.5/SHASUMS256.txt
[0m[91mgyp http [0m[91m200 http://nodejs.org/dist/v0.12.5/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.5/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.5',
gyp info spawn args   '-Druntime=node',
gyp[0m[91m info [0m[91mspawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp[0m[91m info[0m[91m spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.5
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 50a3246829be
Removing intermediate container 43906aeb1e63
Step 5 : ENV NODE_ENV production
 ---> Running in 621db3f92da2
 ---> 1679412ac88b
Removing intermediate container 621db3f92da2
Step 6 : WORKDIR /usr/src/app
 ---> Running in d66c985cf6e9
 ---> 9a3fc234d769
Removing intermediate container d66c985cf6e9
Step 7 : CMD npm start
 ---> Running in f2c8451d590e
 ---> 21a692da8b6c
Removing intermediate container f2c8451d590e
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in f9720d8eda4b
Get:1 http://security.debian.org wheezy/updates Release.gpg [1554 B]
Get:2 http://security.debian.org wheezy/updates Release [102 kB]
Get:3 http://security.debian.org wheezy/updates/main amd64 Packages [426 kB]
Get:4 http://httpredir.debian.org wheezy Release.gpg [2373 B]
Get:5 http://httpredir.debian.org wheezy-updates Release.gpg [1554 B]
Get:6 http://httpredir.debian.org wheezy Release [191 kB]
Get:7 http://httpredir.debian.org wheezy-updates Release [143 kB]
Get:8 http://httpredir.debian.org wheezy/main amd64 Packages [7637 kB]
Get:9 http://httpredir.debian.org wheezy-updates/main amd64 Packages [5788 B]
Fetched 8511 kB in 18s (459 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> dca71a66afcc
Removing intermediate container f9720d8eda4b
Successfully built dca71a66afcc

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test30`

Contents of dockerfile `/root/docker-node/.~tmp.test30/Dockerfile`:

```
FROM nodesource/wheezy:0.12.5
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/wheezy:0.12.5-test1` from `/root/docker-node/.~tmp.test30`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/wheezy:0.12.5
 ---> dca71a66afcc
Step 2 : ENV NODE_ENV test
 ---> Running in 7950e1274993
 ---> 38d3ceb4e80c
Removing intermediate container 7950e1274993
Step 3 : RUN node -v
 ---> Running in 6d6bb3668cf8
v0.12.5
 ---> be6b9edf4f77
Removing intermediate container 6d6bb3668cf8
Step 4 : RUN node -p "process.versions"
 ---> Running in 0b70331af06a
{ http_parser: '2.3',
  node: '0.12.5',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1o' }
 ---> 79d8e65e9c55
Removing intermediate container 0b70331af06a
Step 5 : RUN npm --version
 ---> Running in 0cea4791f8f1
2.11.2
 ---> 0efbf1d15491
Removing intermediate container 0cea4791f8f1
Successfully built 0efbf1d15491

```

# Tested image `nodesource/jessie:4.2.4`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 552572d19b7d
 ---> 9a1d45920bbe
Removing intermediate container 552572d19b7d
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.4-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in b517a78ccddb
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 D[0m[91mload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 53 8346k   53 4495k    0     0  6851k      0  0:00:01 --:--:--  0:00:01 6842k[0m[91m100 8346k  100 8346k    0     0  8821k      0 --:--:-- --:--:-- --:--:-- 8813k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.2.4-1nodesource1~jessie1) ...
Setting up nodejs (4.2.4-1nodesource1~jessie1) ...
 ---> 2432f13753ac
Removing intermediate container b517a78ccddb
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 82ee605b7c87
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
gyp info using node@4.2.4 | linux | x64
[0m[91mgyp http [0m[91mGET http://nodejs.org/dist/v4.2.4/node-v4.2.4.tar.gz
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v4.2.4/node-v4.2.4.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.2.4/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp[0m[91m 200 http://nodejs.org/dist/v4.2.4/SHASUMS256.txt
[0m[91mgyp[0m[91m info [0m[91mspawn python
[0m[91mgyp[0m[91m [0m[91minfo spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp [0m[91minfo[0m[91m [0m[91mspawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
[0m[91mgyp[0m[91m [0m[91minfo [0m[91mspawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info[0m[91m spawn args[0m[91m   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.4/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.4',
[0m[91mgyp[0m[91m [0m[91minfo[0m[91m spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
[0m[91mgyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp [0m[91minfo[0m[91m [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp info[0m[91m [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR![0m[91m [0m[91mconfigure error 
[0m[91mgyp[0m[91m ERR! stack Error: `gyp` failed with exit code: 1
[0m[91mgyp[0m[91m ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack[0m[91m     at emitTwo (events.js:87:13)
gyp ERR! stack[0m[91m     at ChildProcess.emit (events.js:172:7)
[0m[91mgyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp [0m[91mERR! [0m[91mSystem[0m[91m Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR![0m[91m cwd[0m[91m /
gyp ERR! node -v v4.2.4
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 7ec909faf047
Removing intermediate container 82ee605b7c87
Step 5 : ENV NODE_ENV production
 ---> Running in f825893d05a3
 ---> 20a48079ac1d
Removing intermediate container f825893d05a3
Step 6 : WORKDIR /usr/src/app
 ---> Running in f05c4f2604e8
 ---> eb2853b2a18e
Removing intermediate container f05c4f2604e8
Step 7 : CMD npm start
 ---> Running in 1bddbfc8d01e
 ---> 2a260ef96d17
Removing intermediate container 1bddbfc8d01e
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in f7a1032f21f9
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3952 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> be6b1948cc09
Removing intermediate container f7a1032f21f9
Successfully built be6b1948cc09

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test85`

Contents of dockerfile `/root/docker-node/.~tmp.test85/Dockerfile`:

```
FROM nodesource/jessie:4.2.4
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:4.2.4-test1` from `/root/docker-node/.~tmp.test85`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:4.2.4
 ---> be6b1948cc09
Step 2 : ENV NODE_ENV test
 ---> Running in 68f4d541d248
 ---> 4a528daef1f9
Removing intermediate container 68f4d541d248
Step 3 : RUN node -v
 ---> Running in 21eea17913af
v4.2.4
 ---> 69899755a30f
Removing intermediate container 21eea17913af
Step 4 : RUN node -p "process.versions"
 ---> Running in 733aa94266c0
{ http_parser: '2.5.0',
  node: '4.2.4',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2e' }
 ---> 9793366437fc
Removing intermediate container 733aa94266c0
Step 5 : RUN npm --version
 ---> Running in ea8feca98146
2.14.12
 ---> ceda6ca667ab
Removing intermediate container ea8feca98146
Successfully built ceda6ca667ab

```

# Tested image `nodesource/jessie:iojs-3.3.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 1427d3f17cea
 ---> 03d0016dc4af
Removing intermediate container 1427d3f17cea
Step 3 : RUN curl https://deb.nodesource.com/iojs_3.x/pool/main/i/iojs/iojs_3.3.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in f70ba8df4ba8
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 83 6228k   83 5215k    0     0  7250k      0 --:--:-- --:--:-- --:--:-- 7244k[0m[91m100 6228k  100 6228k    0     0  7729k      0 --:--:-- --:--[0m[91m:-- --:--:-- 7727k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (3.3.0-1nodesource1~jessie1) ...
Setting up iojs (3.3.0-1nodesource1~jessie1) ...
 ---> 6c1e94e7a4ab
Removing intermediate container f70ba8df4ba8
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in a68f7d08d6b3
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using[0m[91m pangyp@2.3.3
[0m[91mgyp info using node@3.3.0 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp[0m[91m GET https://iojs.org/dist/v3.3.0/iojs-v3.3.0.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v3.3.0/iojs-v3.3.0.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v3.3.0/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v3.3.0/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info[0m[91m spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info [0m[91mspawn args   '-I',
gyp info spawn args   '/root/.node-gyp/3.3.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp [0m[91minfo [0m[91mspawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/3.3.0',
gyp info spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! [0m[91mconfigure error 
[0m[91mgyp ERR! stack[0m[91m Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! [0m[91mstack[0m[91m     at emitTwo (events.js:87:13)
[0m[91mgyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp[0m[91m ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd[0m[91m /
[0m[91mgyp[0m[91m ERR! node -v v3.3.0
gyp ERR! pangyp -v v2.3.3
[0m[91mgyp ERR! not ok 
[0m
 ---> f5c31331a44b
Removing intermediate container a68f7d08d6b3
Step 5 : ENV NODE_ENV production
 ---> Running in 5789637bad38
 ---> b462314b5ff9
Removing intermediate container 5789637bad38
Step 6 : WORKDIR /usr/src/app
 ---> Running in 2f059d28807c
 ---> 6214f9439b43
Removing intermediate container 2f059d28807c
Step 7 : CMD npm start
 ---> Running in 7936d9191063
 ---> 7fa946a93e9f
Removing intermediate container 7936d9191063
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 7c9a7a19483b
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 8s (1126 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 3cc4d87114c7
Removing intermediate container 7c9a7a19483b
Successfully built 3cc4d87114c7

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test92`

Contents of dockerfile `/root/docker-node/.~tmp.test92/Dockerfile`:

```
FROM nodesource/jessie:iojs-3.3.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-3.3.0-test1` from `/root/docker-node/.~tmp.test92`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-3.3.0
 ---> 3cc4d87114c7
Step 2 : ENV NODE_ENV test
 ---> Running in 97c0eb7517de
 ---> ebc23c474157
Removing intermediate container 97c0eb7517de
Step 3 : RUN node -v
 ---> Running in 3b7b8a8459a0
v3.3.0
 ---> 2e901cb430fc
Removing intermediate container 3b7b8a8459a0
Step 4 : RUN node -p "process.versions"
 ---> Running in 0871dba6078d
{ http_parser: '2.5.0',
  node: '3.3.0',
  v8: '4.4.63.30',
  uv: '1.7.3',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '45',
  openssl: '1.0.2d' }
 ---> 870d8aa89d45
Removing intermediate container 0871dba6078d
Step 5 : RUN npm --version
 ---> Running in aef08ea401b7
2.13.3
 ---> 3752d48fd9da
Removing intermediate container aef08ea401b7
Successfully built 3752d48fd9da

```

# Tested image `nodesource/jessie:iojs-2.2.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 79debd5e6082
 ---> c3e3d31fbb78
Removing intermediate container 79debd5e6082
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.2.1-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 7643a1b9c831
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Tim[0m[91me  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 61 5640k   61 3487k    0     0  6211k      0 --:--:-- --:--:-- --:--:-- 6205k[0m[91m100 5640k  100 5640k    0     0  7988k      0 --:--:-- --:--:-- --:--:-- 7978k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.2.1-1nodesource1~jessie1) ...
Setting up iojs (2.2.1-1nodesource1~jessie1) ...
 ---> 2af00e732fbb
Removing intermediate container 7643a1b9c831
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 91b93a207139
[91mnpm[0m[91m WARN deprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated[0m[91m graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
[0m[91mgyp info[0m[91m using node@2.2.1 | linux | x64
[0m[91mgyp http GET https://iojs.org/dist/v2.2.1/iojs-v2.2.1.tar.gz
[0m[91mgyp http 200[0m[91m https://iojs.org/dist/v2.2.1/iojs-v2.2.1.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v2.2.1/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200 https://iojs.org/dist/v2.2.1/SHASUMS256.txt
[0m[91mgyp[0m[91m info [0m[91mspawn python
[0m[91mgyp[0m[91m info[0m[91m spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info[0m[91m spawn args   '/build/config.gypi',
[0m[91mgyp info spawn args   '-I',
[0m[91mgyp[0m[91m info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/2.2.1/common.gypi',
gyp info [0m[91mspawn args   '-Dlibrary=shared_library',
gyp[0m[91m [0m[91minfo[0m[91m spawn args[0m[91m   '-Dvisibility=default',
gyp info[0m[91m spawn args[0m[91m   '-Dnode_root_dir=/root/.node-gyp/2.2.1',
gyp info spawn args   '-Druntime=iojs',
gyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
[0m[91mgyp [0m[91minfo spawn args   '--depth=.',
[0m[91mgyp[0m[91m info [0m[91mspawn args   '--no-parallel',
gyp info spawn args[0m[91m   '--generator-output',
gyp info[0m[91m [0m[91mspawn args[0m[91m   'build',
gyp [0m[91minfo spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR![0m[91m stack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
[0m[91mgyp ERR! [0m[91mstack     at Process.ChildProcess._handle.onexit (internal/child_process.js:199:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v2.2.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 68ff2cba6b7d
Removing intermediate container 91b93a207139
Step 5 : ENV NODE_ENV production
 ---> Running in 81e71da9d840
 ---> 667f96b86fc0
Removing intermediate container 81e71da9d840
Step 6 : WORKDIR /usr/src/app
 ---> Running in 11d1b66110b5
 ---> 82d53b673648
Removing intermediate container 11d1b66110b5
Step 7 : CMD npm start
 ---> Running in 7fcb20c0ca85
 ---> 8fc99fc0c550
Removing intermediate container 7fcb20c0ca85
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 6382ff1a0ffb
Ign http://httpredir.debian.org jessie InRelease
Get:1 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:2 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:3 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:4 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:5 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 1s (5334 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 51c00bad0dcf
Removing intermediate container 6382ff1a0ffb
Successfully built 51c00bad0dcf

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test100`

Contents of dockerfile `/root/docker-node/.~tmp.test100/Dockerfile`:

```
FROM nodesource/jessie:iojs-2.2.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-2.2.1-test1` from `/root/docker-node/.~tmp.test100`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-2.2.1
 ---> 51c00bad0dcf
Step 2 : ENV NODE_ENV test
 ---> Running in 20f10bfbb18c
 ---> 973d8a4febde
Removing intermediate container 20f10bfbb18c
Step 3 : RUN node -v
 ---> Running in 15c3465f78b5
v2.2.1
 ---> f63309bf017f
Removing intermediate container 15c3465f78b5
Step 4 : RUN node -p "process.versions"
 ---> Running in cc77d0ed0a44
{ http_parser: '2.5.0',
  node: '2.2.1',
  v8: '4.2.77.20',
  uv: '1.5.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2a' }
 ---> cdc10e2f7bb4
Removing intermediate container cc77d0ed0a44
Step 5 : RUN npm --version
 ---> Running in efdbfbca5b32
2.11.0
 ---> cedf608f6f5c
Removing intermediate container efdbfbca5b32
Successfully built cedf608f6f5c

```

# Tested image `nodesource/sid:4.2.5`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 3692da98438f
 ---> 85f9c36eb106
Removing intermediate container 3692da98438f
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.5-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in cffc586f6a38
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0[0m[91m    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 33 8365k   33 2767k    0     0  3935k      0  0:00:02 --:--:--  0:00:02 3931k[0m[91m100 8365k  100 8365k    0     0  7477k      0  0:00:01  0:00:01 --:--:-- 7482k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.2.5-1nodesource1~sid1) ...
Setting up nodejs (4.2.5-1nodesource1~sid1) ...
 ---> b7f6015d679b
Removing intermediate container cffc586f6a38
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 1368e8705c13
[91mnpm[0m[91m WARN [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
gyp [0m[91minfo[0m[91m using node@4.2.5 | linux | x64
[0m[91mgyp [0m[91mhttp GET http://nodejs.org/dist/v4.2.5/node-v4.2.5.tar.gz
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v4.2.5/node-v4.2.5.tar.gz
[0m[91mgyp[0m[91m http[0m[91m [0m[91mGET http://nodejs.org/dist/v4.2.5/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.5/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.5/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.5',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.2.5
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 4c404cdec1a5
Error removing intermediate container 1368e8705c13: rmdriverfs: Driver aufs failed to remove root filesystem 1368e8705c13c85ff905631f0fb78a44700c66261bc587464165ba0bf94f8c1c: rename /var/lib/docker/aufs/mnt/404449cfca586e9de32982f55c1f21e8db12fc0fc95f0b8a6994e3047c877288 /var/lib/docker/aufs/mnt/404449cfca586e9de32982f55c1f21e8db12fc0fc95f0b8a6994e3047c877288-removing: device or resource busy
Step 5 : ENV NODE_ENV production
 ---> Running in afb64205904c
 ---> 74893fe3113e
Removing intermediate container afb64205904c
Error removing intermediate container 1368e8705c13: nosuchcontainer: No such container: 1368e8705c13c85ff905631f0fb78a44700c66261bc587464165ba0bf94f8c1c
Step 6 : WORKDIR /usr/src/app
 ---> Running in eeb14720f029
 ---> 6339f123c80b
Error removing intermediate container 1368e8705c13: nosuchcontainer: No such container: 1368e8705c13c85ff905631f0fb78a44700c66261bc587464165ba0bf94f8c1c
Step 7 : CMD npm start
 ---> Running in 559591635d66
 ---> dba8c687294f
Error removing intermediate container 1368e8705c13: nosuchcontainer: No such container: 1368e8705c13c85ff905631f0fb78a44700c66261bc587464165ba0bf94f8c1c
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 8fb9dd17b91c
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4950 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (5496 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 58c23223652a
Error removing intermediate container 1368e8705c13: nosuchcontainer: No such container: 1368e8705c13c85ff905631f0fb78a44700c66261bc587464165ba0bf94f8c1c
Successfully built 58c23223652a

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test162`

Contents of dockerfile `/root/docker-node/.~tmp.test162/Dockerfile`:

```
FROM nodesource/sid:4.2.5
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:4.2.5-test1` from `/root/docker-node/.~tmp.test162`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:4.2.5
 ---> 58c23223652a
Step 2 : ENV NODE_ENV test
 ---> Running in 8b050ec509b0
 ---> d4da38ae709e
Removing intermediate container 8b050ec509b0
Step 3 : RUN node -v
 ---> Running in 05d59e8ea816
v4.2.5
 ---> 05fd46997d6d
Removing intermediate container 05d59e8ea816
Step 4 : RUN node -p "process.versions"
 ---> Running in ae971b4b8573
{ http_parser: '2.5.0',
  node: '4.2.5',
  v8: '4.5.103.35',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2e' }
 ---> a7583992ce4a
Removing intermediate container ae971b4b8573
Step 5 : RUN npm --version
 ---> Running in d66b82466ca8
2.14.12
 ---> 9fa4822ce398
Error removing intermediate container d66b82466ca8: rmdriverfs: Driver aufs failed to remove root filesystem d66b82466ca8793721f14fa02edc090a9213dab0ab20e661f340e1dcd3e4fe5c: rename /var/lib/docker/aufs/mnt/fbdc2949996dee98a735511a6934c19e93f389ab61d941deb1fc849479738545 /var/lib/docker/aufs/mnt/fbdc2949996dee98a735511a6934c19e93f389ab61d941deb1fc849479738545-removing: device or resource busy
Successfully built 9fa4822ce398

```

# Tested image `nodesource/jessie:iojs-2.3.4`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 25fc7aaa46f3
 ---> ff8ae1309074
Removing intermediate container 25fc7aaa46f3
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.3.4-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 2cef928d12f9
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  1 6046k    1  111k    0     0   404k      0  0:00:14 --:--:--  0:00:14  404k[0m[91m100 6046k  100 6046k    0     0  7276k      0 --:--:-- --:--:-- --:--:-- 7276k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.3.4-1nodesource1~jessie1) ...
Setting up iojs (2.3.4-1nodesource1~jessie1) ...
 ---> b8b7039f7f56
Removing intermediate container 2cef928d12f9
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 35b1a34af044
[91mnpm[0m[91m [0m[91mWARN [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
gyp info using node@2.3.4 | linux | x64
[0m[91mgyp http GET https://iojs.org/dist/v2.3.4/iojs-v2.3.4.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v2.3.4/iojs-v2.3.4.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v2.3.4/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200 https://iojs.org/dist/v2.3.4/SHASUMS256.txt
gyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/2.3.4/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/2.3.4',
gyp info spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
[0m[91mgyp[0m[91m ERR! [0m[91mstack Error: `gyp` failed with exit code: 1
[0m[91mgyp[0m[91m ERR![0m[91m stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
[0m[91mgyp[0m[91m ERR![0m[91m stack[0m[91m     at ChildProcess.emit (events.js:172:7)
[0m[91mgyp ERR! stack[0m[91m     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp [0m[91mERR! System[0m[91m Linux 3.13.0-79-generic
gyp[0m[91m [0m[91mERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
[0m[91mgyp[0m[91m ERR! node -v[0m[91m v2.3.4
[0m[91mgyp ERR![0m[91m [0m[91mpangyp -v v2.3.3
gyp ERR! not ok[0m[91m 
[0m
 ---> 5038dad0e547
Removing intermediate container 35b1a34af044
Step 5 : ENV NODE_ENV production
 ---> Running in 4604b14cf579
 ---> 0abb4670c861
Removing intermediate container 4604b14cf579
Step 6 : WORKDIR /usr/src/app
 ---> Running in 8dd0cf9f3fe6
 ---> 4ea157a35041
Removing intermediate container 8dd0cf9f3fe6
Step 7 : CMD npm start
 ---> Running in 14a621ca8f79
 ---> 21f0433d0b76
Removing intermediate container 14a621ca8f79
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in fd6e341d33e6
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (2895 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 8c0620046b6d
Removing intermediate container fd6e341d33e6
Successfully built 8c0620046b6d

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test101`

Contents of dockerfile `/root/docker-node/.~tmp.test101/Dockerfile`:

```
FROM nodesource/jessie:iojs-2.3.4
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-2.3.4-test1` from `/root/docker-node/.~tmp.test101`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-2.3.4
 ---> 8c0620046b6d
Step 2 : ENV NODE_ENV test
 ---> Running in 0f9644c5aa3a
 ---> 20541b0ba7e1
Removing intermediate container 0f9644c5aa3a
Step 3 : RUN node -v
 ---> Running in b132481346fe
v2.3.4
 ---> 5c5baf3814c7
Removing intermediate container b132481346fe
Step 4 : RUN node -p "process.versions"
 ---> Running in 8f20517fbbdc
{ http_parser: '2.5.0',
  node: '2.3.4',
  v8: '4.2.77.20',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2d' }
 ---> 61da7dd38ac1
Removing intermediate container 8f20517fbbdc
Step 5 : RUN npm --version
 ---> Running in 2375305a1a1a
2.12.1
 ---> 3cff7c374605
Removing intermediate container 2375305a1a1a
Successfully built 3cff7c374605

```

# Tested image `nodesource/jessie:iojs-1.4.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 9663b0dc07c7
 ---> 636582673a74
Removing intermediate container 9663b0dc07c7
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.4.1-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in af9531686ef5
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
        [0m[91m                         Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 32 5087k   32 1663k    0     0  3600k      0  0:00:01 --:--:--  0:00:01 3593k[0m[91m100 5087k  100 5087k    0     0  7092k      0 -[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
[91m-:--:-- --:--:-- --:--:-- 7085k
[0mPreparing to unpack node.deb ...
Unpacking iojs (1.4.1-1nodesource1~jessie1) ...
Setting up iojs (1.4.1-1nodesource1~jessie1) ...
 ---> 05af21a30476
Removing intermediate container af9531686ef5
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in c414126c8268
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@1.4.1 | linux | x64
[0m[91mgyp http GET https://iojs.org/dist/v1.4.1/iojs-v1.4.1.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v1.4.1/iojs-v1.4.1.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp GET https://iojs.org/dist/v1.4.1/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v1.4.1/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp [0m[91minfo spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.4.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.4.1',
gyp info spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info[0m[91m spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.4.1
gyp ERR! [0m[91mpangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 1c16df57463a
Removing intermediate container c414126c8268
Step 5 : ENV NODE_ENV production
 ---> Running in c122167b7f92
 ---> 003706171b14
Removing intermediate container c122167b7f92
Step 6 : WORKDIR /usr/src/app
 ---> Running in e7f072b3862f
 ---> c85ba694234f
Removing intermediate container e7f072b3862f
Step 7 : CMD npm start
 ---> Running in ad2559113b69
 ---> d816f3009652
Removing intermediate container ad2559113b69
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 077a863715ae
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (3211 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 10d019a73403
Removing intermediate container 077a863715ae
Successfully built 10d019a73403

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test106`

Contents of dockerfile `/root/docker-node/.~tmp.test106/Dockerfile`:

```
FROM nodesource/jessie:iojs-1.4.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-1.4.1-test1` from `/root/docker-node/.~tmp.test106`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-1.4.1
 ---> 10d019a73403
Step 2 : ENV NODE_ENV test
 ---> Running in 6e4014831bd2
 ---> acf2524f30c0
Removing intermediate container 6e4014831bd2
Step 3 : RUN node -v
 ---> Running in f2a43f2b171c
v1.4.1
 ---> a6a4d485e0be
Removing intermediate container f2a43f2b171c
Step 4 : RUN node -p "process.versions"
 ---> Running in 3f808c71d6fc
{ http_parser: '2.3.0',
  node: '1.4.1',
  v8: '4.1.0.21',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1k' }
 ---> 75b505b79aea
Removing intermediate container 3f808c71d6fc
Step 5 : RUN npm --version
 ---> Running in 23daeaabeb1d
2.6.0
 ---> 71d59fe44211
Removing intermediate container 23daeaabeb1d
Successfully built 71d59fe44211

```

# Tested image `nodesource/jessie:iojs-3.1.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in eb2341c4c57d
 ---> 9c53f27eb698
Removing intermediate container eb2341c4c57d
Step 3 : RUN curl https://deb.nodesource.com/iojs_3.x/pool/main/i/iojs/iojs_3.1.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in ee7fc51dc8b9
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0 6159k    0 32470    0     0   128k      0  0:00:48 --:--:--  0:00:48[0m[91m  127k[0m[91m100 6159k  100 6159k    0     0  7761k      0 --:--:-- --:--:-- --:--:-- 7757k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (3.1.0-1nodesource1~jessie1) ...
Setting up iojs (3.1.0-1nodesource1~jessie1) ...
 ---> da713739cc40
Removing intermediate container ee7fc51dc8b9
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in fdc06d9ec949
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@3.1.0 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v3.1.0/iojs-v3.1.0.tar.gz
[0m[91mgyp[0m[91m http 200 https://iojs.org/dist/v3.1.0/iojs-v3.1.0.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v3.1.0/SHASUMS256.txt
[0m[91mgyp http [0m[91m200 https://iojs.org/dist/v3.1.0/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp[0m[91m info spawn args   'binding.gyp',
gyp info spawn args   '-f',
[0m[91mgyp info spawn args[0m[91m   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp info spawn args   '-I',
[0m[91mgyp info spawn args   '/root/.node-gyp/3.1.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/3.1.0',
gyp info[0m[91m spawn args[0m[91m   '-Druntime=iojs',
[0m[91mgyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
[0m[91mgyp[0m[91m [0m[91minfo spawn args   '--no-parallel',
[0m[91mgyp info [0m[91mspawn args   '--generator-output',
gyp [0m[91minfo spawn args   'build',
gyp info[0m[91m spawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m [0m[91mERR! configure error 
[0m[91mgyp[0m[91m ERR![0m[91m stack[0m[91m Error: `gyp` failed with exit code: 1
[0m[91mgyp[0m[91m [0m[91mERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! [0m[91mstack     at ChildProcess.emit (events.js:172:7)
[0m[91mgyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp [0m[91mERR! [0m[91mSystem Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v3.1.0
[0m[91mgyp [0m[91mERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> b3b22fa2edd0
Removing intermediate container fdc06d9ec949
Step 5 : ENV NODE_ENV production
 ---> Running in c36f27db64c5
 ---> 788716c37438
Removing intermediate container c36f27db64c5
Step 6 : WORKDIR /usr/src/app
 ---> Running in fb799a3907f2
 ---> 218582ac3c43
Removing intermediate container fb799a3907f2
Step 7 : CMD npm start
 ---> Running in 011ece56c379
 ---> 9e8ce68f86ee
Removing intermediate container 011ece56c379
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 09e43a016c16
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (3180 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 00dc4fdfaf46
Removing intermediate container 09e43a016c16
Successfully built 00dc4fdfaf46

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test104`

Contents of dockerfile `/root/docker-node/.~tmp.test104/Dockerfile`:

```
FROM nodesource/jessie:iojs-3.1.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-3.1.0-test1` from `/root/docker-node/.~tmp.test104`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-3.1.0
 ---> 00dc4fdfaf46
Step 2 : ENV NODE_ENV test
 ---> Running in 02cb8b0ad42a
 ---> ea764f9d74b9
Removing intermediate container 02cb8b0ad42a
Step 3 : RUN node -v
 ---> Running in 9fc1d8da27cd
v3.1.0
 ---> 67c2f1025897
Removing intermediate container 9fc1d8da27cd
Step 4 : RUN node -p "process.versions"
 ---> Running in f691ed9f27f8
{ http_parser: '2.5.0',
  node: '3.1.0',
  v8: '4.4.63.26',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '45',
  openssl: '1.0.2d' }
 ---> 01118c7ae0e8
Removing intermediate container f691ed9f27f8
Step 5 : RUN npm --version
 ---> Running in 28c80b3f050f
2.13.3
 ---> aede07db4a1a
Removing intermediate container 28c80b3f050f
Successfully built aede07db4a1a

```

# Tested image `nodesource/jessie:iojs-1.4.2`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 18b631adb3a1
 ---> 792b5ef43afd
Removing intermediate container 18b631adb3a1
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.4.2-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 8c06be0046e0
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  1 5093k    1 98006    0     0   272k      0  0:00:18 --:--:--  0:00:18  271k[0m[91m100 5093k  100 5093k    0     0  6339k      0 --:--:-- --:--:-- --:--:-- 6335k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.4.2-1nodesource1~jessie1) ...
Setting up iojs (1.4.2-1nodesource1~jessie1) ...
 ---> c6bf5bf0ea1a
Removing intermediate container 8c06be0046e0
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in d0fd153a639f
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, hawk@1.1.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with[0m[91m ok
[0m[91mgyp[0m[91m info[0m[91m using pangyp@2.3.3
gyp info using node@1.4.2 | linux | x64
[0m[91mgyp http GET https://iojs.org/dist/v1.4.2/iojs-v1.4.2.tar.gz
[0m[91mgyp[0m[91m http 200 https://iojs.org/dist/v1.4.2/iojs-v1.4.2.tar.gz
[0m[91mgyp [0m[91mhttp GET https://iojs.org/dist/v1.4.2/SHASUMS256.txt
[0m[91mgyp http[0m[91m [0m[91m200 https://iojs.org/dist/v1.4.2/SHASUMS256.txt
[0m[91mgyp [0m[91minfo [0m[91mspawn python
[0m[91mgyp[0m[91m info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args[0m[91m   'make',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.4.2/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.4.2',
gyp [0m[91minfo spawn args   '-Druntime=iojs',
gyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args[0m[91m   '--generator-output',
gyp[0m[91m info[0m[91m spawn args[0m[91m   'build',
gyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
[0m[91mgyp [0m[91mERR! stack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR![0m[91m [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp [0m[91mERR! cwd /
[0m[91mgyp ERR! node -v v1.4.2
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 0ad1935477d6
Removing intermediate container d0fd153a639f
Step 5 : ENV NODE_ENV production
 ---> Running in 7077d3b694cd
 ---> bc11c8d807bc
Removing intermediate container 7077d3b694cd
Step 6 : WORKDIR /usr/src/app
 ---> Running in 99b55d5aa87d
 ---> 755f8c474933
Removing intermediate container 99b55d5aa87d
Step 7 : CMD npm start
 ---> Running in 7b5148b9d2fb
 ---> 6ed496271b69
Removing intermediate container 7b5148b9d2fb
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in af566a746a3b
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 1s (5544 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 82d3730fbcc8
Removing intermediate container af566a746a3b
Successfully built 82d3730fbcc8

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test107`

Contents of dockerfile `/root/docker-node/.~tmp.test107/Dockerfile`:

```
FROM nodesource/jessie:iojs-1.4.2
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-1.4.2-test1` from `/root/docker-node/.~tmp.test107`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-1.4.2
 ---> 82d3730fbcc8
Step 2 : ENV NODE_ENV test
 ---> Running in ca28a5dc4388
 ---> 736951e549b7
Removing intermediate container ca28a5dc4388
Step 3 : RUN node -v
 ---> Running in f26882749c4f
v1.4.2
 ---> 3888a4517322
Removing intermediate container f26882749c4f
Step 4 : RUN node -p "process.versions"
 ---> Running in 1276c2a5f146
{ http_parser: '2.3.0',
  node: '1.4.2',
  v8: '4.1.0.21',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1k' }
 ---> 8d0f31b61299
Removing intermediate container 1276c2a5f146
Step 5 : RUN npm --version
 ---> Running in 151dab9168d4
2.6.1
 ---> cd63db98d97c
Removing intermediate container 151dab9168d4
Successfully built cd63db98d97c

```

# Tested image `nodesource/jessie:iojs-3.2.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in f9232a728c64
 ---> 7bac616410b3
Removing intermediate container f9232a728c64
Step 3 : RUN curl https://deb.nodesource.com/iojs_3.x/pool/main/i/iojs/iojs_3.2.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in bef6d3ad951a
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 66 6216k   66 4127k    0     0  4651k      0  0:00:01 --:--:--  0:00:01 4648k[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (3.2.0-1nodesource1~jessie1) ...
[91m100 6216k  100 6216k    0     0  6065k      0  0:00:01  0:00:01 --:--:-- 6071k
[0mSetting up iojs (3.2.0-1nodesource1~jessie1) ...
 ---> 39b30f3d80d7
Removing intermediate container bef6d3ad951a
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 93a9aff7ec36
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@3.2.0 | linux | x64
[0m[91mgyp http GET https://iojs.org/dist/v3.2.0/iojs-v3.2.0.tar.gz
[0m[91mgyp [0m[91mhttp 200 https://iojs.org/dist/v3.2.0/iojs-v3.2.0.tar.gz
[0m[91mgyp [0m[91mhttp GET https://iojs.org/dist/v3.2.0/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v3.2.0/SHASUMS256.txt
[0m[91mgyp info spawn[0m[91m python
[0m[91mgyp info[0m[91m [0m[91mspawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp[0m[91m info spawn args[0m[91m   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args[0m[91m   '-I',
gyp[0m[91m [0m[91minfo[0m[91m spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp[0m[91m info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/3.2.0/common.gypi',
[0m[91mgyp[0m[91m [0m[91minfo spawn args   '-Dlibrary=shared_library',
gyp info [0m[91mspawn args   '-Dvisibility=default',
[0m[91mgyp[0m[91m info [0m[91mspawn args   '-Dnode_root_dir=/root/.node-gyp/3.2.0',
[0m[91mgyp info [0m[91mspawn args[0m[91m   '-Druntime=iojs',
[0m[91mgyp [0m[91minfo spawn args   '-Dmodule_root_dir=/',
gyp [0m[91minfo[0m[91m [0m[91mspawn args   '--depth=.',
[0m[91mgyp[0m[91m [0m[91minfo spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
[0m[91mgyp [0m[91minfo[0m[91m spawn args   'build',
gyp[0m[91m info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! [0m[91mconfigure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp[0m[91m ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp[0m[91m ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v3.2.0
gyp ERR![0m[91m pangyp -v v2.3.3
gyp [0m[91mERR! not ok 
[0m
 ---> 849bff6ce253
Removing intermediate container 93a9aff7ec36
Step 5 : ENV NODE_ENV production
 ---> Running in e09f8e2dcfbf
 ---> b98ed8351d1f
Removing intermediate container e09f8e2dcfbf
Step 6 : WORKDIR /usr/src/app
 ---> Running in 34711c3e8711
 ---> 87ef00c181f6
Removing intermediate container 34711c3e8711
Step 7 : CMD npm start
 ---> Running in f10c84fbcc3d
 ---> 54ef0007ea3b
Removing intermediate container f10c84fbcc3d
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in ac263b26163b
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3751 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 65ccaa9e019b
Removing intermediate container ac263b26163b
Successfully built 65ccaa9e019b

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test105`

Contents of dockerfile `/root/docker-node/.~tmp.test105/Dockerfile`:

```
FROM nodesource/jessie:iojs-3.2.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-3.2.0-test1` from `/root/docker-node/.~tmp.test105`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-3.2.0
 ---> 65ccaa9e019b
Step 2 : ENV NODE_ENV test
 ---> Running in ae6fffacb990
 ---> de1fda4f245a
Removing intermediate container ae6fffacb990
Step 3 : RUN node -v
 ---> Running in 128667c2ec5f
v3.2.0
 ---> 13b0a8a9c895
Removing intermediate container 128667c2ec5f
Step 4 : RUN node -p "process.versions"
 ---> Running in e92b56357246
{ http_parser: '2.5.0',
  node: '3.2.0',
  v8: '4.4.63.26',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '45',
  openssl: '1.0.2d' }
 ---> 2f7bcbb36347
Removing intermediate container e92b56357246
Step 5 : RUN npm --version
 ---> Running in 1306766c50bc
2.13.3
 ---> f06894c36dbe
Removing intermediate container 1306766c50bc
Successfully built f06894c36dbe

```

# Tested image `nodesource/jessie:iojs-2.4.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in ff80a64639bf
 ---> 1361eec8b7f8
Removing intermediate container ff80a64639bf
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.4.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in cef34edf42cb
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 43 6076k   43 2623k    0     0  5117k      0  0:00:01 --:--:--  0:00:01 5114k[0m[91m100 6076k  100 6076k    0     0  8027k      0 --:--:-- --:--:-- --:--:-- 8027k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.4.0-1nodesource1~jessie1) ...
Setting up iojs (2.4.0-1nodesource1~jessie1) ...
 ---> 98626a783781
Removing intermediate container cef34edf42cb
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 91afe0805860
[91mnpm[0m[91m [0m[91mWARN deprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@2.4.0 | linux | x64
[0m[91mgyp [0m[91mhttp GET https://iojs.org/dist/v2.4.0/iojs-v2.4.0.tar.gz
[0m[91mgyp [0m[91mhttp 200 https://iojs.org/dist/v2.4.0/iojs-v2.4.0.tar.gz
[0m[91mgyp [0m[91mhttp GET[0m[91m https://iojs.org/dist/v2.4.0/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v2.4.0/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info[0m[91m spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args[0m[91m   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info[0m[91m spawn args   '/root/.node-gyp/2.4.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/2.4.0',
gyp info[0m[91m spawn args   '-Druntime=iojs',
gyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
[0m[91mgyp info spawn args   '--depth=.',
gyp info[0m[91m spawn args   '--no-parallel',
gyp [0m[91minfo spawn args[0m[91m   '--generator-output',
gyp info [0m[91mspawn args   'build',
gyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
[0m[91mgyp [0m[91mERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
[0m[91mgyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v2.4.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> a633e7b2c133
Removing intermediate container 91afe0805860
Step 5 : ENV NODE_ENV production
 ---> Running in bd7ef4755723
 ---> c2ed63c1bc5c
Removing intermediate container bd7ef4755723
Step 6 : WORKDIR /usr/src/app
 ---> Running in a6251837add1
 ---> 5c05e7d1b02a
Removing intermediate container a6251837add1
Step 7 : CMD npm start
 ---> Running in 560512e993e0
 ---> 0566396c9102
Removing intermediate container 560512e993e0
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 2ffa8072debd
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3245 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 22cd5ce4123b
Removing intermediate container 2ffa8072debd
Successfully built 22cd5ce4123b

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test102`

Contents of dockerfile `/root/docker-node/.~tmp.test102/Dockerfile`:

```
FROM nodesource/jessie:iojs-2.4.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-2.4.0-test1` from `/root/docker-node/.~tmp.test102`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-2.4.0
 ---> 22cd5ce4123b
Step 2 : ENV NODE_ENV test
 ---> Running in 269ba5355968
 ---> 98cfc8ffd020
Removing intermediate container 269ba5355968
Step 3 : RUN node -v
 ---> Running in aeaf234e6e31
v2.4.0
 ---> c4d53ca0dbd8
Removing intermediate container aeaf234e6e31
Step 4 : RUN node -p "process.versions"
 ---> Running in a82914f35430
{ http_parser: '2.5.0',
  node: '2.4.0',
  v8: '4.2.77.20',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2d' }
 ---> b4d76aaa4229
Removing intermediate container a82914f35430
Step 5 : RUN npm --version
 ---> Running in b0ec6843f892
2.13.0
 ---> d6ff977dfe2c
Removing intermediate container b0ec6843f892
Successfully built d6ff977dfe2c

```

# Tested image `nodesource/sid:5.3.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 82fbae9f2689
 ---> aaf7a6e29c22
Removing intermediate container 82fbae9f2689
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.3.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in ec1bca1d668a
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 88 8478k   88 7503k    0     0  7118k      0  0:00:01  0:00:01 --:--:-- 7112k[0m[91m100 8478k  100 8478k    0     0  7555k      0  0:00:01  0:00:01 --:--:-- 7550k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.3.0-1nodesource1~sid1) ...
Setting up nodejs (5.3.0-1nodesource1~sid1) ...
 ---> 31df72cf6ec2
Removing intermediate container ec1bca1d668a
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 0efe7d868237
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@5.3.0 | linux | x64
[0m[91mgyp [0m[91mhttp GET http://nodejs.org/dist/v5.3.0/node-v5.3.0.tar.gz
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v5.3.0/node-v5.3.0.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v5.3.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v5.3.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.3.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.3.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.3.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> f65ec1601722
Removing intermediate container 0efe7d868237
Step 5 : ENV NODE_ENV production
 ---> Running in f8aa5f44c7eb
 ---> dc4e0377c405
Removing intermediate container f8aa5f44c7eb
Step 6 : WORKDIR /usr/src/app
 ---> Running in 28d56c40b825
 ---> e86a592360e7
Removing intermediate container 28d56c40b825
Step 7 : CMD npm start
 ---> Running in 3a9dd06de2b8
 ---> b71c860e9b30
Removing intermediate container 3a9dd06de2b8
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 89d68c40f56b
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 1s (5612 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.kernel.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:3 http://mirror.picosecond.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:5 http://mirrors.kernel.org/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:8 http://mirrors.kernel.org/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.kernel.org/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.kernel.org/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:13 http://mirrors.kernel.org/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
Get:11 http://mirror.picosecond.org/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirror.picosecond.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (2960 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 377b25fed909
Removing intermediate container 89d68c40f56b
Successfully built 377b25fed909

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test130`

Contents of dockerfile `/root/docker-node/.~tmp.test130/Dockerfile`:

```
FROM nodesource/sid:5.3.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:5.3.0-test1` from `/root/docker-node/.~tmp.test130`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:5.3.0
 ---> 377b25fed909
Step 2 : ENV NODE_ENV test
 ---> Running in fbb50040c13d
 ---> 2c1747bcbbc9
Removing intermediate container fbb50040c13d
Step 3 : RUN node -v
 ---> Running in 42bc7cd2e329
v5.3.0
 ---> 019b8a1e002a
Removing intermediate container 42bc7cd2e329
Step 4 : RUN node -p "process.versions"
 ---> Running in 1c03f68d4cc3
{ http_parser: '2.6.0',
  node: '5.3.0',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> 6aaf0bf59a0d
Removing intermediate container 1c03f68d4cc3
Step 5 : RUN npm --version
 ---> Running in be80e88470ab
3.3.12
 ---> ad3a22a71042
Removing intermediate container be80e88470ab
Successfully built ad3a22a71042

```

# Tested image `nodesource/sid:0.12.6`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 38434783ed1b
 ---> c0a9b5178afe
Removing intermediate container 38434783ed1b
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.6-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 9d37ce53ab28
[91m  % Total    % Received % Xferd  Average Speed   Time[0m[91m    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 78 5280k   78 4127k    0     0  5266k      0  0:00:01 --:--:--  0:00:01 5264k[0m[91m100 5280k  100 5280k    0     0  6103k      0 --:--:-- --:--:-- --:--:-- 6097k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.6-1nodesource1~sid1) ...
Setting up nodejs (0.12.6-1nodesource1~sid1) ...
 ---> 54231db0a2dd
Removing intermediate container 9d37ce53ab28
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 54d97005c0ae
[91mnpm[0m[91m [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.12.6 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.6/node-v0.12.6.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.6/node-v0.12.6.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp GET[0m[91m http://nodejs.org/dist/v0.12.6/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.6/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp [0m[91minfo spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.6/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.6',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR![0m[91m [0m[91mstack     at ChildProcess.emit (events.js:110:17)
[0m[91mgyp [0m[91mERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
[0m[91mgyp [0m[91mERR! System[0m[91m Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.6
gyp [0m[91mERR! [0m[91mpangyp -v[0m[91m v2.3.3
[0m[91mgyp ERR! not ok 
[0m
 ---> 583d8b7030f1
Removing intermediate container 54d97005c0ae
Step 5 : ENV NODE_ENV production
 ---> Running in 3ee12e22c849
 ---> 5cb97009d0f9
Removing intermediate container 3ee12e22c849
Step 6 : WORKDIR /usr/src/app
 ---> Running in 3015d90521b7
 ---> 9e3248d8111b
Removing intermediate container 3015d90521b7
Step 7 : CMD npm start
 ---> Running in b5be10fd9bf5
 ---> ea718690c1a3
Removing intermediate container b5be10fd9bf5
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in f1078aa38be1
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4912 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (5620 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 24d5374e0f06
Removing intermediate container f1078aa38be1
Successfully built 24d5374e0f06

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test152`

Contents of dockerfile `/root/docker-node/.~tmp.test152/Dockerfile`:

```
FROM nodesource/sid:0.12.6
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.12.6-test1` from `/root/docker-node/.~tmp.test152`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.12.6
 ---> 24d5374e0f06
Step 2 : ENV NODE_ENV test
 ---> Running in 9b352d9e984c
 ---> b2ccf954cc65
Removing intermediate container 9b352d9e984c
Step 3 : RUN node -v
 ---> Running in e240b684ce31
v0.12.6
 ---> 1127f9299441
Removing intermediate container e240b684ce31
Step 4 : RUN node -p "process.versions"
 ---> Running in 76ebecf289a5
{ http_parser: '2.3',
  node: '0.12.6',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1o' }
 ---> f62a9fa67f62
Removing intermediate container 76ebecf289a5
Step 5 : RUN npm --version
 ---> Running in 5725a4f600fa
2.11.2
 ---> 3d9d42efa254
Removing intermediate container 5725a4f600fa
Successfully built 3d9d42efa254

```

# Tested image `nodesource/sid:4.3.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in f472846cecc7
 ---> 56ef423e6d10
Removing intermediate container f472846cecc7
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.3.1-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in d919badd693e
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  6 8374k    6  559k    0     0   786k      0  0:00:10 --:--:--  0:0[0m[91m0:10  786k[0m[91m100 8374k  100 8374k    0     0  6883k      0  0:00:01  0:00:01 --:--:-- 6886k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.3.1-1nodesource1~sid1) ...
Setting up nodejs (4.3.1-1nodesource1~sid1) ...
 ---> 88b58186993e
Removing intermediate container d919badd693e
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 20e9f901d112
[91mnpm [0m[91mWARN [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (forever-agent@0.5.2, caseless@0.8.0, aws-sign2@0.5.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@4.3.1 | linux | x64
[0m[91mgyp [0m[91mhttp GET http://nodejs.org/dist/v4.3.1/node-v4.3.1.tar.gz
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v4.3.1/node-v4.3.1.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v4.3.1/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200[0m[91m http://nodejs.org/dist/v4.3.1/SHASUMS256.txt
[0m[91mgyp[0m[91m [0m[91minfo spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp[0m[91m [0m[91minfo spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args[0m[91m   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.3.1/common.gypi',
gyp info[0m[91m spawn args[0m[91m   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.3.1',
gyp info spawn args   '-Druntime=node',
gyp [0m[91minfo[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
[0m[91mgyp info[0m[91m [0m[91mspawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args   'build',
[0m[91mgyp [0m[91minfo[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp [0m[91mERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.3.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 7832040d0547
Removing intermediate container 20e9f901d112
Step 5 : ENV NODE_ENV production
 ---> Running in d6fcd75c6ef7
 ---> 77d59adfa070
Removing intermediate container d6fcd75c6ef7
Step 6 : WORKDIR /usr/src/app
 ---> Running in e94e44496d28
 ---> a82e8a3926ce
Removing intermediate container e94e44496d28
Step 7 : CMD npm start
 ---> Running in 9fc5952deaa8
 ---> 8a9e91a9e7ad
Removing intermediate container 9fc5952deaa8
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 8689493746a1
Get:1 http://mirrors.kernel.org/debian sid InRelease [287 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (5426 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.kernel.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:3 http://mirrors.kernel.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:6 http://mirrors.kernel.org/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.kernel.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.kernel.org/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:11 http://mirrors.kernel.org/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:4 http://mirror.picosecond.org/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:12 http://mirrors.kernel.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.kernel.org/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
Get:10 http://mirror.picosecond.org/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2283 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 14a524a49726
Removing intermediate container 8689493746a1
Successfully built 14a524a49726

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test120`

Contents of dockerfile `/root/docker-node/.~tmp.test120/Dockerfile`:

```
FROM nodesource/sid:4.3.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:4.3.1-test1` from `/root/docker-node/.~tmp.test120`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:4.3.1
 ---> 14a524a49726
Step 2 : ENV NODE_ENV test
 ---> Running in aa6c86a400de
 ---> 5638d06f557f
Removing intermediate container aa6c86a400de
Step 3 : RUN node -v
 ---> Running in d0cbe0fbfbb8
v4.3.1
 ---> 03663cd475db
Removing intermediate container d0cbe0fbfbb8
Step 4 : RUN node -p "process.versions"
 ---> Running in 986fefcb6d19
{ http_parser: '2.5.2',
  node: '4.3.1',
  v8: '4.5.103.35',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2f' }
 ---> fba12a701764
Removing intermediate container 986fefcb6d19
Step 5 : RUN npm --version
 ---> Running in 49dde52ea54d
2.14.12
 ---> 8b9885be14c0
Removing intermediate container 49dde52ea54d
Successfully built 8b9885be14c0

```

# Tested image `nodesource/jessie:iojs-1.6.2`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 68b440e4190c
 ---> 5b30fb0fab86
Removing intermediate container 68b440e4190c
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.6.2-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 6a95b278542e
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 99 5139k   99 5135k    0     0  7036k      0 --:--:-- --:--:-- --:--:-- 7035k100 5139k  100 5139k    0     0  7040k      0 --:--:-- --:--:-- --:--:-- 7040k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.6.2-1nodesource1~jessie1) ...
Setting up iojs (1.6.2-1nodesource1~jessie1) ...
 ---> 3afa2deb527d
Removing intermediate container 6a95b278542e
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 03422de49274
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, hawk@1.1.1, bl@0.9.5, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo[0m[91m it worked if it ends with[0m[91m ok
[0m[91mgyp info [0m[91musing pangyp@2.3.3
[0m[91mgyp info using node@1.6.2 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v1.6.2/iojs-v1.6.2.tar.gz
[0m[91mgyp[0m[91m http[0m[91m [0m[91m200 https://iojs.org/dist/v1.6.2/iojs-v1.6.2.tar.gz
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v1.6.2/SHASUMS256.txt
[0m[91mgyp http 200[0m[91m https://iojs.org/dist/v1.6.2/SHASUMS256.txt
[0m[91mgyp info[0m[91m [0m[91mspawn python
[0m[91mgyp info [0m[91mspawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info [0m[91mspawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args[0m[91m   '-I',
[0m[91mgyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.6.2/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
[0m[91mgyp [0m[91minfo spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.6.2',
gyp info spawn args[0m[91m   '-Druntime=iojs',
gyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
[0m[91mgyp info[0m[91m [0m[91mspawn args[0m[91m   '--depth=.',
[0m[91mgyp [0m[91minfo spawn args   '--no-parallel',
[0m[91mgyp info spawn args   '--generator-output',
[0m[91mgyp[0m[91m info spawn args[0m[91m   'build',
[0m[91mgyp [0m[91minfo[0m[91m [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! [0m[91mconfigure error 
[0m[91mgyp ERR![0m[91m stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack[0m[91m     at ChildProcess.emit (events.js:169:7)
gyp[0m[91m ERR! stack[0m[91m     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp [0m[91mERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR![0m[91m [0m[91mnode -v v1.6.2
gyp ERR! pangyp -v v2.3.3
gyp [0m[91mERR![0m[91m not ok[0m[91m 
[0m
 ---> 42dde8cdc2da
Removing intermediate container 03422de49274
Step 5 : ENV NODE_ENV production
 ---> Running in acde30eb6d0b
 ---> e78325cc35b7
Removing intermediate container acde30eb6d0b
Step 6 : WORKDIR /usr/src/app
 ---> Running in f2dce65fa5a9
 ---> 1a4c5180aab4
Removing intermediate container f2dce65fa5a9
Step 7 : CMD npm start
 ---> Running in 3efdde510813
 ---> d10ca0e6465a
Removing intermediate container 3efdde510813
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 8a201b76e72b
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3287 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> bacd0e366453
Removing intermediate container 8a201b76e72b
Successfully built bacd0e366453

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test110`

Contents of dockerfile `/root/docker-node/.~tmp.test110/Dockerfile`:

```
FROM nodesource/jessie:iojs-1.6.2
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-1.6.2-test1` from `/root/docker-node/.~tmp.test110`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-1.6.2
 ---> bacd0e366453
Step 2 : ENV NODE_ENV test
 ---> Running in 632e5ccb7fed
 ---> f836e7e9b063
Removing intermediate container 632e5ccb7fed
Step 3 : RUN node -v
 ---> Running in a4b851329361
v1.6.2
 ---> 5ef560cc7926
Removing intermediate container a4b851329361
Step 4 : RUN node -p "process.versions"
 ---> Running in 77d289b91a41
{ http_parser: '2.3.0',
  node: '1.6.2',
  v8: '4.1.0.25',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1m' }
 ---> a2030282d03d
Removing intermediate container 77d289b91a41
Step 5 : RUN npm --version
 ---> Running in 2675e84bc690
2.7.1
 ---> 69744ba99dfa
Removing intermediate container 2675e84bc690
Successfully built 69744ba99dfa

```

# Tested image `nodesource/jessie:iojs-1.6.3`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 0134185d5dea
 ---> 63f5ef747f6a
Removing intermediate container 0134185d5dea
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.6.3-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in b71ba1f8b12e
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0 5177k    0 48854    0     0   242k      0  0:00:21 --:--:--  0:00:21  242k[0m[91m10[0m[91m0 5177k  100 5177k    0     0  6866k      0 --:--:-- --:--:-- --:--:-- 6866k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.6.3-1nodesource1~jessie1) ...
Setting up iojs (1.6.3-1nodesource1~jessie1) ...
 ---> 277b94227db9
Removing intermediate container b71ba1f8b12e
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 545e126ac1f1
[91mnpm WARN deprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with[0m[91m ok
[0m[91mgyp info [0m[91musing pangyp@2.3.3
[0m[91mgyp info using node@1.6.3 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v1.6.3/iojs-v1.6.3.tar.gz
[0m[91mgyp[0m[91m http [0m[91m200 https://iojs.org/dist/v1.6.3/iojs-v1.6.3.tar.gz
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v1.6.3/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp [0m[91m200[0m[91m https://iojs.org/dist/v1.6.3/SHASUMS256.txt
[0m[91mgyp [0m[91minfo [0m[91mspawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info spawn args   'binding.gyp',
[0m[91mgyp info spawn args   '-f',
[0m[91mgyp info[0m[91m spawn args   'make',
gyp info spawn args   '-I',
gyp [0m[91minfo spawn args[0m[91m   '/build/config.gypi',
[0m[91mgyp info spawn args   '-I',
gyp info [0m[91mspawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.6.3/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info [0m[91mspawn args[0m[91m   '-Dnode_root_dir=/root/.node-gyp/1.6.3',
gyp info[0m[91m spawn args[0m[91m   '-Druntime=iojs',
gyp [0m[91minfo spawn args   '-Dmodule_root_dir=/',
gyp info [0m[91mspawn args   '--depth=.',
[0m[91mgyp info spawn args   '--no-parallel',
gyp [0m[91minfo spawn args[0m[91m   '--generator-output',
gyp [0m[91minfo spawn args[0m[91m   'build',
[0m[91mgyp info[0m[91m spawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
[0m[91mgyp ERR![0m[91m stack[0m[91m Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR![0m[91m [0m[91mstack[0m[91m     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
[0m[91mgyp ERR! System[0m[91m Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.6.3
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 3d8029220878
Removing intermediate container 545e126ac1f1
Step 5 : ENV NODE_ENV production
 ---> Running in 9b87bf8a9249
 ---> 5db2c2fe4f52
Removing intermediate container 9b87bf8a9249
Step 6 : WORKDIR /usr/src/app
 ---> Running in dde7d75c37da
 ---> 5b1eb15f2523
Removing intermediate container dde7d75c37da
Step 7 : CMD npm start
 ---> Running in f418f488ec2d
 ---> 6bb2b88a1f4d
Removing intermediate container f418f488ec2d
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in afd8e05d78ce
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:4 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3866 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> e85fd079cff0
Removing intermediate container afd8e05d78ce
Successfully built e85fd079cff0

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test111`

Contents of dockerfile `/root/docker-node/.~tmp.test111/Dockerfile`:

```
FROM nodesource/jessie:iojs-1.6.3
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-1.6.3-test1` from `/root/docker-node/.~tmp.test111`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-1.6.3
 ---> e85fd079cff0
Step 2 : ENV NODE_ENV test
 ---> Running in 4616b8edf9a8
 ---> 2481543ee0ee
Removing intermediate container 4616b8edf9a8
Step 3 : RUN node -v
 ---> Running in 41de088a7b2a
v1.6.3
 ---> a3449181bc1e
Removing intermediate container 41de088a7b2a
Step 4 : RUN node -p "process.versions"
 ---> Running in d42249f85add
{ http_parser: '2.3.0',
  node: '1.6.3',
  v8: '4.1.0.27',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1m' }
 ---> 54b264d4c991
Removing intermediate container d42249f85add
Step 5 : RUN npm --version
 ---> Running in 1f23320a15f2
2.7.4
 ---> ac5df5bf124f
Removing intermediate container 1f23320a15f2
Successfully built ac5df5bf124f

```

# Tested image `nodesource/sid:0.10.36`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 1caa57850c15
 ---> ee445366396c
Removing intermediate container 1caa57850c15
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.36-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in cd384fabbac6
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 3959k  100 3959k    0     0  5342k      0 --:--:-- --:--:-- --:--:-- 5343k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.36-1nodesource1~sid1) ...
Setting up nodejs (0.10.36-1nodesource1~sid1) ...
 ---> 0b04aa77a2d0
Removing intermediate container cd384fabbac6
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 2f087f189928
[91mnpm[0m[91m [0m[91mWARN[0m[91m [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ fstream@1.0.8 (graceful-fs@4.1.3, inherits@2.0.1)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1, bl@0.9.5)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp [0m[91minfo [0m[91musing pangyp@2.3.3
gyp info using node@0.10.36 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.36/node-v0.10.36.tar.gz
[0m[91mgyp http[0m[91m 200[0m[91m http://nodejs.org/dist/v0.10.36/node-v0.10.36.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.10.36/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.36/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info [0m[91mspawn args   'binding.gyp',
gyp[0m[91m info spawn args   '-f',
[0m[91mgyp [0m[91minfo [0m[91mspawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info [0m[91mspawn args[0m[91m   '-I',
[0m[91mgyp info [0m[91mspawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp [0m[91minfo [0m[91mspawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.36/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.36',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
[0m[91mgyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.36
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 3484fdc1aa85
Removing intermediate container 2f087f189928
Step 5 : ENV NODE_ENV production
 ---> Running in 959e314eb881
 ---> 0b05e3e4c39c
Removing intermediate container 959e314eb881
Step 6 : WORKDIR /usr/src/app
 ---> Running in 465aff4a8b60
 ---> 3844f89e841a
Removing intermediate container 465aff4a8b60
Step 7 : CMD npm start
 ---> Running in 7819975a9a78
 ---> b1ce08af358e
Removing intermediate container 7819975a9a78
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 9d10c44c42e9
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 1s (5563 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2719 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 59a6463e90bb
Removing intermediate container 9d10c44c42e9
Successfully built 59a6463e90bb

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test140`

Contents of dockerfile `/root/docker-node/.~tmp.test140/Dockerfile`:

```
FROM nodesource/sid:0.10.36
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.10.36-test1` from `/root/docker-node/.~tmp.test140`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.10.36
 ---> 59a6463e90bb
Step 2 : ENV NODE_ENV test
 ---> Running in b17c8132d20a
 ---> 8deb73e5e73b
Removing intermediate container b17c8132d20a
Step 3 : RUN node -v
 ---> Running in e84c75db9a41
v0.10.36
 ---> daa10a9aeb56
Removing intermediate container e84c75db9a41
Step 4 : RUN node -p "process.versions"
 ---> Running in 976cc96e07ef
{ http_parser: '1.0',
  node: '0.10.36',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.30',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1l' }
 ---> f17d76f339bb
Removing intermediate container 976cc96e07ef
Step 5 : RUN npm --version
 ---> Running in 9f4244430cfa
1.4.28
 ---> 347642e07e1a
Removing intermediate container 9f4244430cfa
Successfully built 347642e07e1a

```

# Tested image `nodesource/jessie:iojs-1.8.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 30b1ca0d9379
 ---> eba9e6f5712e
Removing intermediate container 30b1ca0d9379
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.8.1-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in e761b1431be5
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 59 5546k   59 3279k    0     0  5498k      0  0:00:01 --:--:--  0:00:01 5493k[0m[91m100 5546k  100 5546k    0     0  7438k      0 --:--:-- --:--:-- --:--:-- 7435k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.8.1-1nodesource1~jessie1) ...
Setting up iojs (1.8.1-1nodesource1~jessie1) ...
 ---> 717f85f55226
Removing intermediate container e761b1431be5
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 8e069869d90a
[91mnpm[0m[91m WARN[0m[91m [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@1.8.1 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp GET https://iojs.org/dist/v1.8.1/iojs-v1.8.1.tar.gz
[0m[91mgyp [0m[91mhttp [0m[91m200[0m[91m https://iojs.org/dist/v1.8.1/iojs-v1.8.1.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v1.8.1/SHASUMS256.txt
[0m[91mgyp[0m[91m http [0m[91m200 https://iojs.org/dist/v1.8.1/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp[0m[91m [0m[91minfo spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.8.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.8.1',
gyp info[0m[91m spawn args   '-Druntime=iojs',
gyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info [0m[91mspawn args   '--depth=.',
gyp [0m[91minfo spawn args   '--no-parallel',
gyp [0m[91minfo spawn args   '--generator-output',
gyp info[0m[91m [0m[91mspawn args   'build',
gyp [0m[91minfo [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! [0m[91mconfigure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! stack     at emitTwo (events.js:87:13)
[0m[91mgyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1009:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp ERR! [0m[91mnode -v[0m[91m v1.8.1
[0m[91mgyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> f498fd7edcea
Removing intermediate container 8e069869d90a
Step 5 : ENV NODE_ENV production
 ---> Running in 14f8cc4175f3
 ---> dda2b386e57a
Removing intermediate container 14f8cc4175f3
Step 6 : WORKDIR /usr/src/app
 ---> Running in b4d4e75f6d7a
 ---> 5c45d3b73bed
Removing intermediate container b4d4e75f6d7a
Step 7 : CMD npm start
 ---> Running in a79a020bb4d8
 ---> 908c1e75ef88
Removing intermediate container a79a020bb4d8
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 9c85d6ece228
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie Release [148 kB]
Get:6 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 1s (5674 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 03b1f8d19cfd
Removing intermediate container 9c85d6ece228
Successfully built 03b1f8d19cfd

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test112`

Contents of dockerfile `/root/docker-node/.~tmp.test112/Dockerfile`:

```
FROM nodesource/jessie:iojs-1.8.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-1.8.1-test1` from `/root/docker-node/.~tmp.test112`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-1.8.1
 ---> 03b1f8d19cfd
Step 2 : ENV NODE_ENV test
 ---> Running in e3da8266f786
 ---> 909e83959ac4
Removing intermediate container e3da8266f786
Step 3 : RUN node -v
 ---> Running in 82f4aab0ca12
v1.8.1
 ---> 0dd80977209c
Removing intermediate container 82f4aab0ca12
Step 4 : RUN node -p "process.versions"
 ---> Running in acf2d73ecf58
{ http_parser: '2.3.0',
  node: '1.8.1',
  v8: '4.1.0.27',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.2a' }
 ---> 3a088118f78b
Removing intermediate container acf2d73ecf58
Step 5 : RUN npm --version
 ---> Running in 78831cb4f904
2.8.3
 ---> 632b6bd56d68
Removing intermediate container 78831cb4f904
Successfully built 632b6bd56d68

```

# Tested image `nodesource/jessie:iojs-1.8.3`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 34da910b3d61
 ---> 381e3031e94d
Removing intermediate container 34da910b3d61
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.8.3-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 9d0c8bd64670
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0  [0m[91m  0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 60 5762k   60 3487k    0     0  6047k      0 --:--:-- --:--:-- --:--:-- 6044k[0m[91m100 5762k  100 5762k    0     0  7913k      0 --:--:-- --:--:-- --:--:-- 7904k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.8.3-1nodesource1~jessie1) ...
Setting up iojs (1.8.3-1nodesource1~jessie1) ...
 ---> 4b4008a21d66
Removing intermediate container 9d0c8bd64670
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in d1f76289d1d5
[91mnpm[0m[91m [0m[91mWARN[0m[91m [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@1.8.3 | linux | x64
[0m[91mgyp http GET https://iojs.org/dist/v1.8.3/iojs-v1.8.3.tar.gz
[0m[91mgyp[0m[91m http [0m[91m200[0m[91m https://iojs.org/dist/v1.8.3/iojs-v1.8.3.tar.gz
[0m[91mgyp [0m[91mhttp GET https://iojs.org/dist/v1.8.3/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v1.8.3/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.8.3/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.8.3',
gyp info [0m[91mspawn args[0m[91m   '-Druntime=iojs',
gyp[0m[91m info[0m[91m spawn args[0m[91m   '-Dmodule_root_dir=/',
gyp[0m[91m [0m[91minfo spawn args   '--depth=.',
gyp info[0m[91m spawn args[0m[91m   '--no-parallel',
gyp info[0m[91m spawn args[0m[91m   '--generator-output',
gyp[0m[91m info spawn args   'build',
gyp info[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! [0m[91mconfigure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR![0m[91m stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1009:12)
gyp[0m[91m ERR![0m[91m System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.8.3
[0m[91mgyp ERR! pangyp -v[0m[91m v2.3.3
[0m[91mgyp ERR! not ok 
[0m
 ---> 69f37f41975f
Removing intermediate container d1f76289d1d5
Step 5 : ENV NODE_ENV production
 ---> Running in 3a03f97a9c54
 ---> 1b7827632793
Removing intermediate container 3a03f97a9c54
Step 6 : WORKDIR /usr/src/app
 ---> Running in af0746c3d949
 ---> e1d704d55607
Removing intermediate container af0746c3d949
Step 7 : CMD npm start
 ---> Running in 6040330c97fa
 ---> aa9b5d4faed1
Removing intermediate container 6040330c97fa
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in a04eda71b0fa
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3311 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> f191d4d96ac4
Removing intermediate container a04eda71b0fa
Successfully built f191d4d96ac4

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test113`

Contents of dockerfile `/root/docker-node/.~tmp.test113/Dockerfile`:

```
FROM nodesource/jessie:iojs-1.8.3
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-1.8.3-test1` from `/root/docker-node/.~tmp.test113`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-1.8.3
 ---> f191d4d96ac4
Step 2 : ENV NODE_ENV test
 ---> Running in cca3bdc55d27
 ---> 968c248206d3
Removing intermediate container cca3bdc55d27
Step 3 : RUN node -v
 ---> Running in d011839b1a3a
v1.8.3
 ---> 6dbe7a724ded
Removing intermediate container d011839b1a3a
Step 4 : RUN node -p "process.versions"
 ---> Running in 91db3b6e4c00
{ http_parser: '2.5.0',
  node: '1.8.3',
  v8: '4.1.0.27',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.2c' }
 ---> b22844bd2488
Removing intermediate container 91db3b6e4c00
Step 5 : RUN npm --version
 ---> Running in ab66979ad77d
2.9.0
 ---> 2c279ed7d7bb
Removing intermediate container ab66979ad77d
Successfully built 2c279ed7d7bb

```

# Tested image `nodesource/jessie:iojs-3.0.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 36e32c3963c9
 ---> d6c764e4344a
Removing intermediate container 36e32c3963c9
Step 3 : RUN curl https://deb.nodesource.com/iojs_3.x/pool/main/i/iojs/iojs_3.0.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 495f2e272da0
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 63 6152k   63 3919k    0     0  5931k      0  0:00:01 --:--:--  0:00:01 5929k[0m[91m100 6152k  100 6152k    0     0  7634k      0 --:--:-- --:--:-- --:--:-- 7632k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (3.0.0-1nodesource1~jessie1) ...
Setting up iojs (3.0.0-1nodesource1~jessie1) ...
 ---> 841f240a093b
Removing intermediate container 495f2e272da0
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 0fdec8fc6842
[91mnpm[0m[91m WARN[0m[91m [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo[0m[91m using pangyp@2.3.3
gyp info using node@3.0.0 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v3.0.0/iojs-v3.0.0.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v3.0.0/iojs-v3.0.0.tar.gz
[0m[91mgyp [0m[91mhttp GET https://iojs.org/dist/v3.0.0/SHASUMS256.txt
[0m[91mgyp http 200[0m[91m https://iojs.org/dist/v3.0.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/3.0.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/3.0.0',
gyp info spawn args   '-Druntime=iojs',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
gyp info [0m[91mspawn args   '--depth=.',
[0m[91mgyp[0m[91m info[0m[91m spawn args   '--no-parallel',
gyp[0m[91m info spawn args[0m[91m   '--generator-output',
gyp info[0m[91m spawn args   'build',
gyp [0m[91minfo[0m[91m [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp[0m[91m ERR![0m[91m stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command[0m[91m "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp ERR! node -v v3.0.0
[0m[91mgyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 2724e34cadcf
Removing intermediate container 0fdec8fc6842
Step 5 : ENV NODE_ENV production
 ---> Running in 9f559ece4fa0
 ---> 98ba1931b06b
Removing intermediate container 9f559ece4fa0
Step 6 : WORKDIR /usr/src/app
 ---> Running in 31deb712f82f
 ---> ff008bcb55bd
Removing intermediate container 31deb712f82f
Step 7 : CMD npm start
 ---> Running in 1ef632f6134e
 ---> 58404f97a40d
Removing intermediate container 1ef632f6134e
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 1dbb3ace4bcd
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (4703 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> cfc279b2f8e9
Removing intermediate container 1dbb3ace4bcd
Successfully built cfc279b2f8e9

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test103`

Contents of dockerfile `/root/docker-node/.~tmp.test103/Dockerfile`:

```
FROM nodesource/jessie:iojs-3.0.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-3.0.0-test1` from `/root/docker-node/.~tmp.test103`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-3.0.0
 ---> cfc279b2f8e9
Step 2 : ENV NODE_ENV test
 ---> Running in 21cb2e47ae06
 ---> 5ce0464f93ca
Removing intermediate container 21cb2e47ae06
Step 3 : RUN node -v
 ---> Running in 1e288508adda
v3.0.0
 ---> d24950724f28
Removing intermediate container 1e288508adda
Step 4 : RUN node -p "process.versions"
 ---> Running in 4c67a80cf085
{ http_parser: '2.5.0',
  node: '3.0.0',
  v8: '4.4.63.26',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '45',
  openssl: '1.0.2d' }
 ---> a7b1321aeee6
Removing intermediate container 4c67a80cf085
Step 5 : RUN npm --version
 ---> Running in bafb4fa81abb
2.13.3
 ---> 467f21bbf551
Removing intermediate container bafb4fa81abb
Successfully built 467f21bbf551

```

# Tested image `nodesource/jessie:iojs-2.0.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 429f7e508605
 ---> 58da27337625
Removing intermediate container 429f7e508605
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.0.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in ef0ab9fea1f2
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0 5604k    0 16086    0     0  98770      0  0:00:58 --:--:--  0:00:58 98687[0m[91m100 5604k  100 5604k    0     0  7667k      0 --:--:-- --:--:-- -[0m[91m-:--:-- 7666k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.0.0-1nodesource1~jessie1) ...
Setting up iojs (2.0.0-1nodesource1~jessie1) ...
 ---> 2c5f3a7f9657
Removing intermediate container ef0ab9fea1f2
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 2ec9d8a763a8
[91mnpm[0m[91m [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@2.0.0 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp GET https://iojs.org/dist/v2.0.0/iojs-v2.0.0.tar.gz
[0m[91mgyp http [0m[91m200 https://iojs.org/dist/v2.0.0/iojs-v2.0.0.tar.gz
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v2.0.0/SHASUMS256.txt
[0m[91mgyp http[0m[91m 200 https://iojs.org/dist/v2.0.0/SHASUMS256.txt
[0m[91mgyp[0m[91m [0m[91minfo [0m[91mspawn[0m[91m python
[0m[91mgyp[0m[91m info [0m[91mspawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args[0m[91m   '-f',
[0m[91mgyp [0m[91minfo spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args[0m[91m   '/build/config.gypi',
gyp [0m[91minfo spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/2.0.0/common.gypi',
[0m[91mgyp [0m[91minfo spawn args   '-Dlibrary=shared_library',
gyp info [0m[91mspawn args   '-Dvisibility=default',
gyp [0m[91minfo spawn args[0m[91m   '-Dnode_root_dir=/root/.node-gyp/2.0.0',
gyp[0m[91m info[0m[91m spawn args[0m[91m   '-Druntime=iojs',
[0m[91mgyp info[0m[91m [0m[91mspawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
[0m[91mgyp [0m[91minfo spawn args[0m[91m   '--no-parallel',
gyp info spawn args   '--generator-output',
[0m[91mgyp[0m[91m [0m[91minfo spawn args[0m[91m   'build',
[0m[91mgyp info[0m[91m spawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m [0m[91mERR! [0m[91mconfigure error[0m[91m 
[0m[91mgyp ERR! stack[0m[91m Error: `gyp` failed with exit code: 1
gyp[0m[91m ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
[0m[91mgyp [0m[91mERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1009:12)
[0m[91mgyp[0m[91m [0m[91mERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v2.0.0
[0m[91mgyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 2644deef3b8a
Removing intermediate container 2ec9d8a763a8
Step 5 : ENV NODE_ENV production
 ---> Running in 9fa137239ee6
 ---> 4ae826cadd63
Removing intermediate container 9fa137239ee6
Step 6 : WORKDIR /usr/src/app
 ---> Running in 60e7856f99d4
 ---> 2a236ad311c4
Removing intermediate container 60e7856f99d4
Step 7 : CMD npm start
 ---> Running in 130238ea2982
 ---> 82b8abc55edb
Removing intermediate container 130238ea2982
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 859cf42c9e73
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:4 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 1s (5047 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 35326092849b
Removing intermediate container 859cf42c9e73
Successfully built 35326092849b

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test114`

Contents of dockerfile `/root/docker-node/.~tmp.test114/Dockerfile`:

```
FROM nodesource/jessie:iojs-2.0.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-2.0.0-test1` from `/root/docker-node/.~tmp.test114`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-2.0.0
 ---> 35326092849b
Step 2 : ENV NODE_ENV test
 ---> Running in 7c50c5f58941
 ---> b129a7238bf9
Removing intermediate container 7c50c5f58941
Step 3 : RUN node -v
 ---> Running in 361620cc2f42
v2.0.0
 ---> c12344db6dc8
Removing intermediate container 361620cc2f42
Step 4 : RUN node -p "process.versions"
 ---> Running in f4c143393684
{ http_parser: '2.5.0',
  node: '2.0.0',
  v8: '4.2.77.18',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '44',
  openssl: '1.0.2a' }
 ---> a87d3dcc9bf7
Removing intermediate container f4c143393684
Step 5 : RUN npm --version
 ---> Running in 650c62c998c4
2.9.0
 ---> 6851f71d475b
Removing intermediate container 650c62c998c4
Successfully built 6851f71d475b

```

# Tested image `nodesource/jessie:iojs-2.3.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in a2b893e6bb71
 ---> 3546814c2e88
Removing intermediate container a2b893e6bb71
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.3.1-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in e8dab7df7a32
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5776k  100 5776k    0     0  7741k      0 --:--:-- --:--:-- --:--:-- 7753k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.3.1-1nodesource1~jessie1) ...
Setting up iojs (2.3.1-1nodesource1~jessie1) ...
 ---> e36d7b66477d
Removing intermediate container e8dab7df7a32
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 847695f9b213
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp[0m[91m info using pangyp@2.3.3
[0m[91mgyp [0m[91minfo using node@2.3.1 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v2.3.1/iojs-v2.3.1.tar.gz
[0m[91mgyp http [0m[91m200 https://iojs.org/dist/v2.3.1/iojs-v2.3.1.tar.gz
[0m[91mgyp[0m[91m http GET[0m[91m https://iojs.org/dist/v2.3.1/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp[0m[91m [0m[91m200 https://iojs.org/dist/v2.3.1/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/2.3.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/2.3.1',
gyp info spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
[0m[91mgyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! [0m[91mcwd /
gyp ERR! node -v v2.3.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 9bf9a4df99b8
Removing intermediate container 847695f9b213
Step 5 : ENV NODE_ENV production
 ---> Running in 3f2266e5abf6
 ---> 90bc5741de76
Removing intermediate container 3f2266e5abf6
Step 6 : WORKDIR /usr/src/app
 ---> Running in eec21b04f84b
 ---> 31a5489265ae
Removing intermediate container eec21b04f84b
Step 7 : CMD npm start
 ---> Running in 3170f846c9c4
 ---> 3fcbca39da78
Removing intermediate container 3170f846c9c4
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in f8bc6054d5de
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:4 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:5 http://httpredir.debian.org jessie Release [148 kB]
Get:6 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3290 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 13d0e5d2e3d1
Removing intermediate container f8bc6054d5de
Successfully built 13d0e5d2e3d1

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test117`

Contents of dockerfile `/root/docker-node/.~tmp.test117/Dockerfile`:

```
FROM nodesource/jessie:iojs-2.3.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-2.3.1-test1` from `/root/docker-node/.~tmp.test117`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-2.3.1
 ---> 13d0e5d2e3d1
Step 2 : ENV NODE_ENV test
 ---> Running in 00a39c29a505
 ---> 517cec0a9674
Removing intermediate container 00a39c29a505
Step 3 : RUN node -v
 ---> Running in 35d383bd9a00
v2.3.1
 ---> a15ea075aecf
Removing intermediate container 35d383bd9a00
Step 4 : RUN node -p "process.versions"
 ---> Running in 9be28a1c0fed
{ http_parser: '2.5.0',
  node: '2.3.1',
  v8: '4.2.77.20',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2c' }
 ---> a95f963fe177
Removing intermediate container 9be28a1c0fed
Step 5 : RUN npm --version
 ---> Running in e9966f1c93e0
2.11.3
 ---> c4a57309bd93
Removing intermediate container e9966f1c93e0
Successfully built c4a57309bd93

```

# Tested image `nodesource/jessie:iojs-2.0.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 132f463242ee
 ---> b565394beb21
Removing intermediate container 132f463242ee
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.0.1-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 26cf8d2e7e1a
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 88 5606k   88 4975k    0     0  6808k      0 --:--:-- --:--:-- --:--:-- 6806k[0m[91m100 5606k  100 5606k    0     0  7343k      0 --:--:-- --:--:-- --:--:-- 7338k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.0.1-1nodesource1~jessie1) ...
Setting up iojs (2.0.1-1nodesource1~jessie1) ...
 ---> 322ea59d1ff1
Removing intermediate container 26cf8d2e7e1a
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 799920fb16ca
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with ok
[0m[91mgyp[0m[91m info[0m[91m using pangyp@2.3.3
[0m[91mgyp info using node@2.0.1 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp[0m[91m GET[0m[91m https://iojs.org/dist/v2.0.1/iojs-v2.0.1.tar.gz
[0m[91mgyp http[0m[91m 200 https://iojs.org/dist/v2.0.1/iojs-v2.0.1.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v2.0.1/SHASUMS256.txt
[0m[91mgyp http[0m[91m 200 https://iojs.org/dist/v2.0.1/SHASUMS256.txt
[0m[91mgyp[0m[91m info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info[0m[91m spawn args   '/root/.node-gyp/2.0.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/2.0.1',
gyp info[0m[91m spawn args   '-Druntime=iojs',
[0m[91mgyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp [0m[91minfo [0m[91mspawn args   '--generator-output',
gyp[0m[91m info spawn args   'build',
gyp [0m[91minfo[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp[0m[91m ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp[0m[91m ERR! stack[0m[91m     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1009:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v2.0.1
gyp ERR! pangyp -v v2.3.3
[0m[91mgyp ERR! [0m[91mnot ok 
[0m
 ---> 4df05f4908e2
Removing intermediate container 799920fb16ca
Step 5 : ENV NODE_ENV production
 ---> Running in db44ff1b429e
 ---> f3bc0968ccc6
Removing intermediate container db44ff1b429e
Step 6 : WORKDIR /usr/src/app
 ---> Running in c57eb0211cef
 ---> d63d9fb7120e
Removing intermediate container c57eb0211cef
Step 7 : CMD npm start
 ---> Running in f7a70d111402
 ---> 3db30031311b
Removing intermediate container f7a70d111402
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 0a31af4921c9
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie Release [148 kB]
Get:6 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (3144 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 7cb11d8567ea
Removing intermediate container 0a31af4921c9
Successfully built 7cb11d8567ea

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test115`

Contents of dockerfile `/root/docker-node/.~tmp.test115/Dockerfile`:

```
FROM nodesource/jessie:iojs-2.0.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-2.0.1-test1` from `/root/docker-node/.~tmp.test115`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-2.0.1
 ---> 7cb11d8567ea
Step 2 : ENV NODE_ENV test
 ---> Running in 41aab5abed02
 ---> 8fd276a9f7e3
Removing intermediate container 41aab5abed02
Step 3 : RUN node -v
 ---> Running in f074cba8332b
v2.0.1
 ---> c52348829cd8
Removing intermediate container f074cba8332b
Step 4 : RUN node -p "process.versions"
 ---> Running in 07d4284d16c6
{ http_parser: '2.5.0',
  node: '2.0.1',
  v8: '4.2.77.20',
  uv: '1.5.0',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '44',
  openssl: '1.0.2a' }
 ---> e0a568ead55d
Removing intermediate container 07d4284d16c6
Step 5 : RUN npm --version
 ---> Running in 8a1bb547e1ea
2.9.0
 ---> e2c4f3029056
Removing intermediate container 8a1bb547e1ea
Successfully built e2c4f3029056

```

# Tested image `nodesource/jessie:iojs-2.3.2`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in bafc9ec5d2fb
 ---> 38545d312744
Removing intermediate container bafc9ec5d2fb
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.3.2-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 399ef40d2959
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 14 5986k   14  879k    0     0  2181k      0  0:00:02 --:--:--  0:00:02 2177k[0m[91m100 5986k  100 5986k    0     0  6692k      0 --:--:-- --:--:-- --:--:-- 6688k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.3.2-1nodesource1~jessie1) ...
Setting up iojs (2.3.2-1nodesource1~jessie1) ...
 ---> 1efc7e7e32ed
Removing intermediate container 399ef40d2959
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 5fdcea9da628
[91mnpm[0m[91m [0m[91mWARN [0m[91mdeprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
[0m[91mgyp info using node@2.3.2 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v2.3.2/iojs-v2.3.2.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v2.3.2/iojs-v2.3.2.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp[0m[91m [0m[91mGET https://iojs.org/dist/v2.3.2/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp [0m[91m200 https://iojs.org/dist/v2.3.2/SHASUMS256.txt
[0m[91mgyp [0m[91minfo spawn python
[0m[91mgyp info [0m[91mspawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/2.3.2/common.gypi',
gyp[0m[91m info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
[0m[91mgyp[0m[91m info[0m[91m [0m[91mspawn args   '-Dnode_root_dir=/root/.node-gyp/2.3.2',
gyp info spawn args   '-Druntime=iojs',
gyp info[0m[91m [0m[91mspawn args   '-Dmodule_root_dir=/',
gyp[0m[91m [0m[91minfo[0m[91m spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp [0m[91minfo [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp [0m[91minfo[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m [0m[91mERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v2.3.2
gyp ERR! pangyp -v v2.3.3
[0m[91mgyp [0m[91mERR! not ok 
[0m
 ---> ae618590d39f
Removing intermediate container 5fdcea9da628
Step 5 : ENV NODE_ENV production
 ---> Running in 05e3a7f833b5
 ---> f05a81c251cd
Removing intermediate container 05e3a7f833b5
Step 6 : WORKDIR /usr/src/app
 ---> Running in 0c3757d698ba
 ---> 3a3d06a0ce24
Removing intermediate container 0c3757d698ba
Step 7 : CMD npm start
 ---> Running in 99155a9c8815
 ---> 9dacdb62481a
Removing intermediate container 99155a9c8815
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in e334daf30942
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (3179 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 95879f20350d
Removing intermediate container e334daf30942
Successfully built 95879f20350d

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test118`

Contents of dockerfile `/root/docker-node/.~tmp.test118/Dockerfile`:

```
FROM nodesource/jessie:iojs-2.3.2
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-2.3.2-test1` from `/root/docker-node/.~tmp.test118`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-2.3.2
 ---> 95879f20350d
Step 2 : ENV NODE_ENV test
 ---> Running in 9cb4af6bf5f8
 ---> 5d1b329d9e6a
Removing intermediate container 9cb4af6bf5f8
Step 3 : RUN node -v
 ---> Running in da468a488138
v2.3.2
 ---> 33292e427672
Removing intermediate container da468a488138
Step 4 : RUN node -p "process.versions"
 ---> Running in d003195578be
{ http_parser: '2.5.0',
  node: '2.3.2',
  v8: '4.2.77.20',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2c' }
 ---> 1df8fd9c4339
Removing intermediate container d003195578be
Step 5 : RUN npm --version
 ---> Running in e6b9719bcff2
2.11.3
 ---> 079d5049986e
Removing intermediate container e6b9719bcff2
Successfully built 079d5049986e

```

# Tested image `nodesource/jessie:iojs-2.3.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in e82677d1ff32
 ---> 1fc830798f75
Removing intermediate container e82677d1ff32
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.3.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 9e447c2b65b4
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5729k  100 5729k    0     0  7349k      0 --:--:-- --:--:-- --:--:-- 7354k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.3.0-1nodesource1~jessie1) ...
Setting up iojs (2.3.0-1nodesource1~jessie1) ...
 ---> 812c3618fbfd
Removing intermediate container 9e447c2b65b4
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in c4e30f47acdd
[91mnpm[0m[91m WARN[0m[91m [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo [0m[91musing pangyp@2.3.3
gyp info using[0m[91m node@2.3.0 | linux | x64
[0m[91mgyp http GET https://iojs.org/dist/v2.3.0/iojs-v2.3.0.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v2.3.0/iojs-v2.3.0.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v2.3.0/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v2.3.0/SHASUMS256.txt
[0m[91mgyp info spawn[0m[91m python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args[0m[91m   'binding.gyp',
[0m[91mgyp info spawn args   '-f',
gyp info spawn args   'make',
gyp [0m[91minfo [0m[91mspawn args[0m[91m   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args[0m[91m   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/2.3.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
[0m[91mgyp[0m[91m info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/2.3.0',
gyp [0m[91minfo[0m[91m spawn args[0m[91m   '-Druntime=iojs',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
[0m[91mgyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp[0m[91m info spawn args   '--generator-output',
gyp[0m[91m info spawn args   'build',
gyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR![0m[91m stack[0m[91m Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! [0m[91mstack[0m[91m     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! [0m[91mSystem Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
[0m[91mgyp ERR! node -v v2.3.0
gyp [0m[91mERR! pangyp -v[0m[91m v2.3.3
[0m[91mgyp ERR! [0m[91mnot ok 
[0m
 ---> c7d7f726724c
Removing intermediate container c4e30f47acdd
Step 5 : ENV NODE_ENV production
 ---> Running in 239ae8171a7b
 ---> 4d2e8cf467c7
Removing intermediate container 239ae8171a7b
Step 6 : WORKDIR /usr/src/app
 ---> Running in dc430de5a627
 ---> c5c9732c02c4
Removing intermediate container dc430de5a627
Step 7 : CMD npm start
 ---> Running in e7dd8178ffd2
 ---> 9dc10c34dffc
Removing intermediate container e7dd8178ffd2
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 27ff6ad63e31
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3289 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> cd0f1ad2efd2
Removing intermediate container 27ff6ad63e31
Successfully built cd0f1ad2efd2

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test116`

Contents of dockerfile `/root/docker-node/.~tmp.test116/Dockerfile`:

```
FROM nodesource/jessie:iojs-2.3.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-2.3.0-test1` from `/root/docker-node/.~tmp.test116`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-2.3.0
 ---> cd0f1ad2efd2
Step 2 : ENV NODE_ENV test
 ---> Running in 570b6cd8115d
 ---> 77cf91d64994
Removing intermediate container 570b6cd8115d
Step 3 : RUN node -v
 ---> Running in 587db3ed0a6e
v2.3.0
 ---> 39b2dc32f013
Removing intermediate container 587db3ed0a6e
Step 4 : RUN node -p "process.versions"
 ---> Running in cacb0cb5b739
{ http_parser: '2.5.0',
  node: '2.3.0',
  v8: '4.2.77.20',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2c' }
 ---> e5a6c4f35ab2
Removing intermediate container cacb0cb5b739
Step 5 : RUN npm --version
 ---> Running in 1a7f08a2b79e
2.11.1
 ---> e854ab07c3b8
Removing intermediate container 1a7f08a2b79e
Successfully built e854ab07c3b8

```

# Tested image `nodesource/jessie:iojs-1.6.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 8fceaf119e07
 ---> abaa30a3bac6
Removing intermediate container 8fceaf119e07
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.6.1-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 4294b96af6bc
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5136k  100 5136k    0     0  7557k      0 --:--:-- --:--:-- --:--:-- 7565k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.6.1-1nodesource1~jessie1) ...
Setting up iojs (1.6.1-1nodesource1~jessie1) ...
 ---> 5f8df591ae9e
Removing intermediate container 4294b96af6bc
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in adcc35fb36e3
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@1.6.1 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp GET https://iojs.org/dist/v1.6.1/iojs-v1.6.1.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v1.6.1/iojs-v1.6.1.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v1.6.1/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v1.6.1/SHASUMS256.txt
[0m[91mgyp info[0m[91m spawn python
[0m[91mgyp info[0m[91m spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args[0m[91m   '-f',
[0m[91mgyp info[0m[91m spawn args[0m[91m   'make',
[0m[91mgyp info spawn args   '-I',
gyp[0m[91m [0m[91minfo spawn args   '/build/config.gypi',
gyp info [0m[91mspawn args   '-I',
[0m[91mgyp[0m[91m [0m[91minfo spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.6.1/common.gypi',
gyp info[0m[91m spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
[0m[91mgyp [0m[91minfo[0m[91m spawn args   '-Dnode_root_dir=/root/.node-gyp/1.6.1',
[0m[91mgyp[0m[91m info[0m[91m spawn args   '-Druntime=iojs',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
[0m[91mgyp[0m[91m [0m[91minfo [0m[91mspawn args[0m[91m   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp[0m[91m [0m[91minfo spawn args[0m[91m   'build',
[0m[91mgyp[0m[91m [0m[91minfo [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error[0m[91m 
[0m[91mgyp [0m[91mERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp[0m[91m ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.6.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> bbef2adf8ec1
Removing intermediate container adcc35fb36e3
Step 5 : ENV NODE_ENV production
 ---> Running in 2a4dfee39a4f
 ---> 96ea2cd3d40c
Removing intermediate container 2a4dfee39a4f
Step 6 : WORKDIR /usr/src/app
 ---> Running in 710c4e2e2f1d
 ---> bc32878e5ecf
Removing intermediate container 710c4e2e2f1d
Step 7 : CMD npm start
 ---> Running in 792d01717e6a
 ---> 5c7775320222
Removing intermediate container 792d01717e6a
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 3aa1d11e9d8e
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 2s (3235 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 3b39bdbdd884
Removing intermediate container 3aa1d11e9d8e
Successfully built 3b39bdbdd884

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test109`

Contents of dockerfile `/root/docker-node/.~tmp.test109/Dockerfile`:

```
FROM nodesource/jessie:iojs-1.6.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-1.6.1-test1` from `/root/docker-node/.~tmp.test109`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-1.6.1
 ---> 3b39bdbdd884
Step 2 : ENV NODE_ENV test
 ---> Running in 7db4e2e26a42
 ---> 47a4ecf1acf6
Removing intermediate container 7db4e2e26a42
Step 3 : RUN node -v
 ---> Running in 2e4c9e6992b5
v1.6.1
 ---> 2edbb4292da6
Removing intermediate container 2e4c9e6992b5
Step 4 : RUN node -p "process.versions"
 ---> Running in b5e4ce6a9fc0
{ http_parser: '2.3.0',
  node: '1.6.1',
  v8: '4.1.0.21',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1m' }
 ---> 384b4c1e3a42
Removing intermediate container b5e4ce6a9fc0
Step 5 : RUN npm --version
 ---> Running in c697962caf37
2.7.1
 ---> 88b1c5bd8e22
Removing intermediate container c697962caf37
Successfully built 88b1c5bd8e22

```

# Tested image `nodesource/sid:0.10.42`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 7060a13e6dc9
 ---> ea3587e87993
Removing intermediate container 7060a13e6dc9
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.42-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in cfcb7137e9b8
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Up[0m[91mload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 4263k  100 4263k    0     0  5624k      0 --:--:-- --:--:-- --:--:-- 5631k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.42-1nodesource1~sid1) ...
Setting up nodejs (0.10.42-1nodesource1~sid1) ...
 ---> 1b682d7c882d
Removing intermediate container cfcb7137e9b8
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 2c250f5918d4
[91mnpm[0m[91m WARN [0m[91mdeprecated[0m[91m This version of npm lacks support for important features,
npm WARN deprecated such as scoped packages, offered by the primary npm
[0m[91mnpm WARN deprecated registry. Consider upgrading to at least npm@2, if not the
npm WARN deprecated latest stable version. To upgrade to npm@2, run:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest-2
npm [0m[91mWARN deprecated 
[0m[91mnpm WARN deprecated To upgrade to the latest stable version, run:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest
[0m[91mnpm[0m[91m WARN deprecated 
npm WARN deprecated (Depending on how Node.js was installed on your system, you
npm WARN deprecated may need to prefix the preceding commands with `sudo`, or if
npm WARN deprecated on Windows, run them from an Administrator prompt.)
[0m[91mnpm WARN deprecated 
[0m[91mnpm WARN deprecated If you're running the version of npm bundled with
npm WARN deprecated Node.js 0.10 LTS, be aware that the next version of 0.10 LTS
npm WARN deprecated will be bundled with a version of npm@2, which has some small
npm[0m[91m [0m[91mWARN [0m[91mdeprecated backwards-incompatible changes made to `npm run-script` and
npm WARN[0m[91m deprecated semver behavior.
[0m[91mnpm[0m[91m [0m[91mWARN[0m[91m deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (block-stream@0.0.8, inherits@2.0.1)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, hawk@1.1.1, form-data@0.2.0)
[91mnpm[0m[91m [0m[91mWARN[0m[91m [0m[91mdeprecated This version of npm lacks support for important features,
npm WARN [0m[91mdeprecated[0m[91m such as scoped packages, offered by the primary npm
[0m[91mnpm WARN deprecated registry. Consider upgrading to at least npm@2, if not the
[0m[91mnpm WARN deprecated[0m[91m latest stable version. To upgrade to npm@2, run:
npm[0m[91m [0m[91mWARN [0m[91mdeprecated[0m[91m 
npm WARN deprecated   npm -g install npm@latest-2
npm WARN [0m[91mdeprecated 
npm [0m[91mWARN deprecated To upgrade to the latest stable version, run:
npm WARN[0m[91m deprecated 
[0m[91mnpm [0m[91mWARN deprecated   npm -g install npm@latest
[0m[91mnpm[0m[91m WARN deprecated 
npm WARN deprecated (Depending on how Node.js was installed on your system, you
npm WARN deprecated may need to prefix the preceding commands with `sudo`, or if
npm WARN deprecated on Windows, run them from an Administrator prompt.)
npm WARN[0m[91m deprecated 
[0m[91mnpm WARN deprecated If you're running the version of npm bundled with
npm WARN [0m[91mdeprecated Node.js 0.10 LTS, be aware that the next version of 0.10 LTS
npm [0m[91mWARN[0m[91m deprecated will be bundled with a version of npm@2, which has some small
npm WARN [0m[91mdeprecated backwards-incompatible changes made to `npm run-script` and
[0m[91mnpm WARN deprecated semver behavior.
[0m[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info [0m[91musing pangyp@2.3.3
[0m[91mgyp info using node@0.10.42 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.42/node-v0.10.42.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.42/node-v0.10.42.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.10.42/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.42/SHASUMS256.txt
[0m[91mgyp[0m[91m [0m[91minfo spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args[0m[91m   'binding.gyp',
[0m[91mgyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info [0m[91mspawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.42/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.42',
gyp info[0m[91m spawn args[0m[91m   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
[0m[91mgyp [0m[91mERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! [0m[91mstack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! [0m[91mcommand "node" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp ERR! node -v v0.10.42
gyp ERR! pangyp -v v2.3.3
[0m[91mgyp [0m[91mERR![0m[91m [0m[91mnot ok 
[0m
 ---> 2177c52c2965
Removing intermediate container 2c250f5918d4
Step 5 : ENV NODE_ENV production
 ---> Running in c5d2f55835f8
 ---> a28f3620c252
Removing intermediate container c5d2f55835f8
Step 6 : WORKDIR /usr/src/app
 ---> Running in 4a04dfce151c
 ---> 50f5f58afd3e
Removing intermediate container 4a04dfce151c
Step 7 : CMD npm start
 ---> Running in 3dd181057b24
 ---> 7e010abe9dba
Removing intermediate container 3dd181057b24
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 404ef1c64a8c
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (3978 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.kernel.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:3 http://mirrors.kernel.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:10 http://mirror.picosecond.org/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:4 http://mirrors.kernel.org/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:7 http://mirrors.kernel.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.kernel.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (3421 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> a6e4d6da56b3
Removing intermediate container 404ef1c64a8c
Successfully built a6e4d6da56b3

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test122`

Contents of dockerfile `/root/docker-node/.~tmp.test122/Dockerfile`:

```
FROM nodesource/sid:0.10.42
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.10.42-test1` from `/root/docker-node/.~tmp.test122`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.10.42
 ---> a6e4d6da56b3
Step 2 : ENV NODE_ENV test
 ---> Running in 655c50843793
 ---> 0d29cf719341
Removing intermediate container 655c50843793
Step 3 : RUN node -v
 ---> Running in 08ebcb96b942
v0.10.42
 ---> f8b0e933ec2c
Removing intermediate container 08ebcb96b942
Step 4 : RUN node -p "process.versions"
 ---> Running in baca538ff97d
{ http_parser: '1.1',
  node: '0.10.42',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1r' }
 ---> 9510814b98ca
Removing intermediate container baca538ff97d
Step 5 : RUN npm --version
 ---> Running in b3edaf104b9d
1.4.29
 ---> bc1131669794
Removing intermediate container b3edaf104b9d
Successfully built bc1131669794

```

# Tested image `nodesource/sid:5.7.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in faba9d242603
 ---> d732250e9e23
Removing intermediate container faba9d242603
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.7.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in e749c3407cf0
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0 8788k    0 16086    0     0  4425[0m[91m5      0  0:03:23 --:--:--  0:03:23 44192[0m[91m100 8788k  100 8788k    0     0  7944k      0  0:00:01  0:00:01 --:--:-- 7945k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.7.0-1nodesource1~sid1) ...
Setting up nodejs (5.7.0-1nodesource1~sid1) ...
 ---> 7f6f11583f64
Removing intermediate container e749c3407cf0
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 5f8a7746d06e
[91mnpm [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@5.7.0 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v5.7.0/node-v5.7.0.tar.gz
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v5.7.0/node-v5.7.0.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v5.7.0/SHASUMS256.txt
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v5.7.0/SHASUMS256.txt
[0m[91mgyp info [0m[91mspawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp[0m[91m info [0m[91mspawn args   '-f',
[0m[91mgyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args[0m[91m   '/build/config.gypi',
[0m[91mgyp[0m[91m info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp [0m[91minfo [0m[91mspawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.7.0/common.gypi',
[0m[91mgyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.7.0',
gyp info spawn args   '-Druntime=node',
[0m[91mgyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
[0m[91mgyp info[0m[91m spawn args   '--no-parallel',
[0m[91mgyp info [0m[91mspawn args[0m[91m   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp [0m[91minfo[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
gyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:100:13)
gyp ERR! stack     at ChildProcess.emit (events.js:185:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.7.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 795e653ceb6f
Removing intermediate container 5f8a7746d06e
Step 5 : ENV NODE_ENV production
 ---> Running in efc9c3bd9258
 ---> 3ac5b9f37630
Removing intermediate container efc9c3bd9258
Step 6 : WORKDIR /usr/src/app
 ---> Running in ace322ca10b1
 ---> 8107acbac19f
Removing intermediate container ace322ca10b1
Step 7 : CMD npm start
 ---> Running in 4808c93c795c
 ---> 380820118d2f
Removing intermediate container 4808c93c795c
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in a99934a527c5
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3446 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (6141 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19648 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19648 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19648 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19648 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19648 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19648 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19648 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19648 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19648 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19648 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19648 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19648 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19648 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 74239ad19ac0
Removing intermediate container a99934a527c5
Successfully built 74239ad19ac0

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test121`

Contents of dockerfile `/root/docker-node/.~tmp.test121/Dockerfile`:

```
FROM nodesource/sid:5.7.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:5.7.0-test1` from `/root/docker-node/.~tmp.test121`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:5.7.0
 ---> 74239ad19ac0
Step 2 : ENV NODE_ENV test
 ---> Running in 6ff066e1f33c
 ---> bea81f8aa63c
Removing intermediate container 6ff066e1f33c
Step 3 : RUN node -v
 ---> Running in 9ffed7a6faf4
v5.7.0
 ---> aba33f609f19
Removing intermediate container 9ffed7a6faf4
Step 4 : RUN node -p "process.versions"
 ---> Running in c33c26005de1
{ http_parser: '2.6.2',
  node: '5.7.0',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2f' }
 ---> a45830a9e486
Removing intermediate container c33c26005de1
Step 5 : RUN npm --version
 ---> Running in 353bedc40047
3.6.0
 ---> 38eddc10d042
Removing intermediate container 353bedc40047
Successfully built 38eddc10d042

```

# Tested image `nodesource/sid:iojs-2.0.2`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 634b99dbcac8
 ---> f041b4ef67a6
Removing intermediate container 634b99dbcac8
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.0.2-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 075621a440bc
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5608k  100 5608k    0     0  6284k      0 --:--:-- --:--:-- --:--:-- 6280k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.0.2-1nodesource1~sid1) ...
Setting up iojs (2.0.2-1nodesource1~sid1) ...
 ---> 8d542cbdb0df
Removing intermediate container 075621a440bc
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 4cb3664b4332
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info[0m[91m using pangyp@2.3.3
gyp info using node@2.0.2 | linux | x64
[0m[91mgyp[0m[91m http [0m[91mGET https://iojs.org/dist/v2.0.2/iojs-v2.0.2.tar.gz
[0m[91mgyp[0m[91m http 200 https://iojs.org/dist/v2.0.2/iojs-v2.0.2.tar.gz
[0m[91mgyp [0m[91mhttp GET https://iojs.org/dist/v2.0.2/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v2.0.2/SHASUMS256.txt
[0m[91mgyp[0m[91m info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/2.0.2/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/2.0.2',
gyp info spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m ERR! [0m[91mconfigure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR![0m[91m stack[0m[91m     at Process.ChildProcess._handle.onexit (child_process.js:1009:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v2.0.2
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 3726e91f81b6
Removing intermediate container 4cb3664b4332
Step 5 : ENV NODE_ENV production
 ---> Running in 5b495b7ae53e
 ---> a51b7542d1f9
Removing intermediate container 5b495b7ae53e
Step 6 : WORKDIR /usr/src/app
 ---> Running in b580fcbf7ff4
 ---> 13a3cf3329e4
Removing intermediate container b580fcbf7ff4
Step 7 : CMD npm start
 ---> Running in 218716197c6c
 ---> 9412d8792ab1
Removing intermediate container 218716197c6c
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 35bfefee1c15
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4279 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2334 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> e8471ea244f9
Removing intermediate container 35bfefee1c15
Successfully built e8471ea244f9

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test174`

Contents of dockerfile `/root/docker-node/.~tmp.test174/Dockerfile`:

```
FROM nodesource/sid:iojs-2.0.2
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-2.0.2-test1` from `/root/docker-node/.~tmp.test174`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-2.0.2
 ---> e8471ea244f9
Step 2 : ENV NODE_ENV test
 ---> Running in c675c3742673
 ---> bf11b14e313a
Removing intermediate container c675c3742673
Step 3 : RUN node -v
 ---> Running in ec66b8d2117f
v2.0.2
 ---> cce2d3a0e3b7
Removing intermediate container ec66b8d2117f
Step 4 : RUN node -p "process.versions"
 ---> Running in 2f59aa15e1d8
{ http_parser: '2.5.0',
  node: '2.0.2',
  v8: '4.2.77.20',
  uv: '1.5.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2a' }
 ---> 7e6f716f0795
Error removing intermediate container 2f59aa15e1d8: rmdriverfs: Driver aufs failed to remove root filesystem 2f59aa15e1d8272f6ae038c4c08a65135f001efb3a389113f37786ac6216c068: rename /var/lib/docker/aufs/mnt/dd68fec5af49164189112729620df0d3489c3f9334b37c944d22ecd5bd710b99 /var/lib/docker/aufs/mnt/dd68fec5af49164189112729620df0d3489c3f9334b37c944d22ecd5bd710b99-removing: device or resource busy
Step 5 : RUN npm --version
 ---> Running in d6988f62f2c6
2.9.0
 ---> 3b9147e51ee9
Removing intermediate container d6988f62f2c6
Error removing intermediate container 2f59aa15e1d8: nosuchcontainer: No such container: 2f59aa15e1d8272f6ae038c4c08a65135f001efb3a389113f37786ac6216c068
Successfully built 3b9147e51ee9

```

# Tested image `nodesource/sid:0.10.31`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 065382bb99b8
 ---> 2668fe96394f
Removing intermediate container 065382bb99b8
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.31-1chl1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 47faf8184358
[91m  % Total    % Received % Xferd  Average Speed   Time    Time[0m[91m     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 3993k  100 3993k    0     0  4661k      0 --:--:-- --:--:-- --:--:-- 4665k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.31-1chl1~sid1) ...
Setting up nodejs (0.10.31-1chl1~sid1) ...
 ---> 70199832a39e
Removing intermediate container 47faf8184358
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in bfa13841892e
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo[0m[91m [0m[91mit worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
gyp info using node@0.10.31 | linux | x64
[0m[91mgyp [0m[91mhttp GET http://nodejs.org/dist/v0.10.31/node-v0.10.31.tar.gz
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v0.10.31/node-v0.10.31.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.10.31/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200[0m[91m http://nodejs.org/dist/v0.10.31/SHASUMS256.txt
[0m[91mgyp [0m[91minfo spawn[0m[91m python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args[0m[91m   'binding.gyp',
[0m[91mgyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info[0m[91m spawn args[0m[91m   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args[0m[91m   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.31/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.31',
gyp info[0m[91m spawn args[0m[91m   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
[0m
[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:810:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.31
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m ---> 4aa9392f86a9
Removing intermediate container bfa13841892e
Step 5 : ENV NODE_ENV production
 ---> Running in fd73cbe41411
 ---> c83f0d60df01
Removing intermediate container fd73cbe41411
Step 6 : WORKDIR /usr/src/app
 ---> Running in afaa78ed3f13
 ---> 5532c21ed416
Removing intermediate container afaa78ed3f13
Step 7 : CMD npm start
 ---> Running in 803890041ec5
 ---> 9f82dfcf5dba
Removing intermediate container 803890041ec5
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 9b23d63e5c30
Get:1 http://mirrors.kernel.org/debian sid InRelease [287 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (3850 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (5693 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17789 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17789 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17789 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17789 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17789 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17789 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17789 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17789 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17789 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17789 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17789 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17789 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17789 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> afa58c8511c1
Removing intermediate container 9b23d63e5c30
Successfully built afa58c8511c1

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test135`

Contents of dockerfile `/root/docker-node/.~tmp.test135/Dockerfile`:

```
FROM nodesource/sid:0.10.31
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.10.31-test1` from `/root/docker-node/.~tmp.test135`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.10.31
 ---> afa58c8511c1
Step 2 : ENV NODE_ENV test
 ---> Running in de9dd223042e
 ---> f877908abd6e
Removing intermediate container de9dd223042e
Step 3 : RUN node -v
 ---> Running in 70c3252f6c94
v0.10.31
 ---> 6d341b4b62d0
Removing intermediate container 70c3252f6c94
Step 4 : RUN node -p "process.versions"
 ---> Running in 9669eeb3615f
{ http_parser: '1.0',
  node: '0.10.31',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.28',
  zlib: '1.2.3',
  modules: '11',
  openssl: '1.0.1i' }
 ---> 982215171c25
Removing intermediate container 9669eeb3615f
Step 5 : RUN npm --version
 ---> Running in 6a1f8f3da45a
1.4.23
 ---> f321545ffc21
Removing intermediate container 6a1f8f3da45a
Successfully built f321545ffc21

```

# Tested image `nodesource/sid:0.10.32`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 0149ff4ea831
 ---> 0faf6ec9d96b
Removing intermediate container 0149ff4ea831
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.32-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in da40e4399719
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0 4041k    0 32470    0     0  99107      0  0:00:41 --:--:--  0:00:41 98993[0m[91m100 4041k  100 4041k    0     0  5232k      0 --:--:-- --:--:-- --:--:-- 5227k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.32-1nodesource1~sid1) ...
Setting up nodejs (0.10.32-1nodesource1~sid1) ...
 ---> 47f4b657f2d9
Removing intermediate container da40e4399719
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 1a789feb8f74
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.10.32 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.32/node-v0.10.32.tar.gz
[0m[91mgyp http [0m[91m200 http://nodejs.org/dist/v0.10.32/node-v0.10.32.tar.gz
[0m[91mgyp[0m[91m http [0m[91mGET http://nodejs.org/dist/v0.10.32/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.32/SHASUMS256.txt
[0m[91mgyp[0m[91m info spawn python
[0m[91mgyp[0m[91m [0m[91minfo spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info [0m[91mspawn args   '-f',
[0m[91mgyp[0m[91m info spawn args   'make',
gyp info spawn args   '-I',
gyp[0m[91m info [0m[91mspawn args[0m[91m   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp[0m[91m info[0m[91m spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.32/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args[0m[91m   '-Dvisibility=default',
gyp[0m[91m [0m[91minfo spawn args[0m[91m   '-Dnode_root_dir=/root/.node-gyp/0.10.32',
gyp info[0m[91m spawn args[0m[91m   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
[0m[91mgyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args[0m[91m   'build',
[0m[91mgyp[0m[91m [0m[91minfo [0m[91mspawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR![0m[91m configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR![0m[91m [0m[91mstack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:810:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.32
gyp ERR! [0m[91mpangyp -v v2.3.3
gyp [0m[91mERR! not ok[0m[91m 
[0m
 ---> 42e44bf6deec
Removing intermediate container 1a789feb8f74
Step 5 : ENV NODE_ENV production
 ---> Running in bdecf2c844bd
 ---> 585ecf93227b
Removing intermediate container bdecf2c844bd
Step 6 : WORKDIR /usr/src/app
 ---> Running in 03f068dca76c
 ---> b41cfd6fb75d
Removing intermediate container 03f068dca76c
Step 7 : CMD npm start
 ---> Running in 13ab2f0a5c66
 ---> b3ecbc391d3c
Removing intermediate container 13ab2f0a5c66
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 8d84a0ef9807
Get:1 http://mirrors.kernel.org/debian sid InRelease [287 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3385 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.kernel.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.kernel.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:7 http://mirror.picosecond.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:4 http://mirrors.kernel.org/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.kernel.org/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:10 http://mirrors.kernel.org/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.kernel.org/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (3259 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17878 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17878 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17878 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17878 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17878 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17878 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17878 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17878 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17878 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17878 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17878 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17878 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17878 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 20bcd54a1688
Removing intermediate container 8d84a0ef9807
Successfully built 20bcd54a1688

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test136`

Contents of dockerfile `/root/docker-node/.~tmp.test136/Dockerfile`:

```
FROM nodesource/sid:0.10.32
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.10.32-test1` from `/root/docker-node/.~tmp.test136`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.10.32
 ---> 20bcd54a1688
Step 2 : ENV NODE_ENV test
 ---> Running in 6cffcfbb26dd
 ---> 734f103433e0
Removing intermediate container 6cffcfbb26dd
Step 3 : RUN node -v
 ---> Running in 806b5ef097e5
v0.10.32
 ---> 6330d2730694
Removing intermediate container 806b5ef097e5
Step 4 : RUN node -p "process.versions"
 ---> Running in 2befcd6c48d1
{ http_parser: '1.0',
  node: '0.10.32',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.28',
  zlib: '1.2.3',
  modules: '11',
  openssl: '1.0.1i' }
 ---> ed2858c10590
Removing intermediate container 2befcd6c48d1
Step 5 : RUN npm --version
 ---> Running in be1a21bbf2bb
1.4.28
 ---> 353113fc0595
Removing intermediate container be1a21bbf2bb
Successfully built 353113fc0595

```

# Tested image `nodesource/sid:0.10.35`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in e52cc1b56493
 ---> b29ab4f25efb
Removing intermediate container e52cc1b56493
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.35-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 4e6289458b41
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Spe[0m[91med
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 13 3959k   13  543k    0     0  1021k      0  0:00:03 --:--:--  0:00:03 1020k[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.35-1nodesource1~sid1) ...
[91m100 3959k  100 3959k    0     0  4795k      0 --:--:-- --:--:-- --:--:-- 4793k
[0mSetting up nodejs (0.10.35-1nodesource1~sid1) ...
 ---> 85b8ba714ef3
Removing intermediate container 4e6289458b41
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 80ac74a00e3e
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ fstream@1.0.8 (graceful-fs@4.1.3, inherits@2.0.1)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo [0m[91musing pangyp@2.3.3
gyp info using node@0.10.35 | linux | x64
[0m[91mgyp [0m[91mhttp GET http://nodejs.org/dist/v0.10.35/node-v0.10.35.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.35/node-v0.10.35.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp [0m[91mGET http://nodejs.org/dist/v0.10.35/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.35/SHASUMS256.txt
[0m[91mgyp[0m[91m info[0m[91m spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
[0m[91mgyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.35/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.35',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.35
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> e0787bae4a4b
Removing intermediate container 80ac74a00e3e
Step 5 : ENV NODE_ENV production
 ---> Running in 1eb52719cc1f
 ---> b012669db749
Removing intermediate container 1eb52719cc1f
Step 6 : WORKDIR /usr/src/app
 ---> Running in 472aeab4b26b
 ---> 9961a4f12133
Removing intermediate container 472aeab4b26b
Step 7 : CMD npm start
 ---> Running in 96f8cee89db5
 ---> 07fa55b6d069
Removing intermediate container 96f8cee89db5
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in cb4841398ac7
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3035 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2902 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 2aaa171ff2cf
Removing intermediate container cb4841398ac7
Successfully built 2aaa171ff2cf

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test139`

Contents of dockerfile `/root/docker-node/.~tmp.test139/Dockerfile`:

```
FROM nodesource/sid:0.10.35
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.10.35-test1` from `/root/docker-node/.~tmp.test139`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.10.35
 ---> 2aaa171ff2cf
Step 2 : ENV NODE_ENV test
 ---> Running in 1ee9ade1d9cd
 ---> f29831bfad10
Removing intermediate container 1ee9ade1d9cd
Step 3 : RUN node -v
 ---> Running in dae5dd34d170
v0.10.35
 ---> a985e7df4d19
Removing intermediate container dae5dd34d170
Step 4 : RUN node -p "process.versions"
 ---> Running in 62aa91be6abc
{ http_parser: '1.0',
  node: '0.10.35',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.30',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1j' }
 ---> bebb58806097
Removing intermediate container 62aa91be6abc
Step 5 : RUN npm --version
 ---> Running in 78b73d11fc1f
1.4.28
 ---> 4356e798836c
Removing intermediate container 78b73d11fc1f
Successfully built 4356e798836c

```

# Tested image `nodesource/sid:4.2.4`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in a83bfffec549
 ---> bf86328fe5c8
Removing intermediate container a83bfffec549
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.4-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 84801744f818
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0 8322k    0 32470    0     0  96078      0  0:01:28 --:--:--  0:01:28 96065[0m[91m100 8322k  100 8322k    0     0  7111k      0  0:00:01  0:00:01 --:--:-- 7112k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.2.4-1nodesource1~sid1) ...
Setting up nodejs (4.2.4-1nodesource1~sid1) ...
 ---> 81903802bbf1
Removing intermediate container 84801744f818
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in d51d74b97620
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, oauth-sign@0.5.0, tunnel-agent@0.4.2, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo [0m[91musing pangyp@2.3.3
gyp info using node@4.2.4 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp GET http://nodejs.org/dist/v4.2.4/node-v4.2.4.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.4/node-v4.2.4.tar.gz
[0m[91mgyp[0m[91m http GET[0m[91m http://nodejs.org/dist/v4.2.4/SHASUMS256.txt
[0m[91mgyp http [0m[91m200 http://nodejs.org/dist/v4.2.4/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp[0m[91m info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp [0m[91minfo spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info[0m[91m spawn args   '/build/config.gypi',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.4/common.gypi',
[0m[91mgyp[0m[91m info[0m[91m spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.4',
gyp info[0m[91m spawn args[0m[91m   '-Druntime=node',
gyp[0m[91m [0m[91minfo[0m[91m spawn args   '-Dmodule_root_dir=/',
[0m[91mgyp [0m[91minfo spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args[0m[91m   'build',
[0m[91mgyp[0m[91m info[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR![0m[91m configure error[0m[91m 
[0m[91mgyp ERR! stack[0m[91m Error: `gyp` failed with exit code: 1
gyp[0m[91m ERR![0m[91m stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
[0m[91mgyp[0m[91m ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.2.4
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 59f33859d651
Removing intermediate container d51d74b97620
Step 5 : ENV NODE_ENV production
 ---> Running in a37e6a5db60c
 ---> 749de1389f78
Removing intermediate container a37e6a5db60c
Step 6 : WORKDIR /usr/src/app
 ---> Running in 23c3bf94bc81
 ---> 6aaa58fdd88d
Removing intermediate container 23c3bf94bc81
Step 7 : CMD npm start
 ---> Running in cf969cea36e0
 ---> e3e165349b92
Removing intermediate container cf969cea36e0
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in e7f8f6f77448
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (2972 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirror.picosecond.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:4 http://mirror.picosecond.org/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:3 http://mirrors.kernel.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:6 http://mirrors.kernel.org/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.kernel.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:10 http://mirrors.kernel.org/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.kernel.org/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:5 http://mirror.picosecond.org/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
Get:12 http://mirror.picosecond.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2792 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19013 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19013 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19013 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19013 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19013 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19013 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19013 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19013 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19013 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19013 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19013 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19013 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19013 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 8416717411bc
Removing intermediate container e7f8f6f77448
Successfully built 8416717411bc

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test161`

Contents of dockerfile `/root/docker-node/.~tmp.test161/Dockerfile`:

```
FROM nodesource/sid:4.2.4
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:4.2.4-test1` from `/root/docker-node/.~tmp.test161`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:4.2.4
 ---> 8416717411bc
Step 2 : ENV NODE_ENV test
 ---> Running in 634a19afdf16
 ---> 4504834ea6c8
Removing intermediate container 634a19afdf16
Step 3 : RUN node -v
 ---> Running in c68ba516efc7
v4.2.4
 ---> dcb93705fd91
Removing intermediate container c68ba516efc7
Step 4 : RUN node -p "process.versions"
 ---> Running in e731b16a03fa
{ http_parser: '2.5.0',
  node: '4.2.4',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2e' }
 ---> 93754303b32f
Removing intermediate container e731b16a03fa
Step 5 : RUN npm --version
 ---> Running in c5cdd6d5fe6d
2.14.12
 ---> 31cab036d33a
Removing intermediate container c5cdd6d5fe6d
Successfully built 31cab036d33a

```

# Tested image `nodesource/sid:0.10.33`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 3678a8db6ede
 ---> 3d2dd419fb66
Removing intermediate container 3678a8db6ede
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.33-2nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in b92ff43e9eb0
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0 4048k    0 32470   [0m[91m 0     0  90828      0  0:00:45 --:--:--  0:00:45 90698[0m[91m100 4048k  100 4048k    0     0  5412k      0 --:--:-- --:--:-- --:--:-- 5412k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.33-2nodesource1~sid1) ...
Setting up nodejs (0.10.33-2nodesource1~sid1) ...
 ---> c57f1854c5b9
Removing intermediate container b92ff43e9eb0
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 2c558199baa8
[91mnpm[0m[91m WARN deprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.10.33 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.10.33/node-v0.10.33.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.33/node-v0.10.33.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp [0m[91mGET http://nodejs.org/dist/v0.10.33/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.33/SHASUMS256.txt
[0m[91mgyp info[0m[91m spawn python
[0m[91mgyp info [0m[91mspawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info[0m[91m spawn args[0m[91m   '-I',
gyp[0m[91m info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info[0m[91m spawn args   '-I',
[0m[91mgyp info spawn args   '/root/.node-gyp/0.10.33/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
[0m[91mgyp [0m[91minfo spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.33',
gyp info[0m[91m spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp[0m[91m ERR! stack[0m[91m Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:810:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.33
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 9c89a6bd0de5
Removing intermediate container 2c558199baa8
Step 5 : ENV NODE_ENV production
 ---> Running in 86cfe9b8cbc1
 ---> 618f17125046
Removing intermediate container 86cfe9b8cbc1
Step 6 : WORKDIR /usr/src/app
 ---> Running in 23a0688cf654
 ---> 7a14024382bf
Removing intermediate container 23a0688cf654
Step 7 : CMD npm start
 ---> Running in 7eb069e2936b
 ---> 96447e99f798
Removing intermediate container 7eb069e2936b
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 8ea92c8896ea
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4711 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (5429 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 60d1656621fb
Removing intermediate container 8ea92c8896ea
Successfully built 60d1656621fb

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test137`

Contents of dockerfile `/root/docker-node/.~tmp.test137/Dockerfile`:

```
FROM nodesource/sid:0.10.33
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.10.33-test1` from `/root/docker-node/.~tmp.test137`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.10.33
 ---> 60d1656621fb
Step 2 : ENV NODE_ENV test
 ---> Running in 715bca1841c2
 ---> 1a5f360590d2
Removing intermediate container 715bca1841c2
Step 3 : RUN node -v
 ---> Running in c0af73a7684d
v0.10.33
 ---> abe70a9fb3e7
Removing intermediate container c0af73a7684d
Step 4 : RUN node -p "process.versions"
 ---> Running in 2f5ee38f5b68
{ http_parser: '1.0',
  node: '0.10.33',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.29',
  zlib: '1.2.3',
  modules: '11',
  openssl: '1.0.1j' }
 ---> 26baf421fd7a
Removing intermediate container 2f5ee38f5b68
Step 5 : RUN npm --version
 ---> Running in 360f66167a65
1.4.28
 ---> 591d1b0a0982
Removing intermediate container 360f66167a65
Successfully built 591d1b0a0982

```

# Tested image `nodesource/sid:4.0.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 02357f927e19
 ---> dae45af957d5
Removing intermediate container 02357f927e19
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.0.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in c3b7da0fefc7
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 90 6429k   90 5807k    0     0  6473k      0 --:--:-- --:--:-- --:--:-- 6467k[0m[91m100 6429k  100 6429k    0     0  6818k      0 --:--:-- --:--:-- --:--:-- 6818k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.0.0-1nodesource1~sid1) ...
Setting up nodejs (4.0.0-1nodesource1~sid1) ...
 ---> f02ec4f7ec5c
Removing intermediate container c3b7da0fefc7
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in f9b2bec794d1
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
[0m[91mgyp info using node@4.0.0 | linux | x64
[0m[91mgyp[0m[91m http [0m[91mGET http://nodejs.org/dist/v4.0.0/node-v4.0.0.tar.gz
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v4.0.0/node-v4.0.0.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v4.0.0/SHASUMS256.txt
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v4.0.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.0.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.0.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info[0m[91m [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
[0m[91mgyp [0m[91mERR![0m[91m stack[0m[91m Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp [0m[91mERR! [0m[91mstack     at emitTwo (events.js:87:13)
[0m[91mgyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.0.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> fdf985e9da64
Removing intermediate container f9b2bec794d1
Step 5 : ENV NODE_ENV production
 ---> Running in 413dd85477e6
 ---> e6108639583b
Removing intermediate container 413dd85477e6
Step 6 : WORKDIR /usr/src/app
 ---> Running in cadbd011c71e
 ---> 20834e4d6e19
Removing intermediate container cadbd011c71e
Step 7 : CMD npm start
 ---> Running in 145bc05b59cd
 ---> eb20051e96b1
Removing intermediate container 145bc05b59cd
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 87fe298e3975
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (5487 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (2926 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18735 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18735 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18735 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18735 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18735 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18735 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18735 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18735 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18735 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18735 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18735 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18735 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18735 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> d0ac598a740a
Removing intermediate container 87fe298e3975
Successfully built d0ac598a740a

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test124`

Contents of dockerfile `/root/docker-node/.~tmp.test124/Dockerfile`:

```
FROM nodesource/sid:4.0.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:4.0.0-test1` from `/root/docker-node/.~tmp.test124`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:4.0.0
 ---> d0ac598a740a
Step 2 : ENV NODE_ENV test
 ---> Running in d2a0268a93b1
 ---> 8ff2689b2f3f
Removing intermediate container d2a0268a93b1
Step 3 : RUN node -v
 ---> Running in afb355cab04f
v4.0.0
 ---> b993223d56da
Removing intermediate container afb355cab04f
Step 4 : RUN node -p "process.versions"
 ---> Running in 3d39e87a14a7
{ http_parser: '2.5.0',
  node: '4.0.0',
  v8: '4.5.103.30',
  uv: '1.7.3',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '46',
  openssl: '1.0.2d' }
 ---> c120490f298f
Removing intermediate container 3d39e87a14a7
Step 5 : RUN npm --version
 ---> Running in 0d85bf3eacaf
2.14.2
 ---> 6b090fe8047f
Removing intermediate container 0d85bf3eacaf
Successfully built 6b090fe8047f

```

# Tested image `nodesource/jessie:iojs-1.5.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in c1f90ed975f5
 ---> ba23e61ae46c
Removing intermediate container c1f90ed975f5
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.5.0-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 22597dd31cb4
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5104k  100 510[0m[91m4k    0     0  7315k      0 --:--:-- --:--:-- --:--:-- 7312k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.5.0-1nodesource1~jessie1) ...
Setting up iojs (1.5.0-1nodesource1~jessie1) ...
 ---> 601731d9bb2d
Removing intermediate container 22597dd31cb4
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 0259f18c7527
[91mnpm WARN deprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, hawk@1.1.1, http-signature@0.10.1, form-data@0.2.0)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@1.5.0 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v1.5.0/iojs-v1.5.0.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v1.5.0/iojs-v1.5.0.tar.gz
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v1.5.0/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v1.5.0/SHASUMS256.txt
[0m[91mgyp info [0m[91mspawn python
[0m[91mgyp info spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp[0m[91m info [0m[91mspawn args[0m[91m   'binding.gyp',
[0m[91mgyp info spawn args   '-f',
gyp [0m[91minfo spawn args   'make',
gyp info[0m[91m spawn args[0m[91m   '-I',
[0m[91mgyp[0m[91m [0m[91minfo spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
[0m[91mgyp[0m[91m [0m[91minfo spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info [0m[91mspawn args[0m[91m   '-I',
gyp info spawn args   '/root/.node-gyp/1.5.0/common.gypi',
[0m[91mgyp[0m[91m info spawn args   '-Dlibrary=shared_library',
gyp info [0m[91mspawn args[0m[91m   '-Dvisibility=default',
gyp[0m[91m [0m[91minfo [0m[91mspawn args[0m[91m   '-Dnode_root_dir=/root/.node-gyp/1.5.0',
gyp info[0m[91m spawn args[0m[91m   '-Druntime=iojs',
[0m[91mgyp [0m[91minfo[0m[91m [0m[91mspawn args   '-Dmodule_root_dir=/',
gyp info spawn args[0m[91m   '--depth=.',
gyp[0m[91m info spawn args   '--no-parallel',
[0m[91mgyp info spawn args   '--generator-output',
gyp[0m[91m [0m[91minfo[0m[91m [0m[91mspawn args[0m[91m   'build',
gyp [0m[91minfo spawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR![0m[91m configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR![0m[91m [0m[91mstack     at emitTwo (events.js:87:13)
[0m[91mgyp [0m[91mERR! [0m[91mstack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.5.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 2575eda84974
Removing intermediate container 0259f18c7527
Step 5 : ENV NODE_ENV production
 ---> Running in 698c7fffe5c4
 ---> 9aac153c98f4
Removing intermediate container 698c7fffe5c4
Step 6 : WORKDIR /usr/src/app
 ---> Running in 71ce9ede6183
 ---> 10bf57552a57
Removing intermediate container 71ce9ede6183
Step 7 : CMD npm start
 ---> Running in cb87f922edf2
 ---> f76a3c4ec00c
Removing intermediate container cb87f922edf2
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 088f82e8bc54
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:2 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:3 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 6s (1498 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> 0852980ad2ab
Removing intermediate container 088f82e8bc54
Successfully built 0852980ad2ab

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test108`

Contents of dockerfile `/root/docker-node/.~tmp.test108/Dockerfile`:

```
FROM nodesource/jessie:iojs-1.5.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-1.5.0-test1` from `/root/docker-node/.~tmp.test108`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-1.5.0
 ---> 0852980ad2ab
Step 2 : ENV NODE_ENV test
 ---> Running in 021efa689fe5
 ---> fb920fadf44f
Removing intermediate container 021efa689fe5
Step 3 : RUN node -v
 ---> Running in 9608c7b0229d
v1.5.0
 ---> 4f36cc27c431
Removing intermediate container 9608c7b0229d
Step 4 : RUN node -p "process.versions"
 ---> Running in 4fd89778f463
{ http_parser: '2.3.0',
  node: '1.5.0',
  v8: '4.1.0.21',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1k' }
 ---> 2a0d8785c15c
Removing intermediate container 4fd89778f463
Step 5 : RUN npm --version
 ---> Running in f44e6742e5f5
2.7.0
 ---> f3f150050e50
Removing intermediate container f44e6742e5f5
Successfully built f3f150050e50

```

# Tested image `nodesource/sid:4.2.6`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in ce5c8bee3a27
 ---> f85b6d5724a1
Removing intermediate container ce5c8bee3a27
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.6-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in d30066fdcb77
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 79 8366k   79 6623k    0     0  6798k      0  0:00:01 --:--:--  0:00:01 6793k[0m[91m100 8366k  100 8366k    0     0  7539k      0  0:00:01  0:00:01 --:--:-- 7543k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.2.6-1nodesource1~sid1) ...
Setting up nodejs (4.2.6-1nodesource1~sid1) ...
 ---> 0b0451cde64b
Removing intermediate container d30066fdcb77
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 608ece80d434
[91mnpm[0m[91m [0m[91mWARN deprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, oauth-sign@0.5.0, tunnel-agent@0.4.2, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, hawk@1.1.1, bl@0.9.5, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@4.2.6 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.2.6/node-v4.2.6.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.6/node-v4.2.6.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.2.6/SHASUMS256.txt
[0m[91mgyp[0m[91m [0m[91mhttp [0m[91m200 http://nodejs.org/dist/v4.2.6/SHASUMS256.txt
[0m[91mgyp[0m[91m info spawn[0m[91m python
[0m[91mgyp[0m[91m info spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args[0m[91m   'binding.gyp',
[0m[91mgyp [0m[91minfo spawn args   '-f',
gyp [0m[91minfo [0m[91mspawn args[0m[91m   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
[0m[91mgyp [0m[91minfo spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp [0m[91minfo[0m[91m spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.6/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info [0m[91mspawn args   '-Dvisibility=default',
[0m[91mgyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.6',
gyp info spawn args   '-Druntime=node',
gyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info [0m[91mspawn args[0m[91m   '--no-parallel',
[0m[91mgyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp[0m[91m [0m[91minfo[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
[0m[91mgyp [0m[91mERR! stack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR![0m[91m stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp[0m[91m ERR![0m[91m [0m[91mstack[0m[91m     at emitTwo (events.js:87:13)
[0m[91mgyp[0m[91m ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp [0m[91mERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.2.6
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> cfe66bd9c268
Removing intermediate container 608ece80d434
Step 5 : ENV NODE_ENV production
 ---> Running in 5f3fb38a9d45
 ---> 99b2adf36b80
Removing intermediate container 5f3fb38a9d45
Step 6 : WORKDIR /usr/src/app
 ---> Running in 9ce30685984f
 ---> 78ff118e5fb2
Removing intermediate container 9ce30685984f
Step 7 : CMD npm start
 ---> Running in ef03429fa68a
 ---> 4e1879fea0aa
Removing intermediate container ef03429fa68a
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 8f521c115785
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (2819 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.kernel.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:4 http://mirrors.kernel.org/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:5 http://mirrors.kernel.org/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:7 http://mirrors.kernel.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:9 http://mirrors.kernel.org/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:6 http://mirror.picosecond.org/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:8 http://mirror.picosecond.org/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:12 http://mirror.picosecond.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirror.picosecond.org/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (1995 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 189bc16adece
Removing intermediate container 8f521c115785
Successfully built 189bc16adece

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test126`

Contents of dockerfile `/root/docker-node/.~tmp.test126/Dockerfile`:

```
FROM nodesource/sid:4.2.6
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:4.2.6-test1` from `/root/docker-node/.~tmp.test126`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:4.2.6
 ---> 189bc16adece
Step 2 : ENV NODE_ENV test
 ---> Running in 604ba39a0e7e
 ---> 941dccfa7835
Removing intermediate container 604ba39a0e7e
Step 3 : RUN node -v
 ---> Running in fee52a881197
v4.2.6
 ---> 22ac48973671
Removing intermediate container fee52a881197
Step 4 : RUN node -p "process.versions"
 ---> Running in 8c7585715ff4
{ http_parser: '2.5.0',
  node: '4.2.6',
  v8: '4.5.103.35',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2e' }
 ---> 700bb9e0241d
Removing intermediate container 8c7585715ff4
Step 5 : RUN npm --version
 ---> Running in bec4ab77a3ac
2.14.12
 ---> 8af29567e262
Removing intermediate container bec4ab77a3ac
Successfully built 8af29567e262

```

# Tested image `nodesource/sid:iojs-1.6.4`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 63edcae65cd4
 ---> b33eefc2451c
Removing intermediate container 63edcae65cd4
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.6.4-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in d5df8fcaca1e
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--  [0m[91m   0[0m[91m100 5292k  100 5292k    0     0  6080k      0 --:--:-- --:--:-- --:--:-- 6076k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.6.4-1nodesource1~sid1) ...
Setting up iojs (1.6.4-1nodesource1~sid1) ...
 ---> 340da078e7a8
Removing intermediate container d5df8fcaca1e
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in e46c558dc56d
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â”œâ”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1, http-signature@0.10.1)
â””â”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
[91mgyp info it worked if it ends with[0m[91m ok
[0m[91mgyp info[0m[91m using pangyp@2.3.3
gyp info using node@1.6.4 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp GET https://iojs.org/dist/v1.6.4/iojs-v1.6.4.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v1.6.4/iojs-v1.6.4.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp GET https://iojs.org/dist/v1.6.4/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200 https://iojs.org/dist/v1.6.4/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info [0m[91mspawn args   'binding.gyp',
gyp info spawn args[0m[91m   '-f',
gyp info spawn args   'make',
gyp[0m[91m info spawn args   '-I',
gyp[0m[91m info spawn args   '/build/config.gypi',
gyp info [0m[91mspawn args   '-I',
gyp info spawn args[0m[91m   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
[0m[91mgyp info spawn args   '/root/.node-gyp/1.6.4/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.6.4',
[0m[91mgyp [0m[91minfo[0m[91m spawn args   '-Druntime=iojs',
[0m[91mgyp [0m[91minfo [0m[91mspawn args   '-Dmodule_root_dir=/',
[0m[91mgyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp[0m[91m [0m[91minfo[0m[91m spawn args   '--generator-output',
[0m[91mgyp[0m[91m info spawn args   'build',
gyp[0m[91m info[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp[0m[91m ERR! [0m[91mstack[0m[91m     at emitTwo (events.js:87:13)
[0m[91mgyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.6.4
[0m[91mgyp ERR! pangyp -v[0m[91m v2.3.3
[0m[91mgyp ERR! [0m[91mnot ok[0m[91m 
[0m
 ---> 395bd5269d41
Removing intermediate container e46c558dc56d
Step 5 : ENV NODE_ENV production
 ---> Running in d4d4a4cd3134
 ---> 7f2d7d90f59c
Removing intermediate container d4d4a4cd3134
Step 6 : WORKDIR /usr/src/app
 ---> Running in 590da331091f
 ---> f4cb1cb38ab7
Removing intermediate container 590da331091f
Step 7 : CMD npm start
 ---> Running in 28401dea96be
 ---> 00425332d1f4
Removing intermediate container 28401dea96be
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 000e2a40b84a
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (2882 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2569 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18477 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18477 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18477 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18477 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18477 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18477 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18477 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18477 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18477 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18477 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18477 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18477 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18477 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> c3e1989c0ba7
Removing intermediate container 000e2a40b84a
Successfully built c3e1989c0ba7

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test172`

Contents of dockerfile `/root/docker-node/.~tmp.test172/Dockerfile`:

```
FROM nodesource/sid:iojs-1.6.4
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-1.6.4-test1` from `/root/docker-node/.~tmp.test172`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-1.6.4
 ---> c3e1989c0ba7
Step 2 : ENV NODE_ENV test
 ---> Running in 7ce428113d5e
 ---> 741c7e8c55a9
Removing intermediate container 7ce428113d5e
Step 3 : RUN node -v
 ---> Running in bc6d2f6be4a1
v1.6.4
 ---> 53572af14fd5
Removing intermediate container bc6d2f6be4a1
Step 4 : RUN node -p "process.versions"
 ---> Running in d7127a06e2b7
{ http_parser: '2.3.0',
  node: '1.6.4',
  v8: '4.1.0.27',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1m' }
 ---> 3ffb835362cd
Removing intermediate container d7127a06e2b7
Step 5 : RUN npm --version
 ---> Running in 0ba5c9c7b179
2.7.5
 ---> 7eb494011927
Removing intermediate container 0ba5c9c7b179
Successfully built 7eb494011927

```

# Tested image `nodesource/sid:4.2.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 12e80b18e62d
 ---> 587d9f62533e
Removing intermediate container 12e80b18e62d
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in f7b2e1f5d3d8
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 6466k  100 6466k    0     0  6998k      0 --:--:-- --:--:-- --:--:-- 6998k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.2.0-1nodesource1~sid1) ...
Setting up nodejs (4.2.0-1nodesource1~sid1) ...
 ---> 7c85aa7e470a
Removing intermediate container f7b2e1f5d3d8
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in c080cec4860d
[91mnpm[0m[91m [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (forever-agent@0.5.2, aws-sign2@0.5.0, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
[0m[91mgyp [0m[91minfo[0m[91m using pangyp@2.3.3
gyp info using node@4.2.0 | linux | x64
[0m[91mgyp[0m[91m http[0m[91m GET[0m[91m http://nodejs.org/dist/v4.2.0/node-v4.2.0.tar.gz
[0m[91mgyp http 200[0m[91m http://nodejs.org/dist/v4.2.0/node-v4.2.0.tar.gz
[0m[91mgyp [0m[91mhttp [0m[91mGET http://nodejs.org/dist/v4.2.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.0/SHASUMS256.txt
[0m[91mgyp [0m[91minfo spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m ERR![0m[91m configure error[0m[91m 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR![0m[91m command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR![0m[91m cwd /
gyp ERR! node -v v4.2.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 19d731cca8a4
Removing intermediate container c080cec4860d
Step 5 : ENV NODE_ENV production
 ---> Running in 1f84fd22285e
 ---> f9371c6fa243
Removing intermediate container 1f84fd22285e
Step 6 : WORKDIR /usr/src/app
 ---> Running in 4fe3b5cb784f
 ---> 5eefd2d0300b
Removing intermediate container 4fe3b5cb784f
Step 7 : CMD npm start
 ---> Running in 769e9bddfc93
 ---> 11510c030a4e
Removing intermediate container 769e9bddfc93
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 603a1bbbcff7
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4261 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:9 http://mirrors.kernel.org/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:3 http://mirror.picosecond.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
Get:5 http://mirror.picosecond.org/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:11 http://mirror.picosecond.org/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2627 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18736 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18736 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18736 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18736 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18736 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18736 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18736 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18736 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18736 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18736 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18736 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18736 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18736 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> dcb50a7f2930
Removing intermediate container 603a1bbbcff7
Successfully built dcb50a7f2930

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test157`

Contents of dockerfile `/root/docker-node/.~tmp.test157/Dockerfile`:

```
FROM nodesource/sid:4.2.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:4.2.0-test1` from `/root/docker-node/.~tmp.test157`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:4.2.0
 ---> dcb50a7f2930
Step 2 : ENV NODE_ENV test
 ---> Running in 26a5201a01d9
 ---> f022562a921a
Removing intermediate container 26a5201a01d9
Step 3 : RUN node -v
 ---> Running in 648bffcf7b17
v4.2.0
 ---> 697295487e28
Removing intermediate container 648bffcf7b17
Step 4 : RUN node -p "process.versions"
 ---> Running in 94b17c8439ca
{ http_parser: '2.5.0',
  node: '4.2.0',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '46',
  openssl: '1.0.2d' }
 ---> 2429601b94fb
Removing intermediate container 94b17c8439ca
Step 5 : RUN npm --version
 ---> Running in 8d7a20915981
2.14.7
 ---> 736481313351
Removing intermediate container 8d7a20915981
Successfully built 736481313351

```

# Tested image `nodesource/sid:4.3.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in dcb59100fec2
 ---> 2193035ccb00
Removing intermediate container dcb59100fec2
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.3.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 37a9888c3c63
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spen[0m[91mt    Left  Speed
  0     0    0     0    0     0      0      0 --:--:[0m[91m-- --:--:-- --:--[0m[91m:--     0[0m[91m  2 8367k    2  191k    0     0   431k      0  0:00:19 --:--:--  0:00:19  430k[0m[91m100 8367k  100 8367k    0     0  7110k      0  0:00:01  0:00:01 --:--:-- 7115k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.3.0-1nodesource1~sid1) ...
Setting up nodejs (4.3.0-1nodesource1~sid1) ...
 ---> eea4de022888
Removing intermediate container 37a9888c3c63
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in a7970a6ffbc0
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (forever-agent@0.5.2, aws-sign2@0.5.0, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, hawk@1.1.1, bl@0.9.5, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
gyp info using node@4.3.0 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp[0m[91m [0m[91mGET http://nodejs.org/dist/v4.3.0/node-v4.3.0.tar.gz
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v4.3.0/node-v4.3.0.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.3.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.3.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.3.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.3.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error[0m[91m 
[0m[91mgyp [0m[91mERR! stack[0m[91m Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.3.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 2169d07c6b96
Removing intermediate container a7970a6ffbc0
Step 5 : ENV NODE_ENV production
 ---> Running in 4ed1063292ea
 ---> 367365ed1b0d
Removing intermediate container 4ed1063292ea
Step 6 : WORKDIR /usr/src/app
 ---> Running in a2c178299ed1
 ---> f5577014b684
Removing intermediate container a2c178299ed1
Step 7 : CMD npm start
 ---> Running in b2146c907142
 ---> 74178bcb3b4d
Removing intermediate container b2146c907142
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 2f7efd994ef3
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 4s (2501 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (3645 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19019 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 96a07e803c11
Removing intermediate container 2f7efd994ef3
Successfully built 96a07e803c11

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test163`

Contents of dockerfile `/root/docker-node/.~tmp.test163/Dockerfile`:

```
FROM nodesource/sid:4.3.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:4.3.0-test1` from `/root/docker-node/.~tmp.test163`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:4.3.0
 ---> 96a07e803c11
Step 2 : ENV NODE_ENV test
 ---> Running in eedb07c87ac1
 ---> 95a0e850e763
Removing intermediate container eedb07c87ac1
Step 3 : RUN node -v
 ---> Running in 1eff698207e2
v4.3.0
 ---> 5624f0b2981d
Removing intermediate container 1eff698207e2
Step 4 : RUN node -p "process.versions"
 ---> Running in e09a3d4433a0
{ http_parser: '2.5.1',
  node: '4.3.0',
  v8: '4.5.103.35',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2f' }
 ---> 44c41d729864
Removing intermediate container e09a3d4433a0
Step 5 : RUN npm --version
 ---> Running in 1eb3eeff5b8e
2.14.12
 ---> d674c716cfd8
Removing intermediate container 1eb3eeff5b8e
Successfully built d674c716cfd8

```

# Tested image `nodesource/jessie:iojs-2.3.3`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/jessie-base
 ---> 388c7a524b5f
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 97adde92e7d3
 ---> 5ab254857571
Removing intermediate container 97adde92e7d3
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.3.3-1nodesource1~jessie1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in eea2699ba1fb
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5987k  100 5987k    0     0  8139k      0 --:--:-- --:--:-- --:--:-- 8135k
[0mSelecting previously unselected package iojs.
(Reading database ... 14690 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.3.3-1nodesource1~jessie1) ...
Setting up iojs (2.3.3-1nodesource1~jessie1) ...
 ---> c01d4f18acfb
Removing intermediate container eea2699ba1fb
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 6924eae48641
[91mnpm[0m[91m [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp [0m[91minfo using node@2.3.3 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp GET https://iojs.org/dist/v2.3.3/iojs-v2.3.3.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v2.3.3/iojs-v2.3.3.tar.gz
[0m[91mgyp [0m[91mhttp GET https://iojs.org/dist/v2.3.3/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v2.3.3/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/2.3.3/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/2.3.3',
gyp info spawn args   '-Druntime=iojs',
gyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info [0m[91mspawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp [0m[91mERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp[0m[91m ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp [0m[91mERR! [0m[91mstack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v2.3.3
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> fe4cdddf7d41
Removing intermediate container 6924eae48641
Step 5 : ENV NODE_ENV production
 ---> Running in 7270eadd38b8
 ---> d814e3186a0a
Removing intermediate container 7270eadd38b8
Step 6 : WORKDIR /usr/src/app
 ---> Running in 26300308fd88
 ---> b0c212504b1c
Removing intermediate container 26300308fd88
Step 7 : CMD npm start
 ---> Running in c698c249c95d
 ---> fa6721e0a493
Removing intermediate container c698c249c95d
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 04835214287e
Get:1 http://security.debian.org jessie/updates InRelease [63.1 kB]
Get:2 http://security.debian.org jessie/updates/main amd64 Packages [263 kB]
Ign http://httpredir.debian.org jessie InRelease
Get:3 http://httpredir.debian.org jessie-updates InRelease [136 kB]
Get:4 http://httpredir.debian.org jessie Release.gpg [2373 B]
Get:5 http://httpredir.debian.org jessie-updates/main amd64 Packages [3619 B]
Get:6 http://httpredir.debian.org jessie Release [148 kB]
Get:7 http://httpredir.debian.org jessie/main amd64 Packages [9034 kB]
Fetched 9651 kB in 3s (2684 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
 ---> eb4b63eaccc7
Removing intermediate container 04835214287e
Successfully built eb4b63eaccc7

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test119`

Contents of dockerfile `/root/docker-node/.~tmp.test119/Dockerfile`:

```
FROM nodesource/jessie:iojs-2.3.3
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/jessie:iojs-2.3.3-test1` from `/root/docker-node/.~tmp.test119`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/jessie:iojs-2.3.3
 ---> eb4b63eaccc7
Step 2 : ENV NODE_ENV test
 ---> Running in e2ea1b2f961d
 ---> eda19190f14f
Removing intermediate container e2ea1b2f961d
Step 3 : RUN node -v
 ---> Running in c35504f1f692
v2.3.3
 ---> 38354f66d33c
Removing intermediate container c35504f1f692
Step 4 : RUN node -p "process.versions"
 ---> Running in 7b342857d23c
{ http_parser: '2.5.0',
  node: '2.3.3',
  v8: '4.2.77.20',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2c' }
 ---> 324ed93715fc
Removing intermediate container 7b342857d23c
Step 5 : RUN npm --version
 ---> Running in f4cd69656c71
2.11.3
 ---> 7d1b505c6b27
Removing intermediate container f4cd69656c71
Successfully built 7d1b505c6b27

```

# Tested image `nodesource/sid:0.10.37`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 8307e10dd83d
 ---> fbba8e477c4a
Removing intermediate container 8307e10dd83d
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.37-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in d05e0b12c16e
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:[0m[91m-- --:--:--     0[0m[91m100 3960k  100 3960k    0     0  4574k      0 --:--:-- --:--:-- --:--:-- 4573k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.37-1nodesource1~sid1) ...
Setting up nodejs (0.10.37-1nodesource1~sid1) ...
 ---> 1b7aa3ea2044
Removing intermediate container d05e0b12c16e
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in fb70ca4b1ccb
[91mnpm[0m[91m WARN [0m[91mdeprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, tunnel-agent@0.4.2, oauth-sign@0.5.0, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp [0m[91minfo [0m[91musing[0m[91m pangyp@2.3.3
gyp info using node@0.10.37 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.37/node-v0.10.37.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.37/node-v0.10.37.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.37/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.37/SHASUMS256.txt
[0m[91mgyp[0m[91m [0m[91minfo[0m[91m spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.37/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.37',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m [0m[91mERR! configure error 
[0m[91mgyp ERR! [0m[91mstack Error: `gyp` failed with exit code: 1
gyp[0m[91m [0m[91mERR! [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at ChildProcess.emit (events.js:98:17)
[0m[91mgyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.37
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 2746bb094529
Removing intermediate container fb70ca4b1ccb
Step 5 : ENV NODE_ENV production
 ---> Running in a422044fbc59
 ---> 22d3f28ef868
Removing intermediate container a422044fbc59
Step 6 : WORKDIR /usr/src/app
 ---> Running in 9ce174a4818f
 ---> 58fa222f3b05
Removing intermediate container 9ce174a4818f
Step 7 : CMD npm start
 ---> Running in 399ebed50c1d
 ---> e600b1cad706
Removing intermediate container 399ebed50c1d
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 0139e00b6349
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (2901 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (5822 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> d6dcad572070
Removing intermediate container 0139e00b6349
Successfully built d6dcad572070

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test141`

Contents of dockerfile `/root/docker-node/.~tmp.test141/Dockerfile`:

```
FROM nodesource/sid:0.10.37
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.10.37-test1` from `/root/docker-node/.~tmp.test141`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.10.37
 ---> d6dcad572070
Step 2 : ENV NODE_ENV test
 ---> Running in 9ae81c4c456d
 ---> ce2f22155ee3
Removing intermediate container 9ae81c4c456d
Step 3 : RUN node -v
 ---> Running in 86b2f1d01c26
v0.10.37
 ---> c4592e0ddf39
Removing intermediate container 86b2f1d01c26
Step 4 : RUN node -p "process.versions"
 ---> Running in 95aead5c4e74
{ http_parser: '1.0',
  node: '0.10.37',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1l' }
 ---> 07d10065636a
Removing intermediate container 95aead5c4e74
Step 5 : RUN npm --version
 ---> Running in a7b067ea12ee
1.4.28
 ---> d3430c0e4840
Removing intermediate container a7b067ea12ee
Successfully built d3430c0e4840

```

# Tested image `nodesource/sid:0.10.40`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 06ff1439ee9f
 ---> 8da0efdbad68
Removing intermediate container 06ff1439ee9f
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.40-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 39e72d4fd23f
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spen[0m[91mt    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0 3964k    0 16086    0     0  45501      0  0:01:29 --:--:--  0:01:29 45440[0m[91m100 3964k  100 3964k    0     0  4943k      0 --:--:-- --:--:-- --:--:-- 4943k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.40-1nodesource1~sid1) ...
Setting up nodejs (0.10.40-1nodesource1~sid1) ...
 ---> 5697d7c60013
Removing intermediate container 39e72d4fd23f
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 94385a1a6f9a
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@0.10.40 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.40/node-v0.10.40.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.40/node-v0.10.40.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp GET http://nodejs.org/dist/v0.10.40/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.40/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.40/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.40',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! [0m[91mconfigure error[0m[91m 
[0m[91mgyp ERR! [0m[91mstack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp[0m[91m ERR![0m[91m [0m[91mstack     at ChildProcess.emit (events.js:98:17)
gyp [0m[91mERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
[0m[91mgyp ERR![0m[91m [0m[91mSystem[0m[91m Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR![0m[91m node -v v0.10.40
[0m[91mgyp ERR! [0m[91mpangyp -v v2.3.3
[0m[91mgyp ERR! not ok 
[0m
 ---> 3980554f934a
Removing intermediate container 94385a1a6f9a
Step 5 : ENV NODE_ENV production
 ---> Running in 79d60e948092
 ---> 48c77fb33b8b
Removing intermediate container 79d60e948092
Step 6 : WORKDIR /usr/src/app
 ---> Running in 558b5bbdcc2f
 ---> 4f740ef56057
Removing intermediate container 558b5bbdcc2f
Step 7 : CMD npm start
 ---> Running in 346a9fb344d4
 ---> b88499099fda
Removing intermediate container 346a9fb344d4
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 4a252335f94e
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4155 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (6608 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 82f260d2ce32
Removing intermediate container 4a252335f94e
Successfully built 82f260d2ce32

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test144`

Contents of dockerfile `/root/docker-node/.~tmp.test144/Dockerfile`:

```
FROM nodesource/sid:0.10.40
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.10.40-test1` from `/root/docker-node/.~tmp.test144`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.10.40
 ---> 82f260d2ce32
Step 2 : ENV NODE_ENV test
 ---> Running in dba504931a33
 ---> de2777ce43ad
Removing intermediate container dba504931a33
Step 3 : RUN node -v
 ---> Running in ab2b1b5fe6b4
v0.10.40
 ---> 2d59dd6e75b7
Removing intermediate container ab2b1b5fe6b4
Step 4 : RUN node -p "process.versions"
 ---> Running in d5438d3fa8a2
{ http_parser: '1.0',
  node: '0.10.40',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1p' }
 ---> 06b361ad22db
Removing intermediate container d5438d3fa8a2
Step 5 : RUN npm --version
 ---> Running in dc0ecbc5eec6
1.4.28
 ---> eec58bee11f8
Removing intermediate container dc0ecbc5eec6
Successfully built eec58bee11f8

```

# Tested image `nodesource/sid:0.10.41`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 8f9c498f02f0
 ---> 77bcc87c9ce4
Removing intermediate container 8f9c498f02f0
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.41-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 8f04e797bc18
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0   [0m[91m   0 --:--:-- --:--:-- --:--:--     0[0m[91m  5 4260k    5  239k    0     0   403k      0  0:00:10 --:--:--  0:00:10  403k[0m[91m100 4260k  100 4260k    0     0  4255k      0  0:00:01  0:00:01 --:--:-- 4256k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.41-1nodesource1~sid1) ...
Setting up nodejs (0.10.41-1nodesource1~sid1) ...
 ---> 3e3956893f07
Removing intermediate container 8f04e797bc18
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 0cac668bd644
[91mnpm[0m[91m [0m[91mWARN deprecated This version of npm lacks support for important features,
npm WARN deprecated such as scoped packages, offered by the primary npm
[0m[91mnpm WARN deprecated registry. Consider upgrading to at least npm@2, if not the
npm WARN deprecated latest stable version. To upgrade to npm@2, run:
[0m[91mnpm WARN deprecated 
[0m[91mnpm WARN deprecated   npm -g install npm@latest-2
npm WARN deprecated 
npm WARN deprecated To upgrade to the latest stable version, run:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest
[0m[91mnpm [0m[91mWARN deprecated 
npm WARN deprecated (Depending on how Node.js was installed on your system, you
npm WARN deprecated may need to prefix the preceding commands with `sudo`, or if
npm WARN deprecated on Windows, run them from an Administrator prompt.)
npm WARN deprecated 
[0m[91mnpm WARN [0m[91mdeprecated If you're running the version of npm bundled with
[0m[91mnpm WARN deprecated Node.js 0.10 LTS, be aware that the next version of 0.10 LTS
npm WARN deprecated will be bundled with a version of npm@2, which has some small
npm WARN deprecated backwards-incompatible changes made to `npm run-script` and
npm WARN[0m[91m [0m[91mdeprecated semver behavior.
[0m[91mnpm[0m[91m [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mnpm[0m[91m WARN deprecated This version of npm lacks support for important features,
npm WARN deprecated such as scoped packages, offered by the primary npm
[0m[91mnpm WARN deprecated registry. Consider upgrading to at least npm@2, if not the
npm WARN deprecated latest stable version. To upgrade to npm@2, run:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest-2
npm WARN deprecated 
npm WARN deprecated To upgrade to the latest stable version, run:
[0m[91mnpm [0m[91mWARN deprecated 
npm WARN deprecated   npm -g install npm@latest
npm WARN deprecated 
npm WARN deprecated (Depending on how Node.js was installed on your system, you
npm WARN deprecated may need to prefix the preceding commands with `sudo`, or if
npm [0m[91mWARN deprecated[0m[91m on Windows, run them from an Administrator prompt.)
npm [0m[91mWARN deprecated 
npm WARN deprecated If you're running the version of npm bundled with
npm WARN deprecated Node.js 0.10 LTS, be aware that the next version of 0.10 LTS
npm WARN deprecated will be bundled with a version of npm@2, which has some small
npm WARN deprecated backwards-incompatible changes made to `npm run-script` and
[0m[91mnpm WARN deprecated semver behavior.
[0m[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp[0m[91m info [0m[91musing[0m[91m pangyp@2.3.3
gyp info using node@0.10.41 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.41/node-v0.10.41.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.41/node-v0.10.41.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.41/SHASUMS256.txt
gyp http 200 http://nodejs.org/dist/v0.10.41/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
[0m[91mgyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.41/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.41',
gyp info[0m[91m spawn args   '-Druntime=node',
gyp info [0m[91mspawn args   '-Dmodule_root_dir=/',
[0m[91mgyp [0m[91minfo [0m[91mspawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp [0m[91minfo [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp[0m[91m [0m[91mERR! cwd[0m[91m /
gyp [0m[91mERR! [0m[91mnode -v v0.10.41
gyp ERR! [0m[91mpangyp -v v2.3.3
[0m[91mgyp [0m[91mERR! not ok 
[0m
 ---> 6d557a52e208
Removing intermediate container 0cac668bd644
Step 5 : ENV NODE_ENV production
 ---> Running in 48946b47119f
 ---> 4f9c9672d458
Removing intermediate container 48946b47119f
Step 6 : WORKDIR /usr/src/app
 ---> Running in 7fe3bbe0c1d8
 ---> 5fc7bf47c9f0
Removing intermediate container 7fe3bbe0c1d8
Step 7 : CMD npm start
 ---> Running in da7404fda4b4
 ---> e9651a218744
Removing intermediate container da7404fda4b4
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 927bf25c3841
Get:1 http://mirrors.kernel.org/debian sid InRelease [287 kB]
Get:2 http://mirror.picosecond.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 4s (2694 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2786 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17985 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> ef9a11b38f11
Removing intermediate container 927bf25c3841
Successfully built ef9a11b38f11

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test145`

Contents of dockerfile `/root/docker-node/.~tmp.test145/Dockerfile`:

```
FROM nodesource/sid:0.10.41
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.10.41-test1` from `/root/docker-node/.~tmp.test145`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.10.41
 ---> ef9a11b38f11
Step 2 : ENV NODE_ENV test
 ---> Running in cf73faeb8dbc
 ---> a36087b5c7f1
Removing intermediate container cf73faeb8dbc
Step 3 : RUN node -v
 ---> Running in 65d4ff58147a
v0.10.41
 ---> e9ad11902809
Removing intermediate container 65d4ff58147a
Step 4 : RUN node -p "process.versions"
 ---> Running in 2a999227a10e
{ http_parser: '1.0',
  node: '0.10.41',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1q' }
 ---> 7b9c0b410414
Removing intermediate container 2a999227a10e
Step 5 : RUN npm --version
 ---> Running in 4624489ec5cc
1.4.29
 ---> 8764133e0cb0
Removing intermediate container 4624489ec5cc
Successfully built 8764133e0cb0

```

# Tested image `nodesource/sid:5.0.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 908ba2ebf0cf
 ---> 8f10c2ffd19e
Removing intermediate container 908ba2ebf0cf
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.0.0-3nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 37e6cfe912c4
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 6937k  100 6937k    0     0  6844k      0  0:00:01  0:00:01 --:--:-- 6848k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.0.0-3nodesource1~sid1) ...
Setting up nodejs (5.0.0-3nodesource1~sid1) ...
 ---> 9ed7768f4ff3
Removing intermediate container 37e6cfe912c4
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 6c1c9bf94150
[91mnpm[0m[91m WARN[0m[91m deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp [0m[91minfo using node@5.0.0 | linux | x64
[0m[91mgyp[0m[91m http[0m[91m [0m[91mGET[0m[91m http://nodejs.org/dist/v5.0.0/node-v5.0.0.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v5.0.0/node-v5.0.0.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v5.0.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v5.0.0/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.0.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.0.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args[0m[91m   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! [0m[91mstack[0m[91m     at ChildProcess.emit (events.js:172:7)
[0m[91mgyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp[0m[91m [0m[91mERR![0m[91m [0m[91mcommand[0m[91m "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.0.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> dd4fc8a2f0d3
Removing intermediate container 6c1c9bf94150
Step 5 : ENV NODE_ENV production
 ---> Running in 2e206a7efe31
 ---> 46d05088cdd2
Removing intermediate container 2e206a7efe31
Step 6 : WORKDIR /usr/src/app
 ---> Running in 0eae3bd6ba8a
 ---> ee0d124fe2dc
Removing intermediate container 0eae3bd6ba8a
Step 7 : CMD npm start
 ---> Running in 676d6d2ac677
 ---> b5cb861d228b
Removing intermediate container 676d6d2ac677
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 10e60a5820c6
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3411 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2230 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18839 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18839 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18839 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18839 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18839 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18839 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18839 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18839 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18839 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18839 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18839 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18839 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18839 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> ac475e280253
Removing intermediate container 10e60a5820c6
Successfully built ac475e280253

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test127`

Contents of dockerfile `/root/docker-node/.~tmp.test127/Dockerfile`:

```
FROM nodesource/sid:5.0.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:5.0.0-test1` from `/root/docker-node/.~tmp.test127`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:5.0.0
 ---> ac475e280253
Step 2 : ENV NODE_ENV test
 ---> Running in b786e8ee365f
 ---> f42078dbc328
Removing intermediate container b786e8ee365f
Step 3 : RUN node -v
 ---> Running in b95e74543197
v5.0.0
 ---> 215d713b7b3f
Removing intermediate container b95e74543197
Step 4 : RUN node -p "process.versions"
 ---> Running in 442a86a3502c
{ http_parser: '2.5.0',
  node: '5.0.0',
  v8: '4.6.85.28',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '55.1',
  modules: '47',
  openssl: '1.0.2d' }
 ---> c1b2f914762c
Removing intermediate container 442a86a3502c
Step 5 : RUN npm --version
 ---> Running in 2a76c631f363
3.3.6
 ---> 6235b1659c4f
Removing intermediate container 2a76c631f363
Successfully built 6235b1659c4f

```

# Tested image `nodesource/sid:0.12.9`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 8ae8e66fc24b
 ---> 4c3174296d25
Removing intermediate container 8ae8e66fc24b
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.9-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 1e1f68590f7e
[91m  % Total    % Receive[0m[91md % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0    [0m[91m  0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 53 6907k   53 3727k    0     0  4534k      0  0:00:01 --:--:--  0:00:01 4534k[0m[91m100 6907k  100 6907k    0     0  6544k      0  0:00:01  0:00:01 --:--:-- 6547k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.9-1nodesource1~sid1) ...
Setting up nodejs (0.12.9-1nodesource1~sid1) ...
 ---> c8167b45185f
Removing intermediate container 1e1f68590f7e
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in d4d8f304c02c
[91mnpm[0m[91m [0m[91mWARN deprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.12.9 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp GET http://nodejs.org/dist/v0.12.9/node-v0.12.9.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.9/node-v0.12.9.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp GET http://nodejs.org/dist/v0.12.9/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp [0m[91m200[0m[91m http://nodejs.org/dist/v0.12.9/SHASUMS256.txt
[0m[91mgyp [0m[91minfo spawn python
[0m[91mgyp [0m[91minfo spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp[0m[91m info[0m[91m spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp [0m[91minfo [0m[91mspawn args   'make',
[0m[91mgyp info spawn args   '-I',
[0m[91mgyp info spawn args   '/build/config.gypi',
[0m[91mgyp info spawn args   '-I',
[0m[91mgyp[0m[91m info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp[0m[91m info[0m[91m [0m[91mspawn args[0m[91m   '-I',
gyp info[0m[91m [0m[91mspawn args[0m[91m   '/root/.node-gyp/0.12.9/common.gypi',
[0m[91mgyp info spawn args   '-Dlibrary=shared_library',
gyp info [0m[91mspawn args[0m[91m   '-Dvisibility=default',
[0m[91mgyp[0m[91m info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.9',
gyp info[0m[91m spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
[0m[91mgyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info [0m[91mspawn args[0m[91m   '--generator-output',
gyp[0m[91m [0m[91minfo[0m[91m [0m[91mspawn args   'build',
[0m[91mgyp[0m[91m info[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp[0m[91m ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1075:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp [0m[91mERR! command "node" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp ERR! node -v v0.12.9
gyp [0m[91mERR![0m[91m pangyp -v[0m[91m v2.3.3
[0m[91mgyp ERR! not ok 
[0m
 ---> 2594af7d4f7c
Removing intermediate container d4d8f304c02c
Step 5 : ENV NODE_ENV production
 ---> Running in a224e5e69642
 ---> 3b66a2fd7ba3
Removing intermediate container a224e5e69642
Step 6 : WORKDIR /usr/src/app
 ---> Running in fb4d44d2fa3b
 ---> a1f5b4980bbf
Removing intermediate container fb4d44d2fa3b
Step 7 : CMD npm start
 ---> Running in 3a299c21ea45
 ---> aec159c3ad25
Removing intermediate container 3a299c21ea45
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in e32ea923676d
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4971 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirror.picosecond.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirror.picosecond.org/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:3 http://mirrors.kernel.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.kernel.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.kernel.org/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:10 http://mirrors.kernel.org/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:13 http://mirrors.kernel.org/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:5 http://mirror.picosecond.org/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:9 http://mirror.picosecond.org/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2689 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 735a118838d4
Removing intermediate container e32ea923676d
Successfully built 735a118838d4

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test123`

Contents of dockerfile `/root/docker-node/.~tmp.test123/Dockerfile`:

```
FROM nodesource/sid:0.12.9
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.12.9-test1` from `/root/docker-node/.~tmp.test123`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.12.9
 ---> 735a118838d4
Step 2 : ENV NODE_ENV test
 ---> Running in 6c04cce6df21
 ---> 3ad7fc2f697f
Removing intermediate container 6c04cce6df21
Step 3 : RUN node -v
 ---> Running in 9ee050bc5f31
v0.12.9
 ---> 97c6e8a81009
Removing intermediate container 9ee050bc5f31
Step 4 : RUN node -p "process.versions"
 ---> Running in 5b8c09e90ddf
{ http_parser: '2.3',
  node: '0.12.9',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1q' }
 ---> 217c72cd2757
Removing intermediate container 5b8c09e90ddf
Step 5 : RUN npm --version
 ---> Running in d62fc4bec58c
2.14.9
 ---> 806fb2efd029
Removing intermediate container d62fc4bec58c
Successfully built 806fb2efd029

```

# Tested image `nodesource/sid:0.10.38`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 461d05df32eb
 ---> 7206fcb62547
Removing intermediate container 461d05df32eb
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.38-1chl1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 79eb26bb053d
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 3961k  100 3961k    0     0  5443k      0 --:--:-- --:--:-- --:--:-- 5449k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.38-1chl1~sid1) ...
Setting up nodejs (0.10.38-1chl1~sid1) ...
 ---> 595d21744ec8
Removing intermediate container 79eb26bb053d
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 4215b2ae7e1e
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info [0m[91musing pangyp@2.3.3
gyp info using node@0.10.38 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.38/node-v0.10.38.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.38/node-v0.10.38.tar.gz
[0m[91mgyp[0m[91m http [0m[91mGET http://nodejs.org/dist/v0.10.38/SHASUMS256.txt
[0m[91mgyp[0m[91m http [0m[91m200 http://nodejs.org/dist/v0.10.38/SHASUMS256.txt
[0m[91mgyp[0m[91m [0m[91minfo spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp [0m[91minfo spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.38/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.38',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp[0m[91m [0m[91mERR![0m[91m [0m[91mstack     at ChildProcess.emit (events.js:98:17)
gyp[0m[91m ERR![0m[91m [0m[91mstack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp [0m[91mERR! command[0m[91m "node" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp ERR![0m[91m node -v v0.10.38
[0m[91mgyp ERR! [0m[91mpangyp -v v2.3.3
[0m[91mgyp ERR! not ok 
[0m
 ---> 37a53d5d725e
Removing intermediate container 4215b2ae7e1e
Step 5 : ENV NODE_ENV production
 ---> Running in f48e83244585
 ---> 24cd14a28ba4
Removing intermediate container f48e83244585
Step 6 : WORKDIR /usr/src/app
 ---> Running in f39342f9a6d1
 ---> 88a6b5178d39
Removing intermediate container f39342f9a6d1
Step 7 : CMD npm start
 ---> Running in 16c2c50fe85d
 ---> 40ff1ec2e5c0
Removing intermediate container 16c2c50fe85d
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 76719e7be27f
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (2880 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (6635 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> a397063d738f
Removing intermediate container 76719e7be27f
Successfully built a397063d738f

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test142`

Contents of dockerfile `/root/docker-node/.~tmp.test142/Dockerfile`:

```
FROM nodesource/sid:0.10.38
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.10.38-test1` from `/root/docker-node/.~tmp.test142`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.10.38
 ---> a397063d738f
Step 2 : ENV NODE_ENV test
 ---> Running in bad5371e50a6
 ---> a6a76b2f071a
Removing intermediate container bad5371e50a6
Step 3 : RUN node -v
 ---> Running in c8648884b33f
v0.10.38
 ---> 044a9dedf65c
Removing intermediate container c8648884b33f
Step 4 : RUN node -p "process.versions"
 ---> Running in b71b69732654
{ http_parser: '1.0',
  node: '0.10.38',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1m' }
 ---> bee64c9e8c4d
Removing intermediate container b71b69732654
Step 5 : RUN npm --version
 ---> Running in 36dd2f189077
1.4.28
 ---> b907ea3c2de7
Removing intermediate container 36dd2f189077
Successfully built b907ea3c2de7

```

# Tested image `nodesource/sid:0.10.39`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 021d63110260
 ---> 9e870f87b1ec
Removing intermediate container 021d63110260
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.39-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 63d326f2003f
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 53 3964k   53 2127k    0     0  3086k      0  0:00:01 --:--:--  0:00:01 3083k[0m[91m100 3964k  100 3964k    0     0  4020k      0 --:--:-- --:--:-- --:--:-- 4020k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.39-1nodesource1~sid1) ...
Setting up nodejs (0.10.39-1nodesource1~sid1) ...
 ---> 31f938afe033
Removing intermediate container 63d326f2003f
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in e436d66798a4
[91mnpm [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo[0m[91m [0m[91mit worked if it ends with[0m[91m ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@0.10.39 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.39/node-v0.10.39.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.39/node-v0.10.39.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.10.39/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v0.10.39/SHASUMS256.txt
[0m[91mgyp[0m[91m info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
[0m[91mgyp info [0m[91mspawn args[0m[91m   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.39/common.gypi',
gyp info spawn args[0m[91m   '-Dlibrary=shared_library',
gyp[0m[91m info[0m[91m spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.39',
gyp [0m[91minfo spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp [0m[91minfo spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! [0m[91mconfigure error 
[0m[91mgyp ERR! stack[0m[91m Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR![0m[91m [0m[91mstack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System[0m[91m Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.39
[0m[91mgyp ERR! [0m[91mpangyp -v v2.3.3
[0m[91mgyp [0m[91mERR! not ok 
[0m
 ---> 5bf6979175fa
Removing intermediate container e436d66798a4
Step 5 : ENV NODE_ENV production
 ---> Running in 85fe5c663cc6
 ---> 15ea2d6b752b
Removing intermediate container 85fe5c663cc6
Step 6 : WORKDIR /usr/src/app
 ---> Running in 5258785fea87
 ---> f2b79bf7da3e
Removing intermediate container 5258785fea87
Step 7 : CMD npm start
 ---> Running in 7c0a80a09e89
 ---> 53703dff793c
Removing intermediate container 7c0a80a09e89
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 3008d469b749
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4074 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirror.picosecond.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:3 http://mirror.picosecond.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.kernel.org/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:7 http://mirrors.kernel.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.kernel.org/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:10 http://mirrors.kernel.org/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.kernel.org/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:5 http://mirror.picosecond.org/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirror.picosecond.org/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:12 http://mirror.picosecond.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirror.picosecond.org/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (1711 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17880 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> f3d38381fbf6
Removing intermediate container 3008d469b749
Successfully built f3d38381fbf6

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test143`

Contents of dockerfile `/root/docker-node/.~tmp.test143/Dockerfile`:

```
FROM nodesource/sid:0.10.39
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.10.39-test1` from `/root/docker-node/.~tmp.test143`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.10.39
 ---> f3d38381fbf6
Step 2 : ENV NODE_ENV test
 ---> Running in 5b1865355bc0
 ---> 2dbe262d2870
Removing intermediate container 5b1865355bc0
Step 3 : RUN node -v
 ---> Running in e4a74f2ba1c6
v0.10.39
 ---> 8ab6bddbfede
Removing intermediate container e4a74f2ba1c6
Step 4 : RUN node -p "process.versions"
 ---> Running in f01b763e2d47
{ http_parser: '1.0',
  node: '0.10.39',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1o' }
 ---> fafc17dae662
Removing intermediate container f01b763e2d47
Step 5 : RUN npm --version
 ---> Running in 486a1daf3344
1.4.28
 ---> edeb255ec13e
Removing intermediate container 486a1daf3344
Successfully built edeb255ec13e

```

# Tested image `nodesource/sid:0.12.5`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 1d12125c33de
 ---> a782d5f40cb3
Removing intermediate container 1d12125c33de
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.5-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 7f0710b5e042
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5281k  100 5281k    0     0  5745k      0 --:--:-- --:--:-- --:--:-- 5740k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.5-1nodesource1~sid1) ...
Setting up nodejs (0.12.5-1nodesource1~sid1) ...
 ---> ba11dc440cf1
Removing intermediate container 7f0710b5e042
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 2c7e2ba4c311
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo [0m[91musing pangyp@2.3.3
gyp info using node@0.12.5 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.5/node-v0.12.5.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.5/node-v0.12.5.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.5/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.5/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.5/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.5',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.5
gyp ERR! pangyp -v v2.3.3
[0m[91mgyp ERR! not ok 
[0m
 ---> cd0a2f6185f6
Removing intermediate container 2c7e2ba4c311
Step 5 : ENV NODE_ENV production
 ---> Running in cc7ebc4e7bf4
 ---> 2f9f9042baf2
Removing intermediate container cc7ebc4e7bf4
Step 6 : WORKDIR /usr/src/app
 ---> Running in 80aaee9ca66c
 ---> 27175d21f0b1
Removing intermediate container 80aaee9ca66c
Step 7 : CMD npm start
 ---> Running in 6664ef512b37
 ---> 2bdbb527a020
Removing intermediate container 6664ef512b37
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in e3f4581c32af
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3219 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.kernel.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:4 http://mirrors.kernel.org/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirror.picosecond.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:6 http://mirrors.kernel.org/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:7 http://mirrors.kernel.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
Get:5 http://mirror.picosecond.org/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:9 http://mirror.picosecond.org/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2359 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18601 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> d6a73e4edb2a
Removing intermediate container e3f4581c32af
Successfully built d6a73e4edb2a

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test151`

Contents of dockerfile `/root/docker-node/.~tmp.test151/Dockerfile`:

```
FROM nodesource/sid:0.12.5
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.12.5-test1` from `/root/docker-node/.~tmp.test151`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.12.5
 ---> d6a73e4edb2a
Step 2 : ENV NODE_ENV test
 ---> Running in c0b04bde2add
 ---> 49d7ab5f3f5a
Removing intermediate container c0b04bde2add
Step 3 : RUN node -v
 ---> Running in 616c32c6fa9e
v0.12.5
 ---> 4277237a88d4
Removing intermediate container 616c32c6fa9e
Step 4 : RUN node -p "process.versions"
 ---> Running in af04c6f0bcbc
{ http_parser: '2.3',
  node: '0.12.5',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1o' }
 ---> 7a86910c918f
Removing intermediate container af04c6f0bcbc
Step 5 : RUN npm --version
 ---> Running in 4658ac5a4bdd
2.11.2
 ---> b1def233f035
Removing intermediate container 4658ac5a4bdd
Successfully built b1def233f035

```

# Tested image `nodesource/sid:0.12.10`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 6a81c40c627a
 ---> 1fb95f58de55
Removing intermediate container 6a81c40c627a
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.10-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 2df329148e3b
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Le[0m[91mft  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0 6910k    0 16086    0     0  50103      0  0:02:21 --:--:--  0:02:21 50112[0m[91m100 6910k  100 6910k    0     0  7038k      0 --:--:-- --:--:-- --:--:-- 7036k[0m[91m
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.10-1nodesource1~sid1) ...
Setting up nodejs (0.12.10-1nodesource1~sid1) ...
 ---> c691b5e69205
Removing intermediate container 2df329148e3b
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 2517e79b63bf
[91mnpm[0m[91m WARN [0m[91mdeprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@0.12.10 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.10/node-v0.12.10.tar.gz
[0m[91mgyp http 200[0m[91m http://nodejs.org/dist/v0.12.10/node-v0.12.10.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.12.10/SHASUMS256.txt
[0m[91mgyp http [0m[91m200[0m[91m http://nodejs.org/dist/v0.12.10/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp [0m[91minfo spawn args   '-f',
gyp info spawn args[0m[91m   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp[0m[91m info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.10/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp [0m[91minfo spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.10',
gyp info[0m[91m spawn args[0m[91m   '-Druntime=node',
[0m[91mgyp info spawn args[0m[91m   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
[0m[91mgyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! stack[0m[91m     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1075:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.10
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> f8d9ee24bf6c
Removing intermediate container 2517e79b63bf
Step 5 : ENV NODE_ENV production
 ---> Running in 2dde6ec60921
 ---> db69597618c2
Removing intermediate container 2dde6ec60921
Step 6 : WORKDIR /usr/src/app
 ---> Running in 852714d7791b
 ---> f0e3bb41c2d8
Removing intermediate container 852714d7791b
Step 7 : CMD npm start
 ---> Running in e360557caff8
 ---> 5114aaac513b
Removing intermediate container e360557caff8
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in f9f45f4d9776
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (3962 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (5969 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 0e4ee5dae1ca
Removing intermediate container f9f45f4d9776
Successfully built 0e4ee5dae1ca

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test147`

Contents of dockerfile `/root/docker-node/.~tmp.test147/Dockerfile`:

```
FROM nodesource/sid:0.12.10
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.12.10-test1` from `/root/docker-node/.~tmp.test147`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.12.10
 ---> 0e4ee5dae1ca
Step 2 : ENV NODE_ENV test
 ---> Running in 8651c3a94636
 ---> 68f96b87c0ff
Removing intermediate container 8651c3a94636
Step 3 : RUN node -v
 ---> Running in 48f9e8545f17
v0.12.10
 ---> 5b09d1b8a289
Removing intermediate container 48f9e8545f17
Step 4 : RUN node -p "process.versions"
 ---> Running in 7fa1a0367113
{ http_parser: '2.3',
  node: '0.12.10',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1r' }
 ---> 5ec5d61c1142
Removing intermediate container 7fa1a0367113
Step 5 : RUN npm --version
 ---> Running in d22f0ad6b2c0
2.14.9
 ---> 3e7c0510c8c9
Removing intermediate container d22f0ad6b2c0
Successfully built 3e7c0510c8c9

```

# Tested image `nodesource/sid:0.10.34`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in ef42011132f7
 ---> e0a629c35b18
Removing intermediate container ef42011132f7
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.34-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 5f65031dabfe
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 3955k  100 3955k    0     0  4648k      0 --:--:-- --:--:-- --:--:-- 4653k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.34-1nodesource1~sid1) ...
Setting up nodejs (0.10.34-1nodesource1~sid1) ...
 ---> 7b2525bee6eb
Removing intermediate container 5f65031dabfe
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 72cef0c60279
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
gyp info using node@0.10.34 | linux | x64
[0m[91mgyp http GET[0m[91m http://nodejs.org/dist/v0.10.34/node-v0.10.34.tar.gz
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v0.10.34/node-v0.10.34.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.34/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v0.10.34/SHASUMS256.txt
[0m[91mgyp[0m[91m info spawn python
[0m[91mgyp [0m[91minfo[0m[91m spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp[0m[91m info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp [0m[91minfo[0m[91m spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.34/common.gypi',
gyp info spawn args[0m[91m   '-Dlibrary=shared_library',
gyp[0m[91m info [0m[91mspawn args[0m[91m   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.34',
gyp info[0m[91m [0m[91mspawn args[0m[91m   '-Druntime=node',
[0m[91mgyp[0m[91m [0m[91minfo spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp [0m[91minfo[0m[91m spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info [0m[91mspawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! [0m[91mconfigure error 
[0m[91mgyp[0m[91m ERR![0m[91m [0m[91mstack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR![0m[91m [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp[0m[91m ERR![0m[91m System Linux 3.13.0-79-generic
[0m[91mgyp [0m[91mERR![0m[91m [0m[91mcommand "node" "/usr/bin/node-gyp" "configure"
gyp ERR! [0m[91mcwd /
[0m[91mgyp ERR! node -v v0.10.34
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 65f59178bcfe
Removing intermediate container 72cef0c60279
Step 5 : ENV NODE_ENV production
 ---> Running in 6aa768dcf5c3
 ---> 2901da82b58e
Removing intermediate container 6aa768dcf5c3
Step 6 : WORKDIR /usr/src/app
 ---> Running in e165bb08d506
 ---> 090a7956da62
Removing intermediate container e165bb08d506
Step 7 : CMD npm start
 ---> Running in 42509a2f0509
 ---> 537f4fdbb613
Removing intermediate container 42509a2f0509
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 4d48c9a440fd
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3429 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.kernel.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.kernel.org/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:2 http://mirror.picosecond.org/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:6 http://mirrors.kernel.org/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.kernel.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:11 http://mirrors.kernel.org/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.kernel.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.kernel.org/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
Get:3 http://mirror.picosecond.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:9 http://mirror.picosecond.org/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirror.picosecond.org/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (1566 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17882 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 216a9e2cda06
Removing intermediate container 4d48c9a440fd
Successfully built 216a9e2cda06

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test138`

Contents of dockerfile `/root/docker-node/.~tmp.test138/Dockerfile`:

```
FROM nodesource/sid:0.10.34
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.10.34-test1` from `/root/docker-node/.~tmp.test138`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.10.34
 ---> 216a9e2cda06
Step 2 : ENV NODE_ENV test
 ---> Running in 277ff34b67da
 ---> 148f1a1fe1b5
Removing intermediate container 277ff34b67da
Step 3 : RUN node -v
 ---> Running in 9161c3c1d0bd
v0.10.34
 ---> 08d4b1ae7daa
Removing intermediate container 9161c3c1d0bd
Step 4 : RUN node -p "process.versions"
 ---> Running in 4e714b26e684
{ http_parser: '1.0',
  node: '0.10.34',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.30',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1j' }
 ---> a04f20da59ad
Removing intermediate container 4e714b26e684
Step 5 : RUN npm --version
 ---> Running in d4e83ed3e444
1.4.28
 ---> b053b64b8abf
Removing intermediate container d4e83ed3e444
Successfully built b053b64b8abf

```

# Tested image `nodesource/sid:iojs-3.1.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in e9b88354578f
 ---> 8eedd411cef0
Removing intermediate container e9b88354578f
Step 3 : RUN curl https://deb.nodesource.com/iojs_3.x/pool/main/i/iojs/iojs_3.1.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in a456b5af22f6
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 88 6161k   88 5423k    0     0  6821k      0 --:--:-- --:--:-- --:--:-- 6822k[0m[91m100 6161k  100 6161k    0     0  7283k      0 --:--:-- --:--:-- --:--:-- 7282k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (3.1.0-1nodesource1~sid1) ...
Setting up iojs (3.1.0-1nodesource1~sid1) ...
 ---> 33355c5946d5
Removing intermediate container a456b5af22f6
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 690d3f8e5af9
[91mnpm [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, tunnel-agent@0.4.2, oauth-sign@0.5.0, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m info [0m[91mit worked if it ends with ok
[0m[91mgyp [0m[91minfo [0m[91musing pangyp@2.3.3
gyp info using node@3.1.0 | linux | x64
[0m[91mgyp http GET https://iojs.org/dist/v3.1.0/iojs-v3.1.0.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v3.1.0/iojs-v3.1.0.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v3.1.0/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v3.1.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp [0m[91minfo spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/3.1.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/3.1.0',
gyp info[0m[91m spawn args[0m[91m   '-Druntime=iojs',
gyp info[0m[91m [0m[91mspawn args   '-Dmodule_root_dir=/',
[0m[91mgyp info spawn args   '--depth=.',
gyp [0m[91minfo spawn args   '--no-parallel',
[0m[91mgyp info[0m[91m spawn args[0m[91m   '--generator-output',
[0m[91mgyp info spawn args   'build',
gyp info[0m[91m [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
[0m[91mgyp ERR![0m[91m stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
[0m[91mgyp ERR! [0m[91mnode -v v3.1.0
[0m[91mgyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> ae5d41b7f472
Removing intermediate container 690d3f8e5af9
Step 5 : ENV NODE_ENV production
 ---> Running in ac251c8ad178
 ---> 870516c3fc56
Removing intermediate container ac251c8ad178
Step 6 : WORKDIR /usr/src/app
 ---> Running in 4476c51d99bb
 ---> 1f5fca8e504d
Removing intermediate container 4476c51d99bb
Step 7 : CMD npm start
 ---> Running in 0046f027592e
 ---> 49919a78e0f8
Removing intermediate container 0046f027592e
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in d320b3caeae1
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (5127 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2825 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 43feed2f57ef
Removing intermediate container d320b3caeae1
Successfully built 43feed2f57ef

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test180`

Contents of dockerfile `/root/docker-node/.~tmp.test180/Dockerfile`:

```
FROM nodesource/sid:iojs-3.1.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-3.1.0-test1` from `/root/docker-node/.~tmp.test180`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-3.1.0
 ---> 43feed2f57ef
Step 2 : ENV NODE_ENV test
 ---> Running in ecc27ea758e8
 ---> 53487c1d6159
Removing intermediate container ecc27ea758e8
Step 3 : RUN node -v
 ---> Running in 770b4ef7caec
v3.1.0
 ---> 01f27cf7d9b1
Removing intermediate container 770b4ef7caec
Step 4 : RUN node -p "process.versions"
 ---> Running in afe3e93f2fce
{ http_parser: '2.5.0',
  node: '3.1.0',
  v8: '4.4.63.26',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '45',
  openssl: '1.0.2d' }
 ---> 23ba55add66b
Removing intermediate container afe3e93f2fce
Step 5 : RUN npm --version
 ---> Running in 1c571941df31
2.13.3
 ---> a38f3db18b63
Removing intermediate container 1c571941df31
Successfully built a38f3db18b63

```

# Tested image `nodesource/sid:0.12.4`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 448536d69b68
 ---> f9d331fb91f6
Removing intermediate container 448536d69b68
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.4-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in f58b6d516fc3
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 44 5195k   44 2303k    0     0  3600k      0  0:00:01 --:--:--  0:00:01 3599k[0m[91m100 5195k  100 5195k    0     0  6184k      0 --:--:-- --:--:-- --:--:-- 6178k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.4-1nodesource1~sid1) ...
Setting up nodejs (0.12.4-1nodesource1~sid1) ...
 ---> 0840a9beeb36
Removing intermediate container f58b6d516fc3
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in a49de6c66571
[91mnpm[0m[91m WARN[0m[91m [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, oauth-sign@0.5.0, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo[0m[91m [0m[91musing pangyp@2.3.3
gyp[0m[91m info[0m[91m [0m[91musing node@0.12.4 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.4/node-v0.12.4.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.4/node-v0.12.4.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.4/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.4/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp[0m[91m info [0m[91mspawn args[0m[91m   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.4/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.4',
gyp info[0m[91m spawn args[0m[91m   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
[0m[91mgyp[0m[91m info spawn args   '--depth=.',
gyp info spawn args[0m[91m   '--no-parallel',
[0m[91mgyp[0m[91m info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! [0m[91mconfigure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp[0m[91m [0m[91mERR! [0m[91mstack     at ChildProcess.emit (events.js:110:17)
[0m[91mgyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
[0m[91mgyp ERR! [0m[91mSystem Linux 3.13.0-79-generic
[0m[91mgyp ERR! [0m[91mcommand "node" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp ERR! node -v v0.12.4
gyp ERR! [0m[91mpangyp -v v2.3.3
[0m[91mgyp ERR! not ok 
[0m
 ---> 6585d3b5d806
Removing intermediate container a49de6c66571
Step 5 : ENV NODE_ENV production
 ---> Running in d2d3cbf86e6d
 ---> 357ddbaf50ad
Removing intermediate container d2d3cbf86e6d
Step 6 : WORKDIR /usr/src/app
 ---> Running in 7d3343865672
 ---> 7ea7271b3d5f
Removing intermediate container 7d3343865672
Step 7 : CMD npm start
 ---> Running in 920a18deaba3
 ---> db56632e7c36
Removing intermediate container 920a18deaba3
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 82d3e5e4d4f3
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3440 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2801 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18594 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18594 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18594 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18594 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18594 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18594 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18594 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18594 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18594 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18594 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18594 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18594 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18594 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> f5244b5216c8
Removing intermediate container 82d3e5e4d4f3
Successfully built f5244b5216c8

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test150`

Contents of dockerfile `/root/docker-node/.~tmp.test150/Dockerfile`:

```
FROM nodesource/sid:0.12.4
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.12.4-test1` from `/root/docker-node/.~tmp.test150`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.12.4
 ---> f5244b5216c8
Step 2 : ENV NODE_ENV test
 ---> Running in 9ac808f8d910
 ---> 2936e41ee1c8
Removing intermediate container 9ac808f8d910
Step 3 : RUN node -v
 ---> Running in 96edab24af69
v0.12.4
 ---> ad221853806c
Removing intermediate container 96edab24af69
Step 4 : RUN node -p "process.versions"
 ---> Running in a1108d00daeb
{ http_parser: '2.3',
  node: '0.12.4',
  v8: '3.28.71.19',
  uv: '1.5.0',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1m' }
 ---> 9a6d93b11fbe
Removing intermediate container a1108d00daeb
Step 5 : RUN npm --version
 ---> Running in 18f1484661f0
2.10.1
 ---> 916e4e087ad3
Removing intermediate container 18f1484661f0
Successfully built 916e4e087ad3

```

# Tested image `nodesource/sid:0.12.8`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 658c38189942
 ---> 7b6199a09668
Removing intermediate container 658c38189942
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.8-2nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in ea89f4e0e8af
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 7063k  100 7063k    0     0  6440k      0  0:00:01  0:00:01 --:--:-- 6445k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.8-2nodesource1~sid1) ...
Setting up nodejs (0.12.8-2nodesource1~sid1) ...
 ---> 748184e2ca07
Removing intermediate container ea89f4e0e8af
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 885734c6068c
[91mnpm[0m[91m [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated[0m[91m graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
gyp info using node@0.12.8 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.8/node-v0.12.8.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.8/node-v0.12.8.tar.gz
[0m[91mgyp http [0m[91mGET http://nodejs.org/dist/v0.12.8/SHASUMS256.txt
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v0.12.8/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.8/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.8',
gyp info spawn args   '-Druntime=node',
[0m[91mgyp info [0m[91mspawn args   '-Dmodule_root_dir=/',
gyp[0m[91m info[0m[91m [0m[91mspawn args[0m[91m   '--depth=.',
[0m[91mgyp[0m[91m [0m[91minfo[0m[91m [0m[91mspawn args   '--no-parallel',
gyp info [0m[91mspawn args[0m[91m   '--generator-output',
[0m[91mgyp[0m[91m info[0m[91m [0m[91mspawn args   'build',
gyp [0m[91minfo [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR![0m[91m configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
[0m[91mgyp [0m[91mERR![0m[91m [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp[0m[91m ERR! [0m[91mstack     at ChildProcess.emit (events.js:110:17)
gyp [0m[91mERR! stack[0m[91m     at Process.ChildProcess._handle.onexit (child_process.js:1075:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp [0m[91mERR! node -v v0.12.8
[0m[91mgyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 4a216ce8c416
Removing intermediate container 885734c6068c
Step 5 : ENV NODE_ENV production
 ---> Running in 63652875e0fc
 ---> 611df48267d7
Removing intermediate container 63652875e0fc
Step 6 : WORKDIR /usr/src/app
 ---> Running in 2af48c5bf845
 ---> c23923c86b84
Removing intermediate container 2af48c5bf845
Step 7 : CMD npm start
 ---> Running in a9e232307b9f
 ---> 43a50e4ea2b7
Removing intermediate container a9e232307b9f
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 7a5afc602671
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3206 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (4952 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18765 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 5367fa83c414
Removing intermediate container 7a5afc602671
Successfully built 5367fa83c414

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test154`

Contents of dockerfile `/root/docker-node/.~tmp.test154/Dockerfile`:

```
FROM nodesource/sid:0.12.8
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.12.8-test1` from `/root/docker-node/.~tmp.test154`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.12.8
 ---> 5367fa83c414
Step 2 : ENV NODE_ENV test
 ---> Running in 8a0501705f33
 ---> 9b0a992dfd67
Removing intermediate container 8a0501705f33
Step 3 : RUN node -v
 ---> Running in 4fc575b81ddf
v0.12.8
 ---> 682addd94565
Removing intermediate container 4fc575b81ddf
Step 4 : RUN node -p "process.versions"
 ---> Running in 7a7200dfb9f7
{ http_parser: '2.3',
  node: '0.12.8',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1p' }
 ---> 8d699be8cbf3
Removing intermediate container 7a7200dfb9f7
Step 5 : RUN npm --version
 ---> Running in 697a445f8134
2.14.9
 ---> 5c94dd810817
Removing intermediate container 697a445f8134
Successfully built 5c94dd810817

```

# Tested image `nodesource/sid:0.12.7`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 1224801b6fb5
 ---> b12e8f484aa3
Removing intermediate container 1224801b6fb5
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.7-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in d87cfdf87365
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5284k  100 5284k    0     0  5774k      0 --:--:-- --:--:-- --:--:-- 5775k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.7-1nodesource1~sid1) ...
Setting up nodejs (0.12.7-1nodesource1~sid1) ...
 ---> ac111351a1e7
Removing intermediate container d87cfdf87365
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 853ace1f6e69
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated[0m[91m graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@0.12.7 | linux | x64
[0m[91mgyp [0m[91mhttp GET http://nodejs.org/dist/v0.12.7/node-v0.12.7.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.7/node-v0.12.7.tar.gz
[0m[91mgyp[0m[91m http [0m[91mGET[0m[91m http://nodejs.org/dist/v0.12.7/SHASUMS256.txt
[0m[91mgyp http 200[0m[91m http://nodejs.org/dist/v0.12.7/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info[0m[91m spawn args[0m[91m   'binding.gyp',
[0m[91mgyp info spawn args   '-f',
gyp info [0m[91mspawn args   'make',
gyp [0m[91minfo spawn args[0m[91m   '-I',
[0m[91mgyp info spawn args[0m[91m   '/build/config.gypi',
[0m[91mgyp [0m[91minfo spawn args   '-I',
gyp info [0m[91mspawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp [0m[91minfo spawn args   '-I',
[0m[91mgyp[0m[91m info[0m[91m spawn args   '/root/.node-gyp/0.12.7/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp [0m[91minfo [0m[91mspawn args   '-Dvisibility=default',
[0m[91mgyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.7',
gyp info spawn args[0m[91m   '-Druntime=node',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
gyp info [0m[91mspawn args[0m[91m   '--depth=.',
[0m[91mgyp [0m[91minfo [0m[91mspawn args[0m[91m   '--no-parallel',
gyp[0m[91m info spawn args   '--generator-output',
[0m[91mgyp info[0m[91m [0m[91mspawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp[0m[91m ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.7
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> a28bbbda49aa
Removing intermediate container 853ace1f6e69
Step 5 : ENV NODE_ENV production
 ---> Running in 923ce18f9c2c
 ---> 65362a3c800e
Removing intermediate container 923ce18f9c2c
Step 6 : WORKDIR /usr/src/app
 ---> Running in 1c218781b955
 ---> 15e60f43272a
Removing intermediate container 1c218781b955
Step 7 : CMD npm start
 ---> Running in a004c2087c06
 ---> b173b7536694
Removing intermediate container a004c2087c06
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 02f40c2e0fa0
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 4s (2669 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2700 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18621 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18621 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18621 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18621 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18621 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18621 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18621 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18621 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18621 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18621 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18621 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18621 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18621 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 8a18da7cec59
Removing intermediate container 02f40c2e0fa0
Successfully built 8a18da7cec59

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test153`

Contents of dockerfile `/root/docker-node/.~tmp.test153/Dockerfile`:

```
FROM nodesource/sid:0.12.7
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.12.7-test1` from `/root/docker-node/.~tmp.test153`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.12.7
 ---> 8a18da7cec59
Step 2 : ENV NODE_ENV test
 ---> Running in 65f392536d0c
 ---> c3c9f9b679f0
Removing intermediate container 65f392536d0c
Step 3 : RUN node -v
 ---> Running in 8ad72187d1ea
v0.12.7
 ---> 3d2305835025
Removing intermediate container 8ad72187d1ea
Step 4 : RUN node -p "process.versions"
 ---> Running in a581f1c238c9
{ http_parser: '2.3',
  node: '0.12.7',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1p' }
 ---> f10ced29772b
Removing intermediate container a581f1c238c9
Step 5 : RUN npm --version
 ---> Running in da0a18f4722c
2.11.3
 ---> 2887f5641970
Removing intermediate container da0a18f4722c
Successfully built 2887f5641970

```

# Tested image `nodesource/sid:0.10.30`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 9fe782e58a4f
 ---> 5c877e9898b9
Removing intermediate container 9fe782e58a4f
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.30-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in a07ad10dd1a5
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 3992k  100 3992k    0     0  4857k      0 --:--:-- --:--:-- --:--:-- 4856k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.10.30-1nodesource1~sid1) ...
Setting up nodejs (0.10.30-1nodesource1~sid1) ...
 ---> 8c82b7da5a46
Removing intermediate container a07ad10dd1a5
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 61ea4471c596
[91mnpm[0m[91m [0m[91mWARN [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (block-stream@0.0.8, inherits@2.0.1)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with ok
[0m[91mgyp[0m[91m [0m[91minfo using pangyp@2.3.3
gyp info using node@0.10.30 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.30/node-v0.10.30.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.30/node-v0.10.30.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp GET http://nodejs.org/dist/v0.10.30/SHASUMS256.txt
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v0.10.30/SHASUMS256.txt
[0m[91mgyp[0m[91m [0m[91minfo[0m[91m [0m[91mspawn python
[0m[91mgyp[0m[91m info[0m[91m [0m[91mspawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
[0m[91mgyp info spawn args   'make',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.10.30/common.gypi',
gyp info [0m[91mspawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp[0m[91m info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.30',
gyp[0m[91m info[0m[91m spawn args[0m[91m   '-Druntime=node',
[0m[91mgyp info spawn args[0m[91m   '-Dmodule_root_dir=/',
[0m[91mgyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR![0m[91m stack Error: `gyp` failed with exit code: 1
gyp ERR![0m[91m stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! stack     at ChildProcess.emit (events.js:98:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:810:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.10.30
[0m[91mgyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 6b0e126f2f0c
Removing intermediate container 61ea4471c596
Step 5 : ENV NODE_ENV production
 ---> Running in af4781792c98
 ---> 72014b93250c
Removing intermediate container af4781792c98
Step 6 : WORKDIR /usr/src/app
 ---> Running in 087d137bc888
 ---> 5fbb7ae958ab
Removing intermediate container 087d137bc888
Step 7 : CMD npm start
 ---> Running in 0063ddb7d65a
 ---> cee75ff999e1
Removing intermediate container 0063ddb7d65a
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 4ff303167fc9
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (2822 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:5 http://mirror.picosecond.org/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:8 http://mirrors.kernel.org/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:12 http://mirrors.kernel.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:7 http://mirror.picosecond.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:9 http://mirror.picosecond.org/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirror.picosecond.org/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirror.picosecond.org/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:13 http://mirror.picosecond.org/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2436 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17776 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17776 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17776 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17776 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17776 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17776 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17776 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17776 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17776 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17776 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17776 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17776 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 17776 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 0ed107991e69
Removing intermediate container 4ff303167fc9
Successfully built 0ed107991e69

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test134`

Contents of dockerfile `/root/docker-node/.~tmp.test134/Dockerfile`:

```
FROM nodesource/sid:0.10.30
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.10.30-test1` from `/root/docker-node/.~tmp.test134`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.10.30
 ---> 0ed107991e69
Step 2 : ENV NODE_ENV test
 ---> Running in 1e42cd1b1760
 ---> 688e4f8e3229
Removing intermediate container 1e42cd1b1760
Step 3 : RUN node -v
 ---> Running in 918041e42656
v0.10.30
 ---> 6e4060db154b
Removing intermediate container 918041e42656
Step 4 : RUN node -p "process.versions"
 ---> Running in cd441b7ff059
{ http_parser: '1.0',
  node: '0.10.30',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.28',
  zlib: '1.2.3',
  modules: '11',
  openssl: '1.0.1h' }
 ---> b4dfeafb922d
Removing intermediate container cd441b7ff059
Step 5 : RUN npm --version
 ---> Running in c6bfab402dbb
1.4.21
 ---> 48f7e4b2ed8d
Removing intermediate container c6bfab402dbb
Successfully built 48f7e4b2ed8d

```

# Tested image `nodesource/sid:0.12.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in b6c346e4a4d0
 ---> d9ce3a15aa07
Removing intermediate container b6c346e4a4d0
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 7a3700388265
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  3 4999k    3  191k   [0m[91m 0     0   474k      0  0:00:10 --:--:--  0:00:10  474k[0m[91m100 4999k  100 4999k    0     0  6020k      0 --:--:-- --:--:-- --:--:-- 6015k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.0-1nodesource1~sid1) ...
Setting up nodejs (0.12.0-1nodesource1~sid1) ...
 ---> a693b55edcb4
Removing intermediate container 7a3700388265
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 008db3c8b0ee
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp [0m[91minfo [0m[91musing pangyp@2.3.3
gyp info using node@0.12.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.0/node-v0.12.0.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.0/node-v0.12.0.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.0/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info[0m[91m spawn args[0m[91m   'binding.gyp',
[0m[91mgyp info spawn args   '-f',
[0m[91mgyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! [0m[91mstack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! stack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1067:12)
[0m[91mgyp [0m[91mERR![0m[91m [0m[91mSystem[0m[91m Linux 3.13.0-79-generic
gyp [0m[91mERR! [0m[91mcommand "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> aa8a6231c299
Removing intermediate container 008db3c8b0ee
Step 5 : ENV NODE_ENV production
 ---> Running in c6906529aa90
 ---> 36435e6a45d4
Removing intermediate container c6906529aa90
Step 6 : WORKDIR /usr/src/app
 ---> Running in c49e2c3ffd2e
 ---> ffa7b8ff09bc
Removing intermediate container c49e2c3ffd2e
Step 7 : CMD npm start
 ---> Running in ba8c0fb851c5
 ---> d1697ecf8725
Removing intermediate container ba8c0fb851c5
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 09b4c922f891
Get:1 http://mirrors.kernel.org/debian sid InRelease [287 kB]
Get:2 http://mirror.picosecond.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 8s (1342 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirror.picosecond.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:9 http://mirror.picosecond.org/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:3 http://mirrors.kernel.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:10 http://mirror.picosecond.org/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:4 http://mirrors.kernel.org/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.kernel.org/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.kernel.org/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.kernel.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.kernel.org/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:11 http://mirrors.kernel.org/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirror.picosecond.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.kernel.org/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (3692 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18183 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18183 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18183 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18183 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18183 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18183 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18183 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18183 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18183 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18183 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18183 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18183 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18183 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: [0m[91m--force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 887ffa994cc5
Removing intermediate container 09b4c922f891
Successfully built 887ffa994cc5

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test146`

Contents of dockerfile `/root/docker-node/.~tmp.test146/Dockerfile`:

```
FROM nodesource/sid:0.12.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.12.0-test1` from `/root/docker-node/.~tmp.test146`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.12.0
 ---> 887ffa994cc5
Step 2 : ENV NODE_ENV test
 ---> Running in 43bdb59892c3
 ---> 061993e2c802
Removing intermediate container 43bdb59892c3
Step 3 : RUN node -v
 ---> Running in c74a44bdf9d7
v0.12.0
 ---> a930c2a3ed31
Removing intermediate container c74a44bdf9d7
Step 4 : RUN node -p "process.versions"
 ---> Running in 30c7d1ca7d00
{ http_parser: '2.3',
  node: '0.12.0',
  v8: '3.28.73',
  uv: '1.0.2',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1l' }
 ---> 55cbe4749085
Removing intermediate container 30c7d1ca7d00
Step 5 : RUN npm --version
 ---> Running in 2770e4865cdb
2.5.1
 ---> 91b397a154d9
Removing intermediate container 2770e4865cdb
Successfully built 91b397a154d9

```

# Tested image `nodesource/sid:5.4.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in df7c644b1e08
 ---> fd7647121200
Removing intermediate container df7c644b1e08
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.4.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in a079b77f1aa1
[91m  % Total    % Received % Xferd  Ave[0m[91mrage Speed   Time   [0m[91m Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 35 8502k   35 3007k    0     0  2434k      0  0:00:03  0:00:01  0:00:02 2433k[0m[91m100 8502k  100 8502k    0     0  5438k      0  0:00:01  0:00:01 --:--:-- 5436k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.4.0-1nodesource1~sid1) ...
Setting up nodejs (5.4.0-1nodesource1~sid1) ...
 ---> b17abe215db6
Removing intermediate container a079b77f1aa1
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 428aa2432805
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info[0m[91m using pangyp@2.3.3
gyp info using node@5.4.0 | linux | x64
[0m[91mgyp[0m[91m http [0m[91mGET http://nodejs.org/dist/v5.4.0/node-v5.4.0.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v5.4.0/node-v5.4.0.tar.gz
[0m[91mgyp[0m[91m http[0m[91m [0m[91mGET http://nodejs.org/dist/v5.4.0/SHASUMS256.txt
[0m[91mgyp http 200[0m[91m http://nodejs.org/dist/v5.4.0/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info [0m[91mspawn args   '-f',
[0m[91mgyp [0m[91minfo spawn args   'make',
gyp info spawn args   '-I',
gyp info [0m[91mspawn args   '/build/config.gypi',
[0m[91mgyp info spawn args[0m[91m   '-I',
[0m[91mgyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args[0m[91m   '-I',
gyp[0m[91m info spawn args   '/root/.node-gyp/5.4.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.4.0',
gyp info spawn args   '-Druntime=node',
[0m[91mgyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
[0m[91mgyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
[0m[91mgyp[0m[91m info spawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
[0m[91mgyp ERR! [0m[91mstack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! [0m[91mstack[0m[91m     at emitTwo (events.js:87:13)
gyp[0m[91m [0m[91mERR![0m[91m stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp [0m[91mERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.4.0
gyp ERR! [0m[91mpangyp -v[0m[91m v2.3.3
[0m[91mgyp [0m[91mERR![0m[91m not ok 
[0m
 ---> d94952194a6d
Removing intermediate container 428aa2432805
Step 5 : ENV NODE_ENV production
 ---> Running in cce40ed77be8
 ---> 10f7e87558d6
Removing intermediate container cce40ed77be8
Step 6 : WORKDIR /usr/src/app
 ---> Running in d6553508784b
 ---> 04f463dd41eb
Removing intermediate container d6553508784b
Step 7 : CMD npm start
 ---> Running in 02a4bbd8f463
 ---> a8332bb58968
Removing intermediate container 02a4bbd8f463
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in d35c3bd81818
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (2908 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2723 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> b981cb290198
Removing intermediate container d35c3bd81818
Successfully built b981cb290198

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test165`

Contents of dockerfile `/root/docker-node/.~tmp.test165/Dockerfile`:

```
FROM nodesource/sid:5.4.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:5.4.0-test1` from `/root/docker-node/.~tmp.test165`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:5.4.0
 ---> b981cb290198
Step 2 : ENV NODE_ENV test
 ---> Running in 3d60333d5e93
 ---> 8e0eb298e9ba
Removing intermediate container 3d60333d5e93
Step 3 : RUN node -v
 ---> Running in 3a4430b93a0c
v5.4.0
 ---> 59085e4b47d8
Removing intermediate container 3a4430b93a0c
Step 4 : RUN node -p "process.versions"
 ---> Running in 4d9416d68fbc
{ http_parser: '2.6.0',
  node: '5.4.0',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> f32bedd75832
Removing intermediate container 4d9416d68fbc
Step 5 : RUN npm --version
 ---> Running in f48b7c1814c8
3.3.12
 ---> 1e7d8bceabda
Removing intermediate container f48b7c1814c8
Successfully built 1e7d8bceabda

```

# Tested image `nodesource/sid:5.2.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in b8e1644b2d2c
 ---> 2243710c4b33
Removing intermediate container b8e1644b2d2c
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.2.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 4b08ca2370fb
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 8467k  100 8467k    0     0  7827k      0  0:00:01  0:00:01 --:--:-- 7833k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.2.0-1nodesource1~sid1) ...
Setting up nodejs (5.2.0-1nodesource1~sid1) ...
 ---> 5045299151dd
Removing intermediate container 4b08ca2370fb
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in edb14fa6493c
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp info [0m[91musing[0m[91m pangyp@2.3.3
[0m[91mgyp info [0m[91musing node@5.2.0 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v5.2.0/node-v5.2.0.tar.gz
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v5.2.0/node-v5.2.0.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v5.2.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v5.2.0/SHASUMS256.txt
[0m[91mgyp [0m[91minfo spawn[0m[91m python
[0m[91mgyp[0m[91m info spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp [0m[91minfo[0m[91m spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.2.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.2.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp[0m[91m [0m[91minfo spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:88:13)
gyp ERR! stack     at ChildProcess.emit (events.js:173:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:201:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp ERR! node -v v5.2.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> c2c629134e4f
Removing intermediate container edb14fa6493c
Step 5 : ENV NODE_ENV production
 ---> Running in 7d98dfa8e535
 ---> 83051c10c141
Removing intermediate container 7d98dfa8e535
Step 6 : WORKDIR /usr/src/app
 ---> Running in d3e7bc0b659a
 ---> 1f73f61e40fb
Removing intermediate container d3e7bc0b659a
Step 7 : CMD npm start
 ---> Running in 60d599bb08c1
 ---> 63ac94f3c01d
Removing intermediate container 60d599bb08c1
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 6374b4804683
Get:1 http://mirrors.kernel.org/debian sid InRelease [287 kB]
Get:2 http://mirror.picosecond.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 13s (800 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirror.picosecond.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirror.picosecond.org/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:9 http://mirrors.kernel.org/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.kernel.org/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:4 http://mirror.picosecond.org/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:13 http://mirrors.kernel.org/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:5 http://mirror.picosecond.org/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirror.picosecond.org/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:11 http://mirror.picosecond.org/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (2963 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18934 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18934 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18934 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18934 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18934 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18934 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18934 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18934 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18934 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18934 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18934 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18934 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18934 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> d1aa9e87d4a9
Removing intermediate container 6374b4804683
Successfully built d1aa9e87d4a9

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test129`

Contents of dockerfile `/root/docker-node/.~tmp.test129/Dockerfile`:

```
FROM nodesource/sid:5.2.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:5.2.0-test1` from `/root/docker-node/.~tmp.test129`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:5.2.0
 ---> d1aa9e87d4a9
Step 2 : ENV NODE_ENV test
 ---> Running in 7a97794986dc
 ---> d339d6abaf6a
Removing intermediate container 7a97794986dc
Step 3 : RUN node -v
 ---> Running in 55f4c3c94976
v5.2.0
 ---> def1f2a5bb17
Removing intermediate container 55f4c3c94976
Step 4 : RUN node -p "process.versions"
 ---> Running in 9d3497651ed5
{ http_parser: '2.6.0',
  node: '5.2.0',
  v8: '4.6.85.31',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> d4b098fe167e
Removing intermediate container 9d3497651ed5
Step 5 : RUN npm --version
 ---> Running in c98b7aeead81
3.3.12
 ---> 2c87ef9a74b9
Removing intermediate container c98b7aeead81
Successfully built 2c87ef9a74b9

```

# Tested image `nodesource/sid:iojs-2.5.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 999d27921a31
 ---> 5192f9296146
Removing intermediate container 999d27921a31
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.5.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 331d1755d41c
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 82 6052k   82 5023k    0     0  5695k      0  0:00:01 --:--:--  0:00:01 5695k[0m[91m100 6052k  100 6052k    0     0  6407k      0 --:--:-- --:--:-- --:--:-- 6405k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.5.0-1nodesource1~sid1) ...
Setting up iojs (2.5.0-1nodesource1~sid1) ...
 ---> 394f3223a7f4
Removing intermediate container 331d1755d41c
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 58cb2d240092
[91mnpm[0m[91m [0m[91mWARN [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp[0m[91m [0m[91minfo using pangyp@2.3.3
gyp info using node@2.5.0 | linux | x64
[0m[91mgyp[0m[91m http[0m[91m GET https://iojs.org/dist/v2.5.0/iojs-v2.5.0.tar.gz
[0m[91mgyp [0m[91mhttp [0m[91m200 https://iojs.org/dist/v2.5.0/iojs-v2.5.0.tar.gz
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v2.5.0/SHASUMS256.txt
[0m[91mgyp http 200[0m[91m https://iojs.org/dist/v2.5.0/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/2.5.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args[0m[91m   '-Dvisibility=default',
gyp [0m[91minfo spawn args   '-Dnode_root_dir=/root/.node-gyp/2.5.0',
gyp info spawn args   '-Druntime=iojs',
gyp[0m[91m info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp [0m[91minfo[0m[91m spawn args   '--no-parallel',
gyp info spawn args[0m[91m   '--generator-output',
gyp info[0m[91m [0m[91mspawn args   'build',
[0m[91mgyp [0m[91minfo spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp [0m[91mERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR![0m[91m [0m[91mstack     at emitTwo (events.js:87:13)
gyp[0m[91m ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp [0m[91mERR! [0m[91mstack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System[0m[91m Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v2.5.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 497b622333e9
Removing intermediate container 58cb2d240092
Step 5 : ENV NODE_ENV production
 ---> Running in 072ece8e2298
 ---> 3e92ff2f4784
Removing intermediate container 072ece8e2298
Step 6 : WORKDIR /usr/src/app
 ---> Running in 2322b9b27179
 ---> 7a8e8b69c78b
Removing intermediate container 2322b9b27179
Step 7 : CMD npm start
 ---> Running in b5f5c7713c6e
 ---> 8cac8ba58175
Removing intermediate container b5f5c7713c6e
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 419449924c10
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (2862 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (3627 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18750 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18750 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18750 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18750 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18750 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18750 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18750 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18750 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18750 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18750 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18750 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18750 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18750 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 197d0322f7db
Removing intermediate container 419449924c10
Successfully built 197d0322f7db

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test167`

Contents of dockerfile `/root/docker-node/.~tmp.test167/Dockerfile`:

```
FROM nodesource/sid:iojs-2.5.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-2.5.0-test1` from `/root/docker-node/.~tmp.test167`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-2.5.0
 ---> 197d0322f7db
Step 2 : ENV NODE_ENV test
 ---> Running in d923d7322425
 ---> adbe918130f2
Removing intermediate container d923d7322425
Step 3 : RUN node -v
 ---> Running in e665ecfb0fb9
v2.5.0
 ---> 0a405c18bcaa
Removing intermediate container e665ecfb0fb9
Step 4 : RUN node -p "process.versions"
 ---> Running in 4e12a2554320
{ http_parser: '2.5.0',
  node: '2.5.0',
  v8: '4.2.77.21',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2d' }
 ---> d8008e729fac
Removing intermediate container 4e12a2554320
Step 5 : RUN npm --version
 ---> Running in 4a46bf58a672
2.13.2
 ---> a7bee122b91d
Removing intermediate container 4a46bf58a672
Successfully built a7bee122b91d

```

# Tested image `nodesource/sid:4.1.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 71828813511c
 ---> be20b95bbef6
Removing intermediate container 71828813511c
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.1.1-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 004433d9560d
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 24 6441k   24 1567k    0     0  1860k      0  0:00:03 --:--:--  0:00:03 1859k[0m[91m100 6441k  100 6441k [0m[91m   0     0  5072k      0  0:0[0m[91m0:01  0:0[0m[91m0:01 --:[0m[91m--:-- [0m[91m5076[0m[91mk
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.1.1-1nodesource1~sid1) ...
Setting up nodejs (4.1.1-1nodesource1~sid1) ...
 ---> 506d4081735a
Removing intermediate container 004433d9560d
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 818cd7536966
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, hawk@1.1.1, bl@0.9.5, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@4.1.1 | linux | x64
[0m[91mgyp[0m[91m http GET[0m[91m http://nodejs.org/dist/v4.1.1/node-v4.1.1.tar.gz
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v4.1.1/node-v4.1.1.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp GET http://nodejs.org/dist/v4.1.1/SHASUMS256.txt
[0m[91mgyp http 200[0m[91m http://nodejs.org/dist/v4.1.1/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info spawn args   'binding.gyp',
[0m[91mgyp[0m[91m info [0m[91mspawn args   '-f',
[0m[91mgyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.1.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.1.1',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info [0m[91mspawn args   '--no-parallel',
gyp info[0m[91m spawn args   '--generator-output',
[0m[91mgyp [0m[91minfo[0m[91m [0m[91mspawn args   'build',
[0m[91mgyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.1.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> b9fb0fe7d8f6
Removing intermediate container 818cd7536966
Step 5 : ENV NODE_ENV production
 ---> Running in 3c2148d3db29
 ---> f03fcce37cf8
Removing intermediate container 3c2148d3db29
Step 6 : WORKDIR /usr/src/app
 ---> Running in e43dd384a597
 ---> 0a472aa8d790
Removing intermediate container e43dd384a597
Step 7 : CMD npm start
 ---> Running in 10f71c8d7b85
 ---> d4751804c812
Removing intermediate container 10f71c8d7b85
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in ef798df89130
Get:1 http://mirrors.kernel.org/debian sid InRelease [287 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4363 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.kernel.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:5 http://mirror.picosecond.org/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:3 http://mirrors.kernel.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:4 http://mirrors.kernel.org/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:12 http://mirrors.kernel.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:7 http://mirror.picosecond.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirror.picosecond.org/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirror.picosecond.org/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirror.picosecond.org/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:13 http://mirror.picosecond.org/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2260 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 68bd6d87803b
Removing intermediate container ef798df89130
Successfully built 68bd6d87803b

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test156`

Contents of dockerfile `/root/docker-node/.~tmp.test156/Dockerfile`:

```
FROM nodesource/sid:4.1.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:4.1.1-test1` from `/root/docker-node/.~tmp.test156`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:4.1.1
 ---> 68bd6d87803b
Step 2 : ENV NODE_ENV test
 ---> Running in 7dc01fb45667
 ---> bec78f6d15df
Removing intermediate container 7dc01fb45667
Step 3 : RUN node -v
 ---> Running in 54bbeb629929
v4.1.1
 ---> b61f4018af4f
Removing intermediate container 54bbeb629929
Step 4 : RUN node -p "process.versions"
 ---> Running in fd0fc28ffaa6
{ http_parser: '2.5.0',
  node: '4.1.1',
  v8: '4.5.103.33',
  uv: '1.7.4',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '46',
  openssl: '1.0.2d' }
 ---> a8684a366083
Removing intermediate container fd0fc28ffaa6
Step 5 : RUN npm --version
 ---> Running in c5138844e342
2.14.4
 ---> ba71f02e6d56
Removing intermediate container c5138844e342
Successfully built ba71f02e6d56

```

# Tested image `nodesource/sid:0.12.3`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 40513992ccd8
 ---> 8e421a0f82c3
Removing intermediate container 40513992ccd8
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.3-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 4dad87c76254
[91m  % Total    % Received % Xferd  Average Speed   Time    Time  [0m[91m [0m[91m  Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5177k  100 5177k    0     0  5797k      0 --:--:-- --:--:-- --:--:-- 5804k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.3-1nodesource1~sid1) ...
Setting up nodejs (0.12.3-1nodesource1~sid1) ...
 ---> 2f267b110bfa
Removing intermediate container 4dad87c76254
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in fab27c3326f9
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo[0m[91m [0m[91mit worked if it ends with ok
[0m[91mgyp [0m[91minfo [0m[91musing[0m[91m pangyp@2.3.3
[0m[91mgyp info using node@0.12.3 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.3/node-v0.12.3.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.3/node-v0.12.3.tar.gz
[0m[91mgyp[0m[91m http [0m[91mGET http://nodejs.org/dist/v0.12.3/SHASUMS256.txt
[0m[91mgyp http [0m[91m200 http://nodejs.org/dist/v0.12.3/SHASUMS256.txt
[0m[91mgyp[0m[91m info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info [0m[91mspawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info [0m[91mspawn args   '-I',
gyp info [0m[91mspawn args   '/build/config.gypi',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.3/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info [0m[91mspawn args   '-Dvisibility=default',
gyp [0m[91minfo [0m[91mspawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.3',
gyp info[0m[91m spawn args   '-Druntime=node',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info [0m[91mspawn args[0m[91m   '--no-parallel',
gyp [0m[91minfo spawn args   '--generator-output',
[0m[91mgyp [0m[91minfo spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! [0m[91mstack[0m[91m     at ChildProcess.emit (events.js:110:17)
[0m[91mgyp[0m[91m ERR! [0m[91mstack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp[0m[91m ERR! node -v v0.12.3
gyp[0m[91m ERR! pangyp -v v2.3.3
[0m[91mgyp ERR! not ok 
[0m
 ---> 76a0326fe86c
Removing intermediate container fab27c3326f9
Step 5 : ENV NODE_ENV production
 ---> Running in 6f93bc7a1a21
 ---> 1f3aa036dc34
Removing intermediate container 6f93bc7a1a21
Step 6 : WORKDIR /usr/src/app
 ---> Running in 1e0e192e8dc7
 ---> 1c75e69815cf
Removing intermediate container 1e0e192e8dc7
Step 7 : CMD npm start
 ---> Running in e364410e8c17
 ---> d5d9fe2910a9
Removing intermediate container e364410e8c17
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in c57bb1a848d4
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirror.picosecond.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 8s (1277 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (3137 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18572 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18572 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18572 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18572 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18572 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18572 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18572 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18572 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18572 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18572 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18572 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18572 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18572 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 294f0ccb7028
Removing intermediate container c57bb1a848d4
Successfully built 294f0ccb7028

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test149`

Contents of dockerfile `/root/docker-node/.~tmp.test149/Dockerfile`:

```
FROM nodesource/sid:0.12.3
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.12.3-test1` from `/root/docker-node/.~tmp.test149`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.12.3
 ---> 294f0ccb7028
Step 2 : ENV NODE_ENV test
 ---> Running in 91ad36b44f6d
 ---> e7e0120e5097
Removing intermediate container 91ad36b44f6d
Step 3 : RUN node -v
 ---> Running in d3d0baa03a08
v0.12.3
 ---> ef65d496f0cc
Removing intermediate container d3d0baa03a08
Step 4 : RUN node -p "process.versions"
 ---> Running in 9732f108c189
{ http_parser: '2.3',
  node: '0.12.3',
  v8: '3.28.71.19',
  uv: '1.5.0',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1m' }
 ---> 9deb835c329d
Removing intermediate container 9732f108c189
Step 5 : RUN npm --version
 ---> Running in d221d0aa4d36
2.9.1
 ---> 1955b2a8700c
Removing intermediate container d221d0aa4d36
Successfully built 1955b2a8700c

```

# Tested image `nodesource/sid:5.5.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 3df5859cd353
 ---> f6b54811d37c
Removing intermediate container 3df5859cd353
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.5.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 7816c2e45fb0
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0  [0m[91m    0 --:--:-- --:--:-- --:--:--     0[0m[91m 25 8521k   25 2159k    0     0  3249k      0  0:00:02 --:--:--  0:00:02 3247k[0m[91m100 8521k  100 8521k    0     0  7422k      0  0:00:01  0:00:01 --:--:-- 7429k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.5.0-1nodesource1~sid1) ...
Setting up nodejs (5.5.0-1nodesource1~sid1) ...
 ---> fc3129802eb0
Removing intermediate container 7816c2e45fb0
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 242dc43739df
[91mnpm[0m[91m WARN [0m[91mdeprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo using[0m[91m pangyp@2.3.3
gyp info using node@5.5.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v5.5.0/node-v5.5.0.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v5.5.0/node-v5.5.0.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v5.5.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v5.5.0/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.5.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.5.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp [0m[91minfo spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:100:13)
gyp ERR! stack     at ChildProcess.emit (events.js:185:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.5.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> cb853f4ba475
Removing intermediate container 242dc43739df
Step 5 : ENV NODE_ENV production
 ---> Running in bdb3181d6375
 ---> cabf82f590c7
Removing intermediate container bdb3181d6375
Step 6 : WORKDIR /usr/src/app
 ---> Running in 41ce1cdb1434
 ---> acf7d26b0b05
Removing intermediate container 41ce1cdb1434
Step 7 : CMD npm start
 ---> Running in 055ec33f00e1
 ---> 850dd1a0e00f
Removing intermediate container 055ec33f00e1
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 16ec82816320
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4696 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (6079 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> b07fee8f10eb
Removing intermediate container 16ec82816320
Successfully built b07fee8f10eb

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test132`

Contents of dockerfile `/root/docker-node/.~tmp.test132/Dockerfile`:

```
FROM nodesource/sid:5.5.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:5.5.0-test1` from `/root/docker-node/.~tmp.test132`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:5.5.0
 ---> b07fee8f10eb
Step 2 : ENV NODE_ENV test
 ---> Running in 9a90c3232894
 ---> 309b2f722915
Removing intermediate container 9a90c3232894
Step 3 : RUN node -v
 ---> Running in de618d16a5cd
v5.5.0
 ---> e60c360ee905
Removing intermediate container de618d16a5cd
Step 4 : RUN node -p "process.versions"
 ---> Running in 9ab5e73bf1fc
{ http_parser: '2.6.0',
  node: '5.5.0',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> 4c1ba4294746
Removing intermediate container 9ab5e73bf1fc
Step 5 : RUN npm --version
 ---> Running in c460472f6af6
3.3.12
 ---> f2843737bd39
Removing intermediate container c460472f6af6
Successfully built f2843737bd39

```

# Tested image `nodesource/sid:5.1.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in eac0675f36a1
 ---> 042f222d496c
Removing intermediate container eac0675f36a1
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.1.1-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 3d0a0792e54e
[91m  % Tota[0m[91ml    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 69 8316k   69 5807k    0     0  6539k      0  0:00:01 --:--:--  0:00:01 6540k[0m[91m100 8316k  100 8316k    0     0  7839k      0  0:00:01  0:00:01 --:--:-- 7845k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.1.1-1nodesource1~sid1) ...
Setting up nodejs (5.1.1-1nodesource1~sid1) ...
 ---> 20e33f56ed64
Removing intermediate container 3d0a0792e54e
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in a2520bc4700d
[91mnpm[0m[91m WARN [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@5.1.1 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp GET[0m[91m http://nodejs.org/dist/v5.1.1/node-v5.1.1.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp 200 http://nodejs.org/dist/v5.1.1/node-v5.1.1.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v5.1.1/SHASUMS256.txt
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v5.1.1/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.1.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.1.1',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.1.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> a8efe5a3bd9f
Removing intermediate container a2520bc4700d
Step 5 : ENV NODE_ENV production
 ---> Running in 120c72b40c30
 ---> 69a2628b38de
Removing intermediate container 120c72b40c30
Step 6 : WORKDIR /usr/src/app
 ---> Running in feed87ca889f
 ---> 6a7ebb439334
Removing intermediate container feed87ca889f
Step 7 : CMD npm start
 ---> Running in d6cec1a503a4
 ---> ff2529145536
Removing intermediate container d6cec1a503a4
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 3a1ba6fad2d3
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (2832 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.kernel.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:5 http://mirror.picosecond.org/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:8 http://mirrors.kernel.org/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
Get:6 http://mirror.picosecond.org/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:12 http://mirror.picosecond.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (3259 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 44b6802be878
Removing intermediate container 3a1ba6fad2d3
Successfully built 44b6802be878

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test128`

Contents of dockerfile `/root/docker-node/.~tmp.test128/Dockerfile`:

```
FROM nodesource/sid:5.1.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:5.1.1-test1` from `/root/docker-node/.~tmp.test128`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:5.1.1
 ---> 44b6802be878
Step 2 : ENV NODE_ENV test
 ---> Running in db7ec2931ccb
 ---> 3a5f6da0141e
Removing intermediate container db7ec2931ccb
Step 3 : RUN node -v
 ---> Running in bda557bbeb91
v5.1.1
 ---> 27fb1fdd423d
Removing intermediate container bda557bbeb91
Step 4 : RUN node -p "process.versions"
 ---> Running in cfdbc5944538
{ http_parser: '2.6.0',
  node: '5.1.1',
  v8: '4.6.85.31',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> 80dfc8fc8ae2
Removing intermediate container cfdbc5944538
Step 5 : RUN npm --version
 ---> Running in a2a661f29dfe
3.3.12
 ---> f4da8c52bf72
Removing intermediate container a2a661f29dfe
Successfully built f4da8c52bf72

```

# Tested image `nodesource/sid:iojs-1.6.2`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in bf97b2460b4e
 ---> 8f31a5972bd9
Removing intermediate container bf97b2460b4e
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.6.2-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 3e0fb37d0ca1
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 89 5139k   89 4591k    0     0  5028k      0  0:00:01 --:--:--  0:00:01 5029k[0m[91m100 5139k  100 5139k    0     0  5113k      0  0:00:01  0:00:01 --:--:-- 5118k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.6.2-1nodesource1~sid1) ...
Setting up iojs (1.6.2-1nodesource1~sid1) ...
 ---> e847c165d8b0
Removing intermediate container 3e0fb37d0ca1
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in ff8ae0e6de44
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN [0m[91mdeprecated[0m[91m graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info[0m[91m using[0m[91m pangyp@2.3.3
gyp info using node@1.6.2 | linux | x64
[0m[91mgyp http GET https://iojs.org/dist/v1.6.2/iojs-v1.6.2.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v1.6.2/iojs-v1.6.2.tar.gz
[0m[91mgyp http [0m[91mGET https://iojs.org/dist/v1.6.2/SHASUMS256.txt
[0m[91mgyp http 200[0m[91m https://iojs.org/dist/v1.6.2/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.6.2/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.6.2',
gyp info spawn args[0m[91m   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp[0m[91m info spawn args   '--depth=.',
[0m[91mgyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp[0m[91m [0m[91minfo [0m[91mspawn args[0m[91m   'build',
gyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp [0m[91mERR! [0m[91mcommand[0m[91m "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp ERR! node -v v1.6.2
gyp ERR! [0m[91mpangyp -v v2.3.3
[0m[91mgyp [0m[91mERR! [0m[91mnot ok 
[0m
 ---> ea213b59d89d
Removing intermediate container ff8ae0e6de44
Step 5 : ENV NODE_ENV production
 ---> Running in f88c6f6389b9
 ---> 8baf9d871321
Removing intermediate container f88c6f6389b9
Step 6 : WORKDIR /usr/src/app
 ---> Running in 7bf366952305
 ---> 5e7c8fc01d7d
Removing intermediate container 7bf366952305
Step 7 : CMD npm start
 ---> Running in 351478644d5d
 ---> b30614271db9
Removing intermediate container 351478644d5d
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in ffee8ebbd7a2
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3232 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (6197 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18065 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18065 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18065 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18065 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18065 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18065 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18065 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18065 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18065 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18065 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18065 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18065 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18065 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> dfa7d4b0ad1b
Removing intermediate container ffee8ebbd7a2
Successfully built dfa7d4b0ad1b

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test186`

Contents of dockerfile `/root/docker-node/.~tmp.test186/Dockerfile`:

```
FROM nodesource/sid:iojs-1.6.2
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-1.6.2-test1` from `/root/docker-node/.~tmp.test186`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-1.6.2
 ---> dfa7d4b0ad1b
Step 2 : ENV NODE_ENV test
 ---> Running in c5e4b3456b24
 ---> eaff7dc21f3e
Removing intermediate container c5e4b3456b24
Step 3 : RUN node -v
 ---> Running in 51120e6aa867
v1.6.2
 ---> dd3b3cef12bd
Removing intermediate container 51120e6aa867
Step 4 : RUN node -p "process.versions"
 ---> Running in b5820ec1ffae
{ http_parser: '2.3.0',
  node: '1.6.2',
  v8: '4.1.0.25',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1m' }
 ---> e830c11b8f43
Removing intermediate container b5820ec1ffae
Step 5 : RUN npm --version
 ---> Running in 6452424e3536
2.7.1
 ---> 901b132bbf23
Removing intermediate container 6452424e3536
Successfully built 901b132bbf23

```

# Tested image `nodesource/sid:4.2.3`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in bc0051317392
 ---> 247dd9605164
Removing intermediate container bc0051317392
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.3-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 41a5142863b5
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  2 8263k    2  207k    0     0   447k      0  0:00:18 --:--:--  0:00:18  446k[0m[91m100 8263k  100 8263k    0     0  7343k      0  0:00:01  0:00:01 --:--:-- 7345k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.2.3-1nodesource1~sid1) ...
Setting up nodejs (4.2.3-1nodesource1~sid1) ...
 ---> d12677114f1f
Removing intermediate container 41a5142863b5
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 3a46cc7c209c
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0, bl@0.9.5)
â””â”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
[91mgyp[0m[91m info [0m[91mit worked if it ends with[0m[91m ok
[0m[91mgyp info using[0m[91m pangyp@2.3.3
[0m[91mgyp info using node@4.2.3 | linux | x64
[0m[91mgyp[0m[91m http [0m[91mGET http://nodejs.org/dist/v4.2.3/node-v4.2.3.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.3/node-v4.2.3.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp GET[0m[91m http://nodejs.org/dist/v4.2.3/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.3/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp [0m[91minfo spawn args   'make',
gyp info[0m[91m spawn args[0m[91m   '-I',
[0m[91mgyp[0m[91m info[0m[91m [0m[91mspawn args[0m[91m   '/build/config.gypi',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.3/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
[0m[91mgyp info spawn args[0m[91m   '-Dvisibility=default',
[0m[91mgyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.3',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp [0m[91mERR! [0m[91mstack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp[0m[91m ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! [0m[91mcommand "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp [0m[91mERR! cwd /
[0m[91mgyp ERR! node -v v4.2.3
[0m[91mgyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 1522982f9860
Removing intermediate container 3a46cc7c209c
Step 5 : ENV NODE_ENV production
 ---> Running in c604bbbb4aa8
 ---> 80da0524cdd1
Removing intermediate container c604bbbb4aa8
Step 6 : WORKDIR /usr/src/app
 ---> Running in 21bf8f2b5dc9
 ---> 4805a625ee2c
Removing intermediate container 21bf8f2b5dc9
Step 7 : CMD npm start
 ---> Running in 4ac9a277fcfc
 ---> 33e8c254e093
Removing intermediate container 4ac9a277fcfc
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 9e49b41b4944
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4859 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2400 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> dac9f81c17d0
Removing intermediate container 9e49b41b4944
Successfully built dac9f81c17d0

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test160`

Contents of dockerfile `/root/docker-node/.~tmp.test160/Dockerfile`:

```
FROM nodesource/sid:4.2.3
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:4.2.3-test1` from `/root/docker-node/.~tmp.test160`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:4.2.3
 ---> dac9f81c17d0
Step 2 : ENV NODE_ENV test
 ---> Running in 67af79271da2
 ---> ee88465c3975
Removing intermediate container 67af79271da2
Step 3 : RUN node -v
 ---> Running in b1232a60b8ac
v4.2.3
 ---> 9b49df805d83
Removing intermediate container b1232a60b8ac
Step 4 : RUN node -p "process.versions"
 ---> Running in 0029b56abe45
{ http_parser: '2.5.0',
  node: '4.2.3',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2e' }
 ---> 3d181913ecab
Removing intermediate container 0029b56abe45
Step 5 : RUN npm --version
 ---> Running in e2e3a526c8fb
2.14.7
 ---> 5b04401c66e6
Removing intermediate container e2e3a526c8fb
Successfully built 5b04401c66e6

```

# Tested image `nodesource/sid:5.4.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 3154d384377b
 ---> 558ab5cefe20
Removing intermediate container 3154d384377b
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.4.1-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 9531fbe2d938
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 63 8512k   63 5375k    0     0  6290k      0  0:00:01 --:--:--  0:00:01 6287k[0m[91m100 8512k  100 8512k    0     0  7611k      0  0:00:01  0:00:01 --:--:-- 7614k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.4.1-1nodesource1~sid1) ...
Setting up nodejs (5.4.1-1nodesource1~sid1) ...
 ---> 2e6baa9d2353
Removing intermediate container 9531fbe2d938
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 1703cc7ac4ea
[91mnpm[0m[91m WARN deprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with[0m[91m ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
[0m[91mgyp info [0m[91musing[0m[91m node@5.4.1 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v5.4.1/node-v5.4.1.tar.gz
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v5.4.1/node-v5.4.1.tar.gz
[0m[91mgyp http GET http://nodejs.org/dist/v5.4.1/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v5.4.1/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.4.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.4.1',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
[0m[91mgyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.4.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> dc229155fcbc
Removing intermediate container 1703cc7ac4ea
Step 5 : ENV NODE_ENV production
 ---> Running in adca851bc6e7
 ---> 9318826c0c82
Removing intermediate container adca851bc6e7
Step 6 : WORKDIR /usr/src/app
 ---> Running in 02e03ad4aebd
 ---> 80ba358a8101
Removing intermediate container 02e03ad4aebd
Step 7 : CMD npm start
 ---> Running in 4f124685c36e
 ---> 0e33f172295d
Removing intermediate container 4f124685c36e
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in bfcfaaea10af
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3062 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2893 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18936 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 48f500123bc0
Removing intermediate container bfcfaaea10af
Successfully built 48f500123bc0

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test131`

Contents of dockerfile `/root/docker-node/.~tmp.test131/Dockerfile`:

```
FROM nodesource/sid:5.4.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:5.4.1-test1` from `/root/docker-node/.~tmp.test131`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:5.4.1
 ---> 48f500123bc0
Step 2 : ENV NODE_ENV test
 ---> Running in 9a68f2dd440e
 ---> 6b1e01e900ff
Removing intermediate container 9a68f2dd440e
Step 3 : RUN node -v
 ---> Running in ec24560d0cdd
v5.4.1
 ---> a535232c4ce3
Removing intermediate container ec24560d0cdd
Step 4 : RUN node -p "process.versions"
 ---> Running in 3cebdac96c02
{ http_parser: '2.6.0',
  node: '5.4.1',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2e' }
 ---> ad30d27d39e1
Removing intermediate container 3cebdac96c02
Step 5 : RUN npm --version
 ---> Running in c6f67b40b419
3.3.12
 ---> 913998e06645
Removing intermediate container c6f67b40b419
Successfully built 913998e06645

```

# Tested image `nodesource/sid:4.2.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 04c4d0280ee7
 ---> 107556cd73e6
Removing intermediate container 04c4d0280ee7
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.1-3nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 899b594e0aac
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 53 6797k   53 3631k    0     0  4727k      0  0:00:01 --:--:--  0:00:01 4722k[0m[91m100 6797k  100 6797k    0     0  6833k      0 --:--:-- --:--:-- --:--:-- 6831k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.2.1-3nodesource1~sid1) ...
Setting up nodejs (4.2.1-3nodesource1~sid1) ...
 ---> 7b22e24cc8ec
Removing intermediate container 899b594e0aac
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 647f31129fc0
[91mnpm[0m[91m [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@4.2.1 | linux | x64
[0m[91mgyp[0m[91m http GET[0m[91m http://nodejs.org/dist/v4.2.1/node-v4.2.1.tar.gz
[0m[91mgyp[0m[91m http[0m[91m [0m[91m200[0m[91m http://nodejs.org/dist/v4.2.1/node-v4.2.1.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.2.1/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.1/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.1',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp[0m[91m ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.2.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> e544e12cbd6f
Removing intermediate container 647f31129fc0
Step 5 : ENV NODE_ENV production
 ---> Running in 9b9e2b7918a5
 ---> 3fed611fcc6e
Removing intermediate container 9b9e2b7918a5
Step 6 : WORKDIR /usr/src/app
 ---> Running in 2820f7184be9
 ---> 0fb8ea1d25ec
Removing intermediate container 2820f7184be9
Step 7 : CMD npm start
 ---> Running in c9153b72cfd9
 ---> 3ffd07ca1552
Removing intermediate container c9153b72cfd9
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 3b2d94be856e
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3217 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (6221 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> a448d6d6589c
Removing intermediate container 3b2d94be856e
Successfully built a448d6d6589c

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test158`

Contents of dockerfile `/root/docker-node/.~tmp.test158/Dockerfile`:

```
FROM nodesource/sid:4.2.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:4.2.1-test1` from `/root/docker-node/.~tmp.test158`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:4.2.1
 ---> a448d6d6589c
Step 2 : ENV NODE_ENV test
 ---> Running in 0cfd52c40e5d
 ---> 39f2d3bebf17
Removing intermediate container 0cfd52c40e5d
Step 3 : RUN node -v
 ---> Running in de97fc596b84
v4.2.1
 ---> 3193d58945cf
Removing intermediate container de97fc596b84
Step 4 : RUN node -p "process.versions"
 ---> Running in 026f1d006e4e
{ http_parser: '2.5.0',
  node: '4.2.1',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '46',
  openssl: '1.0.2d' }
 ---> 512ae58255f6
Removing intermediate container 026f1d006e4e
Step 5 : RUN npm --version
 ---> Running in 3c06c1acaf67
2.14.7
 ---> 173e4d600f25
Removing intermediate container 3c06c1acaf67
Successfully built 173e4d600f25

```

# Tested image `nodesource/sid:iojs-2.4.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in ca7a6da32e03
 ---> 29583572d20c
Removing intermediate container ca7a6da32e03
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.4.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in ce72f9f888cb
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 12 6076k   12  751k    0     0  1684k      0  0:00:03 --:--:--  0:00:03 1681k[0m[91m100 6076k  100 6076k    0     0  7353k      0 --:--:-- --:--:-- --:--:-- 7347k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.4.0-1nodesource1~sid1) ...
Setting up iojs (2.4.0-1nodesource1~sid1) ...
 ---> 9e8f23728f94
Removing intermediate container ce72f9f888cb
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 589001b30963
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with[0m[91m ok
gyp info using pangyp@2.3.3
gyp info using node@2.4.0 | linux | x64
[0m[91mgyp http GET https://iojs.org/dist/v2.4.0/iojs-v2.4.0.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp 200 https://iojs.org/dist/v2.4.0/iojs-v2.4.0.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp [0m[91mGET[0m[91m https://iojs.org/dist/v2.4.0/SHASUMS256.txt
[0m[91mgyp[0m[91m http 200[0m[91m https://iojs.org/dist/v2.4.0/SHASUMS256.txt
[0m[91mgyp info [0m[91mspawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info[0m[91m spawn args[0m[91m   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args[0m[91m   '/root/.node-gyp/2.4.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
[0m[91mgyp [0m[91minfo[0m[91m spawn args[0m[91m   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/2.4.0',
gyp info [0m[91mspawn args   '-Druntime=iojs',
gyp [0m[91minfo spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info[0m[91m [0m[91mspawn args   '--generator-output',
[0m[91mgyp[0m[91m info[0m[91m spawn args   'build',
gyp[0m[91m [0m[91minfo[0m[91m [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR![0m[91m [0m[91mconfigure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp[0m[91m ERR! cwd /
gyp ERR! node -v v2.4.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 12b8465220b6
Removing intermediate container 589001b30963
Step 5 : ENV NODE_ENV production
 ---> Running in 7c97b1d1da96
 ---> b33484851f9e
Removing intermediate container 7c97b1d1da96
Step 6 : WORKDIR /usr/src/app
 ---> Running in 3e1ffc85b1ae
 ---> 22b15118ae84
Removing intermediate container 3e1ffc85b1ae
Step 7 : CMD npm start
 ---> Running in 102beca770f4
 ---> 33d25914eeec
Removing intermediate container 102beca770f4
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in e0e65ed7680d
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3021 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (5813 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18770 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18770 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18770 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18770 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18770 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18770 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18770 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18770 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18770 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18770 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18770 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18770 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18770 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 4889d045f1cc
Removing intermediate container e0e65ed7680d
Successfully built 4889d045f1cc

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test178`

Contents of dockerfile `/root/docker-node/.~tmp.test178/Dockerfile`:

```
FROM nodesource/sid:iojs-2.4.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-2.4.0-test1` from `/root/docker-node/.~tmp.test178`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-2.4.0
 ---> 4889d045f1cc
Step 2 : ENV NODE_ENV test
 ---> Running in 316d149aa3a2
 ---> 823d1fa23926
Removing intermediate container 316d149aa3a2
Step 3 : RUN node -v
 ---> Running in 2451371e0776
v2.4.0
 ---> ab9a94f17df1
Removing intermediate container 2451371e0776
Step 4 : RUN node -p "process.versions"
 ---> Running in 44d975a94ceb
{ http_parser: '2.5.0',
  node: '2.4.0',
  v8: '4.2.77.20',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2d' }
 ---> 89b47b1a96cd
Removing intermediate container 44d975a94ceb
Step 5 : RUN npm --version
 ---> Running in dc00685f6b6c
2.13.0
 ---> 0590c06d6125
Removing intermediate container dc00685f6b6c
Successfully built 0590c06d6125

```

# Tested image `nodesource/sid:4.2.2`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 7221d70ce661
 ---> cce9e69de79d
Removing intermediate container 7221d70ce661
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.2.2-2nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in efdecdb14077
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 23 6821k   23 1615k    0     0  2627k      0  0:00:02 --:--:--  0:00:02 2627k[0m[91m100 6821k  100 6821k    0     0  6740k      0  0:00:01  0:00:01 --:--:-- 6747k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.2.2-2nodesource1~sid1) ...
Setting up nodejs (4.2.2-2nodesource1~sid1) ...
 ---> 98571f6d64ec
Removing intermediate container efdecdb14077
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 27ae9847eb31
[91mnpm[0m[91m [0m[91mWARN [0m[91mdeprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (forever-agent@0.5.2, caseless@0.8.0, aws-sign2@0.5.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with[0m[91m ok
[0m[91mgyp info using pangyp@2.3.3
gyp [0m[91minfo using[0m[91m node@4.2.2 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp GET http://nodejs.org/dist/v4.2.2/node-v4.2.2.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.2/node-v4.2.2.tar.gz
[0m[91mgyp http[0m[91m GET http://nodejs.org/dist/v4.2.2/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.2.2/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
[0m[91mgyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.2.2/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.2.2',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args[0m[91m   'build',
gyp[0m[91m info[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp[0m[91m ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp[0m[91m ERR! cwd /
gyp ERR! node -v v4.2.2
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 4404c4f552c5
Removing intermediate container 27ae9847eb31
Step 5 : ENV NODE_ENV production
 ---> Running in 83cc824e3cf2
 ---> 980b746376dc
Removing intermediate container 83cc824e3cf2
Step 6 : WORKDIR /usr/src/app
 ---> Running in a81d4cf75114
 ---> 390a02a59658
Removing intermediate container a81d4cf75114
Step 7 : CMD npm start
 ---> Running in a26fc82dca68
 ---> 22ae5ccad0d2
Removing intermediate container a26fc82dca68
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in df547e631e70
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4891 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:7 http://mirrors.kernel.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:2 http://mirror.picosecond.org/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:8 http://mirrors.kernel.org/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:10 http://mirrors.kernel.org/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:4 http://mirror.picosecond.org/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirror.picosecond.org/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:11 http://mirrors.kernel.org/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:6 http://mirror.picosecond.org/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:12 http://mirrors.kernel.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:9 http://mirror.picosecond.org/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:13 http://mirror.picosecond.org/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2227 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18886 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> c70b7637aa7f
Removing intermediate container df547e631e70
Successfully built c70b7637aa7f

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test159`

Contents of dockerfile `/root/docker-node/.~tmp.test159/Dockerfile`:

```
FROM nodesource/sid:4.2.2
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:4.2.2-test1` from `/root/docker-node/.~tmp.test159`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:4.2.2
 ---> c70b7637aa7f
Step 2 : ENV NODE_ENV test
 ---> Running in 5b891da96810
 ---> 4209665f10e7
Removing intermediate container 5b891da96810
Step 3 : RUN node -v
 ---> Running in 2e6d3350a9b9
v4.2.2
 ---> 6185bc43662f
Removing intermediate container 2e6d3350a9b9
Step 4 : RUN node -p "process.versions"
 ---> Running in a3b9c15a9ff7
{ http_parser: '2.5.0',
  node: '4.2.2',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '55.1',
  modules: '46',
  openssl: '1.0.2d' }
 ---> 687d2dd3c034
Removing intermediate container a3b9c15a9ff7
Step 5 : RUN npm --version
 ---> Running in c921098bad19
2.14.7
 ---> d17328d53c6a
Removing intermediate container c921098bad19
Successfully built d17328d53c6a

```

# Tested image `nodesource/sid:0.12.2`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in c1ae8d8ecacd
 ---> e6e64226f189
Removing intermediate container c1ae8d8ecacd
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.2-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 7c57727a62a6
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5[0m[91m068k  100 5068k    0     0  6005k      0 --:--:-- --:--:-- --:--:-- 6005k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (0.12.2-1nodesource1~sid1) ...
Setting up nodejs (0.12.2-1nodesource1~sid1) ...
 ---> e48ab5a301f7
Removing intermediate container 7c57727a62a6
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 5695857c2037
[91mnpm WARN [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp [0m[91minfo it worked if it ends with[0m[91m ok
[0m[91mgyp info using pangyp@2.3.3
gyp[0m[91m info using node@0.12.2 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.12.2/node-v0.12.2.tar.gz
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v0.12.2/node-v0.12.2.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp GET http://nodejs.org/dist/v0.12.2/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.2/SHASUMS256.txt
[0m[91mgyp[0m[91m info [0m[91mspawn python
[0m[91mgyp info spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp[0m[91m info spawn args   'binding.gyp',
gyp info spawn args   '-f',
[0m[91mgyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info[0m[91m [0m[91mspawn args   '/build/config.gypi',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info [0m[91mspawn args[0m[91m   '-I',
gyp info spawn args   '/root/.node-gyp/0.12.2/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp[0m[91m [0m[91minfo[0m[91m spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.2',
gyp info spawn args   '-Druntime=node',
[0m[91mgyp[0m[91m info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args[0m[91m   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp[0m[91m [0m[91minfo [0m[91mspawn args   'build',
[0m[91mgyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at ChildProcess.emit (events.js:110:17)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1074:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v0.12.2
[0m[91mgyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 8707b20e80d4
Removing intermediate container 5695857c2037
Step 5 : ENV NODE_ENV production
 ---> Running in c9d37b46a1ce
 ---> c8c1f1088ca7
Removing intermediate container c9d37b46a1ce
Step 6 : WORKDIR /usr/src/app
 ---> Running in 5480d8a78a92
 ---> c0a4dc7bc107
Removing intermediate container 5480d8a78a92
Step 7 : CMD npm start
 ---> Running in 45cb007d4036
 ---> 83f40a62c1fb
Removing intermediate container 45cb007d4036
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 21e2a6a72c4c
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 4s (2461 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2396 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18340 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18340 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18340 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18340 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18340 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18340 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18340 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18340 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18340 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18340 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18340 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18340 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18340 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> e6b27f524f8c
Removing intermediate container 21e2a6a72c4c
Successfully built e6b27f524f8c

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test148`

Contents of dockerfile `/root/docker-node/.~tmp.test148/Dockerfile`:

```
FROM nodesource/sid:0.12.2
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:0.12.2-test1` from `/root/docker-node/.~tmp.test148`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:0.12.2
 ---> e6b27f524f8c
Step 2 : ENV NODE_ENV test
 ---> Running in 548d8826e0d0
 ---> b9a3001c63aa
Removing intermediate container 548d8826e0d0
Step 3 : RUN node -v
 ---> Running in c8d29617904d
v0.12.2
 ---> 69ec1f1ee2c7
Removing intermediate container c8d29617904d
Step 4 : RUN node -p "process.versions"
 ---> Running in ffddd424aa61
{ http_parser: '2.3',
  node: '0.12.2',
  v8: '3.28.73',
  uv: '1.4.2-node1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1m' }
 ---> 6d486fbfa469
Removing intermediate container ffddd424aa61
Step 5 : RUN npm --version
 ---> Running in 3d6cd3049c97
2.7.4
 ---> 2cba3d43fbd6
Removing intermediate container 3d6cd3049c97
Successfully built 2cba3d43fbd6

```

# Tested image `nodesource/sid:iojs-3.3.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in a2af625305c1
 ---> c7eaeac76b26
Removing intermediate container a2af625305c1
Step 3 : RUN curl https://deb.nodesource.com/iojs_3.x/pool/main/i/iojs/iojs_3.3.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in be934e5b6720
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0 6207k    0 16086    0     0  49849      0  0:02:07 --:--:--  0:02:07 49801[0m[91m100 6207k  100 6207k    0     0  6860k      0 --:--:-- --:--:-- --:--:-- 6858k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (3.3.0-1nodesource1~sid1) ...
Setting up iojs (3.3.0-1nodesource1~sid1) ...
 ---> c3d94d1d4173
Removing intermediate container be934e5b6720
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 73e7b288ca69
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN[0m[91m deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@3.3.0 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v3.3.0/iojs-v3.3.0.tar.gz
[0m[91mgyp http[0m[91m 200 https://iojs.org/dist/v3.3.0/iojs-v3.3.0.tar.gz
[0m[91mgyp http[0m[91m [0m[91mGET https://iojs.org/dist/v3.3.0/SHASUMS256.txt
[0m[91mgyp[0m[91m [0m[91mhttp[0m[91m 200 https://iojs.org/dist/v3.3.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info[0m[91m [0m[91mspawn args   'binding.gyp',
[0m[91mgyp info spawn args   '-f',
gyp [0m[91minfo spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/3.3.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/3.3.0',
gyp info spawn args   '-Druntime=iojs',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp [0m[91mERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v3.3.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 807cc6dfcb6a
Removing intermediate container 73e7b288ca69
Step 5 : ENV NODE_ENV production
 ---> Running in 3b385904db50
 ---> 139e5051ede3
Removing intermediate container 3b385904db50
Step 6 : WORKDIR /usr/src/app
 ---> Running in 909da3090c61
 ---> 0a68341b7c3d
Removing intermediate container 909da3090c61
Step 7 : CMD npm start
 ---> Running in 31c8aa42d39d
 ---> 855f69171e45
Removing intermediate container 31c8aa42d39d
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 7c73a671320a
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4272 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2835 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 830b62ffae35
Removing intermediate container 7c73a671320a
Successfully built 830b62ffae35

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test168`

Contents of dockerfile `/root/docker-node/.~tmp.test168/Dockerfile`:

```
FROM nodesource/sid:iojs-3.3.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-3.3.0-test1` from `/root/docker-node/.~tmp.test168`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-3.3.0
 ---> 830b62ffae35
Step 2 : ENV NODE_ENV test
 ---> Running in c1865771ddc9
 ---> 8c9155c3e3a3
Removing intermediate container c1865771ddc9
Step 3 : RUN node -v
 ---> Running in d02da96bbe96
v3.3.0
 ---> c2affa766dfc
Removing intermediate container d02da96bbe96
Step 4 : RUN node -p "process.versions"
 ---> Running in 949d8cd9857c
{ http_parser: '2.5.0',
  node: '3.3.0',
  v8: '4.4.63.30',
  uv: '1.7.3',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '45',
  openssl: '1.0.2d' }
 ---> 278d07bf4556
Removing intermediate container 949d8cd9857c
Step 5 : RUN npm --version
 ---> Running in 0f1ea6900b76
2.13.3
 ---> a6fc9d4667d8
Removing intermediate container 0f1ea6900b76
Successfully built a6fc9d4667d8

```

# Tested image `nodesource/sid:iojs-1.4.3`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 26023fd9e2a3
 ---> 5acba9b9adac
Removing intermediate container 26023fd9e2a3
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.4.3-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in c2d65c21051a
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Spee[0m[91md
  0     0    0     0    0     0      0  [0m[91m    0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5094k  100 5094k    0     0  5454k      0 --:--:-- --:--:-- --:--:-- 5454k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.4.3-1nodesource1~sid1) ...
Setting up iojs (1.4.3-1nodesource1~sid1) ...
 ---> b8148c55c437
Removing intermediate container c2d65c21051a
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in a5d8181dc7dc
[91mnpm[0m[91m WARN deprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN[0m[91m deprecated[0m[91m graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with[0m[91m ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
[0m[91mgyp info using node@1.4.3 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v1.4.3/iojs-v1.4.3.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v1.4.3/iojs-v1.4.3.tar.gz
[0m[91mgyp [0m[91mhttp GET https://iojs.org/dist/v1.4.3/SHASUMS256.txt
[0m[91mgyp[0m[91m http[0m[91m 200 https://iojs.org/dist/v1.4.3/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info[0m[91m [0m[91mspawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp[0m[91m info spawn args   '-f',
gyp info[0m[91m [0m[91mspawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args[0m[91m   '/build/config.gypi',
gyp info spawn args   '-I',
[0m[91mgyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info [0m[91mspawn args[0m[91m   '/root/.node-gyp/1.4.3/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.4.3',
gyp [0m[91minfo spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args[0m[91m   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR![0m[91m configure error 
[0m[91mgyp [0m[91mERR! stack Error: `gyp` failed with exit code: 1
[0m[91mgyp[0m[91m ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack[0m[91m     at emitTwo (events.js:87:13)
[0m[91mgyp [0m[91mERR![0m[91m stack     at ChildProcess.emit (events.js:169:7)
[0m[91mgyp [0m[91mERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd[0m[91m /
[0m[91mgyp ERR! node -v v1.4.3
gyp ERR![0m[91m pangyp -v[0m[91m v2.3.3
gyp ERR! not ok 
[0m
 ---> 099c704736a0
Removing intermediate container a5d8181dc7dc
Step 5 : ENV NODE_ENV production
 ---> Running in 1468feaa1d98
 ---> 63aac913c40e
Removing intermediate container 1468feaa1d98
Step 6 : WORKDIR /usr/src/app
 ---> Running in 7dbb3f091d07
 ---> 9da5a0437173
Removing intermediate container 7dbb3f091d07
Step 7 : CMD npm start
 ---> Running in aad8bfbdecd5
 ---> 457dbd4f46d7
Removing intermediate container aad8bfbdecd5
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 1830b50c4435
Get:1 http://mirrors.kernel.org/debian sid InRelease [287 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4115 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (6387 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 91a7b894217f
Removing intermediate container 1830b50c4435
Successfully built 91a7b894217f

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test170`

Contents of dockerfile `/root/docker-node/.~tmp.test170/Dockerfile`:

```
FROM nodesource/sid:iojs-1.4.3
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-1.4.3-test1` from `/root/docker-node/.~tmp.test170`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-1.4.3
 ---> 91a7b894217f
Step 2 : ENV NODE_ENV test
 ---> Running in e04c504a22b7
 ---> b6898ca9044b
Removing intermediate container e04c504a22b7
Step 3 : RUN node -v
 ---> Running in b022e6f81dcb
v1.4.3
 ---> 9388cfaf4c6c
Removing intermediate container b022e6f81dcb
Step 4 : RUN node -p "process.versions"
 ---> Running in 20a505d15e63
{ http_parser: '2.3.0',
  node: '1.4.3',
  v8: '4.1.0.21',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1k' }
 ---> 2f6b4265b520
Removing intermediate container 20a505d15e63
Step 5 : RUN npm --version
 ---> Running in 4065fd7c00c6
2.6.1
 ---> 470384bbf97b
Removing intermediate container 4065fd7c00c6
Successfully built 470384bbf97b

```

# Tested image `nodesource/sid:iojs-1.5.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 59177fdf5883
 ---> 07578e0c77f7
Removing intermediate container 59177fdf5883
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.5.1-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 22b180e28240
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5105k  100 5105k    0     0  4499k      0  0:00:01  0:00:01 --:--:-- 4502k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.5.1-1nodesource1~sid1) ...
Setting up iojs (1.5.1-1nodesource1~sid1) ...
 ---> a0a859595dbc
Removing intermediate container 22b180e28240
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in c59e174f9ec1
[91mnpm[0m[91m WARN[0m[91m deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated[0m[91m graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, tunnel-agent@0.4.2, oauth-sign@0.5.0, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, hawk@1.1.1, http-signature@0.10.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo[0m[91m it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@1.5.1 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp GET https://iojs.org/dist/v1.5.1/iojs-v1.5.1.tar.gz
[0m[91mgyp [0m[91mhttp [0m[91m200 https://iojs.org/dist/v1.5.1/iojs-v1.5.1.tar.gz
[0m[91mgyp http [0m[91mGET https://iojs.org/dist/v1.5.1/SHASUMS256.txt
[0m[91mgyp http[0m[91m 200 https://iojs.org/dist/v1.5.1/SHASUMS256.txt
[0m[91mgyp [0m[91minfo spawn python
[0m[91mgyp[0m[91m info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args[0m[91m   '-I',
gyp[0m[91m info spawn args[0m[91m   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp[0m[91m info spawn args   '/root/.node-gyp/1.5.1/common.gypi',
gyp[0m[91m info [0m[91mspawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info[0m[91m spawn args[0m[91m   '-Dnode_root_dir=/root/.node-gyp/1.5.1',
gyp [0m[91minfo[0m[91m spawn args   '-Druntime=iojs',
[0m[91mgyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp [0m[91minfo spawn args   '--generator-output',
[0m[91mgyp[0m[91m info[0m[91m spawn args   'build',
gyp info[0m[91m [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error[0m[91m 
[0m[91mgyp ERR![0m[91m stack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp [0m[91mERR! [0m[91mstack     at emitTwo (events.js:87:13)
[0m[91mgyp [0m[91mERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
gyp ERR! [0m[91mSystem[0m[91m Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp[0m[91m [0m[91mERR! [0m[91mcwd /
[0m[91mgyp ERR! node -v v1.5.1
gyp ERR![0m[91m pangyp -v v2.3.3
gyp [0m[91mERR! not ok[0m[91m 
[0m
 ---> 2a0d04e4f042
Removing intermediate container c59e174f9ec1
Step 5 : ENV NODE_ENV production
 ---> Running in fab1f70091d1
 ---> 979c19a27e7a
Removing intermediate container fab1f70091d1
Step 6 : WORKDIR /usr/src/app
 ---> Running in 05ba16c5572f
 ---> 69ae4a24237d
Removing intermediate container 05ba16c5572f
Step 7 : CMD npm start
 ---> Running in be7fff64429a
 ---> 9e4d43bd64dc
Removing intermediate container be7fff64429a
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in f89c5cb929e1
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4206 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (6658 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> ae9c4fd72b93
Removing intermediate container f89c5cb929e1
Successfully built ae9c4fd72b93

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test171`

Contents of dockerfile `/root/docker-node/.~tmp.test171/Dockerfile`:

```
FROM nodesource/sid:iojs-1.5.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-1.5.1-test1` from `/root/docker-node/.~tmp.test171`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-1.5.1
 ---> ae9c4fd72b93
Step 2 : ENV NODE_ENV test
 ---> Running in cab1c5aab462
 ---> 6dceb7d9b0c2
Removing intermediate container cab1c5aab462
Step 3 : RUN node -v
 ---> Running in 0d32eed8bfce
v1.5.1
 ---> e4a19c631b0c
Removing intermediate container 0d32eed8bfce
Step 4 : RUN node -p "process.versions"
 ---> Running in 48a8e5424b56
{ http_parser: '2.3.0',
  node: '1.5.1',
  v8: '4.1.0.21',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1k' }
 ---> 5651dd9c3070
Removing intermediate container 48a8e5424b56
Step 5 : RUN npm --version
 ---> Running in 4bada7c0f01e
2.7.0
 ---> 4e38ec5a264b
Removing intermediate container 4bada7c0f01e
Successfully built 4e38ec5a264b

```

# Tested image `nodesource/sid:5.1.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 6460602f2a0b
 ---> 8fd0e363df29
Removing intermediate container 6460602f2a0b
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.1.0-2nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in dc05feddf50a
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 25 8317k   25 2143k    0     0  2654k      0  0:00:03 --:--:--  0:00:03 2653k[0m[91m100 8317k  100 8317k    0     0  5354k      0  0:00[0m[91m:01  0:00:01 --:--:-- 5355k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.1.0-2nodesource1~sid1) ...
Setting up nodejs (5.1.0-2nodesource1~sid1) ...
 ---> 4a96d4ba4bef
Removing intermediate container dc05feddf50a
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in dfbd816b330e
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp [0m[91minfo[0m[91m [0m[91musing[0m[91m pangyp@2.3.3
gyp info using node@5.1.0 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp GET http://nodejs.org/dist/v5.1.0/node-v5.1.0.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp 200 http://nodejs.org/dist/v5.1.0/node-v5.1.0.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v5.1.0/SHASUMS256.txt
[0m[91mgyp[0m[91m http 200 http://nodejs.org/dist/v5.1.0/SHASUMS256.txt
[0m[91mgyp [0m[91minfo spawn python
[0m[91mgyp[0m[91m [0m[91minfo [0m[91mspawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.1.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp[0m[91m info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.1.0',
gyp info spawn args   '-Druntime=node',
[0m[91mgyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
[0m[91mgyp info[0m[91m [0m[91mspawn args   'build',
[0m[91mgyp[0m[91m [0m[91minfo[0m[91m [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error[0m[91m 
[0m[91mgyp ERR! [0m[91mstack Error: `gyp` failed with exit code: 1
gyp [0m[91mERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.1.0
gyp ERR! pangyp -v v2.3.3
[0m[91mgyp ERR![0m[91m not ok 
[0m
 ---> 382d9b454c27
Removing intermediate container dfbd816b330e
Step 5 : ENV NODE_ENV production
 ---> Running in 8b9929a01de6
 ---> a93ad526e647
Removing intermediate container 8b9929a01de6
Step 6 : WORKDIR /usr/src/app
 ---> Running in 8f2fb7661123
 ---> 86a410403152
Removing intermediate container 8f2fb7661123
Step 7 : CMD npm start
 ---> Running in 23c193388455
 ---> 9be203583b29
Removing intermediate container 23c193388455
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 56daeaa691de
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4501 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirror.picosecond.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:6 http://mirror.picosecond.org/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:8 http://mirror.picosecond.org/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:3 http://mirrors.kernel.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:9 http://mirror.picosecond.org/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:7 http://mirrors.kernel.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:11 http://mirrors.kernel.org/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:10 http://mirror.picosecond.org/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (3500 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18932 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 8909d26b5f74
Removing intermediate container 56daeaa691de
Successfully built 8909d26b5f74

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test164`

Contents of dockerfile `/root/docker-node/.~tmp.test164/Dockerfile`:

```
FROM nodesource/sid:5.1.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:5.1.0-test1` from `/root/docker-node/.~tmp.test164`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:5.1.0
 ---> 8909d26b5f74
Step 2 : ENV NODE_ENV test
 ---> Running in 305d263629b8
 ---> 64c6b8007c68
Removing intermediate container 305d263629b8
Step 3 : RUN node -v
 ---> Running in 91d03b874bae
v5.1.0
 ---> e374028810f7
Removing intermediate container 91d03b874bae
Step 4 : RUN node -p "process.versions"
 ---> Running in d7580abca106
{ http_parser: '2.6.0',
  node: '5.1.0',
  v8: '4.6.85.31',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2d' }
 ---> 0119d1da6371
Removing intermediate container d7580abca106
Step 5 : RUN npm --version
 ---> Running in 3eda547bdc44
3.3.12
 ---> 5e7faef6546c
Removing intermediate container 3eda547bdc44
Successfully built 5e7faef6546c

```

# Tested image `nodesource/sid:iojs-2.1.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in ab280f95953a
 ---> acfada1fbd00
Removing intermediate container ab280f95953a
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.1.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 0c021e161eee
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 11 5632k   11  671k    0     0  1506k      0  0:00:03 --:--:--  0:[0m[91m00:03 1506k[0m[91m100 5632k  100 5632k    0     0  7069k      0 --:--:-- --:--:-- --:--:-- 7067k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.1.0-1nodesource1~sid1) ...
Setting up iojs (2.1.0-1nodesource1~sid1) ...
 ---> 4a5d2b7f13f8
Removing intermediate container 0c021e161eee
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 4b4a3ee2ae14
[91mnpm[0m[91m WARN [0m[91mdeprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@2.1.0 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp [0m[91mGET https://iojs.org/dist/v2.1.0/iojs-v2.1.0.tar.gz
[0m[91mgyp[0m[91m http [0m[91m200 https://iojs.org/dist/v2.1.0/iojs-v2.1.0.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v2.1.0/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v2.1.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/2.1.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/2.1.0',
gyp[0m[91m info[0m[91m spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp [0m[91minfo spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp[0m[91m ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1009:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
[0m[91mgyp ERR! node -v v2.1.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 9442f5eafa84
Removing intermediate container 4b4a3ee2ae14
Step 5 : ENV NODE_ENV production
 ---> Running in 8ae518f0eeaf
 ---> 1463ac7a79ed
Removing intermediate container 8ae518f0eeaf
Step 6 : WORKDIR /usr/src/app
 ---> Running in b11661cd0315
 ---> 0e0d78b45f69
Removing intermediate container b11661cd0315
Step 7 : CMD npm start
 ---> Running in 95126367e611
 ---> 8210cce7c33a
Removing intermediate container 95126367e611
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in a3fb77692b8c
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (3890 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2816 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18545 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18545 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18545 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18545 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18545 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18545 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18545 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18545 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18545 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18545 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18545 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18545 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18545 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> cc2d071c4b17
Removing intermediate container a3fb77692b8c
Successfully built cc2d071c4b17

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test175`

Contents of dockerfile `/root/docker-node/.~tmp.test175/Dockerfile`:

```
FROM nodesource/sid:iojs-2.1.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-2.1.0-test1` from `/root/docker-node/.~tmp.test175`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-2.1.0
 ---> cc2d071c4b17
Step 2 : ENV NODE_ENV test
 ---> Running in efdabf71aded
 ---> cafb6e720825
Removing intermediate container efdabf71aded
Step 3 : RUN node -v
 ---> Running in 5de3095ff8ad
v2.1.0
 ---> 46cb6b16828d
Removing intermediate container 5de3095ff8ad
Step 4 : RUN node -p "process.versions"
 ---> Running in 109c946fb3b0
{ http_parser: '2.5.0',
  node: '2.1.0',
  v8: '4.2.77.20',
  uv: '1.5.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2a' }
 ---> feba539e8dd9
Removing intermediate container 109c946fb3b0
Step 5 : RUN npm --version
 ---> Running in a4ffe460bfa3
2.10.1
 ---> eaaa8cf522b4
Removing intermediate container a4ffe460bfa3
Successfully built eaaa8cf522b4

```

# Tested image `nodesource/sid:iojs-1.3.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in b6f6e85c3b1d
 ---> d6b12d284f6e
Removing intermediate container b6f6e85c3b1d
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.3.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 4ec1fd9934cb
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5066k  100 5066k    0     0  6414k      0 --:--:-- --:--:-- --:--:-- 6413k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.3.0-1nodesource1~sid1) ...
Setting up iojs (1.3.0-1nodesource1~sid1) ...
 ---> 22cef7277376
Removing intermediate container 4ec1fd9934cb
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in bbd0b8e124aa
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with[0m[91m ok
[0m[91mgyp [0m[91minfo [0m[91musing[0m[91m pangyp@2.3.3
gyp info using node@1.3.0 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp GET https://iojs.org/dist/v1.3.0/iojs-v1.3.0.tar.gz
[0m[91mgyp [0m[91mhttp 200[0m[91m https://iojs.org/dist/v1.3.0/iojs-v1.3.0.tar.gz
[0m[91mgyp[0m[91m http [0m[91mGET[0m[91m https://iojs.org/dist/v1.3.0/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v1.3.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.3.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.3.0',
gyp info spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m [0m[91mERR! configure error 
[0m[91mgyp ERR![0m[91m stack Error: `gyp` failed with exit code: 1
[0m[91mgyp[0m[91m ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack[0m[91m     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
[0m[91mgyp ERR![0m[91m System[0m[91m Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp [0m[91mERR! cwd /
[0m[91mgyp ERR! node -v v1.3.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! [0m[91mnot ok 
[0m
 ---> d9d0506da818
Removing intermediate container bbd0b8e124aa
Step 5 : ENV NODE_ENV production
 ---> Running in 0e2159b32d2b
 ---> 764a94b196a8
Removing intermediate container 0e2159b32d2b
Step 6 : WORKDIR /usr/src/app
 ---> Running in d0693a57735e
 ---> f3ffb2dcef23
Removing intermediate container d0693a57735e
Step 7 : CMD npm start
 ---> Running in 0ae292ce0f08
 ---> f5e7696b9222
Removing intermediate container 0ae292ce0f08
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 97de027e5b44
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 5s (1939 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2919 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18030 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18030 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18030 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18030 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18030 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18030 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18030 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18030 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18030 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18030 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18030 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18030 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18030 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 846f1eed2e5f
Removing intermediate container 97de027e5b44
Successfully built 846f1eed2e5f

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test169`

Contents of dockerfile `/root/docker-node/.~tmp.test169/Dockerfile`:

```
FROM nodesource/sid:iojs-1.3.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-1.3.0-test1` from `/root/docker-node/.~tmp.test169`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-1.3.0
 ---> 846f1eed2e5f
Step 2 : ENV NODE_ENV test
 ---> Running in 61105ae5fd7e
 ---> c64d0c40eab7
Removing intermediate container 61105ae5fd7e
Step 3 : RUN node -v
 ---> Running in a4a873f76869
v1.3.0
 ---> ee72a0917e07
Removing intermediate container a4a873f76869
Step 4 : RUN node -p "process.versions"
 ---> Running in d2475356c0aa
{ http_parser: '2.3.0',
  node: '1.3.0',
  v8: '4.1.0.14',
  uv: '1.4.0',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1k' }
 ---> e7fb3823f772
Removing intermediate container d2475356c0aa
Step 5 : RUN npm --version
 ---> Running in 299e2e663794
2.5.1
 ---> 81b7d049de45
Removing intermediate container 299e2e663794
Successfully built 81b7d049de45

```

# Tested image `nodesource/sid:iojs-1.6.3`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 892ab3197f5b
 ---> 619130dacc8d
Removing intermediate container 892ab3197f5b
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.6.3-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 4548a5c45579
[91m  % [0m[91mTotal    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 76 5178k   76 3967k    0     0  5350k      0 --:--:-- --:--:-- --:--:-- 5347k[0m[91m100 5178k  100 5178k    0     0  6220k      0 --:--:-- --:--:-- --:--:-- 6217k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.6.3-1nodesource1~sid1) ...
Setting up iojs (1.6.3-1nodesource1~sid1) ...
 ---> 95296b530125
Removing intermediate container 4548a5c45579
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in a2bcb021f064
[91mnpm[0m[91m [0m[91mWARN [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated[0m[91m graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp info it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@1.6.3 | linux | x64
[0m[91mgyp http GET https://iojs.org/dist/v1.6.3/iojs-v1.6.3.tar.gz
[0m[91mgyp[0m[91m http 200 https://iojs.org/dist/v1.6.3/iojs-v1.6.3.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp[0m[91m [0m[91mGET https://iojs.org/dist/v1.6.3/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200 https://iojs.org/dist/v1.6.3/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.6.3/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.6.3',
gyp info spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.6.3
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 40bec7cb5a0a
Removing intermediate container a2bcb021f064
Step 5 : ENV NODE_ENV production
 ---> Running in 22e56c9c04ab
 ---> d9776eabd81d
Removing intermediate container 22e56c9c04ab
Step 6 : WORKDIR /usr/src/app
 ---> Running in f848aa283591
 ---> 22ee5d768dad
Removing intermediate container f848aa283591
Step 7 : CMD npm start
 ---> Running in 0e8d84d3e149
 ---> 4f2d4bf5e15b
Removing intermediate container 0e8d84d3e149
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in a3e1165293c0
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirror.picosecond.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 4s (2278 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirror.picosecond.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:6 http://mirrors.kernel.org/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.kernel.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.kernel.org/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:13 http://mirrors.kernel.org/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
Get:11 http://mirror.picosecond.org/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirror.picosecond.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (2986 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18190 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18190 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18190 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18190 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18190 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18190 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18190 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18190 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18190 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18190 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18190 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18190 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18190 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> ddba4398f94d
Removing intermediate container a3e1165293c0
Successfully built ddba4398f94d

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test187`

Contents of dockerfile `/root/docker-node/.~tmp.test187/Dockerfile`:

```
FROM nodesource/sid:iojs-1.6.3
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-1.6.3-test1` from `/root/docker-node/.~tmp.test187`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-1.6.3
 ---> ddba4398f94d
Step 2 : ENV NODE_ENV test
 ---> Running in c60b92efbe34
 ---> 4988f02164e5
Removing intermediate container c60b92efbe34
Step 3 : RUN node -v
 ---> Running in f5b21088899f
v1.6.3
 ---> f70e4ccb5bb6
Removing intermediate container f5b21088899f
Step 4 : RUN node -p "process.versions"
 ---> Running in e3936288c287
{ http_parser: '2.3.0',
  node: '1.6.3',
  v8: '4.1.0.27',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1m' }
 ---> 8dc31a77fa0e
Removing intermediate container e3936288c287
Step 5 : RUN npm --version
 ---> Running in e38c5f9dabe3
2.7.4
 ---> 02c53b7ec102
Removing intermediate container e38c5f9dabe3
Successfully built 02c53b7ec102

```

# Tested image `nodesource/sid:iojs-2.2.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 910b08c8f4ad
 ---> 4ea8e3e7c4ca
Removing intermediate container 910b08c8f4ad
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.2.1-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 3ecb61496222
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 52 5641k   52 2943k    0     0  3954k      0  0:00:01 --:--:--  0:00:01 3951k[0m[91m100 5641k  100 5641k    0     0  5995k      0 --:--:-- --:--:-- --:--:-- 5995k[0m[91m
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.2.1-1nodesource1~sid1) ...
Setting up iojs (2.2.1-1nodesource1~sid1) ...
 ---> 7f9815119f95
Removing intermediate container 3ecb61496222
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in d44a7686c075
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with ok
[0m[91mgyp[0m[91m info using pangyp@2.3.3
gyp info using node@2.2.1 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v2.2.1/iojs-v2.2.1.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v2.2.1/iojs-v2.2.1.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v2.2.1/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v2.2.1/SHASUMS256.txt
[0m[91mgyp [0m[91minfo spawn python
[0m[91mgyp info spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args[0m[91m   'binding.gyp',
[0m[91mgyp[0m[91m info spawn args[0m[91m   '-f',
gyp info spawn args   'make',
gyp info [0m[91mspawn args   '-I',
gyp info spawn args[0m[91m   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
[0m[91mgyp info spawn args   '/root/.node-gyp/2.2.1/common.gypi',
gyp[0m[91m info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/2.2.1',
gyp [0m[91minfo[0m[91m spawn args   '-Druntime=iojs',
gyp [0m[91minfo[0m[91m spawn args[0m[91m   '-Dmodule_root_dir=/',
[0m[91mgyp info[0m[91m spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m ERR![0m[91m configure error 
[0m[91mgyp [0m[91mERR! stack[0m[91m Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack[0m[91m     at Process.ChildProcess._handle.onexit (internal/child_process.js:199:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v2.2.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> bf62b5663100
Removing intermediate container d44a7686c075
Step 5 : ENV NODE_ENV production
 ---> Running in 47339b4531ac
 ---> 9c109e314329
Removing intermediate container 47339b4531ac
Step 6 : WORKDIR /usr/src/app
 ---> Running in 8a8912fe3401
 ---> eaa80d87c98e
Removing intermediate container 8a8912fe3401
Step 7 : CMD npm start
 ---> Running in 1aa4a6a4fa83
 ---> 1df848529e9e
Removing intermediate container 1aa4a6a4fa83
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 4cac6e4c97c7
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (2908 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (4453 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18573 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18573 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18573 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18573 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18573 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18573 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18573 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18573 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18573 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18573 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18573 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18573 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18573 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> dbd4227a5fc6
Removing intermediate container 4cac6e4c97c7
Successfully built dbd4227a5fc6

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test176`

Contents of dockerfile `/root/docker-node/.~tmp.test176/Dockerfile`:

```
FROM nodesource/sid:iojs-2.2.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-2.2.1-test1` from `/root/docker-node/.~tmp.test176`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-2.2.1
 ---> dbd4227a5fc6
Step 2 : ENV NODE_ENV test
 ---> Running in b3781cd70d21
 ---> ba97246331f8
Removing intermediate container b3781cd70d21
Step 3 : RUN node -v
 ---> Running in b0a201a3b4c7
v2.2.1
 ---> e33301c1f6d0
Removing intermediate container b0a201a3b4c7
Step 4 : RUN node -p "process.versions"
 ---> Running in 087c97885997
{ http_parser: '2.5.0',
  node: '2.2.1',
  v8: '4.2.77.20',
  uv: '1.5.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2a' }
 ---> 23ba568654b5
Removing intermediate container 087c97885997
Step 5 : RUN npm --version
 ---> Running in 6bf0d2119e81
2.11.0
 ---> 3929b825c2d5
Removing intermediate container 6bf0d2119e81
Successfully built 3929b825c2d5

```

# Tested image `nodesource/sid:iojs-1.5.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 58b6913abc0c
 ---> 5464093515f8
Removing intermediate container 58b6913abc0c
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.5.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in e7ef9a2c46cd
[91m  % Total    % Received % Xferd  Averag[0m[91me Speed   Time    Time     Time  Cu[0m[91mrrent
                            [0m[91m     Dloa[0m[91md  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 73 5102k   73 3759k    0     0  5038k      0  0:00:01 --:--:--  0:00:01 5033k[0m[91m100 5102k  100 5102k    0     0  6064k      0 --:--:-- --:--:-- --:--:-- 6059k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.5.0-1nodesource1~sid1) ...
Setting up iojs (1.5.0-1nodesource1~sid1) ...
 ---> 1ec6baf603e6
Removing intermediate container e7ef9a2c46cd
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 00b56caaa2d8
[91mnpm[0m[91m [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp[0m[91m info [0m[91musing pangyp@2.3.3
gyp info using node@1.5.0 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v1.5.0/iojs-v1.5.0.tar.gz
[0m[91mgyp http 200[0m[91m https://iojs.org/dist/v1.5.0/iojs-v1.5.0.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v1.5.0/SHASUMS256.txt
[0m[91mgyp[0m[91m http 200 https://iojs.org/dist/v1.5.0/SHASUMS256.txt
[0m[91mgyp [0m[91minfo spawn python
gyp [0m[91minfo spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp[0m[91m info spawn args[0m[91m   '-I',
gyp info[0m[91m spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.5.0/common.gypi',
gyp[0m[91m info spawn args[0m[91m   '-Dlibrary=shared_library',
gyp [0m[91minfo spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.5.0',
gyp[0m[91m info[0m[91m spawn args[0m[91m   '-Druntime=iojs',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
gyp info [0m[91mspawn args   '--depth=.',
gyp[0m[91m info[0m[91m [0m[91mspawn args   '--no-parallel',
gyp info spawn args[0m[91m   '--generator-output',
gyp [0m[91minfo [0m[91mspawn args   'build',
[0m[91mgyp info[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error[0m[91m 
[0m[91mgyp ERR![0m[91m stack Error: `gyp` failed with exit code: 1
gyp ERR! [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp[0m[91m ERR![0m[91m [0m[91mstack[0m[91m     at emitTwo (events.js:87:13)
[0m[91mgyp ERR! [0m[91mstack     at ChildProcess.emit (events.js:169:7)
gyp [0m[91mERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.5.0
gyp ERR![0m[91m pangyp -v[0m[91m v2.3.3
gyp ERR![0m[91m not ok[0m[91m 
[0m
 ---> b030cfa30ef1
Removing intermediate container 00b56caaa2d8
Step 5 : ENV NODE_ENV production
 ---> Running in 942a6686be66
 ---> 3cac09b9710c
Removing intermediate container 942a6686be66
Step 6 : WORKDIR /usr/src/app
 ---> Running in e892fe64912e
 ---> 053e7df7127b
Removing intermediate container e892fe64912e
Step 7 : CMD npm start
 ---> Running in 8e11546ffd7f
 ---> da1a31e9c761
Removing intermediate container 8e11546ffd7f
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in ab64567aabc4
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (3914 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirror.picosecond.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:4 http://mirror.picosecond.org/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:3 http://mirrors.kernel.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:8 http://mirrors.kernel.org/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:7 http://mirror.picosecond.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:12 http://mirrors.kernel.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:10 http://mirror.picosecond.org/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:13 http://mirror.picosecond.org/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2506 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18031 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 8907bcaf00c5
Removing intermediate container ab64567aabc4
Successfully built 8907bcaf00c5

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test184`

Contents of dockerfile `/root/docker-node/.~tmp.test184/Dockerfile`:

```
FROM nodesource/sid:iojs-1.5.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-1.5.0-test1` from `/root/docker-node/.~tmp.test184`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-1.5.0
 ---> 8907bcaf00c5
Step 2 : ENV NODE_ENV test
 ---> Running in dd2a52bffe2a
 ---> 572d22a1b60a
Removing intermediate container dd2a52bffe2a
Step 3 : RUN node -v
 ---> Running in 7f596b6c07d7
v1.5.0
 ---> b6577c45a37a
Removing intermediate container 7f596b6c07d7
Step 4 : RUN node -p "process.versions"
 ---> Running in a697fdf02013
{ http_parser: '2.3.0',
  node: '1.5.0',
  v8: '4.1.0.21',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1k' }
 ---> a9657e424f0a
Removing intermediate container a697fdf02013
Step 5 : RUN npm --version
 ---> Running in 623d24cccc08
2.7.0
 ---> 2d33cb1945cd
Removing intermediate container 623d24cccc08
Successfully built 2d33cb1945cd

```

# Tested image `nodesource/sid:iojs-1.6.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 58c67abce209
 ---> 9cae33d36ed3
Removing intermediate container 58c67abce209
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.6.1-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in bea712d90f2f
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5136k  100 5136k    0     0  5745k      0 --:--:-- --:--:-- --:--:-- 5745k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.6.1-1nodesource1~sid1) ...
Setting up iojs (1.6.1-1nodesource1~sid1) ...
 ---> 594086ad69ab
Removing intermediate container bea712d90f2f
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 70c856596e87
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo[0m[91m [0m[91mit worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
[0m[91mgyp info using node@1.6.1 | linux | x64
[0m[91mgyp http GET https://iojs.org/dist/v1.6.1/iojs-v1.6.1.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v1.6.1/iojs-v1.6.1.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v1.6.1/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v1.6.1/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp [0m[91minfo [0m[91mspawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.6.1/common.gypi',
gyp info spawn args[0m[91m   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.6.1',
gyp[0m[91m info[0m[91m spawn args   '-Druntime=iojs',
[0m[91mgyp info[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp [0m[91minfo spawn args[0m[91m   'build',
gyp [0m[91minfo[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error[0m[91m 
[0m[91mgyp [0m[91mERR! [0m[91mstack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack[0m[91m     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command[0m[91m "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp [0m[91mERR! node -v[0m[91m v1.6.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 9dc2e6237eb5
Removing intermediate container 70c856596e87
Step 5 : ENV NODE_ENV production
 ---> Running in 5c12cbd2e8b3
 ---> 6c2a82ebe0ea
Removing intermediate container 5c12cbd2e8b3
Step 6 : WORKDIR /usr/src/app
 ---> Running in 900e62a837f2
 ---> 97e0f63e8a4b
Removing intermediate container 900e62a837f2
Step 7 : CMD npm start
 ---> Running in d07a7d10634e
 ---> a7d5e810d333
Removing intermediate container d07a7d10634e
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in fefcbf1005dc
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (2914 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2897 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18064 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18064 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18064 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18064 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18064 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18064 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18064 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18064 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18064 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18064 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18064 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18064 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18064 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 85a1911f8da0
Removing intermediate container fefcbf1005dc
Successfully built 85a1911f8da0

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test185`

Contents of dockerfile `/root/docker-node/.~tmp.test185/Dockerfile`:

```
FROM nodesource/sid:iojs-1.6.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-1.6.1-test1` from `/root/docker-node/.~tmp.test185`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-1.6.1
 ---> 85a1911f8da0
Step 2 : ENV NODE_ENV test
 ---> Running in 54058a19d9cf
 ---> 50ca72c0d6c7
Removing intermediate container 54058a19d9cf
Step 3 : RUN node -v
 ---> Running in c6be2b732cba
v1.6.1
 ---> bda5e67d18c0
Removing intermediate container c6be2b732cba
Step 4 : RUN node -p "process.versions"
 ---> Running in 2f4faeeb4d5b
{ http_parser: '2.3.0',
  node: '1.6.1',
  v8: '4.1.0.21',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1m' }
 ---> 36d5c67633a6
Removing intermediate container 2f4faeeb4d5b
Step 5 : RUN npm --version
 ---> Running in d2ec91eadd30
2.7.1
 ---> 6e0e725d7e3b
Removing intermediate container d2ec91eadd30
Successfully built 6e0e725d7e3b

```

# Tested image `nodesource/sid:iojs-3.0.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 58622a935391
 ---> 8f26ab4a82de
Removing intermediate container 58622a935391
Step 3 : RUN curl https://deb.nodesource.com/iojs_3.x/pool/main/i/iojs/iojs_3.0.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 45f231c42f47
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 6153k  100 6153k    0     0  7059k      0 --:--:-- --:--:-- --:--:-- 7056k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (3.0.0-1nodesource1~sid1) ...
Setting up iojs (3.0.0-1nodesource1~sid1) ...
 ---> 26fec516ab70
Removing intermediate container 45f231c42f47
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 864cd0d4f953
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN[0m[91m deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@3.0.0 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v3.0.0/iojs-v3.0.0.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v3.0.0/iojs-v3.0.0.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v3.0.0/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp [0m[91m200 https://iojs.org/dist/v3.0.0/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info [0m[91mspawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp [0m[91minfo spawn args   '/build/config.gypi',
gyp[0m[91m info[0m[91m [0m[91mspawn args[0m[91m   '-I',
gyp [0m[91minfo spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info [0m[91mspawn args   '/root/.node-gyp/3.0.0/common.gypi',
gyp [0m[91minfo [0m[91mspawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info [0m[91mspawn args   '-Dnode_root_dir=/root/.node-gyp/3.0.0',
gyp [0m[91minfo[0m[91m spawn args   '-Druntime=iojs',
[0m[91mgyp [0m[91minfo[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args[0m[91m   '--depth=.',
gyp info spawn args[0m[91m   '--no-parallel',
[0m[91mgyp info spawn args   '--generator-output',
[0m[91mgyp info [0m[91mspawn args   'build',
[0m[91mgyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m [0m[91mERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! [0m[91mnode -v v3.0.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 1d56f8e787fd
Removing intermediate container 864cd0d4f953
Step 5 : ENV NODE_ENV production
 ---> Running in f1826633c9cf
 ---> a8e55dbf56f1
Removing intermediate container f1826633c9cf
Step 6 : WORKDIR /usr/src/app
 ---> Running in f8d1d6302ed5
 ---> 9e08302b4e9c
Removing intermediate container f8d1d6302ed5
Step 7 : CMD npm start
 ---> Running in 874862dd9562
 ---> 6a9144859367
Removing intermediate container 874862dd9562
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 5cf057b9cef7
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3667 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.kernel.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirror.picosecond.org/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.kernel.org/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:8 http://mirrors.kernel.org/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.kernel.org/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:6 http://mirror.picosecond.org/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:12 http://mirror.picosecond.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirror.picosecond.org/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2723 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> b93fb80feee3
Removing intermediate container 5cf057b9cef7
Successfully built b93fb80feee3

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test179`

Contents of dockerfile `/root/docker-node/.~tmp.test179/Dockerfile`:

```
FROM nodesource/sid:iojs-3.0.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-3.0.0-test1` from `/root/docker-node/.~tmp.test179`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-3.0.0
 ---> b93fb80feee3
Step 2 : ENV NODE_ENV test
 ---> Running in 520948ae165b
 ---> c9406a6bd6c1
Removing intermediate container 520948ae165b
Step 3 : RUN node -v
 ---> Running in bf15f4f48c7c
v3.0.0
 ---> 8c1f41fd41a4
Removing intermediate container bf15f4f48c7c
Step 4 : RUN node -p "process.versions"
 ---> Running in 920951e96d3c
{ http_parser: '2.5.0',
  node: '3.0.0',
  v8: '4.4.63.26',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '45',
  openssl: '1.0.2d' }
 ---> bce6f0a2ae3d
Removing intermediate container 920951e96d3c
Step 5 : RUN npm --version
 ---> Running in eb1ad284cd72
2.13.3
 ---> 7c9b568f611e
Removing intermediate container eb1ad284cd72
Successfully built 7c9b568f611e

```

# Tested image `nodesource/sid:iojs-1.8.4`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 84c946db267a
 ---> a1b36439d39a
Removing intermediate container 84c946db267a
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.8.4-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 973ba74b832b
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
               [0m[91m                  Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0 5762k    0 48854    0     0  83201      0  0:01:10 --:--:--  0:01:10 83085[0m[91m100 5762k  100 5762k    0     0  5360k      0  0:00:01  0:00:01 --:--:-- 5365k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.8.4-1nodesource1~sid1) ...
Setting up iojs (1.8.4-1nodesource1~sid1) ...
 ---> a7106b6d4f5f
Removing intermediate container 973ba74b832b
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 1e78b50fc16a
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@1.8.4 | linux | x64
[0m[91mgyp [0m[91mhttp GET https://iojs.org/dist/v1.8.4/iojs-v1.8.4.tar.gz
[0m[91mgyp http 200[0m[91m https://iojs.org/dist/v1.8.4/iojs-v1.8.4.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v1.8.4/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v1.8.4/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.8.4/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.8.4',
gyp info spawn args   '-Druntime=iojs',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp[0m[91m ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1009:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.8.4
[0m[91mgyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 6e9ba3be7a45
Removing intermediate container 1e78b50fc16a
Step 5 : ENV NODE_ENV production
 ---> Running in 554290cc2e9c
 ---> a0ecd9e07330
Removing intermediate container 554290cc2e9c
Step 6 : WORKDIR /usr/src/app
 ---> Running in e5501ef621f9
 ---> 99aeaaf82669
Removing intermediate container e5501ef621f9
Step 7 : CMD npm start
 ---> Running in 0fa9bd7f5de8
 ---> d6de74836f37
Removing intermediate container 0fa9bd7f5de8
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 94419136a186
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4649 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (4557 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> f5b487c3fc9c
Removing intermediate container 94419136a186
Successfully built f5b487c3fc9c

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test166`

Contents of dockerfile `/root/docker-node/.~tmp.test166/Dockerfile`:

```
FROM nodesource/sid:iojs-1.8.4
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-1.8.4-test1` from `/root/docker-node/.~tmp.test166`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-1.8.4
 ---> f5b487c3fc9c
Step 2 : ENV NODE_ENV test
 ---> Running in a7f952b8a756
 ---> 0b69553dd755
Removing intermediate container a7f952b8a756
Step 3 : RUN node -v
 ---> Running in 6b0279d06f4d
v1.8.4
 ---> 24845469bdf6
Removing intermediate container 6b0279d06f4d
Step 4 : RUN node -p "process.versions"
 ---> Running in e6691699fa4f
{ http_parser: '2.5.0',
  node: '1.8.4',
  v8: '4.1.0.27',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.2d' }
 ---> f1f015645645
Removing intermediate container e6691699fa4f
Step 5 : RUN npm --version
 ---> Running in 3502a0bdc2de
2.9.0
 ---> c75d602b67dc
Removing intermediate container 3502a0bdc2de
Successfully built c75d602b67dc

```

# Tested image `nodesource/sid:iojs-2.0.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in b9b5dac779ae
 ---> 5d8d4f757e06
Removing intermediate container b9b5dac779ae
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.0.1-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 41c2473b6a30
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --[0m[91m:--:-- --:--:-- --:--:--     0[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.0.1-1nodesource1~sid1) ...
[91m100 5605k  100 5605k    0     0  6529k      0 --:--:-- --:--:-- --:--:-- 6533k
[0mSetting up iojs (2.0.1-1nodesource1~sid1) ...
 ---> 9df225f027c7
Removing intermediate container 41c2473b6a30
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 9aaf17467152
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, form-data@0.2.0, bl@0.9.5, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
gyp info using node@2.0.1 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v2.0.1/iojs-v2.0.1.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v2.0.1/iojs-v2.0.1.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v2.0.1/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v2.0.1/SHASUMS256.txt
[0m[91mgyp [0m[91minfo spawn python
[0m[91mgyp[0m[91m [0m[91minfo spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
[0m[91mgyp info[0m[91m spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp [0m[91minfo [0m[91mspawn args   '/root/.node-gyp/2.0.1/common.gypi',
gyp info [0m[91mspawn args   '-Dlibrary=shared_library',
gyp info[0m[91m spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/2.0.1',
gyp [0m[91minfo[0m[91m [0m[91mspawn args[0m[91m   '-Druntime=iojs',
[0m[91mgyp [0m[91minfo[0m[91m spawn args   '-Dmodule_root_dir=/',
[0m[91mgyp info[0m[91m spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! [0m[91mconfigure error 
[0m[91mgyp ERR! [0m[91mstack Error: `gyp` failed with exit code: 1
gyp ERR! [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! [0m[91mstack[0m[91m     at emitTwo (events.js:87:13)
[0m[91mgyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack[0m[91m     at Process.ChildProcess._handle.onexit (child_process.js:1009:12)
[0m[91mgyp ERR! [0m[91mSystem[0m[91m Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp [0m[91mERR! [0m[91mnode -v v2.0.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 2b3fb54ccb22
Removing intermediate container 9aaf17467152
Step 5 : ENV NODE_ENV production
 ---> Running in c51267e7b792
 ---> 027a4156c21d
Removing intermediate container c51267e7b792
Step 6 : WORKDIR /usr/src/app
 ---> Running in ff435f299366
 ---> 08752f1ae5d7
Removing intermediate container ff435f299366
Step 7 : CMD npm start
 ---> Running in dd9c1515c076
 ---> 73e3bb406d1d
Removing intermediate container dd9c1515c076
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 1433602cbcc7
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (5414 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (5814 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> de2fe2b354d9
Removing intermediate container 1433602cbcc7
Successfully built de2fe2b354d9

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test191`

Contents of dockerfile `/root/docker-node/.~tmp.test191/Dockerfile`:

```
FROM nodesource/sid:iojs-2.0.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-2.0.1-test1` from `/root/docker-node/.~tmp.test191`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-2.0.1
 ---> de2fe2b354d9
Step 2 : ENV NODE_ENV test
 ---> Running in 7ea741da3964
 ---> 29cf43b718e8
Removing intermediate container 7ea741da3964
Step 3 : RUN node -v
 ---> Running in bcf12bf62ce7
v2.0.1
 ---> c4bb51b28eeb
Removing intermediate container bcf12bf62ce7
Step 4 : RUN node -p "process.versions"
 ---> Running in af8c7f120527
{ http_parser: '2.5.0',
  node: '2.0.1',
  v8: '4.2.77.20',
  uv: '1.5.0',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '44',
  openssl: '1.0.2a' }
 ---> f2fa2715d3c8
Removing intermediate container af8c7f120527
Step 5 : RUN npm --version
 ---> Running in 463f3a9e7b08
2.9.0
 ---> 0b35c27f09b4
Error removing intermediate container 463f3a9e7b08: rmfs: Unable to remove filesystem for 463f3a9e7b080707c0d76dd34252595393ceca54acbe4926d2330dd85ed85b4a: remove /var/lib/docker/containers/463f3a9e7b080707c0d76dd34252595393ceca54acbe4926d2330dd85ed85b4a/shm: device or resource busy
Successfully built 0b35c27f09b4

```

# Tested image `nodesource/sid:5.6.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in fda4cf7458f8
 ---> d34fafc91c1d
Removing intermediate container fda4cf7458f8
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.6.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 10ebbeb979be
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 13 8770k   13 1167k    0     0  1863k      0  0:00:04 --:--:--  0:00:04 1862k[0m[91m100 8770k  100 8770k    0     0  7260k      0  0:00:01  0:00:01 --:--:-- 7265k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (5.6.0-1nodesource1~sid1) ...
Setting up nodejs (5.6.0-1nodesource1~sid1) ...
 ---> 09addc4efbbe
Removing intermediate container 10ebbeb979be
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 35cf86e732a5
[91mnpm[0m[91m WARN [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN[0m[91m deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
[0m[91mgyp info using node@5.6.0 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v5.6.0/node-v5.6.0.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v5.6.0/node-v5.6.0.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v5.6.0/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200 http://nodejs.org/dist/v5.6.0/SHASUMS256.txt
[0m[91mgyp info spawn[0m[91m python
[0m[91mgyp info spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
[0m[91mgyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/5.6.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.6.0',
gyp info spawn args   '-Druntime=node',
gyp[0m[91m [0m[91minfo[0m[91m spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
[0m[91mgyp[0m[91m info[0m[91m spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args   'build',
[0m[91mgyp [0m[91minfo[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp[0m[91m [0m[91mERR! stack Error: `gyp` failed with exit code: 1
gyp ERR![0m[91m stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:100:13)
gyp ERR! stack     at ChildProcess.emit (events.js:185:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.6.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 1dff2c3bffcf
Removing intermediate container 35cf86e732a5
Step 5 : ENV NODE_ENV production
 ---> Running in c953ff951f91
 ---> 3cca9b1dbea7
Removing intermediate container c953ff951f91
Step 6 : WORKDIR /usr/src/app
 ---> Running in b7b9b9d53673
 ---> 467bdb15c81b
Removing intermediate container b7b9b9d53673
Step 7 : CMD npm start
 ---> Running in 7febb978fdc8
 ---> 165e2c2dd4d8
Removing intermediate container 7febb978fdc8
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 618cc661b327
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (2937 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:4 http://mirror.picosecond.org/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:3 http://mirrors.kernel.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:9 http://mirrors.kernel.org/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:7 http://mirror.picosecond.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirror.picosecond.org/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
Get:12 http://mirrors.kernel.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (3467 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19688 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19688 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19688 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19688 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19688 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19688 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19688 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19688 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19688 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19688 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19688 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19688 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 19688 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> d543808a310e
Removing intermediate container 618cc661b327
Successfully built d543808a310e

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test133`

Contents of dockerfile `/root/docker-node/.~tmp.test133/Dockerfile`:

```
FROM nodesource/sid:5.6.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:5.6.0-test1` from `/root/docker-node/.~tmp.test133`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:5.6.0
 ---> d543808a310e
Step 2 : ENV NODE_ENV test
 ---> Running in 6dbbc792d0e4
 ---> d10130471841
Removing intermediate container 6dbbc792d0e4
Step 3 : RUN node -v
 ---> Running in c148a9f88f51
v5.6.0
 ---> f50278f14e3b
Removing intermediate container c148a9f88f51
Step 4 : RUN node -p "process.versions"
 ---> Running in 936f049e7697
{ http_parser: '2.6.1',
  node: '5.6.0',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2f' }
 ---> 927cb7320854
Removing intermediate container 936f049e7697
Step 5 : RUN npm --version
 ---> Running in 8a9e2f41e3fc
3.6.0
 ---> fe82e2d40dd3
Removing intermediate container 8a9e2f41e3fc
Successfully built fe82e2d40dd3

```

# Tested image `nodesource/sid:4.1.2`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 31920bab0ab2
 ---> ae95fb63b0d1
Removing intermediate container 31920bab0ab2
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.1.2-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in ef43b18c112e
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 76 6449k   76 4927k    0     0  5983k      0  0:00:01 --:--:--  0:00:01 5980k[0m[91m100 6449k  100 6449k    0     0  6886k      0 --:--:-- --:--:-- --:--:-- 6883k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.1.2-1nodesource1~sid1) ...
Setting up nodejs (4.1.2-1nodesource1~sid1) ...
 ---> d4947897ad4b
Removing intermediate container ef43b18c112e
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 632f39f9ca8d
[91mnpm[0m[91m WARN[0m[91m deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (forever-agent@0.5.2, aws-sign2@0.5.0, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, hawk@1.1.1, form-data@0.2.0)
[91mgyp info it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@4.1.2 | linux | x64
gyp http GET http://nodejs.org/dist/v4.1.2/node-v4.1.2.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.1.2/node-v4.1.2.tar.gz
[0m[91mgyp[0m[91m http GET[0m[91m http://nodejs.org/dist/v4.1.2/SHASUMS256.txt
[0m[91mgyp http[0m[91m 200[0m[91m http://nodejs.org/dist/v4.1.2/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp[0m[91m info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
[0m[91mgyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.1.2/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args[0m[91m   '-Dnode_root_dir=/root/.node-gyp/4.1.2',
gyp info spawn args   '-Druntime=node',
gyp info spawn args[0m[91m   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp[0m[91m info[0m[91m [0m[91mspawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp [0m[91minfo[0m[91m [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! [0m[91mconfigure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.1.2
[0m[91mgyp [0m[91mERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> a5aacb00ab4f
Removing intermediate container 632f39f9ca8d
Step 5 : ENV NODE_ENV production
 ---> Running in 06510f771f9a
 ---> 34d2e749ceb6
Removing intermediate container 06510f771f9a
Step 6 : WORKDIR /usr/src/app
 ---> Running in f08438b77da6
 ---> 9821e4093fa4
Removing intermediate container f08438b77da6
Step 7 : CMD npm start
 ---> Running in b40c0f83d8c0
 ---> 5ac63f909cac
Removing intermediate container b40c0f83d8c0
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 37ed3f7a9877
Get:1 http://mirrors.kernel.org/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4240 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (5617 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18694 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 16c082cbb0cb
Removing intermediate container 37ed3f7a9877
Successfully built 16c082cbb0cb

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test125`

Contents of dockerfile `/root/docker-node/.~tmp.test125/Dockerfile`:

```
FROM nodesource/sid:4.1.2
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:4.1.2-test1` from `/root/docker-node/.~tmp.test125`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:4.1.2
 ---> 16c082cbb0cb
Step 2 : ENV NODE_ENV test
 ---> Running in 755ac418fad4
 ---> 29a14b7cd3de
Removing intermediate container 755ac418fad4
Step 3 : RUN node -v
 ---> Running in 18202b443fa0
v4.1.2
 ---> 22773fca7a79
Removing intermediate container 18202b443fa0
Step 4 : RUN node -p "process.versions"
 ---> Running in 595625e9586c
{ http_parser: '2.5.0',
  node: '4.1.2',
  v8: '4.5.103.35',
  uv: '1.7.5',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '46',
  openssl: '1.0.2d' }
 ---> 3a0b83a39e35
Removing intermediate container 595625e9586c
Step 5 : RUN npm --version
 ---> Running in 155e5975117e
2.14.4
 ---> 65db417ec45d
Removing intermediate container 155e5975117e
Successfully built 65db417ec45d

```

# Tested image `nodesource/sid:iojs-2.3.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in eb7679ea0854
 ---> 4473148d6b77
Removing intermediate container eb7679ea0854
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.3.1-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 9ebaf4589b1a
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  1 5777k    1 98006    0     0   257k      0  0:00:22 --:--:--  0:00:22  257k[0m[91m100 5777k  100 5777k    0     0  6365k      0 --:--:-- --:--:-- --:--:-- 6363k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.3.1-1nodesource1~sid1) ...
Setting up iojs (2.3.1-1nodesource1~sid1) ...
 ---> b0eed22b0e47
Removing intermediate container 9ebaf4589b1a
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in d0cfc5bfeb0c
[91mnpm[0m[91m [0m[91mWARN deprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
gyp info using pangyp@2.3.3
gyp info using node@2.3.1 | linux | x64
[0m[91mgyp http[0m[91m GET https://iojs.org/dist/v2.3.1/iojs-v2.3.1.tar.gz
[0m[91mgyp http[0m[91m 200 https://iojs.org/dist/v2.3.1/iojs-v2.3.1.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp GET https://iojs.org/dist/v2.3.1/SHASUMS256.txt
[0m[91mgyp[0m[91m [0m[91mhttp 200 https://iojs.org/dist/v2.3.1/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/2.3.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/2.3.1',
gyp info spawn args   '-Druntime=iojs',
gyp [0m[91minfo spawn args[0m[91m   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info[0m[91m spawn args   '--generator-output',
gyp info [0m[91mspawn args   'build',
[0m[91mgyp [0m[91minfo[0m[91m [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m [0m[91mERR! configure error 
[0m[91mgyp [0m[91mERR! stack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp [0m[91mERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System[0m[91m Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp ERR! node -v[0m[91m v2.3.1
[0m[91mgyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> f846f8939a28
Removing intermediate container d0cfc5bfeb0c
Step 5 : ENV NODE_ENV production
 ---> Running in 2178ce47a430
 ---> 6a86df6aeee8
Removing intermediate container 2178ce47a430
Step 6 : WORKDIR /usr/src/app
 ---> Running in afbf0f2ec0b0
 ---> 80151aa29b2b
Removing intermediate container afbf0f2ec0b0
Step 7 : CMD npm start
 ---> Running in 2cd805a338c0
 ---> 1a4862f1834c
Removing intermediate container 2cd805a338c0
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 49584b56d052
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (5322 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (2929 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> d0e52832ac07
Removing intermediate container 49584b56d052
Successfully built d0e52832ac07

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test193`

Contents of dockerfile `/root/docker-node/.~tmp.test193/Dockerfile`:

```
FROM nodesource/sid:iojs-2.3.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-2.3.1-test1` from `/root/docker-node/.~tmp.test193`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-2.3.1
 ---> d0e52832ac07
Step 2 : ENV NODE_ENV test
 ---> Running in e051ab05f0c4
 ---> f6303933dfc4
Removing intermediate container e051ab05f0c4
Step 3 : RUN node -v
 ---> Running in 2b25e729153d
v2.3.1
 ---> 4b333a29a32e
Removing intermediate container 2b25e729153d
Step 4 : RUN node -p "process.versions"
 ---> Running in c562b278ac24
{ http_parser: '2.5.0',
  node: '2.3.1',
  v8: '4.2.77.20',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2c' }
 ---> 1450b93fe4a5
Removing intermediate container c562b278ac24
Step 5 : RUN npm --version
 ---> Running in 2dc18e13ac43
2.11.3
 ---> 0e0f2e7a6d9b
Removing intermediate container 2dc18e13ac43
Successfully built 0e0f2e7a6d9b

```

# Tested image `nodesource/sid:iojs-2.0.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 1d7373933629
 ---> 89cf5650818c
Removing intermediate container 1d7373933629
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.0.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in f728d40493c8
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5606k  100 5606k    0     0  6525k      0 --:--:-- --:--:-- --:--:-- 6526k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.0.0-1nodesource1~sid1) ...
Setting up iojs (2.0.0-1nodesource1~sid1) ...
 ---> ebbc5c37fa30
Removing intermediate container f728d40493c8
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in b761145d1ece
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp info it worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
[0m[91mgyp info using node@2.0.0 | linux | x64
[0m[91mgyp[0m[91m http [0m[91mGET[0m[91m https://iojs.org/dist/v2.0.0/iojs-v2.0.0.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v2.0.0/iojs-v2.0.0.tar.gz
[0m[91mgyp[0m[91m http [0m[91mGET https://iojs.org/dist/v2.0.0/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200[0m[91m https://iojs.org/dist/v2.0.0/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
[0m[91mgyp info [0m[91mspawn args   '-f',
gyp info spawn args   'make',
[0m[91mgyp info [0m[91mspawn args   '-I',
gyp[0m[91m info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/2.0.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/2.0.0',
gyp info spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info [0m[91mspawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error[0m[91m 
[0m[91mgyp [0m[91mERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR![0m[91m stack[0m[91m     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1009:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp[0m[91m ERR! command[0m[91m "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v2.0.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 207eb2fdcd6f
Removing intermediate container b761145d1ece
Step 5 : ENV NODE_ENV production
 ---> Running in 9772130b143c
 ---> 21adedd1fc78
Removing intermediate container 9772130b143c
Step 6 : WORKDIR /usr/src/app
 ---> Running in 74755c0c546d
 ---> 32c795d1c5ad
Removing intermediate container 74755c0c546d
Step 7 : CMD npm start
 ---> Running in 162a3d6713ff
 ---> 726655a7a2dd
Removing intermediate container 162a3d6713ff
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 27bbbf58199d
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3357 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (6733 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> efcef049d1e3
Removing intermediate container 27bbbf58199d
Successfully built efcef049d1e3

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test190`

Contents of dockerfile `/root/docker-node/.~tmp.test190/Dockerfile`:

```
FROM nodesource/sid:iojs-2.0.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-2.0.0-test1` from `/root/docker-node/.~tmp.test190`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-2.0.0
 ---> efcef049d1e3
Step 2 : ENV NODE_ENV test
 ---> Running in 74b7d8058dd7
 ---> 0734544911bf
Removing intermediate container 74b7d8058dd7
Step 3 : RUN node -v
 ---> Running in d8cc1e0a518a
v2.0.0
 ---> ec2933b355d2
Removing intermediate container d8cc1e0a518a
Step 4 : RUN node -p "process.versions"
 ---> Running in ac086a9f322c
{ http_parser: '2.5.0',
  node: '2.0.0',
  v8: '4.2.77.18',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '44',
  openssl: '1.0.2a' }
 ---> f25b28967b8b
Removing intermediate container ac086a9f322c
Step 5 : RUN npm --version
 ---> Running in a43962f391cc
2.9.0
 ---> 7656f635638e
Removing intermediate container a43962f391cc
Successfully built 7656f635638e

```

# Tested image `nodesource/sid:iojs-1.4.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 52c41c57dab6
 ---> bc198e4a8a7a
Removing intermediate container 52c41c57dab6
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.4.1-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 7b009aeef726
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5089k  100 5089k    0     0  6374k      0 --:--:-- --:[0m[91m--:-- --:--:-- 6370k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.4.1-1nodesource1~sid1) ...
Setting up iojs (1.4.1-1nodesource1~sid1) ...
 ---> 8aa9312a68b2
Removing intermediate container 7b009aeef726
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in ae9812737f83
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo [0m[91mit worked if it ends with[0m[91m ok
[0m[91mgyp [0m[91minfo[0m[91m using pangyp@2.3.3
gyp info using node@1.4.1 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v1.4.1/iojs-v1.4.1.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v1.4.1/iojs-v1.4.1.tar.gz
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v1.4.1/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200 https://iojs.org/dist/v1.4.1/SHASUMS256.txt
[0m[91mgyp info spawn[0m[91m python
[0m[91mgyp info[0m[91m spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args[0m[91m   '-f',
[0m[91mgyp[0m[91m [0m[91minfo spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
[0m[91mgyp [0m[91minfo [0m[91mspawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.4.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info [0m[91mspawn args   '-Dnode_root_dir=/root/.node-gyp/1.4.1',
gyp[0m[91m info[0m[91m spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info[0m[91m spawn args[0m[91m   '--generator-output',
gyp[0m[91m info[0m[91m [0m[91mspawn args   'build',
gyp [0m[91minfo[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m
[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.4.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m ---> 9eba604a20be
Removing intermediate container ae9812737f83
Step 5 : ENV NODE_ENV production
 ---> Running in 5f3d01a7044e
 ---> 9e9c7d5993c6
Removing intermediate container 5f3d01a7044e
Step 6 : WORKDIR /usr/src/app
 ---> Running in 006caf7d80d2
 ---> adfa5b919a07
Removing intermediate container 006caf7d80d2
Step 7 : CMD npm start
 ---> Running in 5e13c46c3077
 ---> bc260a7e9b66
Removing intermediate container 5e13c46c3077
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 961486fd4745
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3296 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2790 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18038 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18038 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18038 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18038 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18038 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18038 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18038 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18038 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18038 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18038 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18038 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18038 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18038 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 44ee9c716773
Removing intermediate container 961486fd4745
Successfully built 44ee9c716773

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test182`

Contents of dockerfile `/root/docker-node/.~tmp.test182/Dockerfile`:

```
FROM nodesource/sid:iojs-1.4.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-1.4.1-test1` from `/root/docker-node/.~tmp.test182`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-1.4.1
 ---> 44ee9c716773
Step 2 : ENV NODE_ENV test
 ---> Running in 76741ba3db63
 ---> f219166b3110
Removing intermediate container 76741ba3db63
Step 3 : RUN node -v
 ---> Running in c06424f16029
v1.4.1
 ---> f6b50db9c419
Removing intermediate container c06424f16029
Step 4 : RUN node -p "process.versions"
 ---> Running in 64cd2735359f
{ http_parser: '2.3.0',
  node: '1.4.1',
  v8: '4.1.0.21',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1k' }
 ---> e1ca6e229556
Removing intermediate container 64cd2735359f
Step 5 : RUN npm --version
 ---> Running in 600a88e7d91f
2.6.0
 ---> e23ae2228430
Removing intermediate container 600a88e7d91f
Successfully built e23ae2228430

```

# Tested image `nodesource/sid:iojs-1.7.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in c9ad077b6c79
 ---> 263aa9377781
Removing intermediate container c9ad077b6c79
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.7.1-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 811175a09030
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 5302k  100 5302k    0     0  6543k      0 --:--:-- --:--:-- --:--:-- 6546k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.7.1-1nodesource1~sid1) ...
Setting up iojs (1.7.1-1nodesource1~sid1) ...
 ---> 7af946a2611e
Removing intermediate container 811175a09030
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 29e4d17267c1
[91mnpm[0m[91m [0m[91mWARN [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo[0m[91m [0m[91musing pangyp@2.3.3
[0m[91mgyp info using node@1.7.1 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v1.7.1/iojs-v1.7.1.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp 200[0m[91m https://iojs.org/dist/v1.7.1/iojs-v1.7.1.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v1.7.1/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v1.7.1/SHASUMS256.txt
[0m[91mgyp [0m[91minfo spawn python
[0m[91mgyp info spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
[0m[91mgyp[0m[91m info[0m[91m spawn args   'make',
gyp info[0m[91m spawn args[0m[91m   '-I',
[0m[91mgyp [0m[91minfo [0m[91mspawn args   '/build/config.gypi',
gyp info[0m[91m spawn args[0m[91m   '-I',
gyp info [0m[91mspawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.7.1/common.gypi',
gyp[0m[91m info [0m[91mspawn args[0m[91m   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info[0m[91m spawn args[0m[91m   '-Dnode_root_dir=/root/.node-gyp/1.7.1',
[0m[91mgyp info[0m[91m spawn args[0m[91m   '-Druntime=iojs',
[0m[91mgyp [0m[91minfo spawn args   '-Dmodule_root_dir=/',
gyp info spawn args[0m[91m   '--depth=.',
[0m[91mgyp info[0m[91m spawn args[0m[91m   '--no-parallel',
gyp[0m[91m [0m[91minfo[0m[91m [0m[91mspawn args[0m[91m   '--generator-output',
gyp[0m[91m [0m[91minfo [0m[91mspawn args   'build',
[0m[91mgyp info spawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR![0m[91m configure error[0m[91m 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
[0m[91mgyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1009:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.7.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 57795fedce83
Removing intermediate container 29e4d17267c1
Step 5 : ENV NODE_ENV production
 ---> Running in 110896c25cc7
 ---> e334f982403e
Removing intermediate container 110896c25cc7
Step 6 : WORKDIR /usr/src/app
 ---> Running in 90782025933c
 ---> 3e0c67cf92b5
Removing intermediate container 90782025933c
Step 7 : CMD npm start
 ---> Running in 79afae548fdb
 ---> 047ba4bffe13
Removing intermediate container 79afae548fdb
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 92ca648427df
Get:1 http://mirrors.kernel.org/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3500 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (4120 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18514 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18514 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18514 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18514 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18514 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18514 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18514 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18514 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18514 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18514 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18514 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18514 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18514 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> f1c605f0aedf
Removing intermediate container 92ca648427df
Successfully built f1c605f0aedf

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test173`

Contents of dockerfile `/root/docker-node/.~tmp.test173/Dockerfile`:

```
FROM nodesource/sid:iojs-1.7.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-1.7.1-test1` from `/root/docker-node/.~tmp.test173`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-1.7.1
 ---> f1c605f0aedf
Step 2 : ENV NODE_ENV test
 ---> Running in 93626942c3c7
 ---> 079fc604914a
Removing intermediate container 93626942c3c7
Step 3 : RUN node -v
 ---> Running in 277333acef88
v1.7.1
 ---> f65220f07c22
Removing intermediate container 277333acef88
Step 4 : RUN node -p "process.versions"
 ---> Running in 3959df58939a
{ http_parser: '2.3.0',
  node: '1.7.1',
  v8: '4.1.0.27',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1m' }
 ---> 0a8d137baa90
Removing intermediate container 3959df58939a
Step 5 : RUN npm --version
 ---> Running in 9f04dc5501cb
2.7.6
 ---> ac113f8333dd
Removing intermediate container 9f04dc5501cb
Successfully built ac113f8333dd

```

# Tested image `nodesource/sid:4.1.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in d73c4d049c3c
 ---> 8c8481ae48ee
Removing intermediate container d73c4d049c3c
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.1.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in c8ebe25de221
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 10 6436k   10  671k    0     0  1105k      0  0:00:05 --:--:--  0:00:05 1104k[0m[91m100 6436k  100 6436k    0     0  5434k      0  0:00:01  0:00:01 --:--:-- 5436k
[0mSelecting previously unselected package nodejs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking nodejs (4.1.0-1nodesource1~sid1) ...
Setting up nodejs (4.1.0-1nodesource1~sid1) ...
 ---> 825d8bf1fd21
Removing intermediate container c8ebe25de221
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 0493c43f1db1
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, hawk@1.1.1, bl@0.9.5, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
gyp info using node@4.1.0 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.1.0/node-v4.1.0.tar.gz
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v4.1.0/node-v4.1.0.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.1.0/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.1.0/SHASUMS256.txt
[0m[91mgyp info spawn python
gyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/4.1.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.1.0',
gyp info spawn args   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args[0m[91m   '--generator-output',
gyp info spawn args   'build',
gyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack[0m[91m Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp [0m[91mERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.1.0
[0m[91mgyp ERR! pangyp -v v2.3.3
[0m[91mgyp ERR! not ok 
[0m
 ---> 94f5cc6fde9d
Removing intermediate container 0493c43f1db1
Step 5 : ENV NODE_ENV production
 ---> Running in cdb0e778306e
 ---> abc1ef2146f0
Removing intermediate container cdb0e778306e
Step 6 : WORKDIR /usr/src/app
 ---> Running in 2f8bd2634fe2
 ---> 2d5979b64a69
Removing intermediate container 2f8bd2634fe2
Step 7 : CMD npm start
 ---> Running in cfdd108df69b
 ---> 3aa436c75d1f
Removing intermediate container cfdd108df69b
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in af1d170634fd
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirror.picosecond.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 8s (1322 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages have been kept back:
  nodejs
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.kernel.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:9 http://mirror.picosecond.org/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:10 http://mirror.picosecond.org/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:13 http://mirrors.kernel.org/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
Get:11 http://mirror.picosecond.org/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirror.picosecond.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (3328 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18737 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18737 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18737 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18737 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18737 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18737 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18737 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18737 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18737 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18737 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18737 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18737 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18737 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 442ad4c38792
Removing intermediate container af1d170634fd
Successfully built 442ad4c38792

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test155`

Contents of dockerfile `/root/docker-node/.~tmp.test155/Dockerfile`:

```
FROM nodesource/sid:4.1.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:4.1.0-test1` from `/root/docker-node/.~tmp.test155`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:4.1.0
 ---> 442ad4c38792
Step 2 : ENV NODE_ENV test
 ---> Running in e58a40342796
 ---> a79a8381a8e4
Removing intermediate container e58a40342796
Step 3 : RUN node -v
 ---> Running in 785dc773c9bd
v4.1.0
 ---> 72e825f1aa40
Removing intermediate container 785dc773c9bd
Step 4 : RUN node -p "process.versions"
 ---> Running in cd0aa16daef2
{ http_parser: '2.5.0',
  node: '4.1.0',
  v8: '4.5.103.33',
  uv: '1.7.4',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '46',
  openssl: '1.0.2d' }
 ---> e381ccfe3bb7
Removing intermediate container cd0aa16daef2
Step 5 : RUN npm --version
 ---> Running in 0c4b6b709c5e
2.14.3
 ---> 6cc51503070b
Removing intermediate container 0c4b6b709c5e
Successfully built 6cc51503070b

```

# Tested image `nodesource/sid:iojs-2.3.4`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 0fee59437cf0
 ---> 650d5b3f0189
Removing intermediate container 0fee59437cf0
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.3.4-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 2e5fff2fd256
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 31 6046k   31 1887k    0     0  3255k      0  0:00:01 --:--:--  0:00:01 3254k[0m[91m100 6046k  100 6046k    0     0  6709k      0 --:--:-- --:--:-- --:--:-- 6703k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.3.4-1nodesource1~sid1) ...
Setting up iojs (2.3.4-1nodesource1~sid1) ...
 ---> 8115f18f4c88
Removing intermediate container 2e5fff2fd256
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 1fe05a2fc3a7
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo[0m[91m [0m[91mit worked if it ends with ok
[0m[91mgyp info using[0m[91m pangyp@2.3.3
[0m[91mgyp info using node@2.3.4 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp [0m[91mGET https://iojs.org/dist/v2.3.4/iojs-v2.3.4.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v2.3.4/iojs-v2.3.4.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp GET https://iojs.org/dist/v2.3.4/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200 https://iojs.org/dist/v2.3.4/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info spawn args[0m[91m   'binding.gyp',
gyp info [0m[91mspawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/2.3.4/common.gypi',
[0m[91mgyp info [0m[91mspawn args   '-Dlibrary=shared_library',
gyp[0m[91m info spawn args   '-Dvisibility=default',
gyp info[0m[91m [0m[91mspawn args   '-Dnode_root_dir=/root/.node-gyp/2.3.4',
gyp info spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info[0m[91m spawn args[0m[91m   '--no-parallel',
[0m[91mgyp [0m[91minfo spawn args[0m[91m   '--generator-output',
gyp[0m[91m info spawn args[0m[91m   'build',
[0m[91mgyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m ERR! configure error 
[0m[91mgyp ERR![0m[91m stack Error: `gyp` failed with exit code: 1
gyp ERR! [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR![0m[91m [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! [0m[91mstack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v2.3.4
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> f8ceb9d4e197
Removing intermediate container 1fe05a2fc3a7
Step 5 : ENV NODE_ENV production
 ---> Running in 3a474c60c6d2
 ---> eb42c3f31b8a
Removing intermediate container 3a474c60c6d2
Step 6 : WORKDIR /usr/src/app
 ---> Running in 63b952081612
 ---> e157569e7650
Removing intermediate container 63b952081612
Step 7 : CMD npm start
 ---> Running in f48ad82a54fc
 ---> 99f4b5cb0010
Removing intermediate container f48ad82a54fc
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in e7299ad67caf
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (3810 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2867 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18604 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18604 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18604 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18604 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18604 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18604 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18604 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18604 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18604 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18604 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18604 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18604 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18604 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> d21b874c14a1
Removing intermediate container e7299ad67caf
Successfully built d21b874c14a1

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test177`

Contents of dockerfile `/root/docker-node/.~tmp.test177/Dockerfile`:

```
FROM nodesource/sid:iojs-2.3.4
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-2.3.4-test1` from `/root/docker-node/.~tmp.test177`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-2.3.4
 ---> d21b874c14a1
Step 2 : ENV NODE_ENV test
 ---> Running in 0937b8c3a23f
 ---> f2c768985c53
Removing intermediate container 0937b8c3a23f
Step 3 : RUN node -v
 ---> Running in e16db7585cf4
v2.3.4
 ---> e352a13c6382
Removing intermediate container e16db7585cf4
Step 4 : RUN node -p "process.versions"
 ---> Running in 445db96105ca
{ http_parser: '2.5.0',
  node: '2.3.4',
  v8: '4.2.77.20',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2d' }
 ---> d3e36f295ecb
Removing intermediate container 445db96105ca
Step 5 : RUN npm --version
 ---> Running in dcd15cf0d92e
2.12.1
 ---> abfca41ac77e
Removing intermediate container dcd15cf0d92e
Successfully built abfca41ac77e

```

# Tested image `nodesource/sid:iojs-1.8.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 9504b6e6c4ee
 ---> edcca53fd321
Removing intermediate container 9504b6e6c4ee
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.8.1-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 55a412e617a1
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 29 5547k   29 1631k    0     0  1979k      0  0:00:02 --:--:--  0:00:02 1977k[0m[91m100 5547k  100 5547k    0     0  5017k      0  0:00:01  0:00:01 --:--:-- 5020k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.8.1-1nodesource1~sid1) ...
Setting up iojs (1.8.1-1nodesource1~sid1) ...
 ---> 261115c14dc6
Removing intermediate container 55a412e617a1
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in bb7f61cb8b58
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN[0m[91m deprecated[0m[91m graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info [0m[91musing pangyp@2.3.3
[0m[91mgyp info using node@1.8.1 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v1.8.1/iojs-v1.8.1.tar.gz
[0m[91mgyp http[0m[91m 200 https://iojs.org/dist/v1.8.1/iojs-v1.8.1.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v1.8.1/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200[0m[91m https://iojs.org/dist/v1.8.1/SHASUMS256.txt
[0m[91mgyp[0m[91m info [0m[91mspawn[0m[91m python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp[0m[91m [0m[91minfo[0m[91m spawn args   'binding.gyp',
[0m[91mgyp[0m[91m info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
[0m[91mgyp [0m[91minfo spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args[0m[91m   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.8.1/common.gypi',
[0m[91mgyp[0m[91m info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp[0m[91m [0m[91minfo[0m[91m spawn args   '-Dnode_root_dir=/root/.node-gyp/1.8.1',
gyp info[0m[91m spawn args   '-Druntime=iojs',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
gyp info [0m[91mspawn args[0m[91m   '--depth=.',
[0m[91mgyp [0m[91minfo [0m[91mspawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! [0m[91mconfigure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1009:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.8.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 12affb519ed9
Removing intermediate container bb7f61cb8b58
Step 5 : ENV NODE_ENV production
 ---> Running in 60e634a24952
 ---> 2ad03a22d2bc
Removing intermediate container 60e634a24952
Step 6 : WORKDIR /usr/src/app
 ---> Running in ff04a41b28c5
 ---> 0c68cc2647c1
Removing intermediate container ff04a41b28c5
Step 7 : CMD npm start
 ---> Running in d9b838f04f38
 ---> b86025af3c1a
Removing intermediate container d9b838f04f38
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 35a0e19b7e64
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (4597 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2846 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18520 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18520 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18520 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18520 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18520 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18520 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18520 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18520 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18520 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18520 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18520 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18520 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18520 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 8b4d4cdb34ea
Removing intermediate container 35a0e19b7e64
Successfully built 8b4d4cdb34ea

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test188`

Contents of dockerfile `/root/docker-node/.~tmp.test188/Dockerfile`:

```
FROM nodesource/sid:iojs-1.8.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-1.8.1-test1` from `/root/docker-node/.~tmp.test188`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-1.8.1
 ---> 8b4d4cdb34ea
Step 2 : ENV NODE_ENV test
 ---> Running in 462f48c8b529
 ---> 8074450d529f
Removing intermediate container 462f48c8b529
Step 3 : RUN node -v
 ---> Running in 2487ab1dc24c
v1.8.1
 ---> b4b5a86dbb3b
Removing intermediate container 2487ab1dc24c
Step 4 : RUN node -p "process.versions"
 ---> Running in 61e92738aecc
{ http_parser: '2.3.0',
  node: '1.8.1',
  v8: '4.1.0.27',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.2a' }
 ---> a809c02e796e
Removing intermediate container 61e92738aecc
Step 5 : RUN npm --version
 ---> Running in 9073bece95ff
2.8.3
 ---> 1ea0bc024e6f
Removing intermediate container 9073bece95ff
Successfully built 1ea0bc024e6f

```

# Tested image `nodesource/sid:iojs-1.4.2`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in da8b765250fa
 ---> 48a8dfb81117
Removing intermediate container da8b765250fa
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.4.2-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in fdffd143af67
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 20 5093k   20 1023k    0     0  2001k      0  0:00:[0m[91m02 --:--:--  0:00:02 1999k[0m[91m100 5093k  100 5093k    0     0  6276k      0 --:--:-- --:--:-- --:--:-- 6272k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.4.2-1nodesource1~sid1) ...
Setting up iojs (1.4.2-1nodesource1~sid1) ...
 ---> 65d5e09a3353
Removing intermediate container fdffd143af67
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 1dc64b549869
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo[0m[91m [0m[91mit worked if it ends with ok
[0m[91mgyp info[0m[91m using[0m[91m pangyp@2.3.3
gyp info using node@1.4.2 | linux | x64
[0m[91mgyp[0m[91m http GET[0m[91m https://iojs.org/dist/v1.4.2/iojs-v1.4.2.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v1.4.2/iojs-v1.4.2.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v1.4.2/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v1.4.2/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp[0m[91m info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp [0m[91minfo [0m[91mspawn args   '-I',
gyp info spawn args   '/root/.node-gyp/1.4.2/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/1.4.2',
[0m[91mgyp info[0m[91m spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
[0m[91mgyp info [0m[91mspawn args   '--depth=.',
[0m[91mgyp [0m[91minfo spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp [0m[91minfo spawn args[0m[91m   'build',
gyp [0m[91minfo [0m[91mspawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1044:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v1.4.2
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 13628ee6897d
Removing intermediate container 1dc64b549869
Step 5 : ENV NODE_ENV production
 ---> Running in 238d0dbb2837
 ---> 8f3b4e0dfb34
Removing intermediate container 238d0dbb2837
Step 6 : WORKDIR /usr/src/app
 ---> Running in 40a5f2985e47
 ---> b6cbbe135475
Removing intermediate container 40a5f2985e47
Step 7 : CMD npm start
 ---> Running in aecf5058125d
 ---> 0067a5761f1b
Removing intermediate container aecf5058125d
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 82e889ce909f
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3617 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2810 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18039 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 2d2639e96b7f
Removing intermediate container 82e889ce909f
Successfully built 2d2639e96b7f

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test183`

Contents of dockerfile `/root/docker-node/.~tmp.test183/Dockerfile`:

```
FROM nodesource/sid:iojs-1.4.2
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-1.4.2-test1` from `/root/docker-node/.~tmp.test183`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-1.4.2
 ---> 2d2639e96b7f
Step 2 : ENV NODE_ENV test
 ---> Running in ebe90a979c91
 ---> c686251ed010
Removing intermediate container ebe90a979c91
Step 3 : RUN node -v
 ---> Running in 2a045a34c3e4
v1.4.2
 ---> a10623ff808f
Removing intermediate container 2a045a34c3e4
Step 4 : RUN node -p "process.versions"
 ---> Running in 501b40eca084
{ http_parser: '2.3.0',
  node: '1.4.2',
  v8: '4.1.0.21',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.1k' }
 ---> 6feb5ebf683a
Removing intermediate container 501b40eca084
Step 5 : RUN npm --version
 ---> Running in e8d852f89f22
2.6.1
 ---> 10ae70fe3977
Removing intermediate container e8d852f89f22
Successfully built 10ae70fe3977

```

# Tested image `nodesource/sid:iojs-3.2.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 8fcab790b028
 ---> fa2b10c642b4
Removing intermediate container 8fcab790b028
Step 3 : RUN curl https://deb.nodesource.com/iojs_3.x/pool/main/i/iojs/iojs_3.2.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in d59b6d958db9
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m100 6195k  100 6195k    0     0  7197k      0 --:--:-- --:--:-- --:--:-- 7195k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (3.2.0-1nodesource1~sid1) ...
Setting up iojs (3.2.0-1nodesource1~sid1) ...
 ---> f2c84975eb7d
Removing intermediate container d59b6d958db9
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in c9d9bd54b448
[91mnpm[0m[91m [0m[91mWARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m WARN [0m[91mdeprecated[0m[91m graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, inflight@1.0.4, once@1.3.3)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info using pangyp@2.3.3
gyp info using node@3.2.0 | linux | x64
[0m[91mgyp[0m[91m http GET[0m[91m https://iojs.org/dist/v3.2.0/iojs-v3.2.0.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v3.2.0/iojs-v3.2.0.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v3.2.0/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v3.2.0/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp[0m[91m info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/3.2.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/3.2.0',
gyp info spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info spawn args   'build',
gyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR! stack     at emitTwo (events.js:87:13)
[0m[91mgyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR![0m[91m stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
gyp [0m[91mERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd[0m[91m /
gyp ERR! node -v v3.2.0
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> bdd74e6537e7
Removing intermediate container c9d9bd54b448
Step 5 : ENV NODE_ENV production
 ---> Running in 91b558b608ef
 ---> 5f27d5c447f6
Removing intermediate container 91b558b608ef
Step 6 : WORKDIR /usr/src/app
 ---> Running in 851eb60753ae
 ---> 35d17dbe8b18
Removing intermediate container 851eb60753ae
Step 7 : CMD npm start
 ---> Running in 88ab17364da7
 ---> 841f128feead
Removing intermediate container 88ab17364da7
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 7bf6e878dcff
Get:1 http://mirrors.kernel.org/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (3697 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:3 http://mirror.picosecond.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:8 http://mirrors.kernel.org/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:11 http://mirrors.kernel.org/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
Get:4 http://mirror.picosecond.org/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirror.picosecond.org/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:7 http://mirror.picosecond.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:10 http://mirror.picosecond.org/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2194 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18749 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 50bdcc3cc673
Removing intermediate container 7bf6e878dcff
Successfully built 50bdcc3cc673

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test181`

Contents of dockerfile `/root/docker-node/.~tmp.test181/Dockerfile`:

```
FROM nodesource/sid:iojs-3.2.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-3.2.0-test1` from `/root/docker-node/.~tmp.test181`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-3.2.0
 ---> 50bdcc3cc673
Step 2 : ENV NODE_ENV test
 ---> Running in ecc77c60a37b
 ---> aecde66fa23d
Removing intermediate container ecc77c60a37b
Step 3 : RUN node -v
 ---> Running in 56fd6e50dbaa
v3.2.0
 ---> e12655cb35d1
Removing intermediate container 56fd6e50dbaa
Step 4 : RUN node -p "process.versions"
 ---> Running in 55c2d8928fca
{ http_parser: '2.5.0',
  node: '3.2.0',
  v8: '4.4.63.26',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '45',
  openssl: '1.0.2d' }
 ---> d8f1f8151a2e
Removing intermediate container 55c2d8928fca
Step 5 : RUN npm --version
 ---> Running in 1df3683e706a
2.13.3
 ---> b2502430a9ad
Removing intermediate container 1df3683e706a
Successfully built b2502430a9ad

```

# Tested image `nodesource/precise:0.10.42`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/precise-base
 ---> 862e1a9b72ce
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 80178e594e63
 ---> 1f734e148df2
Removing intermediate container 80178e594e63
Step 3 : RUN curl https://deb.nodesource.com/node/pool/main/n/nodejs/nodejs_0.10.42-1nodesource1~precise1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in ad3e5633f328
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  1 6283k    1  111k    0     0   173k      0  0:00:36 --:--:--  0:00:36  182k[0m[91m100 6283k  100 6283k    0     0  4739k      0  0:00:01  0:00:01 --:--:-- 4855k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14044 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.10.42-1nodesource1~precise1) ...
 ---> f40493049666
Removing intermediate container ad3e5633f328
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in c5d75a8158d2
[91mnpm[0m[91m [0m[91mWARN[0m[91m [0m[91mdeprecated This version of npm lacks support for important features,
[0m[91mnpm WARN deprecated such as scoped packages, offered by the primary npm
npm WARN deprecated registry. Consider upgrading to at least npm@2, if not the
npm WARN deprecated latest stable version. To upgrade to npm@2, run:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest-2
npm WARN deprecated 
npm WARN deprecated To upgrade to the latest stable version, run:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest
npm[0m[91m WARN deprecated 
npm WARN deprecated (Depending on how Node.js was installed on your system, you
npm WARN deprecated may need to prefix the preceding commands with `sudo`, or if
npm WARN deprecated on Windows, run them from an Administrator prompt.)
npm WARN deprecated 
npm WARN deprecated If you're running the version of npm bundled with
npm WARN deprecated Node.js 0.10 LTS, be aware that the next version of 0.10 LTS
npm WARN deprecated will be bundled with a version of npm@2, which has some small
npm WARN deprecated backwards-incompatible changes made to `npm run-script` and
npm WARN deprecated semver behavior.
[0m[91mnpm [0m[91mWARN[0m[91m [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mnpm[0m[91m [0m[91mWARN deprecated This version of npm lacks support for important features,
npm WARN deprecated such as scoped packages, offered by the primary npm
[0m[91mnpm WARN deprecated registry. Consider upgrading to at least npm@2, if not the
npm WARN deprecated latest stable version. To upgrade to npm@2, run:
npm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest-2
npm WARN deprecated 
npm[0m[91m WARN [0m[91mdeprecated To upgrade to the latest stable version, run:
[0m[91mnpm WARN deprecated 
npm WARN deprecated   npm -g install npm@latest
npm WARN deprecated 
npm WARN deprecated (Depending on how Node.js was installed on your system, you
npm[0m[91m WARN deprecated[0m[91m may need to prefix the preceding commands with `sudo`, or if
npm WARN deprecated on Windows, run them from an Administrator prompt.)
npm WARN deprecated 
npm WARN deprecated If you're running the version of npm bundled with
npm WARN deprecated Node.js 0.10 LTS, be aware that the next version of 0.10 LTS
npm WARN deprecated will be bundled with a version of npm@2, which has some small
npm WARN deprecated[0m[91m backwards-incompatible changes made to `npm run-script` and
[0m[91mnpm WARN deprecated semver behavior.
[0m[91mgyp[0m[91m info it worked if it ends with ok
[0m[91mgyp [0m[91minfo using[0m[91m pangyp@2.3.3
[0m[91mgyp info using node@0.10.42 | linux | x64
[0m[91mgyp http GET http://nodejs.org/dist/v0.10.42/node-v0.10.42.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v0.10.42/node-v0.10.42.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.10.42/SHASUMS256.txt
[0m[91mgyp[0m[91m http[0m[91m [0m[91m200 http://nodejs.org/dist/v0.10.42/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp [0m[91minfo spawn args[0m[91m   '-f',
gyp[0m[91m info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp [0m[91minfo spawn args   '-I',
gyp info [0m[91mspawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp [0m[91minfo spawn args   '-I',
[0m[91mgyp info spawn args   '/root/.node-gyp/0.10.42/common.gypi',
gyp [0m[91minfo spawn args   '-Dlibrary=shared_library',
gyp[0m[91m info [0m[91mspawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.10.42',
gyp info[0m[91m spawn args[0m[91m   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info[0m[91m [0m[91mspawn args[0m[91m   'build',
gyp [0m[91minfo spawn args[0m[91m   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp[0m[91m [0m[91mERR![0m[91m stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack[0m[91m     at ChildProcess.emit (events.js:98:17)
gyp[0m[91m [0m[91mERR![0m[91m [0m[91mstack     at Process.ChildProcess._handle.onexit (child_process.js:820:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "node" "/usr/bin/node-gyp" "configure"
gyp ERR! [0m[91mcwd /
gyp ERR! node -v v0.10.42
gyp ERR! pangyp -v v2.3.3
[0m[91mgyp [0m[91mERR! not ok 
[0m
 ---> c66a538954f4
Removing intermediate container c5d75a8158d2
Step 5 : ENV NODE_ENV production
 ---> Running in db1d07a3c6fa
 ---> 0f802b122347
Removing intermediate container db1d07a3c6fa
Step 6 : WORKDIR /usr/src/app
 ---> Running in b7c16fd425b2
 ---> 7585d8ba578c
Removing intermediate container b7c16fd425b2
Step 7 : CMD npm start
 ---> Running in e72e63370ebe
 ---> 3d781868e066
Removing intermediate container e72e63370ebe
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in d3d18eb867f9
Get:1 http://archive.ubuntu.com precise Release.gpg [198 B]
Get:2 http://archive.ubuntu.com precise-updates Release.gpg [198 B]
Get:3 http://archive.ubuntu.com precise-security Release.gpg [198 B]
Get:4 http://archive.ubuntu.com precise Release [49.6 kB]
Get:5 http://archive.ubuntu.com precise-updates Release [55.4 kB]
Get:6 http://archive.ubuntu.com precise-security Release [55.5 kB]
Get:7 http://archive.ubuntu.com precise/main Sources [1175 kB]
Get:8 http://archive.ubuntu.com precise/restricted Sources [5306 B]
Get:9 http://archive.ubuntu.com precise/universe Sources [6239 kB]
Get:10 http://archive.ubuntu.com precise/main amd64 Packages [1640 kB]
Get:11 http://archive.ubuntu.com precise/restricted amd64 Packages [9098 B]
Get:12 http://archive.ubuntu.com precise/universe amd64 Packages [6167 kB]
Get:13 http://archive.ubuntu.com precise/main i386 Packages [1641 kB]
Get:14 http://archive.ubuntu.com precise/restricted i386 Packages [9108 B]
Get:15 http://archive.ubuntu.com precise/universe i386 Packages [6180 kB]
Get:16 http://archive.ubuntu.com precise-updates/main Sources [607 kB]
Get:17 http://archive.ubuntu.com precise-updates/restricted Sources [8938 B]
Get:18 http://archive.ubuntu.com precise-updates/universe Sources [152 kB]
Get:19 http://archive.ubuntu.com precise-updates/main amd64 Packages [1265 kB]
Get:20 http://archive.ubuntu.com precise-updates/restricted amd64 Packages [24.0 kB]
Get:21 http://archive.ubuntu.com precise-updates/universe amd64 Packages [350 kB]
Get:22 http://archive.ubuntu.com precise-updates/main i386 Packages [1342 kB]
Get:23 http://archive.ubuntu.com precise-updates/restricted i386 Packages [24.0 kB]
Get:24 http://archive.ubuntu.com precise-updates/universe i386 Packages [361 kB]
Get:25 http://archive.ubuntu.com precise-security/main Sources [177 kB]
Get:26 http://archive.ubuntu.com precise-security/restricted Sources [4320 B]
Get:27 http://archive.ubuntu.com precise-security/universe Sources [52.5 kB]
Get:28 http://archive.ubuntu.com precise-security/main amd64 Packages [763 kB]
Get:29 http://archive.ubuntu.com precise-security/restricted amd64 Packages [18.3 kB]
Get:30 http://archive.ubuntu.com precise-security/universe amd64 Packages [165 kB]
Get:31 http://archive.ubuntu.com precise-security/main i386 Packages [838 kB]
Get:32 http://archive.ubuntu.com precise-security/restricted i386 Packages [18.3 kB]
Get:33 http://archive.ubuntu.com precise-security/universe i386 Packages [174 kB]
Fetched 29.6 MB in 13s (2238 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
The following packages will be upgraded:
  cpio
1 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 116 kB of archives.
After this operation, 0 B of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu/ precise-updates/main cpio amd64 2.11-7ubuntu3.2 [116 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 116 kB in 0s (280 kB/s)
(Reading database ... 15845 files and directories currently installed.)
Preparing to replace cpio 2.11-7ubuntu3.1 (using .../cpio_2.11-7ubuntu3.2_amd64.deb) ...
Unpacking replacement cpio ...
Setting up cpio (2.11-7ubuntu3.2) ...
 ---> 49af1c6cedc2
Removing intermediate container d3d18eb867f9
Successfully built 49af1c6cedc2

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test198`

Contents of dockerfile `/root/docker-node/.~tmp.test198/Dockerfile`:

```
FROM nodesource/precise:0.10.42
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/precise:0.10.42-test1` from `/root/docker-node/.~tmp.test198`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/precise:0.10.42
 ---> 49af1c6cedc2
Step 2 : ENV NODE_ENV test
 ---> Running in b7a31f828efe
 ---> cd6cef3feae9
Removing intermediate container b7a31f828efe
Step 3 : RUN node -v
 ---> Running in ad75dd952700
v0.10.42
 ---> e84f75b32b6a
Removing intermediate container ad75dd952700
Step 4 : RUN node -p "process.versions"
 ---> Running in f17a29a6ceda
{ http_parser: '1.1',
  node: '0.10.42',
  v8: '3.14.5.9',
  ares: '1.9.0-DEV',
  uv: '0.10.36',
  zlib: '1.2.8',
  modules: '11',
  openssl: '1.0.1r' }
 ---> 9c28c21fab89
Removing intermediate container f17a29a6ceda
Step 5 : RUN npm --version
 ---> Running in 1443c69f828b
1.4.29
 ---> 950c8da7ca83
Removing intermediate container 1443c69f828b
Successfully built 950c8da7ca83

```

# Tested image `nodesource/precise:4.3.1`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/precise-base
 ---> 862e1a9b72ce
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 75caf28504e2
 ---> 9ef5855b5388
Removing intermediate container 75caf28504e2
Step 3 : RUN curl https://deb.nodesource.com/node_4.x/pool/main/n/nodejs/nodejs_4.3.1-1nodesource1~precise1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 3b921e3e993a
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- -[0m[91m-:--:-- --:--:--     0[0m[91m 52 10.4M   52 5679k    0     0  8190k      0  0:00:01 --:--:--  0:00:01 8671k[0m[91m100 10.4M  100 10.4M    0     0  9934k      0  0:00:01  0:00:01 --:--:[0m[91m-- 10.0M
[0mSelecting previously unselected package nodejs.
(Reading database ... 14044 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (4.3.1-1nodesource1~precise1) ...
 ---> 21ef13e4ad31
Removing intermediate container 3b921e3e993a
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in f58d5158fe02
[91mnpm[0m[91m [0m[91mWARN [0m[91mdeprecated[0m[91m pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm[0m[91m [0m[91mWARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (aws-sign2@0.5.0, forever-agent@0.5.2, caseless@0.8.0, tunnel-agent@0.4.2, oauth-sign@0.5.0, stringstream@0.0.5, json-stringify-safe@5.0.1, tough-cookie@2.2.1, mime-types@1.0.2, qs@2.3.3, node-uuid@1.4.7, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, hawk@1.1.1, form-data@0.2.0)
[91mgyp info it worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
[0m[91mgyp info using node@4.3.1 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v4.3.1/node-v4.3.1.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v4.3.1/node-v4.3.1.tar.gz
[0m[91mgyp http [0m[91mGET http://nodejs.org/dist/v4.3.1/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v4.3.1/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp [0m[91minfo[0m[91m [0m[91mspawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp[0m[91m info[0m[91m spawn args[0m[91m   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args[0m[91m   '-I',
gyp info spawn args   '/root/.node-gyp/4.3.1/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
[0m[91mgyp info spawn args   '-Dvisibility=default',
[0m[91mgyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/4.3.1',
gyp info spawn args   '-Druntime=node',
gyp info [0m[91mspawn args[0m[91m   '-Dmodule_root_dir=/',
[0m[91mgyp info [0m[91mspawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args[0m[91m   'build',
gyp [0m[91minfo[0m[91m [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v4.3.1
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> 1cb5f7ee24e0
Removing intermediate container f58d5158fe02
Step 5 : ENV NODE_ENV production
 ---> Running in 4320c69e20ed
 ---> c289eca61382
Removing intermediate container 4320c69e20ed
Step 6 : WORKDIR /usr/src/app
 ---> Running in 740e509edf1a
 ---> 2bca970b75b4
Removing intermediate container 740e509edf1a
Step 7 : CMD npm start
 ---> Running in a26c222dfeb8
 ---> 7a53d209747e
Removing intermediate container a26c222dfeb8
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 890e35b0af76
Get:1 http://archive.ubuntu.com precise Release.gpg [198 B]
Get:2 http://archive.ubuntu.com precise-updates Release.gpg [198 B]
Get:3 http://archive.ubuntu.com precise-security Release.gpg [198 B]
Get:4 http://archive.ubuntu.com precise Release [49.6 kB]
Get:5 http://archive.ubuntu.com precise-updates Release [55.4 kB]
Get:6 http://archive.ubuntu.com precise-security Release [55.5 kB]
Get:7 http://archive.ubuntu.com precise/main Sources [1175 kB]
Get:8 http://archive.ubuntu.com precise/restricted Sources [5306 B]
Get:9 http://archive.ubuntu.com precise/universe Sources [6239 kB]
Get:10 http://archive.ubuntu.com precise/main amd64 Packages [1640 kB]
Get:11 http://archive.ubuntu.com precise/restricted amd64 Packages [9098 B]
Get:12 http://archive.ubuntu.com precise/universe amd64 Packages [6167 kB]
Get:13 http://archive.ubuntu.com precise/main i386 Packages [1641 kB]
Get:14 http://archive.ubuntu.com precise/restricted i386 Packages [9108 B]
Get:15 http://archive.ubuntu.com precise/universe i386 Packages [6180 kB]
Get:16 http://archive.ubuntu.com precise-updates/main Sources [607 kB]
Get:17 http://archive.ubuntu.com precise-updates/restricted Sources [8938 B]
Get:18 http://archive.ubuntu.com precise-updates/universe Sources [152 kB]
Get:19 http://archive.ubuntu.com precise-updates/main amd64 Packages [1265 kB]
Get:20 http://archive.ubuntu.com precise-updates/restricted amd64 Packages [24.0 kB]
Get:21 http://archive.ubuntu.com precise-updates/universe amd64 Packages [350 kB]
Get:22 http://archive.ubuntu.com precise-updates/main i386 Packages [1342 kB]
Get:23 http://archive.ubuntu.com precise-updates/restricted i386 Packages [24.0 kB]
Get:24 http://archive.ubuntu.com precise-updates/universe i386 Packages [361 kB]
Get:25 http://archive.ubuntu.com precise-security/main Sources [177 kB]
Get:26 http://archive.ubuntu.com precise-security/restricted Sources [4320 B]
Get:27 http://archive.ubuntu.com precise-security/universe Sources [52.5 kB]
Get:28 http://archive.ubuntu.com precise-security/main amd64 Packages [763 kB]
Get:29 http://archive.ubuntu.com precise-security/restricted amd64 Packages [18.3 kB]
Get:30 http://archive.ubuntu.com precise-security/universe amd64 Packages [165 kB]
Get:31 http://archive.ubuntu.com precise-security/main i386 Packages [838 kB]
Get:32 http://archive.ubuntu.com precise-security/restricted i386 Packages [18.3 kB]
Get:33 http://archive.ubuntu.com precise-security/universe i386 Packages [174 kB]
Fetched 29.6 MB in 13s (2197 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
The following packages will be upgraded:
  cpio
1 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 116 kB of archives.
After this operation, 0 B of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu/ precise-updates/main cpio amd64 2.11-7ubuntu3.2 [116 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 116 kB in 0s (199 kB/s)
(Reading database ... 16879 files and directories currently installed.)
Preparing to replace cpio 2.11-7ubuntu3.1 (using .../cpio_2.11-7ubuntu3.2_amd64.deb) ...
Unpacking replacement cpio ...
Setting up cpio (2.11-7ubuntu3.2) ...
 ---> a79025e82511
Removing intermediate container 890e35b0af76
Successfully built a79025e82511

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test196`

Contents of dockerfile `/root/docker-node/.~tmp.test196/Dockerfile`:

```
FROM nodesource/precise:4.3.1
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/precise:4.3.1-test1` from `/root/docker-node/.~tmp.test196`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/precise:4.3.1
 ---> a79025e82511
Step 2 : ENV NODE_ENV test
 ---> Running in c05a51f7945d
 ---> d184f4203973
Removing intermediate container c05a51f7945d
Step 3 : RUN node -v
 ---> Running in e39cc165f225
v4.3.1
 ---> d39e5289018d
Removing intermediate container e39cc165f225
Step 4 : RUN node -p "process.versions"
 ---> Running in 473166af4418
{ http_parser: '2.5.2',
  node: '4.3.1',
  v8: '4.5.103.35',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '46',
  openssl: '1.0.2f' }
 ---> fc8213aba1da
Removing intermediate container 473166af4418
Step 5 : RUN npm --version
 ---> Running in 6535c46a4070
2.14.12
 ---> 5e8ad2c6a1fb
Removing intermediate container 6535c46a4070
Successfully built 5e8ad2c6a1fb

```

# Tested image `nodesource/sid:iojs-1.8.3`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 0c348e5fca3b
 ---> aacbfbddd3a1
Removing intermediate container 0c348e5fca3b
Step 3 : RUN curl https://deb.nodesource.com/iojs_1.x/pool/main/i/iojs/iojs_1.8.3-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 7d3be3b9c0a3
[91m  % Total    % Received % Xferd  Average Speed[0m[91m   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 49 5760k   49 2847k    0     0  3944k      0  0:00:01 --:--:--  0:00:01 3944k[0m[91m100 5760k  100 5760k    0     0  6107k      0 --:--:-- --:--:-- --:--:-- 6102k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (1.8.3-1nodesource1~sid1) ...
Setting up iojs (1.8.3-1nodesource1~sid1) ...
 ---> daccd6fcfc57
Removing intermediate container 7d3be3b9c0a3
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 41750e623d89
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN [0m[91mdeprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-tmpdir@1.0.1, os-homedir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, oauth-sign@0.5.0, stringstream@0.0.5, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, http-signature@0.10.1, bl@0.9.5, hawk@1.1.1, form-data@0.2.0)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
[0m[91mgyp info [0m[91musing node@1.8.3 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v1.8.3/iojs-v1.8.3.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v1.8.3/iojs-v1.8.3.tar.gz
[0m[91mgyp http GET[0m[91m https://iojs.org/dist/v1.8.3/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v1.8.3/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info[0m[91m [0m[91mspawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args[0m[91m   '-f',
[0m[91mgyp[0m[91m info[0m[91m spawn args[0m[91m   'make',
gyp [0m[91minfo[0m[91m [0m[91mspawn args   '-I',
[0m[91mgyp info [0m[91mspawn args[0m[91m   '/build/config.gypi',
[0m[91mgyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
[0m[91mgyp [0m[91minfo spawn args   '/root/.node-gyp/1.8.3/common.gypi',
gyp info [0m[91mspawn args   '-Dlibrary=shared_library',
[0m[91mgyp info spawn args   '-Dvisibility=default',
gyp info [0m[91mspawn args   '-Dnode_root_dir=/root/.node-gyp/1.8.3',
[0m[91mgyp [0m[91minfo[0m[91m spawn args[0m[91m   '-Druntime=iojs',
[0m[91mgyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args[0m[91m   '--depth=.',
[0m[91mgyp info spawn args   '--no-parallel',
[0m[91mgyp info spawn args   '--generator-output',
gyp[0m[91m info spawn args   'build',
gyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m [0m[91mERR! configure error 
[0m[91mgyp [0m[91mERR! [0m[91mstack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp ERR![0m[91m stack[0m[91m     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:169:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1009:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp[0m[91m [0m[91mERR! [0m[91mcommand "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR![0m[91m cwd /
[0m[91mgyp ERR! node -v v1.8.3
gyp ERR! pangyp -v v2.3.3
gyp [0m[91mERR! [0m[91mnot ok 
[0m
 ---> 80e9e2553a39
Removing intermediate container 41750e623d89
Step 5 : ENV NODE_ENV production
 ---> Running in cbc4e4edb326
 ---> 1830412b8887
Removing intermediate container cbc4e4edb326
Step 6 : WORKDIR /usr/src/app
 ---> Running in 0b3fbf97b137
 ---> 0c10092fa42f
Removing intermediate container 0b3fbf97b137
Step 7 : CMD npm start
 ---> Running in 12970548c2de
 ---> 98030a50d99d
Removing intermediate container 12970548c2de
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in a2d3e8e2feaf
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.kernel.org/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 2s (5060 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.kernel.org/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:4 http://mirrors.kernel.org/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirror.picosecond.org/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.kernel.org/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.kernel.org/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:9 http://mirrors.kernel.org/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
Get:12 http://mirrors.kernel.org/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:8 http://mirror.picosecond.org/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:11 http://mirror.picosecond.org/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2267 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18521 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 69bf966ab027
Removing intermediate container a2d3e8e2feaf
Successfully built 69bf966ab027

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test189`

Contents of dockerfile `/root/docker-node/.~tmp.test189/Dockerfile`:

```
FROM nodesource/sid:iojs-1.8.3
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-1.8.3-test1` from `/root/docker-node/.~tmp.test189`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-1.8.3
 ---> 69bf966ab027
Step 2 : ENV NODE_ENV test
 ---> Running in dc3516b8efa8
 ---> 3afefee6b4c9
Removing intermediate container dc3516b8efa8
Step 3 : RUN node -v
 ---> Running in a4c4d7b6b586
v1.8.3
 ---> 321cd8a76120
Removing intermediate container a4c4d7b6b586
Step 4 : RUN node -p "process.versions"
 ---> Running in 2dcd3fb8d5ed
{ http_parser: '2.5.0',
  node: '1.8.3',
  v8: '4.1.0.27',
  uv: '1.4.2',
  zlib: '1.2.8',
  ares: '1.10.0-DEV',
  modules: '43',
  openssl: '1.0.2c' }
 ---> 46fdcf64e4e5
Removing intermediate container 2dcd3fb8d5ed
Step 5 : RUN npm --version
 ---> Running in 10c08855d4c6
2.9.0
 ---> 1dbddc9e096f
Removing intermediate container 10c08855d4c6
Successfully built 1dbddc9e096f

```

# Tested image `nodesource/sid:iojs-2.3.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 2b9c5c87a672
 ---> c530f324b0ed
Removing intermediate container 2b9c5c87a672
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.3.0-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in cf596b7829a0
[91m  % Total [0m[91m   % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 13 5727k   13  767k    0     0  1678k      0  0:00:03 --:--:--  0:00:03 1676k[0m[91m100 5727k  100 5727k    0     0  6876k      0 --:--:-- --:--:-- --:--:-- 6876k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.3.0-1nodesource1~sid1) ...
Setting up iojs (2.3.0-1nodesource1~sid1) ...
 ---> e43a5b526579
Removing intermediate container cf596b7829a0
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 84fb05819f4f
[91mnpm[0m[91m WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, node-uuid@1.4.7, qs@2.3.3, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info[0m[91m using[0m[91m pangyp@2.3.3
gyp info using node@2.3.0 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp[0m[91m GET https://iojs.org/dist/v2.3.0/iojs-v2.3.0.tar.gz
[0m[91mgyp[0m[91m http [0m[91m200 https://iojs.org/dist/v2.3.0/iojs-v2.3.0.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v2.3.0/SHASUMS256.txt
[0m[91mgyp [0m[91mhttp 200 https://iojs.org/dist/v2.3.0/SHASUMS256.txt
[0m[91mgyp [0m[91minfo spawn python
[0m[91mgyp info spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info[0m[91m spawn args   'binding.gyp',
[0m[91mgyp info[0m[91m spawn args   '-f',
[0m[91mgyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/root/.node-gyp/2.3.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/2.3.0',
gyp info spawn args   '-Druntime=iojs',
gyp info spawn args[0m[91m   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
[0m[91mgyp [0m[91minfo[0m[91m spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info [0m[91mspawn args   'build',
gyp info[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp[0m[91m ERR! [0m[91mconfigure error 
[0m[91mgyp ERR![0m[91m stack Error: `gyp` failed with exit code: 1
[0m[91mgyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp [0m[91mERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! [0m[91mstack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp[0m[91m ERR! System[0m[91m Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v2.3.0
[0m[91mgyp ERR! pangyp -v v2.3.3
gyp [0m[91mERR! not ok 
[0m
 ---> 84ff8c972a5c
Removing intermediate container 84fb05819f4f
Step 5 : ENV NODE_ENV production
 ---> Running in 32621a7b1652
 ---> b18c26902571
Removing intermediate container 32621a7b1652
Step 6 : WORKDIR /usr/src/app
 ---> Running in c403fa323a3f
 ---> 3cf3b2a688fe
Removing intermediate container c403fa323a3f
Step 7 : CMD npm start
 ---> Running in 65aade6dacc1
 ---> 3c732e8a913a
Removing intermediate container 65aade6dacc1
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 2b6849b3b107
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 4s (2606 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 0s (5464 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18623 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18623 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18623 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18623 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18623 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18623 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18623 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18623 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18623 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18623 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18623 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18623 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18623 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 87ebf3b9b8c4
Removing intermediate container 2b6849b3b107
Successfully built 87ebf3b9b8c4

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test192`

Contents of dockerfile `/root/docker-node/.~tmp.test192/Dockerfile`:

```
FROM nodesource/sid:iojs-2.3.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-2.3.0-test1` from `/root/docker-node/.~tmp.test192`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-2.3.0
 ---> 87ebf3b9b8c4
Step 2 : ENV NODE_ENV test
 ---> Running in bbb2f404a74c
 ---> 86aaff1f604c
Removing intermediate container bbb2f404a74c
Step 3 : RUN node -v
 ---> Running in 813e3e51fc12
v2.3.0
 ---> a2ff19ac8836
Removing intermediate container 813e3e51fc12
Step 4 : RUN node -p "process.versions"
 ---> Running in 821afd4f4482
{ http_parser: '2.5.0',
  node: '2.3.0',
  v8: '4.2.77.20',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2c' }
 ---> 659398ae57ce
Removing intermediate container 821afd4f4482
Step 5 : RUN npm --version
 ---> Running in 9eb96cf02dfa
2.11.1
 ---> e9f06ba64851
Removing intermediate container 9eb96cf02dfa
Successfully built e9f06ba64851

```

# Tested image `nodesource/sid:iojs-2.3.3`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 213d5536dfd7
 ---> 9c062c6e4ebe
Removing intermediate container 213d5536dfd7
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.3.3-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 6d3256231199
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 73 5986k   73 4383k    0     0  5569k      0  0:00:01 --:--:--  0:00:01 5570k[0m[91m100 598[0m[91m6k  100 5986k    0     0  6649k      0 --:--:-- --:--:-- --:--:-- 6644k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.3.3-1nodesource1~sid1) ...
Setting up iojs (2.3.3-1nodesource1~sid1) ...
 ---> 1195d0aeb793
Removing intermediate container 6d3256231199
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in d32535bff0fc
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp[0m[91m [0m[91minfo[0m[91m using pangyp@2.3.3
gyp info using node@2.3.3 | linux | x64
[0m[91mgyp[0m[91m http GET https://iojs.org/dist/v2.3.3/iojs-v2.3.3.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v2.3.3/iojs-v2.3.3.tar.gz
[0m[91mgyp http GET https://iojs.org/dist/v2.3.3/SHASUMS256.txt
[0m[91mgyp[0m[91m http 200 https://iojs.org/dist/v2.3.3/SHASUMS256.txt
[0m[91mgyp [0m[91minfo [0m[91mspawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info [0m[91mspawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info[0m[91m spawn args   'make',
gyp[0m[91m [0m[91minfo[0m[91m [0m[91mspawn args   '-I',
gyp info[0m[91m spawn args[0m[91m   '/build/config.gypi',
gyp [0m[91minfo spawn args   '-I',
gyp[0m[91m info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
[0m[91mgyp[0m[91m info spawn args   '-I',
[0m[91mgyp[0m[91m info[0m[91m [0m[91mspawn args   '/root/.node-gyp/2.3.3/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info[0m[91m spawn args   '-Dvisibility=default',
gyp info[0m[91m [0m[91mspawn args[0m[91m   '-Dnode_root_dir=/root/.node-gyp/2.3.3',
gyp info spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp[0m[91m info spawn args[0m[91m   '--depth=.',
[0m[91mgyp[0m[91m [0m[91minfo [0m[91mspawn args   '--no-parallel',
[0m[91mgyp[0m[91m info [0m[91mspawn args[0m[91m   '--generator-output',
[0m[91mgyp[0m[91m info spawn args   'build',
gyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! configure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! [0m[91mstack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp[0m[91m ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v2.3.3
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> e1188d9028a8
Removing intermediate container d32535bff0fc
Step 5 : ENV NODE_ENV production
 ---> Running in 090d385bf876
 ---> 8b159aa11e7c
Removing intermediate container 090d385bf876
Step 6 : WORKDIR /usr/src/app
 ---> Running in ebfdbf4b1d14
 ---> bdcc55ed6043
Removing intermediate container ebfdbf4b1d14
Step 7 : CMD npm start
 ---> Running in 33541b988f30
 ---> 0f711047986a
Removing intermediate container 33541b988f30
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 30545ba58cd0
Get:1 http://mirrors.cat.pdx.edu/debian sid InRelease [287 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 1s (5722 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.namecheap.com/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.namecheap.com/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.namecheap.com/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.namecheap.com/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.namecheap.com/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.namecheap.com/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.namecheap.com/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.namecheap.com/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.namecheap.com/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.namecheap.com/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.namecheap.com/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.namecheap.com/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (1550 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> 7a5c0b6183a9
Removing intermediate container 30545ba58cd0
Successfully built 7a5c0b6183a9

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test195`

Contents of dockerfile `/root/docker-node/.~tmp.test195/Dockerfile`:

```
FROM nodesource/sid:iojs-2.3.3
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-2.3.3-test1` from `/root/docker-node/.~tmp.test195`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-2.3.3
 ---> 7a5c0b6183a9
Step 2 : ENV NODE_ENV test
 ---> Running in efdaaea28b1e
 ---> 201844382a7c
Removing intermediate container efdaaea28b1e
Step 3 : RUN node -v
 ---> Running in 01e2c69464a4
v2.3.3
 ---> 600c4854b94e
Removing intermediate container 01e2c69464a4
Step 4 : RUN node -p "process.versions"
 ---> Running in 35c42b87fdbb
{ http_parser: '2.5.0',
  node: '2.3.3',
  v8: '4.2.77.20',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2c' }
 ---> c39878aa9561
Removing intermediate container 35c42b87fdbb
Step 5 : RUN npm --version
 ---> Running in 77a01756ff3c
2.11.3
 ---> c45433da26d0
Removing intermediate container 77a01756ff3c
Successfully built c45433da26d0

```

# Tested image `nodesource/precise:5.7.0`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/precise-base
 ---> 862e1a9b72ce
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in aecc103f9de6
 ---> b83ccbaf102b
Removing intermediate container aecc103f9de6
Step 3 : RUN curl https://deb.nodesource.com/node_5.x/pool/main/n/nodejs/nodejs_5.7.0-1nodesource1~precise1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 81c685a6ae71
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 90 [0m[91m10.9M   90  9.9M    0     0  9563k      0  0:00:01  0:00:01 --:--:-- 9841k[0m[91m100 10.9M  100 10.9M    0     0  9836k      0  0:00:01  0:00:01 --:--:--  9.8M
[0mSelecting previously unselected package nodejs.
(Reading database ... 14044 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (5.7.0-1nodesource1~precise1) ...
 ---> b08cdd4ee622
Removing intermediate container 81c685a6ae71
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in 92eb9d3d5a69
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
/usr/lib
`-- pangyp@2.3.3 
  +-- fstream@1.0.8 
  | +-- graceful-fs@4.1.3 
  | `-- inherits@2.0.1 
  +-- glob@4.3.5 
  | +-- inflight@1.0.4 
  | | `-- wrappy@1.0.1 
  | `-- once@1.3.3 
  +-- graceful-fs@3.0.8 
  +-- minimatch@2.0.10 
  | `-- brace-expansion@1.1.3 
  |   +-- balanced-match@0.3.0 
  |   `-- concat-map@0.0.1 
  +-- mkdirp@0.5.1 
  | `-- minimist@0.0.8 
  +-- nopt@3.0.6 
  | `-- abbrev@1.0.7 
  +-- npmlog@1.0.0 
  | +-- ansi@0.3.1 
  | +-- are-we-there-yet@1.0.6 
  | | +-- delegates@1.0.0 
  | | `-- readable-stream@2.0.5 
  | |   +-- core-util-is@1.0.2 
  | |   +-- isarray@0.0.1 
  | |   +-- process-nextick-args@1.0.6 
  | |   +-- string_decoder@0.10.31 
  | |   `-- util-deprecate@1.0.2 
  | `-- gauge@1.0.2 
  |   `-- has-unicode@1.0.1 
  +-- osenv@0.1.3 
  | +-- os-homedir@1.0.1 
  | `-- os-tmpdir@1.0.1 
  +-- request@2.51.0 
  | +-- aws-sign2@0.5.0 
  | +-- bl@0.9.5 
  | | `-- readable-stream@1.0.33 
  | +-- caseless@0.8.0 
  | +-- combined-stream@0.0.7 
  | | `-- delayed-stream@0.0.5 
  | +-- forever-agent@0.5.2 
  | +-- form-data@0.2.0 
  | | +-- async@0.9.2 
  | | `-- mime-types@2.0.14 
  | |   `-- mime-db@1.12.0 
  | +-- hawk@1.1.1 
  | | +-- boom@0.4.2 
  | | +-- cryptiles@0.2.2 
  | | +-- hoek@0.9.1 
  | | `-- sntp@0.2.4 
  | +-- http-signature@0.10.1 
  | | +-- asn1@0.1.11 
  | | +-- assert-plus@0.1.5 
  | | `-- ctype@0.5.3 
  | +-- json-stringify-safe@5.0.1 
  | +-- mime-types@1.0.2 
  | +-- node-uuid@1.4.7 
  | +-- oauth-sign@0.5.0 
  | +-- qs@2.3.3 
  | +-- stringstream@0.0.5 
  | +-- tough-cookie@2.2.1 
  | `-- tunnel-agent@0.4.2 
  +-- rimraf@2.2.8 
  +-- semver@4.3.6 
  +-- tar@1.0.3 
  | `-- block-stream@0.0.8 
  `-- which@1.0.9 

[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp info [0m[91musing pangyp@2.3.3
[0m[91mgyp info using node@5.7.0 | linux | x64
[0m[91mgyp[0m[91m [0m[91mhttp [0m[91mGET http://nodejs.org/dist/v5.7.0/node-v5.7.0.tar.gz
[0m[91mgyp http 200 http://nodejs.org/dist/v5.7.0/node-v5.7.0.tar.gz
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v5.7.0/SHASUMS256.txt
[0m[91mgyp http[0m[91m 200 http://nodejs.org/dist/v5.7.0/SHASUMS256.txt
[0m[91mgyp info[0m[91m spawn[0m[91m python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp[0m[91m info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp [0m[91minfo spawn args[0m[91m   '/build/config.gypi',
gyp [0m[91minfo[0m[91m spawn args[0m[91m   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args[0m[91m   '-I',
[0m[91mgyp[0m[91m info [0m[91mspawn args[0m[91m   '/root/.node-gyp/5.7.0/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/5.7.0',
[0m[91mgyp[0m[91m [0m[91minfo[0m[91m spawn args[0m[91m   '-Druntime=node',
gyp info [0m[91mspawn args[0m[91m   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp info[0m[91m [0m[91mspawn args[0m[91m   'build',
[0m[91mgyp[0m[91m [0m[91minfo[0m[91m spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR![0m[91m [0m[91mconfigure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
[0m[91mgyp[0m[91m ERR![0m[91m stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:100:13)
gyp ERR! stack     at ChildProcess.emit (events.js:185:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR! command "/usr/bin/nodejs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v5.7.0
gyp ERR! pangyp -v v2.3.3
gyp [0m[91mERR! not ok 
[0m
 ---> ccd4ca618f71
Removing intermediate container 92eb9d3d5a69
Step 5 : ENV NODE_ENV production
 ---> Running in 343deaff8167
 ---> 1b78d1d36077
Removing intermediate container 343deaff8167
Step 6 : WORKDIR /usr/src/app
 ---> Running in f951d55fe107
 ---> 7d717c9e8212
Removing intermediate container f951d55fe107
Step 7 : CMD npm start
 ---> Running in 0230f8f7c549
 ---> 47cfb8c857c7
Removing intermediate container 0230f8f7c549
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 7d5d63b8b683
Get:1 http://archive.ubuntu.com precise Release.gpg [198 B]
Get:2 http://archive.ubuntu.com precise-updates Release.gpg [198 B]
Get:3 http://archive.ubuntu.com precise-security Release.gpg [198 B]
Get:4 http://archive.ubuntu.com precise Release [49.6 kB]
Get:5 http://archive.ubuntu.com precise-updates Release [55.4 kB]
Get:6 http://archive.ubuntu.com precise-security Release [55.5 kB]
Get:7 http://archive.ubuntu.com precise/main Sources [1175 kB]
Get:8 http://archive.ubuntu.com precise/restricted Sources [5306 B]
Get:9 http://archive.ubuntu.com precise/universe Sources [6239 kB]
Get:10 http://archive.ubuntu.com precise/main amd64 Packages [1640 kB]
Get:11 http://archive.ubuntu.com precise/restricted amd64 Packages [9098 B]
Get:12 http://archive.ubuntu.com precise/universe amd64 Packages [6167 kB]
Get:13 http://archive.ubuntu.com precise/main i386 Packages [1641 kB]
Get:14 http://archive.ubuntu.com precise/restricted i386 Packages [9108 B]
Get:15 http://archive.ubuntu.com precise/universe i386 Packages [6180 kB]
Get:16 http://archive.ubuntu.com precise-updates/main Sources [607 kB]
Get:17 http://archive.ubuntu.com precise-updates/restricted Sources [8938 B]
Get:18 http://archive.ubuntu.com precise-updates/universe Sources [152 kB]
Get:19 http://archive.ubuntu.com precise-updates/main amd64 Packages [1265 kB]
Get:20 http://archive.ubuntu.com precise-updates/restricted amd64 Packages [24.0 kB]
Get:21 http://archive.ubuntu.com precise-updates/universe amd64 Packages [350 kB]
Get:22 http://archive.ubuntu.com precise-updates/main i386 Packages [1342 kB]
Get:23 http://archive.ubuntu.com precise-updates/restricted i386 Packages [24.0 kB]
Get:24 http://archive.ubuntu.com precise-updates/universe i386 Packages [361 kB]
Get:25 http://archive.ubuntu.com precise-security/main Sources [177 kB]
Get:26 http://archive.ubuntu.com precise-security/restricted Sources [4320 B]
Get:27 http://archive.ubuntu.com precise-security/universe Sources [52.5 kB]
Get:28 http://archive.ubuntu.com precise-security/main amd64 Packages [763 kB]
Get:29 http://archive.ubuntu.com precise-security/restricted amd64 Packages [18.3 kB]
Get:30 http://archive.ubuntu.com precise-security/universe amd64 Packages [165 kB]
Get:31 http://archive.ubuntu.com precise-security/main i386 Packages [838 kB]
Get:32 http://archive.ubuntu.com precise-security/restricted i386 Packages [18.3 kB]
Get:33 http://archive.ubuntu.com precise-security/universe i386 Packages [174 kB]
Fetched 29.6 MB in 13s (2238 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
The following packages will be upgraded:
  cpio
1 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 116 kB of archives.
After this operation, 0 B of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu/ precise-updates/main cpio amd64 2.11-7ubuntu3.2 [116 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 116 kB in 0s (139 kB/s)
(Reading database ... 17508 files and directories currently installed.)
Preparing to replace cpio 2.11-7ubuntu3.1 (using .../cpio_2.11-7ubuntu3.2_amd64.deb) ...
Unpacking replacement cpio ...
Setting up cpio (2.11-7ubuntu3.2) ...
 ---> 06137ba79203
Removing intermediate container 7d5d63b8b683
Successfully built 06137ba79203

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test197`

Contents of dockerfile `/root/docker-node/.~tmp.test197/Dockerfile`:

```
FROM nodesource/precise:5.7.0
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/precise:5.7.0-test1` from `/root/docker-node/.~tmp.test197`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/precise:5.7.0
 ---> 06137ba79203
Step 2 : ENV NODE_ENV test
 ---> Running in 2125a6a94ad3
 ---> e919e84b9e62
Removing intermediate container 2125a6a94ad3
Step 3 : RUN node -v
 ---> Running in 00fee362d7f6
v5.7.0
 ---> 0f9bca268dae
Removing intermediate container 00fee362d7f6
Step 4 : RUN node -p "process.versions"
 ---> Running in d52583a5677a
{ http_parser: '2.6.2',
  node: '5.7.0',
  v8: '4.6.85.31',
  uv: '1.8.0',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  icu: '56.1',
  modules: '47',
  openssl: '1.0.2f' }
 ---> 4efc2132bb00
Removing intermediate container d52583a5677a
Step 5 : RUN npm --version
 ---> Running in d69091d0222f
3.6.0
 ---> e562c40e54da
Removing intermediate container d69091d0222f
Successfully built e562c40e54da

```

# Tested image `nodesource/precise:0.12.9`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/precise-base
 ---> 862e1a9b72ce
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in d84baa5177a4
 ---> 01587be69d94
Removing intermediate container d84baa5177a4
Step 3 : RUN curl https://deb.nodesource.com/node_0.12/pool/main/n/nodejs/nodejs_0.12.9-1nodesource1~precise1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in a3350e0f4cb0
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
[0m[91m  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m 46 9382k   46 4335k    0     0  5530k      0  0:00:01 --:--:--  0:00:01 5742k[0m[91m100 9382k  100 9382k    0     0  8831k      0  0:00:01  0:00:01 --:--:-- 9091k
[0mSelecting previously unselected package nodejs.
(Reading database ... 14044 files and directories currently installed.)
Unpacking nodejs (from node.deb) ...
Setting up nodejs (0.12.9-1nodesource1~precise1) ...
 ---> 3c403c30f491
Removing intermediate container a3350e0f4cb0
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in fb05080f0ef3
[91mnpm[0m[91m [0m[91mWARN [0m[91mdeprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm [0m[91mWARN deprecated[0m[91m graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, forever-agent@0.5.2, aws-sign2@0.5.0, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, tough-cookie@2.2.1, combined-stream@0.0.7, bl@0.9.5, http-signature@0.10.1, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m info[0m[91m [0m[91mit worked if it ends with ok
[0m[91mgyp info using[0m[91m pangyp@2.3.3
[0m[91mgyp info using node@0.12.9 | linux | x64
[0m[91mgyp[0m[91m http GET http://nodejs.org/dist/v0.12.9/node-v0.12.9.tar.gz
[0m[91mgyp [0m[91mhttp 200[0m[91m http://nodejs.org/dist/v0.12.9/node-v0.12.9.tar.gz
[0m[91mgyp http [0m[91mGET http://nodejs.org/dist/v0.12.9/SHASUMS256.txt
[0m[91mgyp http 200 http://nodejs.org/dist/v0.12.9/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp[0m[91m info[0m[91m spawn args[0m[91m [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
[0m[91mgyp info [0m[91mspawn args   'binding.gyp',
[0m[91mgyp [0m[91minfo spawn args[0m[91m   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info [0m[91mspawn args   '-I',
[0m[91mgyp [0m[91minfo spawn args[0m[91m   '/root/.node-gyp/0.12.9/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/0.12.9',
gyp info spawn args[0m[91m   '-Druntime=node',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp info spawn args   '--depth=.',
gyp info[0m[91m spawn args[0m[91m   '--no-parallel',
gyp info spawn args   '--generator-output',
[0m[91mgyp[0m[91m [0m[91minfo[0m[91m spawn args   'build',
[0m[91mgyp info [0m[91mspawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp ERR! [0m[91mconfigure error 
[0m[91mgyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! [0m[91mstack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
[0m[91mgyp[0m[91m ERR! [0m[91mstack     at ChildProcess.emit (events.js:110:17)
[0m[91mgyp ERR! stack     at Process.ChildProcess._handle.onexit (child_process.js:1075:12)
[0m[91mgyp ERR! System Linux 3.13.0-79-generic
[0m[91mgyp ERR![0m[91m command "node" "/usr/bin/node-gyp" "configure"
[0m[91mgyp ERR! cwd /
gyp ERR! node -v v0.12.9
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> a33acd2c20cb
Removing intermediate container fb05080f0ef3
Step 5 : ENV NODE_ENV production
 ---> Running in 204c6f32fe2d
 ---> 054561420ca4
Removing intermediate container 204c6f32fe2d
Step 6 : WORKDIR /usr/src/app
 ---> Running in da08d63685d9
 ---> e99a74627099
Removing intermediate container da08d63685d9
Step 7 : CMD npm start
 ---> Running in 3bf87c4e6f48
 ---> deb8e5470dc8
Removing intermediate container 3bf87c4e6f48
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 26ca65747ea6
Get:1 http://archive.ubuntu.com precise Release.gpg [198 B]
Get:2 http://archive.ubuntu.com precise-updates Release.gpg [198 B]
Get:3 http://archive.ubuntu.com precise-security Release.gpg [198 B]
Get:4 http://archive.ubuntu.com precise Release [49.6 kB]
Get:5 http://archive.ubuntu.com precise-updates Release [55.4 kB]
Get:6 http://archive.ubuntu.com precise-security Release [55.5 kB]
Get:7 http://archive.ubuntu.com precise/main Sources [1175 kB]
Get:8 http://archive.ubuntu.com precise/restricted Sources [5306 B]
Get:9 http://archive.ubuntu.com precise/universe Sources [6239 kB]
Get:10 http://archive.ubuntu.com precise/main amd64 Packages [1640 kB]
Get:11 http://archive.ubuntu.com precise/restricted amd64 Packages [9098 B]
Get:12 http://archive.ubuntu.com precise/universe amd64 Packages [6167 kB]
Get:13 http://archive.ubuntu.com precise/main i386 Packages [1641 kB]
Get:14 http://archive.ubuntu.com precise/restricted i386 Packages [9108 B]
Get:15 http://archive.ubuntu.com precise/universe i386 Packages [6180 kB]
Get:16 http://archive.ubuntu.com precise-updates/main Sources [607 kB]
Get:17 http://archive.ubuntu.com precise-updates/restricted Sources [8938 B]
Get:18 http://archive.ubuntu.com precise-updates/universe Sources [152 kB]
Get:19 http://archive.ubuntu.com precise-updates/main amd64 Packages [1265 kB]
Get:20 http://archive.ubuntu.com precise-updates/restricted amd64 Packages [24.0 kB]
Get:21 http://archive.ubuntu.com precise-updates/universe amd64 Packages [350 kB]
Get:22 http://archive.ubuntu.com precise-updates/main i386 Packages [1342 kB]
Get:23 http://archive.ubuntu.com precise-updates/restricted i386 Packages [24.0 kB]
Get:24 http://archive.ubuntu.com precise-updates/universe i386 Packages [361 kB]
Get:25 http://archive.ubuntu.com precise-security/main Sources [177 kB]
Get:26 http://archive.ubuntu.com precise-security/restricted Sources [4320 B]
Get:27 http://archive.ubuntu.com precise-security/universe Sources [52.5 kB]
Get:28 http://archive.ubuntu.com precise-security/main amd64 Packages [763 kB]
Get:29 http://archive.ubuntu.com precise-security/restricted amd64 Packages [18.3 kB]
Get:30 http://archive.ubuntu.com precise-security/universe amd64 Packages [165 kB]
Get:31 http://archive.ubuntu.com precise-security/main i386 Packages [838 kB]
Get:32 http://archive.ubuntu.com precise-security/restricted i386 Packages [18.3 kB]
Get:33 http://archive.ubuntu.com precise-security/universe i386 Packages [174 kB]
Fetched 29.6 MB in 14s (2039 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
The following packages will be upgraded:
  cpio
1 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 116 kB of archives.
After this operation, 0 B of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu/ precise-updates/main cpio amd64 2.11-7ubuntu3.2 [116 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 116 kB in 0s (137 kB/s)
(Reading database ... 16625 files and directories currently installed.)
Preparing to replace cpio 2.11-7ubuntu3.1 (using .../cpio_2.11-7ubuntu3.2_amd64.deb) ...
Unpacking replacement cpio ...
Setting up cpio (2.11-7ubuntu3.2) ...
 ---> 255fc9c2a167
Removing intermediate container 26ca65747ea6
Successfully built 255fc9c2a167

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test199`

Contents of dockerfile `/root/docker-node/.~tmp.test199/Dockerfile`:

```
FROM nodesource/precise:0.12.9
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/precise:0.12.9-test1` from `/root/docker-node/.~tmp.test199`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/precise:0.12.9
 ---> 255fc9c2a167
Step 2 : ENV NODE_ENV test
 ---> Running in 9d73356082d6
 ---> e1a57ddf1732
Removing intermediate container 9d73356082d6
Step 3 : RUN node -v
 ---> Running in 776cc319f4fe
v0.12.9
 ---> bf8e2496d3fd
Removing intermediate container 776cc319f4fe
Step 4 : RUN node -p "process.versions"
 ---> Running in ad0d8514f0ad
{ http_parser: '2.3',
  node: '0.12.9',
  v8: '3.28.71.19',
  uv: '1.6.1',
  zlib: '1.2.8',
  modules: '14',
  openssl: '1.0.1q' }
 ---> 4ec5831e0cd6
Removing intermediate container ad0d8514f0ad
Step 5 : RUN npm --version
 ---> Running in a5ab9ce5986b
2.14.9
 ---> 032ea0b9039f
Removing intermediate container a5ab9ce5986b
Successfully built 032ea0b9039f

```

# Tested image `nodesource/sid:iojs-2.3.2`

## Build Log

```
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM nodesource/sid-base
 ---> ef8990438980
Step 2 : MAINTAINER William Blankenship <wblankenship@nodesource.com>
 ---> Running in 5291843b83ad
 ---> 256b76a81972
Removing intermediate container 5291843b83ad
Step 3 : RUN curl https://deb.nodesource.com/iojs_2.x/pool/main/i/iojs/iojs_2.3.2-1nodesource1~sid1_amd64.deb > node.deb  && dpkg -i node.deb  && rm node.deb
 ---> Running in 56c1f21f6fba
[91m  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0[0m[91m  3 5986k    3  191k    0     0   185k      0  0:00:32  0:00:01  0:00:31  185k[0m[91m100 5986k  100 5986k    0     0  4113k      0  0:00:01  0:00:01 --:--:-- 4114k
[0mSelecting previously unselected package iojs.
(Reading database ... 16183 files and directories currently installed.)
Preparing to unpack node.deb ...
Unpacking iojs (2.3.2-1nodesource1~sid1) ...
Setting up iojs (2.3.2-1nodesource1~sid1) ...
 ---> c82da15404e3
Removing intermediate container 56c1f21f6fba
Step 4 : RUN npm install -g pangyp && ln -s $(which pangyp) $(dirname $(which pangyp))/node-gyp && npm cache clear && node-gyp configure || echo ""
 ---> Running in bee85c64e6e2
[91mnpm WARN deprecated pangyp@2.3.3: use node-gyp@3+ instead
[0m[91mnpm WARN deprecated graceful-fs@3.0.8: graceful-fs version 3 and before will fail on newer node releases. Please update to graceful-fs@^4.0.0 as soon as possible.
[0m/usr/bin/pangyp -> /usr/lib/node_modules/pangyp/bin/node-gyp.js
pangyp@2.3.3 /usr/lib/node_modules/pangyp
â”œâ”€â”€ which@1.0.9
â”œâ”€â”€ rimraf@2.2.8
â”œâ”€â”€ graceful-fs@3.0.8
â”œâ”€â”€ semver@4.3.6
â”œâ”€â”€ osenv@0.1.3 (os-homedir@1.0.1, os-tmpdir@1.0.1)
â”œâ”€â”€ nopt@3.0.6 (abbrev@1.0.7)
â”œâ”€â”€ fstream@1.0.8 (inherits@2.0.1, graceful-fs@4.1.3)
â”œâ”€â”€ mkdirp@0.5.1 (minimist@0.0.8)
â”œâ”€â”€ glob@4.3.5 (inherits@2.0.1, once@1.3.3, inflight@1.0.4)
â”œâ”€â”€ tar@1.0.3 (inherits@2.0.1, block-stream@0.0.8)
â”œâ”€â”€ minimatch@2.0.10 (brace-expansion@1.1.3)
â”œâ”€â”€ npmlog@1.0.0 (ansi@0.3.1, gauge@1.0.2, are-we-there-yet@1.0.6)
â””â”€â”€ request@2.51.0 (caseless@0.8.0, aws-sign2@0.5.0, forever-agent@0.5.2, stringstream@0.0.5, oauth-sign@0.5.0, tunnel-agent@0.4.2, json-stringify-safe@5.0.1, qs@2.3.3, node-uuid@1.4.7, mime-types@1.0.2, combined-stream@0.0.7, tough-cookie@2.2.1, http-signature@0.10.1, bl@0.9.5, form-data@0.2.0, hawk@1.1.1)
[91mgyp[0m[91m [0m[91minfo it worked if it ends with ok
[0m[91mgyp [0m[91minfo using pangyp@2.3.3
gyp info using node@2.3.2 | linux | x64
[0m[91mgyp http GET https://iojs.org/dist/v2.3.2/iojs-v2.3.2.tar.gz
[0m[91mgyp http 200 https://iojs.org/dist/v2.3.2/iojs-v2.3.2.tar.gz
[0m[91mgyp[0m[91m [0m[91mhttp GET[0m[91m https://iojs.org/dist/v2.3.2/SHASUMS256.txt
[0m[91mgyp http 200 https://iojs.org/dist/v2.3.2/SHASUMS256.txt
[0m[91mgyp info spawn python
[0m[91mgyp info spawn args [ '/usr/lib/node_modules/pangyp/gyp/gyp_main.py',
gyp info spawn args   'binding.gyp',
gyp info spawn args   '-f',
gyp info spawn args   'make',
gyp info spawn args   '-I',
gyp info spawn args   '/build/config.gypi',
gyp info spawn args   '-I',
gyp info spawn args   '/usr/lib/node_modules/pangyp/addon.gypi',
gyp info spawn args   '-I',
gyp [0m[91minfo spawn args   '/root/.node-gyp/2.3.2/common.gypi',
gyp info spawn args   '-Dlibrary=shared_library',
gyp info spawn args   '-Dvisibility=default',
gyp info spawn args   '-Dnode_root_dir=/root/.node-gyp/2.3.2',
gyp info spawn args   '-Druntime=iojs',
gyp info spawn args   '-Dmodule_root_dir=/',
gyp [0m[91minfo [0m[91mspawn args   '--depth=.',
gyp info spawn args   '--no-parallel',
gyp info spawn args   '--generator-output',
gyp [0m[91minfo spawn args[0m[91m   'build',
[0m[91mgyp info spawn args   '-Goutput_dir=.' ]
[0m[91mgyp: binding.gyp not found (cwd: /) while trying to load binding.gyp
[0m[91mgyp [0m[91mERR! configure error 
gyp ERR! stack Error: `gyp` failed with exit code: 1
gyp ERR! stack     at ChildProcess.onCpExit (/usr/lib/node_modules/pangyp/lib/configure.js:346:16)
gyp ERR! stack     at emitTwo (events.js:87:13)
gyp ERR! stack     at ChildProcess.emit (events.js:172:7)
gyp ERR! stack     at Process.ChildProcess._handle.onexit (internal/child_process.js:200:12)
gyp ERR! System Linux 3.13.0-79-generic
gyp ERR! command "/usr/bin/iojs" "/usr/bin/node-gyp" "configure"
gyp ERR! cwd /
gyp ERR! node -v v2.3.2
gyp ERR! pangyp -v v2.3.3
gyp ERR! not ok 
[0m
 ---> f2e6b8afd335
Removing intermediate container bee85c64e6e2
Step 5 : ENV NODE_ENV production
 ---> Running in e3ca297a7544
 ---> e613ce32a107
Removing intermediate container e3ca297a7544
Step 6 : WORKDIR /usr/src/app
 ---> Running in ab4ca31a3bfa
 ---> e03b1845dc24
Removing intermediate container ab4ca31a3bfa
Step 7 : CMD npm start
 ---> Running in 2f15ba3fd0f9
 ---> ba2a28ab0ac4
Removing intermediate container 2f15ba3fd0f9
Step 8 : RUN apt-get update  && apt-get upgrade -y --force-yes  && rm -rf /var/lib/apt/lists/*;
 ---> Running in 681fc5d729cd
Get:1 http://mirrors.namecheap.com/debian sid InRelease [287 kB]
Get:2 http://mirrors.namecheap.com/debian sid/main amd64 Packages [10.8 MB]
Fetched 11.1 MB in 3s (3615 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
The following packages will be upgraded:
  dmsetup hostname iproute2 libc-bin libdebconfclient0 libdevmapper1.02.1
  liblz4-1 libncurses5 libncursesw5 libtinfo5 multiarch-support ncurses-base
  ncurses-bin
13 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
Need to get 2921 kB of archives.
After this operation, 11.3 kB of additional disk space will be used.
Get:1 http://mirrors.cat.pdx.edu/debian sid/main amd64 hostname amd64 3.17 [14.2 kB]
Get:2 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-bin amd64 6.0+20160213-1 [354 kB]
Get:3 http://mirrors.cat.pdx.edu/debian sid/main amd64 libc-bin amd64 2.21-9 [761 kB]
Get:4 http://mirrors.cat.pdx.edu/debian sid/main amd64 ncurses-base all 6.0+20160213-1 [233 kB]
Get:5 http://mirrors.cat.pdx.edu/debian sid/main amd64 libtinfo5 amd64 6.0+20160213-1 [293 kB]
Get:6 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncurses5 amd64 6.0+20160213-1 [94.3 kB]
Get:7 http://mirrors.cat.pdx.edu/debian sid/main amd64 libncursesw5 amd64 6.0+20160213-1 [115 kB]
Get:8 http://mirrors.cat.pdx.edu/debian sid/main amd64 multiarch-support amd64 2.21-9 [187 kB]
Get:9 http://mirrors.cat.pdx.edu/debian sid/main amd64 dmsetup amd64 2:1.02.116-1 [93.2 kB]
Get:10 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdevmapper1.02.1 amd64 2:1.02.116-1 [179 kB]
Get:11 http://mirrors.cat.pdx.edu/debian sid/main amd64 libdebconfclient0 amd64 0.206 [47.3 kB]
Get:12 http://mirrors.cat.pdx.edu/debian sid/main amd64 liblz4-1 amd64 0.0~r131-2 [32.5 kB]
Get:13 http://mirrors.cat.pdx.edu/debian sid/main amd64 iproute2 amd64 4.3.0-1+b1 [516 kB]
[91mdebconf: delaying package configuration, since apt-utils is not installed
[0mFetched 2921 kB in 1s (2322 kB/s)
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../hostname_3.17_amd64.deb ...
Unpacking hostname (3.17) over (3.16) ...
Setting up hostname (3.17) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../ncurses-bin_6.0+20160213-1_amd64.deb ...
Unpacking ncurses-bin (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-bin (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libc-bin_2.21-9_amd64.deb ...
Unpacking libc-bin (2.21-9) over (2.21-8) ...
Setting up libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../ncurses-base_6.0+20160213-1_all.deb ...
Unpacking ncurses-base (6.0+20160213-1) over (6.0+20151024-2) ...
Setting up ncurses-base (6.0+20160213-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libtinfo5_6.0+20160213-1_amd64.deb ...
Unpacking libtinfo5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libtinfo5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libncurses5_6.0+20160213-1_amd64.deb ...
Unpacking libncurses5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncurses5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libncursesw5_6.0+20160213-1_amd64.deb ...
Unpacking libncursesw5:amd64 (6.0+20160213-1) over (6.0+20151024-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libncursesw5:amd64 (6.0+20160213-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../multiarch-support_2.21-9_amd64.deb ...
Unpacking multiarch-support (2.21-9) over (2.21-8) ...
Setting up multiarch-support (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../dmsetup_2%3a1.02.116-1_amd64.deb ...
Unpacking dmsetup (2:1.02.116-1) over (2:1.02.115-2) ...
Setting up dmsetup (2:1.02.116-1) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libdevmapper1.02.1_2%3a1.02.116-1_amd64.deb ...
Unpacking libdevmapper1.02.1:amd64 (2:1.02.116-1) over (2:1.02.115-2) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdevmapper1.02.1:amd64 (2:1.02.116-1) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../libdebconfclient0_0.206_amd64.deb ...
Unpacking libdebconfclient0:amd64 (0.206) over (0.205) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up libdebconfclient0:amd64 (0.206) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../liblz4-1_0.0~r131-2_amd64.deb ...
Unpacking liblz4-1:amd64 (0.0~r131-2) over (0.0~r131-1) ...
Processing triggers for libc-bin (2.21-9) ...
Setting up liblz4-1:amd64 (0.0~r131-2) ...
Processing triggers for libc-bin (2.21-9) ...
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 18570 files and directories currently installed.)
Preparing to unpack .../iproute2_4.3.0-1+b1_amd64.deb ...
Unpacking iproute2 (4.3.0-1+b1) over (4.3.0-1) ...
Setting up iproute2 (4.3.0-1+b1) ...
[91mW: --force-yes is deprecated, use one of the options starting with --allow instead.
[0m ---> eb7662d0eba7
Removing intermediate container 681fc5d729cd
Successfully built eb7662d0eba7

```

Array of tests: `[./tests/node]`

## Running test #0

Copying `/root/docker-node/tests/node` to `/root/docker-node/.~tmp.test194`

Contents of dockerfile `/root/docker-node/.~tmp.test194/Dockerfile`:

```
FROM nodesource/sid:iojs-2.3.2
ENV NODE_ENV test

RUN node -v
RUN node -p "process.versions"
RUN npm --version

```

Building `nodesource/sid:iojs-2.3.2-test1` from `/root/docker-node/.~tmp.test194`

```
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nodesource/sid:iojs-2.3.2
 ---> eb7662d0eba7
Step 2 : ENV NODE_ENV test
 ---> Running in c4663c3ebb93
 ---> adce980f8042
Removing intermediate container c4663c3ebb93
Step 3 : RUN node -v
 ---> Running in ec6f60c16be1
v2.3.2
 ---> 0e0cbe633c94
Removing intermediate container ec6f60c16be1
Step 4 : RUN node -p "process.versions"
 ---> Running in 4aafa76bacbc
{ http_parser: '2.5.0',
  node: '2.3.2',
  v8: '4.2.77.20',
  uv: '1.6.1',
  zlib: '1.2.8',
  ares: '1.10.1-DEV',
  modules: '44',
  openssl: '1.0.2c' }
 ---> 85d54225e7f2
Removing intermediate container 4aafa76bacbc
Step 5 : RUN npm --version
 ---> Running in 5607adaaaf75
2.11.3
 ---> f24abab519c1
Removing intermediate container 5607adaaaf75
Successfully built f24abab519c1

```

